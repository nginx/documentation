<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>OAuth2 Introspection with Keycloak | DEV -- docs-nginx-com</title>


<meta name="description" content="Learn how to set up an F5 NGINX Management Suite API Connectivity Manager OAuth2 Introspection policy with Keycloak as the authorization server.">





<link rel="canonical" href="http://localhost:1313/nginx-management-suite/acm/tutorials/introspection-keycloak/">






<meta name="robots" content="noindex,nofollow" />


<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Learn how to set up an F5 NGINX Management Suite API Connectivity Manager OAuth2 Introspection policy with Keycloak as the authorization server." />
<meta name="twitter:title" content="OAuth2 Introspection with Keycloak" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="01/04/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/">F5 NGINX Management Suite</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/acm/">API Connectivity Manager</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/acm/tutorials/">Tutorials</a><i class="fas fa-chevron-right"></i></li>
                
            
                OAuth2 Introspection with Keycloak
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx-management-suite/acm/tutorials/introspection-keycloak/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx-management-suite/" alt="F5 NGINX Management Suite"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-Management-Suite-product-icon.svg"
                        alt="F5 NGINX Management Suite">
                    F5 NGINX Management Suite</a>
            </h3>
            <ul>
            
            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx-management-suite/about/" href="http://localhost:1313/nginx-management-suite/about/">About</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx-management-suite/nms-resilience/" href="http://localhost:1313/nginx-management-suite/nms-resilience/">NGINX Management Suite Resiliency</a>
                </li>
                
                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-management-suite/nginx-agent/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nms--nginx-agent" aria-controls="nms--nginx-agent">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>NGINX Agent</a>
                            </li>
                        </div>
                        <div id="nms--nginx-agent" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/nginx-agent/install-nginx-agent/"
                                                                href="http://localhost:1313/nginx-management-suite/nginx-agent/install-nginx-agent/">Install and Configure NGINX Agent</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/nginx-agent/install-nginx-plus-advanced-metrics/"
                                                                href="http://localhost:1313/nginx-management-suite/nginx-agent/install-nginx-plus-advanced-metrics/">Install NGINX Plus Metrics Module for API Connectivity Manager</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-management-suite/nim/getting-started/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nms--quick-start-guides" aria-controls="nms--quick-start-guides">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Quick Start Guides</a>
                            </li>
                        </div>
                        <div id="nms--quick-start-guides" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/nim/getting-started/waf-config-management/"
                                                                href="http://localhost:1313/nginx-management-suite/nim/getting-started/waf-config-management/">WAF Configuration Management</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-management-suite/acm/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nms--api-connectivity-manager" aria-controls="nms--api-connectivity-manager">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>API Connectivity Manager</a>
                            </li>
                        </div>
                        <div id="nms--api-connectivity-manager" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/about/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--acm--about">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>About</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--acm--about" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/introduction/" href="http://localhost:1313/nginx-management-suite/acm/about/introduction/">Introduction</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/technical-specifications/" href="http://localhost:1313/nginx-management-suite/acm/about/technical-specifications/">Technical Specifications</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/api-overview/" href="http://localhost:1313/nginx-management-suite/acm/about/api-overview/">API Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/architecture/" href="http://localhost:1313/nginx-management-suite/acm/about/architecture/">Architecture Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/policies-overview/" href="http://localhost:1313/nginx-management-suite/acm/about/policies-overview/">Available Policies</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/about/rbac-roles/" href="http://localhost:1313/nginx-management-suite/acm/about/rbac-roles/">RBAC roles</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/getting-started/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--acm--getting-started-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Getting Started Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--acm--getting-started-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/getting-started/overview/" href="http://localhost:1313/nginx-management-suite/acm/getting-started/overview/">Get Started</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/getting-started/add-api-gateway/" href="http://localhost:1313/nginx-management-suite/acm/getting-started/add-api-gateway/">Set Up an API Gateway Environment</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/getting-started/add-devportal/" href="http://localhost:1313/nginx-management-suite/acm/getting-started/add-devportal/">Set Up a Developer Portal Environment</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/getting-started/publish-api-proxy/" href="http://localhost:1313/nginx-management-suite/acm/getting-started/publish-api-proxy/">Publish an API Proxy</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/how-to/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--acm--how-to-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>How-To Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--acm--how-to-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/install-acm/" href="http://localhost:1313/nginx-management-suite/acm/how-to/install-acm/">Install or Upgrade API Connectivity Manager</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/deploy-api-connectivity-manager/" href="http://localhost:1313/nginx-management-suite/acm/how-to/deploy-api-connectivity-manager/">Deploy API Connectivity Manager on Kubernetes</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nms--how-to--infrastructure">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Infrastructure</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nms--how-to--infrastructure" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/manage-api-infrastructure/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/manage-api-infrastructure/">Manage API Infrastructure</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/configure-devportal-backend/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/configure-devportal-backend/">Deployment Patterns for Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/customize-devportal/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/customize-devportal/">Customize a Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/publish-developer-portal/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/publish-developer-portal/">Publish a Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/enable-create-credentials/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/enable-create-credentials/">Enable Creating Credentials on the Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/infrastructure/enable-sso-devportal/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/enable-sso-devportal/">Enable Single Sign-On for Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/services/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nms--how-to--services">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Services</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nms--how-to--services" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/services/publish-api/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/services/publish-api/">Publish an HTTP API</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/services/publish-grpc-proxy/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/services/publish-grpc-proxy/">Publish a gRPC API Proxy</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nms--how-to--developer-portals">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Developer Portals</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nms--how-to--developer-portals" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <div class="accordion" id="Accordion4">
                                                                                <div class="sidebar-l2-padding">
                                                                                    <div class="accordion-group sidebar-il-border">
                                                                                        <div class="accordion-heading">
                                                                                            <ul>
                                                                                                <li class="nginx-toc-link l2">
                                                                                                    <a data-menu-id="/nms/acm/how-to/devportals/installation/" class="accordion-toggle"
                                                                                                        aria-expanded="false" data-toggle="collapse"
                                                                                                        href="#nms--devportals--install-the-developer-portal">
                                                                                                        <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                                            class="fa fa-2xs fa-fw fa-chevron-down"></i>Install the Developer Portal</a>
                                                                                                </li>
                                                                                            <ul>
                                                                                        </div>
                                                                                        <div id="nms--devportals--install-the-developer-portal" class="accordion-body collapse leaf">
                                                                                            <div class="accordion-inner">
                                                                                                
                                                                                                
                                                                                                
                                                                                                <ul class="sidebar-l2-padding">
                                                                                                    <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                                        <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/installation/install-dev-portal/"
                                                                                                            href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/install-dev-portal/">Install or Upgrade the Developer Portal</a>
                                                                                                    </li>
                                                                                                </ul>
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                <ul class="sidebar-l2-padding">
                                                                                                    <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                                        <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/installation/devportal-helm-chart/"
                                                                                                            href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/devportal-helm-chart/">Deploy the Developer Portal from a Helm chart</a>
                                                                                                    </li>
                                                                                                </ul>
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                <ul class="sidebar-l2-padding">
                                                                                                    <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                                        <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/installation/configure-devportal-helm-options/"
                                                                                                            href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/configure-devportal-helm-options/">Deployment Options for Developer Portal Helm</a>
                                                                                                    </li>
                                                                                                </ul>
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                
                                                                                                <ul class="sidebar-l2-padding">
                                                                                                    <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                                        <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/installation/install-devportal-offline/"
                                                                                                            href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/install-devportal-offline/">Install the Developer Portal in an Offline Environment</a>
                                                                                                    </li>
                                                                                                </ul>
                                                                                                
                                                                                                
                                                                                                
                                                                                            </div>
                                                                                        </div>
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                            
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/publish-to-devportal/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/publish-to-devportal/">Publish Docs to a Developer Portal</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/devportals/devportal-support-package/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/devportal-support-package/">Create an NGINX Developer Portal Support Package</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/policies/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nms--how-to--policies">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Policies</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nms--how-to--policies" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/manage-policies/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/manage-policies/">How to Set Up Policies</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/api-access-control-lists/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/api-access-control-lists/">API Access Control Lists</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/access-control-routing/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/access-control-routing/">Access Control Routing</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/advanced-security/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/advanced-security/">Advanced Security</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/allowed-http-methods/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/allowed-http-methods/">Allowed HTTP Methods</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/apikey-authn/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/apikey-authn/">API Key Authentication</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/basic-authn/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/basic-authn/">Basic Authentication</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/cluster-wide-config/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cluster-wide-config/">Cluster-Wide Config</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/cluster-zone-sync/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cluster-zone-sync/">Cluster Zone Sync</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/cors/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cors/">CORS</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/error-response-format/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/error-response-format/">Error Response Format</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/grpc-policies/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/grpc-policies/">gRPC</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/health-check/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/health-check/">Health Check</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/http-backend-configuration/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/http-backend-configuration/">HTTP Backend Configuration</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/log-format/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/log-format/">Log Format</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/introspection/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/introspection/">Introspection</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/jwt-assertion/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/jwt-assertion/">JWT Assertion</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/openid-connect/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/openid-connect/">OpenID Connect</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/proxy-request-headers/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-request-headers/">Proxy Request Headers</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/proxy-response-headers/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-response-headers/">Proxy Response Headers</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/request-body-size-limit/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-body-size-limit/">Request Body Size Limit</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/rate-limit/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/rate-limit/">Rate Limiting</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/request-correlation-id/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-correlation-id/">Request Correlation ID</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/request-header-specification/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-header-specification/">Request Header Specification</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/tls-policies/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/tls-policies/">TLS</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx-management-suite/acm/how-to/policies/proxy-cache/"
                                                                                        href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-cache/">Proxy Cache</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/backup-recovery/" href="http://localhost:1313/nginx-management-suite/acm/how-to/backup-recovery/">Back up and recovery</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/how-to/install-acm-offline/" href="http://localhost:1313/nginx-management-suite/acm/how-to/install-acm-offline/">Offline Installation Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/tutorials/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--acm--tutorials">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Tutorials</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--acm--tutorials" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/enable-metrics/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/enable-metrics/">Enable Metrics</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/advanced-routing/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/advanced-routing/">Set Up Advanced Routing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/rbac-api-owners/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/rbac-api-owners/">Set Up RBAC for API Owners</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/rbac-infra-admins/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/rbac-infra-admins/">Set Up RBAC for Infra Admins</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/oas-security-schemes/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/oas-security-schemes/">OAS Security Schemes</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/aws-deploy/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/aws-deploy/">Amazon Web Services Deployment Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/tutorials/introspection-keycloak/" href="http://localhost:1313/nginx-management-suite/acm/tutorials/introspection-keycloak/">OAuth2 Introspection with Keycloak</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/releases/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--acm--releases">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Releases</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--acm--releases" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/releases/release-notes/" href="http://localhost:1313/nginx-management-suite/acm/releases/release-notes/">Release Notes</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/acm/releases/known-issues/" href="http://localhost:1313/nginx-management-suite/acm/releases/known-issues/">Known Issues</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/acm/troubleshooting/"
                                                                href="http://localhost:1313/nginx-management-suite/acm/troubleshooting/">Troubleshooting</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-management-suite/reference/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nms--reference" aria-controls="nms--reference">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Reference</a>
                            </li>
                        </div>
                        <div id="nms--reference" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/reference/catalogs/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nms--reference--catalogs">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Catalogs</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nms--reference--catalogs" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/reference/catalogs/dimensions/" href="http://localhost:1313/nginx-management-suite/reference/catalogs/dimensions/">Dimensions Catalog</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/reference/catalogs/events/" href="http://localhost:1313/nginx-management-suite/reference/catalogs/events/">Events Catalog</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-management-suite/reference/catalogs/metrics/" href="http://localhost:1313/nginx-management-suite/reference/catalogs/metrics/">Metrics Catalog</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-management-suite/support/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nms--support" aria-controls="nms--support">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Support</a>
                            </li>
                        </div>
                        <div id="nms--support" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/support/support-package/"
                                                                href="http://localhost:1313/nginx-management-suite/support/support-package/">Create a Support Package</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/support/k8s-support-package/"
                                                                href="http://localhost:1313/nginx-management-suite/support/k8s-support-package/">Create a Support Package from a Helm Installation</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-management-suite/support/contact-support/"
                                                                href="http://localhost:1313/nginx-management-suite/support/contact-support/">Where to Go for Support</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx-management-suite/oss-attribution-notice/" href="http://localhost:1313/nginx-management-suite/oss-attribution-notice/">Open-Source Software Attributions</a>
                </li>
                
                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name"></div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx-management-suite/about/" style="">About </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx-management-suite/nms-resilience/" style="">NGINX Management Suite Resiliency </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-3da7fe2e8e255afd9826f43e2257b450" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-3da7fe2e8e255afd9826f43e2257b450" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        NGINX Agent 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/nginx-agent/install-nginx-agent/" style="">Install and Configure NGINX Agent </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/nginx-agent/install-nginx-plus-advanced-metrics/" style="">Install NGINX Plus Metrics Module for API Connectivity Manager </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-2db157dff885412166e87f43baa70cda" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-2db157dff885412166e87f43baa70cda" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Quick Start Guides 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/nim/getting-started/waf-config-management/" style="">WAF Configuration Management </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-84c076710e9e21294b281047c2683270" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-84c076710e9e21294b281047c2683270" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        API Connectivity Manager 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-dab506e64f1c8a8aadc860722fd7e9c3" class="toggle-checkbox" style="display: none;">
            <label for="toggle-dab506e64f1c8a8aadc860722fd7e9c3" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                About 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/introduction/" style="">Introduction </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/technical-specifications/" style="">Technical Specifications </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/api-overview/" style="">API Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/architecture/" style="">Architecture Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/policies-overview/" style="">Available Policies </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/about/rbac-roles/" style="">RBAC roles </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-3d9449ec576b1cc3f20f3548a10f1ab9" class="toggle-checkbox" style="display: none;">
            <label for="toggle-3d9449ec576b1cc3f20f3548a10f1ab9" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Getting Started Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/getting-started/overview/" style="">Get Started </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/getting-started/add-api-gateway/" style="">Set Up an API Gateway Environment </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/getting-started/add-devportal/" style="">Set Up a Developer Portal Environment </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/getting-started/publish-api-proxy/" style="">Publish an API Proxy </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-f37793f3e80da5a2719a7d0d62a9db80" class="toggle-checkbox" style="display: none;">
            <label for="toggle-f37793f3e80da5a2719a7d0d62a9db80" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                How-To Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/install-acm/" style="">Install or Upgrade API Connectivity Manager </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/deploy-api-connectivity-manager/" style="">Deploy API Connectivity Manager on Kubernetes </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-7dad90766dd65bd54eed91e31665d267" class="toggle-checkbox" style="display: none;">
            <label for="toggle-7dad90766dd65bd54eed91e31665d267" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Infrastructure 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/manage-api-infrastructure/" style="">Manage API Infrastructure </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/configure-devportal-backend/" style="">Deployment Patterns for Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/customize-devportal/" style="">Customize a Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/publish-developer-portal/" style="">Publish a Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/enable-create-credentials/" style="">Enable Creating Credentials on the Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/infrastructure/enable-sso-devportal/" style="">Enable Single Sign-On for Developer Portal </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-d3c288155e56622ef2de9dcf421c1cb7" class="toggle-checkbox" style="display: none;">
            <label for="toggle-d3c288155e56622ef2de9dcf421c1cb7" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Services 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/services/publish-api/" style="">Publish an HTTP API </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/services/publish-grpc-proxy/" style="">Publish a gRPC API Proxy </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-bb6bf9d4d9764c17e7c9dceb1897ff8d" class="toggle-checkbox" style="display: none;">
            <label for="toggle-bb6bf9d4d9764c17e7c9dceb1897ff8d" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Developer Portals 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-ebb8b3c6872b4191c7ab7782e65fa61f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-ebb8b3c6872b4191c7ab7782e65fa61f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Install the Developer Portal 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/install-dev-portal/" style="">Install or Upgrade the Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/devportal-helm-chart/" style="">Deploy the Developer Portal from a Helm chart </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/configure-devportal-helm-options/" style="">Deployment Options for Developer Portal Helm </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/installation/install-devportal-offline/" style="">Install the Developer Portal in an Offline Environment </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/publish-to-devportal/" style="">Publish Docs to a Developer Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/devportals/devportal-support-package/" style="">Create an NGINX Developer Portal Support Package </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-79f742d1c559d75e503bfb4adccab1d7" class="toggle-checkbox" style="display: none;">
            <label for="toggle-79f742d1c559d75e503bfb4adccab1d7" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Policies 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/manage-policies/" style="">How to Set Up Policies </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/api-access-control-lists/" style="">API Access Control Lists </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/access-control-routing/" style="">Access Control Routing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/advanced-security/" style="">Advanced Security </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/allowed-http-methods/" style="">Allowed HTTP Methods </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/apikey-authn/" style="">API Key Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/basic-authn/" style="">Basic Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cluster-wide-config/" style="">Cluster-Wide Config </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cluster-zone-sync/" style="">Cluster Zone Sync </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/cors/" style="">CORS </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/error-response-format/" style="">Error Response Format </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/grpc-policies/" style="">gRPC </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/health-check/" style="">Health Check </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/http-backend-configuration/" style="">HTTP Backend Configuration </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/log-format/" style="">Log Format </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/introspection/" style="">Introspection </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/jwt-assertion/" style="">JWT Assertion </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/openid-connect/" style="">OpenID Connect </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-request-headers/" style="">Proxy Request Headers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-response-headers/" style="">Proxy Response Headers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-body-size-limit/" style="">Request Body Size Limit </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/rate-limit/" style="">Rate Limiting </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-correlation-id/" style="">Request Correlation ID </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/request-header-specification/" style="">Request Header Specification </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/tls-policies/" style="">TLS </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/proxy-cache/" style="">Proxy Cache </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/backup-recovery/" style="">Back up and recovery </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/how-to/install-acm-offline/" style="">Offline Installation Guide </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-278389db56cb023734f4ba2e52b1b91a" class="toggle-checkbox" style="display: none;">
            <label for="toggle-278389db56cb023734f4ba2e52b1b91a" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Tutorials 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/enable-metrics/" style="">Enable Metrics </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/advanced-routing/" style="">Set Up Advanced Routing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/rbac-api-owners/" style="">Set Up RBAC for API Owners </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/rbac-infra-admins/" style="">Set Up RBAC for Infra Admins </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/oas-security-schemes/" style="">OAS Security Schemes </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/aws-deploy/" style="">Amazon Web Services Deployment Guide </a>
            
        
    </li>
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx-management-suite/acm/tutorials/introspection-keycloak/" style="font-weight: bold;">OAuth2 Introspection with Keycloak </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#what-is-oauth2">What is OAuth2?</a></li>
    <li><a href="#before-you-begin">Before You Begin</a></li>
    <li><a href="#host-setup">Host Setup</a>
      <ul>
        <li><a href="#install-nsm-acm">Install NGINX Management Suite &amp; API Connectivity Manager</a></li>
        <li><a href="#install-agent">Install NGINX Agent on Data Plane Host</a></li>
        <li><a href="#install-echo-server">Install Echo Server</a></li>
        <li><a href="#install-auth-server">Install Authorization Server</a></li>
      </ul>
    </li>
    <li><a href="#configure-keycloak">Configure Keycloak</a>
      <ul>
        <li><a href="#accessing-the-keycloak-ui">Accessing the Keycloak UI</a></li>
        <li><a href="#configure-realm">Configure a Realm</a></li>
        <li><a href="#configure-user">Configure a User</a></li>
        <li><a href="#configure-client">Configure a Client</a></li>
        <li><a href="#configure-custom-role">Configure a Custom Role</a></li>
      </ul>
    </li>
    <li><a href="#test-oauth2-token-introspection">Test OAuth2 Token Introspection</a>
      <ul>
        <li><a href="#get-keycloak-introspection-endpoints">Get the Keycloak Token Introspection Endpoints</a></li>
        <li><a href="#generate-user-access-token">Generate a User Access Token</a></li>
        <li><a href="#introspect-token-test">Introspecting a User Access Token</a></li>
      </ul>
    </li>
    <li><a href="#amc-config">Configure API Connectivity Manager</a>
      <ul>
        <li><a href="#create-workspace-environment">Creating Workspaces &amp; Environment</a></li>
        <li><a href="#create-basic-api-proxy">Create a Basic API Proxy</a></li>
        <li><a href="#upsert-oauth2-introspection-policy">Upsert OAuth2 Introspection Policy</a></li>
        <li><a href="#test-introspection-policy">Testing the Introspection Policy</a></li>
        <li><a href="#custom-token-placement-key">Custom Token Placement &amp; Key</a></li>
        <li><a href="#token-caching">Token Caching</a></li>
        <li><a href="#oauth2-server-hostname-resolution">OAuth2 Server Hostname Resolution</a></li>
        <li><a href="#forwarding-token-claims">Forwarding Token Claims in Proxy Header</a></li>
        <li><a href="#verifying-token-claims">Verifying Introspected Token Claim Values</a></li>
        <li><a href="#custom-error-return-codes">Custom Error Return Codes</a></li>
        <li><a href="#introspection-jwt-response-type--token-forwarding">Introspection JWT Response Type &amp; Token Forwarding</a></li>
        <li><a href="#opaque-tokens">Opaque Tokens</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-8f9ffca15ca4a0772aa29746155a57fc" class="toggle-checkbox" style="display: none;">
            <label for="toggle-8f9ffca15ca4a0772aa29746155a57fc" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Releases 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/releases/release-notes/" style="">Release Notes </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/releases/known-issues/" style="">Known Issues </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/acm/troubleshooting/" style="">Troubleshooting </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-7a9c917f98a41b8461742e4c804efb87" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-7a9c917f98a41b8461742e4c804efb87" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Reference 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-56f6a237d4a72d52d673a2eb1dc3b4d3" class="toggle-checkbox" style="display: none;">
            <label for="toggle-56f6a237d4a72d52d673a2eb1dc3b4d3" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Catalogs 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/reference/catalogs/dimensions/" style="">Dimensions Catalog </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/reference/catalogs/events/" style="">Events Catalog </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/reference/catalogs/metrics/" style="">Metrics Catalog </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-ab4ef6810d71ada10f4c6ff68abe9f49" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-ab4ef6810d71ada10f4c6ff68abe9f49" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Support 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/support/support-package/" style="">Create a Support Package </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/support/k8s-support-package/" style="">Create a Support Package from a Helm Installation </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-management-suite/support/contact-support/" style="">Where to Go for Support </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx-management-suite/oss-attribution-notice/" style="">Open-Source Software Attributions </a> 
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/">F5 NGINX Management Suite</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/acm/">API Connectivity Manager</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-management-suite/acm/tutorials/">Tutorials</a><i class="fas fa-chevron-right"></i></li>
                
            
                OAuth2 Introspection with Keycloak
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>OAuth2 Introspection with Keycloak</h1>
        <h2 
id="overview">Overview  <a class="headerlink float-right" href="#overview" title="Overview"><i class="fas fa-link fa-xs"></i></a>
</h2><p>This tutorial walks through configuring an OAuth2 Introspection policy on an API Proxy in API Connectivity Manager with Keycloak as the authorization server.</p>
<blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> The configuration presented in this guide is for demonstration purposes only. The secure configuration of Environments and Proxies in API Connectivity Manager, or the secure configuration of Keycloak as the authorization server, is not in scope for this tutorial and should be given full attention when planning for production use.</div>
</blockquote>

<blockquote class="tip">
  <div><strong>See Also:</strong><br/> See the <a href="http://localhost:1313/nginx-management-suite/acm/how-to/policies/introspection/" target="_blank" rel="noopener">OAuth2 Introspection Policy</a> reference guide for a detailed overview of the policy.</div>
</blockquote>

<hr>
<h2 
id="what-is-oauth2">What is OAuth2?  <a class="headerlink float-right" href="#what-is-oauth2" title="What is OAuth2?"><i class="fas fa-link fa-xs"></i></a>
</h2><p>The <em>OAuth2 Authorization Framework</em> <a href="https://www.rfc-editor.org/rfc/rfc6749" target="_blank" rel="noopener">[RFC-6749]</a> grants third-party applications limited access to an HTTP service either by orchestrating an approval interaction between the resource owner and the HTTP service or granting the third-party application access on its own behalf.</p>
<p>OAuth2 is an authorization protocol, not an authentication protocol. As such, OAuth2 grants access to a set of resources, for example, internal APIs or user data.</p>
<!-- Do not remove. Keep this code at the bottom of the include -->
<!-- DOCS-1023 -->
<hr>
<h2 
id="before-you-begin">Before You Begin  <a class="headerlink float-right" href="#before-you-begin" title="Before You Begin"><i class="fas fa-link fa-xs"></i></a>
</h2><p>To complete the instructions in this guide, you need the following:</p>
<ul>
<li>
<p>Access to a virtual environment</p>
</li>
<li>
<p>Four virtual hosts with Linux installed - this guide uses <a href="https://releases.ubuntu.com/focal/" target="_blank" rel="noopener">Ubuntu 20.04 LTS</a>.</p>
 <details close>
 <summary><i class="fa-solid fa-circle-info"></i> Supported Linux distributions</summary>
<p>The following table lists the Linux distributions supported by NGINX Instance Manager and NGINX App Protect:</p>
   
   
   
   
   
   <table class="table table-striped table-bordered table-v1">
     <thead>
         <tr>
             <th style="text-align: left">Distribution</th>
             <th style="text-align: left">Version</th>
             <th style="text-align: left">Architecture</th>
             <th style="text-align: left">NGINX Instance Manager Support</th>
             <th style="text-align: left">NGINX App Protect Support</th>
         </tr>
     </thead>
     <tbody>
         <tr>
             <td style="text-align: left">Amazon Linux</td>
             <td style="text-align: left">2 LTS</td>
             <td style="text-align: left">x86_64</td>
             <td style="text-align: left">Supported</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.18.0</strong></td>
         </tr>
         <tr>
             <td style="text-align: left">CentOS</td>
             <td style="text-align: left">7.4 and later in the 7.x family</td>
             <td style="text-align: left">x86_64</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.17.0</strong></td>
             <td style="text-align: left">Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Debian</td>
             <td style="text-align: left">11<hr>12</td>
             <td style="text-align: left">x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.13.0+</td>
             <td style="text-align: left">Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Oracle Linux</td>
             <td style="text-align: left">7.4 and later in the 7.x family<hr>8.0 and later in the 8.x family</td>
             <td style="text-align: left">x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.6.0+</td>
             <td style="text-align: left">Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">RHEL</td>
             <td style="text-align: left">7.4 and later in the 7.x family<hr>8.x and later in the 8.x family<hr>9.x and later in the 9.x family</td>
             <td style="text-align: left">x86_64<hr>x86_64<hr>x86_64</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.17.0</strong><hr>Supported<hr>Supported on 2.6.0+</td>
             <td style="text-align: left">Supported<hr>Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Ubuntu</td>
             <td style="text-align: left">20.04<hr>22.04<hr>24.04</td>
             <td style="text-align: left">x86_64<hr>x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.3.0+<hr>Supported on 2.18.0+</td>
             <td style="text-align: left">Supported<hr>Supported<hr>Supported</td>
         </tr>
     </tbody>
   </table>
   
   
   
   
   
   
     
   
   
   <div data-mf="true" style="display: none;" class="table-v2 table table-striped table-bordered narrow">
       <table>
     <thead>
         <tr>
             <th style="text-align: left">Distribution</th>
             <th style="text-align: left">Version</th>
             <th style="text-align: left">Architecture</th>
             <th style="text-align: left">NGINX Instance Manager Support</th>
             <th style="text-align: left">NGINX App Protect Support</th>
         </tr>
     </thead>
     <tbody>
         <tr>
             <td style="text-align: left">Amazon Linux</td>
             <td style="text-align: left">2 LTS</td>
             <td style="text-align: left">x86_64</td>
             <td style="text-align: left">Supported</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.18.0</strong></td>
         </tr>
         <tr>
             <td style="text-align: left">CentOS</td>
             <td style="text-align: left">7.4 and later in the 7.x family</td>
             <td style="text-align: left">x86_64</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.17.0</strong></td>
             <td style="text-align: left">Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Debian</td>
             <td style="text-align: left">11<hr>12</td>
             <td style="text-align: left">x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.13.0+</td>
             <td style="text-align: left">Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Oracle Linux</td>
             <td style="text-align: left">7.4 and later in the 7.x family<hr>8.0 and later in the 8.x family</td>
             <td style="text-align: left">x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.6.0+</td>
             <td style="text-align: left">Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">RHEL</td>
             <td style="text-align: left">7.4 and later in the 7.x family<hr>8.x and later in the 8.x family<hr>9.x and later in the 9.x family</td>
             <td style="text-align: left">x86_64<hr>x86_64<hr>x86_64</td>
             <td style="text-align: left"><strong>Support discontinued as of 2.17.0</strong><hr>Supported<hr>Supported on 2.6.0+</td>
             <td style="text-align: left">Supported<hr>Supported<hr>Supported</td>
         </tr>
         <tr>
             <td style="text-align: left">Ubuntu</td>
             <td style="text-align: left">20.04<hr>22.04<hr>24.04</td>
             <td style="text-align: left">x86_64<hr>x86_64<hr>x86_64</td>
             <td style="text-align: left">Supported<hr>Supported on 2.3.0+<hr>Supported on 2.18.0+</td>
             <td style="text-align: left">Supported<hr>Supported<hr>Supported</td>
         </tr>
     </tbody>
   </table>
   
   </div>

 </details>
</li>
</ul>
<hr>
<h2 
id="host-setup">Host Setup  <a class="headerlink float-right" href="#host-setup" title="Host Setup"><i class="fas fa-link fa-xs"></i></a>
</h2><p>This section configures the hosts used in this tutorial. In the following table, you&rsquo;ll find the details of the test environment used in this tutorial&rsquo;s examples. The options presented are the minimum host requirements for running a fully functional test environment. Remember that production environments may need more resources and incur greater costs.</p>





<table class="table table-striped table-bordered table-v1">
  <thead>
      <tr>
          <th style="text-align: left">Hosts</th>
          <th style="text-align: left">Virtual Cores</th>
          <th style="text-align: left">Memory</th>
          <th style="text-align: left">Storage</th>
          <th style="text-align: left">IP Address</th>
          <th style="text-align: left">Hostname</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">F5 NGINX Management Suite Host</td>
          <td style="text-align: left">2 vCPUs</td>
          <td style="text-align: left">4GB</td>
          <td style="text-align: left">100GB</td>
          <td style="text-align: left"><code>192.0.2.2</code></td>
          <td style="text-align: left"><code>acm-ctrl</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Data Plane Host</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.3</code></td>
          <td style="text-align: left"><code>data-host</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Echo Server</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.4</code></td>
          <td style="text-align: left"><code>echo-host</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Authorization Server</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.5</code></td>
          <td style="text-align: left"><code>auth-host</code></td>
      </tr>
  </tbody>
</table>






  


<div data-mf="true" style="display: none;" class="table-v2 table table-striped table-bordered narrow">
    <table>
  <thead>
      <tr>
          <th style="text-align: left">Hosts</th>
          <th style="text-align: left">Virtual Cores</th>
          <th style="text-align: left">Memory</th>
          <th style="text-align: left">Storage</th>
          <th style="text-align: left">IP Address</th>
          <th style="text-align: left">Hostname</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">F5 NGINX Management Suite Host</td>
          <td style="text-align: left">2 vCPUs</td>
          <td style="text-align: left">4GB</td>
          <td style="text-align: left">100GB</td>
          <td style="text-align: left"><code>192.0.2.2</code></td>
          <td style="text-align: left"><code>acm-ctrl</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Data Plane Host</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.3</code></td>
          <td style="text-align: left"><code>data-host</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Echo Server</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.4</code></td>
          <td style="text-align: left"><code>echo-host</code></td>
      </tr>
      <tr>
          <td style="text-align: left">Authorization Server</td>
          <td style="text-align: left">1 vCPU</td>
          <td style="text-align: left">1GB</td>
          <td style="text-align: left">10GB</td>
          <td style="text-align: left"><code>192.0.2.5</code></td>
          <td style="text-align: left"><code>auth-host</code></td>
      </tr>
  </tbody>
</table>

</div>
<h3 
id="install-nsm-acm">Install NGINX Management Suite &amp; API Connectivity Manager  <a class="headerlink float-right" href="#install-nsm-acm" title="Install NGINX Management Suite &amp; API Connectivity Manager"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>Follow the steps in the <a href="http://localhost:1313/nginx-instance-manager/deploy/">Installation Guide</a> to set up NGINX Management Suite and API Connectivity Manager. You do not need to configure a Developer Portal for this tutorial.</li>
</ol>
<h3 
id="install-agent">Install NGINX Agent on Data Plane Host  <a class="headerlink float-right" href="#install-agent" title="Install NGINX Agent on Data Plane Host"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Run the following commands to install the NGINX Agent on the data plane host, create a new Instance Group called <code>test-ig</code>, and add the host to it:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff47fbcd0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff47fbcd0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl --insecure https://192.0.2.2/install/nginx-agent &gt; install.sh <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="o">&amp;&amp;</span> sudo sh install.sh -g test-ig <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="o">&amp;&amp;</span> sudo systemctl start nginx-agent</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl --insecure https://192.0.2.2/install/nginx-agent &gt; install.sh <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="o">&amp;&amp;</span> sudo sh install.sh -g test-ig <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="o">&amp;&amp;</span> sudo systemctl start nginx-agent</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="install-echo-server">Install Echo Server  <a class="headerlink float-right" href="#install-echo-server" title="Install Echo Server"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p><a href="https://go.dev/doc/install" target="_blank" rel="noopener">Download and install the latest version of Go</a> by following the instructions on the official Go website.</p>
</li>
<li>
<p>Run the following commands to install and start <a href="https://github.com/jmalloc/echo-server" target="_blank" rel="noopener">Echo Server</a>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff485cf80&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff485cf80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go env -w <span class="nv">GO111MODULE</span><span class="o">=</span>off
</span></span><span class="line"><span class="cl">go get -u github.com/jmalloc/echo-server/...
</span></span><span class="line"><span class="cl"><span class="nv">PORT</span><span class="o">=</span><span class="m">10000</span> <span class="nv">LOG_HTTP_BODY</span><span class="o">=</span><span class="nb">true</span> <span class="nv">LOG_HTTP_HEADERS</span><span class="o">=</span><span class="nb">true</span> echo-server</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">go env -w <span class="nv">GO111MODULE</span><span class="o">=</span>off
</span></span><span class="line"><span class="cl">go get -u github.com/jmalloc/echo-server/...
</span></span><span class="line"><span class="cl"><span class="nv">PORT</span><span class="o">=</span><span class="m">10000</span> <span class="nv">LOG_HTTP_BODY</span><span class="o">=</span><span class="nb">true</span> <span class="nv">LOG_HTTP_HEADERS</span><span class="o">=</span><span class="nb">true</span> echo-server</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="install-auth-server">Install Authorization Server  <a class="headerlink float-right" href="#install-auth-server" title="Install Authorization Server"><i class="fas fa-link fa-xs"></i></a>
</h3><p>This tutorial uses Keycloak in <strong>Development mode</strong>. Development mode is suitable for people trying out Keycloak for the first time who want to get it up and running quickly.</p>
<p>Development mode sets the following default configuration:</p>
<ul>
<li>HTTP is enabled</li>
<li>Strict hostname resolution is disabled</li>
<li>The cache is set to local (no distributed cache mechanism is used for high availability)</li>
<li>Theme-caching and template-caching are disabled.</li>
</ul>
<details>
<summary><i class="fa-solid fa-circle-info"></i> (Optional) Production mode default configuration</summary>
<p>For all conventional and production use cases, we recommend starting Keycloak in <strong>Production mode</strong>, which follows a &ldquo;secure by default&rdquo; principle.</p>
<p>Production mode sets the following default configuration:</p>
<ul>
<li>HTTP is disabled as transport layer security (HTTPS) is essential</li>
<li>Hostname configuration is expected</li>
<li>HTTPS/TLS configuration is expected</li>
</ul>
</details>
<br>
<ol>
<li>
<p>To install the Keycloak prerequisites run the following commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff48a05a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff48a05a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get -y install openjdk-11-jre</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get -y install openjdk-11-jre</span></span></code></pre></div>
</div></li>
<li>
<p>Download and extract the Keycloak tarball:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff48e4390&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff48e4390">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">KEYCLOAK_VERSION</span><span class="o">=</span>19.0.3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl -L -o keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>https://github.com/keycloak/keycloak/releases/download/<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>/keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz
</span></span><span class="line"><span class="cl">tar -zxf keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz
</span></span><span class="line"><span class="cl">rm -rf keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nv">KEYCLOAK_VERSION</span><span class="o">=</span>19.0.3
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">curl -L -o keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>https://github.com/keycloak/keycloak/releases/download/<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>/keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz
</span></span><span class="line"><span class="cl">tar -zxf keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz
</span></span><span class="line"><span class="cl">rm -rf keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>.tar.gz</span></span></code></pre></div>
</div></li>
<li>
<p>Create environment variables for the Keycloak admin username and password:</p>
<blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> Do not use the example <code>admin/password</code> combination in any scenario. Replace the username and password with strong alternatives.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4901850&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4901850">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> <span class="nb">export</span> <span class="nv">KEYCLOAK_ADMIN</span><span class="o">=</span>&lt;admin user&gt;
</span></span><span class="line"><span class="cl"> <span class="nb">export</span> <span class="nv">KEYCLOAK_ADMIN_PASSWORD</span><span class="o">=</span>&lt;password&gt;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> <span class="nb">export</span> <span class="nv">KEYCLOAK_ADMIN</span><span class="o">=</span>&lt;admin user&gt;
</span></span><span class="line"><span class="cl"> <span class="nb">export</span> <span class="nv">KEYCLOAK_ADMIN_PASSWORD</span><span class="o">=</span>&lt;password&gt;</span></span></code></pre></div>
</div></li>
<li>
<p>Start Keycloak in <strong>Development Mode</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4918f50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4918f50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">bin/kc.sh start-dev</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> keycloak-<span class="si">${</span><span class="nv">KEYCLOAK_VERSION</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">bin/kc.sh start-dev</span></span></code></pre></div>
</div></li>
</ol>
<hr>
<h2 
id="configure-keycloak">Configure Keycloak  <a class="headerlink float-right" href="#configure-keycloak" title="Configure Keycloak"><i class="fas fa-link fa-xs"></i></a>
</h2><p>In this section, we&rsquo;ll configure Keycloak as our OAuth2 authorization server.</p>
<h3 
id="accessing-the-keycloak-ui">Accessing the Keycloak UI  <a class="headerlink float-right" href="#accessing-the-keycloak-ui" title="Accessing the Keycloak UI"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Using the Keycloak admin credentials that you configured in the preceding <a href="#install-auth-server">Install Authorization Server</a> section, you can access and log in to Keycloak web interface by going to:</p>
<ul>
<li><code>http://192.0.2.5:8080/admin</code></li>
</ul>
<h3 
id="configure-realm">Configure a Realm  <a class="headerlink float-right" href="#configure-realm" title="Configure a Realm"><i class="fas fa-link fa-xs"></i></a>
</h3><p>A <em>Realm</em> manages a set of users, credentials, roles, and groups. A user belongs to and logs in to a Realm. Realms are isolated from one another and can manage and authenticate only the users they control.</p>
<ol>
<li>To create a Realm, select <strong>Master</strong> in the left navigation bar, then select <strong>Add realm</strong> from the list.</li>
<li>Enter the Realm details. For the purposes of this demonstration, our Realm will be called <code>nginx</code>.</li>
<li>Select <strong>Create</strong> to create the Realm.</li>
<li>The <strong>Realm</strong> list in the left navigation bar should now be set to <code>nginx</code>.</li>
</ol>
<h3 
id="configure-user">Configure a User  <a class="headerlink float-right" href="#configure-user" title="Configure a User"><i class="fas fa-link fa-xs"></i></a>
</h3><p><em>Users</em> are entities that can log in to your system. User attributes include an email, username, address, phone number, and birthday. Users can be assigned a group membership and have specific roles assigned to them.</p>
<ol>
<li>To create a user, select <strong>Users</strong>, then select <strong>Create new User</strong>.</li>
<li>Enter the user&rsquo;s details. For the purposes of this demonstration, just the required field <strong>Username</strong> is set as <code>nginx-user</code>.</li>
<li>Select <strong>Create</strong> to create the user.</li>
<li>To set the user&rsquo;s password, select the <strong>Credentials</strong> tab.</li>
<li>Select <strong>Set Password</strong>. Enter the desired password in the <strong>Password</strong> and <strong>Password Confirmation</strong> boxes. Set <strong>Temporary</strong> to <strong>OFF</strong>.</li>
<li>Select <strong>Save</strong>.</li>
<li>Select <strong>Save Password</strong> to confirm the password change.</li>
</ol>
<h3 
id="configure-client">Configure a Client  <a class="headerlink float-right" href="#configure-client" title="Configure a Client"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Clients are entities that can ask Keycloak to authenticate a user. Most often, clients are applications and services that use Keycloak to secure themselves and provide a single sign-on solution. Clients can also be entities that request identity information or an access token to invoke other services on the network that are secured by Keycloak.</p>
<p>To configure a client, take the following steps:</p>
<ol>
<li>Select <strong>Clients</strong>. You will see a list of pre-created Keycloak clients. To create a new one, select <strong>Create Client</strong>.</li>
<li>Enter the details for the client. For the purposes of this demonstration, type <code>nginx-plus</code> for the <strong>Client ID</strong>. Leave <strong>Client Type</strong> as the default value <strong>OpenID Connect</strong>.</li>
<li>Select <strong>Next</strong> to continue.</li>
<li>In the <strong>Capability Config</strong> section of the client configuration, set <strong>Client Authentication</strong> as <strong>On</strong>.</li>
<li>Select <strong>Save</strong> to create the client.</li>
<li>Select the <strong>Credentials</strong> tab. In the <strong>Client Authenticator</strong> list, choose <strong>Client ID and Secret</strong>.</li>
<li>Copy the <strong>Client Secret</strong>. You will need this secret for authenticating the <code>nginx-plus</code> client with Keycloak.</li>
</ol>
<h3 
id="configure-custom-role">Configure a Custom Role  <a class="headerlink float-right" href="#configure-custom-role" title="Configure a Custom Role"><i class="fas fa-link fa-xs"></i></a>
</h3><p><em>Roles</em> identify a user type or category. Typical roles in an organization include admin, user, manager, and employee. Applications often assign access and permissions to specific roles rather than individual users, as dealing with users can be too fine-grained and challenging to manage.</p>
<p>To configure a custom role, take the following steps:</p>
<ol>
<li>Select <strong>Realm Roles</strong>. You will see a list of pre-created Keycloak roles. To create a new role, select <strong>Create Role</strong>.</li>
<li>Type the <strong>Role Name</strong>. For the purposes of this demonstration, use <code>nginx-keycloak-role</code> for the role name.</li>
<li>Select <strong>Save</strong>.</li>
<li>Once a role has been created, you need to assign the role to users. Select <strong>Users</strong>, then select the <code>nginx-user</code> user you created in the preceding <a href="#configure-user">Configure a User</a> steps.</li>
<li>Select the <strong>Role Mapping</strong> tab, then select <strong>Assign Role</strong>.</li>
<li>Select the checkbox beside the <code>nginx-keycloak-role</code> role, then select <strong>Assign</strong>.</li>
</ol>
<hr>
<h2 
id="test-oauth2-token-introspection">Test OAuth2 Token Introspection  <a class="headerlink float-right" href="#test-oauth2-token-introspection" title="Test OAuth2 Token Introspection"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Follow the steps in this section to test the OAuth functionality of Keycloak, token issuing, and token introspection.</p>
<h3 
id="get-keycloak-introspection-endpoints">Get the Keycloak Token Introspection Endpoints  <a class="headerlink float-right" href="#get-keycloak-introspection-endpoints" title="Get the Keycloak Token Introspection Endpoints"><i class="fas fa-link fa-xs"></i></a>
</h3><p>An introspection endpoint is needed to configure the Introspection policy in API Connectivity Manager. Additionally, a token endpoint is required for users to authenticate and access tokens for introspection. You can retrieve these endpoints using a REST API call to Keycloak.</p>
<h4 
id="structure">Structure  <a class="headerlink float-right" href="#structure" title="Structure"><i class="fas fa-link fa-xs"></i></a>
</h4>


<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4954488&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4954488">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X GET http://<span class="o">{</span>HOST/IP_ADDRESS<span class="o">}</span>:<span class="o">{</span>PORT<span class="o">}</span>/realms/<span class="o">{</span>REALM<span class="o">}</span>/.well-known/openid-configuration</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X GET http://<span class="o">{</span>HOST/IP_ADDRESS<span class="o">}</span>:<span class="o">{</span>PORT<span class="o">}</span>/realms/<span class="o">{</span>REALM<span class="o">}</span>/.well-known/openid-configuration</span></span></code></pre></div>
</div><h4 
id="example">Example  <a class="headerlink float-right" href="#example" title="Example"><i class="fas fa-link fa-xs"></i></a>
</h4><blockquote class="note">
  <div><strong>Note:</strong><br/> <code>jq</code> is used in the following examples to format the JSON response from Keycloak in a legible and attractive way. For more information about <code>jq</code>   , see the <a href="https://github.com/stedolan/jq" target="_blank" rel="noopener">jq GitHub page</a>.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff49aa388&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff49aa388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X GET http://192.0.2.5:8080/realms/nginx/.well-known/openid-configuration <span class="p">|</span> jq</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X GET http://192.0.2.5:8080/realms/nginx/.well-known/openid-configuration <span class="p">|</span> jq</span></span></code></pre></div>
</div><p>JSON Response:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4a46f58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4a46f58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;issuer&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;authorization_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/auth&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;token_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;introspection_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;userinfo_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/userinfo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;end_session_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/logout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;jwks_uri&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/certs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;check_session_iframe&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/login-status-iframe.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;grant_types_supported&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;authorization_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;implicit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;refresh_token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;password&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;client_credentials&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;urn:openid:params:grant-type:ciba&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;issuer&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;authorization_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/auth&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;token_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;introspection_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;userinfo_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/userinfo&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;end_session_endpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/logout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;jwks_uri&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/certs&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;check_session_iframe&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/login-status-iframe.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;grant_types_supported&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;authorization_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;implicit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;refresh_token&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;password&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;client_credentials&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;urn:ietf:params:oauth:grant-type:device_code&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;urn:openid:params:grant-type:ciba&#34;</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><br>
<h3 
id="generate-user-access-token">Generate a User Access Token  <a class="headerlink float-right" href="#generate-user-access-token" title="Generate a User Access Token"><i class="fas fa-link fa-xs"></i></a>
</h3><p>To generate an access token the below request structure is used:</p>
<h4 
id="structure-1">Structure  <a class="headerlink float-right" href="#structure-1" title="Structure"><i class="fas fa-link fa-xs"></i></a>
</h4>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4a97098&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4a97098">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -H <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_id=&lt;REPLACE_WITH_CLIENT_ID&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;grant_type=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_secret=&lt;REPLACE_ME_WITH_CLIENT_SECRET&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;scope=openid&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;username=&lt;REPLACE_WITH_USERNAME&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;password=&lt;REPLACE_ME_WITH_PASSWORD&gt;&#39;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -H <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_id=&lt;REPLACE_WITH_CLIENT_ID&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;grant_type=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_secret=&lt;REPLACE_ME_WITH_CLIENT_SECRET&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;scope=openid&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;username=&lt;REPLACE_WITH_USERNAME&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;password=&lt;REPLACE_ME_WITH_PASSWORD&gt;&#39;</span></span></span></code></pre></div>
</div><h4 
id="example-1">Example  <a class="headerlink float-right" href="#example-1" title="Example"><i class="fas fa-link fa-xs"></i></a>
</h4>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4aebc10&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4aebc10">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -H <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_id=nginx-plus&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;grant_type=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_secret=&lt;REPLACE_WITH_CLIENT_SECRET&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;scope=openid&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;username=nginx-user&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;password=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> jq</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -H <span class="s1">&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_id=nginx-plus&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;grant_type=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;client_secret=&lt;REPLACE_WITH_CLIENT_SECRET&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;scope=openid&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;username=nginx-user&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --data-urlencode <span class="s1">&#39;password=password&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  <span class="p">|</span> jq</span></span></code></pre></div>
</div><p>JSON Response:</p>
<p>Keycloak will respond with a JSON object containing an <code>access_token</code> for the user <code>nginx-user</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4b115a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4b115a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;refresh_expires_in&#34;</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;id_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;not-before-policy&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;session_state&#34;</span><span class="p">:</span> <span class="s2">&#34;9836f5fd-987f-4875-ac75-f7dd5325047c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;access_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;expires_in&#34;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;refresh_expires_in&#34;</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;refresh_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;token_type&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;id_token&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;JWT_token&gt;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;not-before-policy&#34;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;session_state&#34;</span><span class="p">:</span> <span class="s2">&#34;9836f5fd-987f-4875-ac75-f7dd5325047c&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Typically, the <code>access_token</code> is passed in requests to a <strong>Resource Server</strong> (API Proxy) as a <code>Bearer</code> token in the <code>Authorization</code> header. This is the default OAuth2 Introspection policy behavior in API Connectivity Manager.</p>
<br>
<h3 
id="introspect-token-test">Introspecting a User Access Token  <a class="headerlink float-right" href="#introspect-token-test" title="Introspecting a User Access Token"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You can mimic the process by which an NGINX client introspects an incoming user <code>access_token</code> with Keycloak.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Keycloak is configured to accept basic auth credentials from the <code>nginx-plus</code> client; in this case, the credentials are formatted as <code>CLIENT_ID:CLIENT_SECRET</code>. This combination must be <a href="https://www.base64url.com/" target="_blank" rel="noopener">base64 url encoded</a> before it is passed in the <code>Authorization</code> header.</div>
</blockquote>

<h4 
id="structure-2">Structure  <a class="headerlink float-right" href="#structure-2" title="Structure"><i class="fas fa-link fa-xs"></i></a>
</h4>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4b40b70&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4b40b70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token/introspect&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Authorization: Bearer &lt;access token&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Accept: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   --data-urlencode <span class="s1">&#39;token=&lt;ACCESS_TOKEN&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   <span class="p">|</span> jq</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://{HOST/IP_ADDRESS}:{PORT}/realms/{REALM}/protocol/openid-connect/token/introspect&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Authorization: Bearer &lt;access token&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Accept: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   --data-urlencode <span class="s1">&#39;token=&lt;ACCESS_TOKEN&gt;&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   <span class="p">|</span> jq</span></span></code></pre></div>
</div><h4 
id="example-2">Example  <a class="headerlink float-right" href="#example-2" title="Example"><i class="fas fa-link fa-xs"></i></a>
</h4>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4b693e0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4b693e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Authorization: Bearer &lt;access token&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Accept: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   --data-urlencode <span class="s1">&#39;token=&lt;JWT_token&gt;&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="p">|</span> jq</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl -L -X POST <span class="s1">&#39;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#39;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Authorization: Bearer &lt;access token&gt;&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Accept: application/json&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   -H <span class="s2">&#34;Content-Type: application/x-www-form-urlencoded&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>   --data-urlencode <span class="s1">&#39;token=&lt;JWT_token&gt;&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="p">|</span> jq</span></span></code></pre></div>
</div><p>JSON Response:</p>
<p>Keycloak responds with a token introspection JSON response with associated claims that NGINX can extract and forward to backend services.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4bf61c8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4bf61c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;active&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;exp&#34;</span><span class="p">:</span> <span class="mi">1665585794</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1665585494</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;jti&#34;</span><span class="p">:</span> <span class="s2">&#34;c8723771-2474-4c94-b155-f78a4583419f&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;aud&#34;</span><span class="p">:</span> <span class="s2">&#34;account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;a95117bf-1a2e-4d46-9c44-5fdee8dddd11&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;typ&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;azp&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;session_state&#34;</span><span class="p">:</span> <span class="s2">&#34;b7ca9271-02ce-453f-b491-61ec4e648d5d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;given_name&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;family_name&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;preferred_username&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;acr&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sid&#34;</span><span class="p">:</span> <span class="s2">&#34;b7ca9271-02ce-453f-b491-61ec4e648d5d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;client_id&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;realm_access&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;default-roles-nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;offline_access&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;nginx-keycloak-role&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;uma_authorization&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;resource_access&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;account&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;manage-account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;manage-account-links&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;view-profile&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;active&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;exp&#34;</span><span class="p">:</span> <span class="mi">1665585794</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;iat&#34;</span><span class="p">:</span> <span class="mi">1665585494</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;jti&#34;</span><span class="p">:</span> <span class="s2">&#34;c8723771-2474-4c94-b155-f78a4583419f&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;iss&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;aud&#34;</span><span class="p">:</span> <span class="s2">&#34;account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sub&#34;</span><span class="p">:</span> <span class="s2">&#34;a95117bf-1a2e-4d46-9c44-5fdee8dddd11&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;typ&#34;</span><span class="p">:</span> <span class="s2">&#34;Bearer&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;azp&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;session_state&#34;</span><span class="p">:</span> <span class="s2">&#34;b7ca9271-02ce-453f-b491-61ec4e648d5d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;given_name&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;family_name&#34;</span><span class="p">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;preferred_username&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;email_verified&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;acr&#34;</span><span class="p">:</span> <span class="s2">&#34;1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;scope&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;sid&#34;</span><span class="p">:</span> <span class="s2">&#34;b7ca9271-02ce-453f-b491-61ec4e648d5d&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;client_id&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;username&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;realm_access&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;default-roles-nginx&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;offline_access&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;nginx-keycloak-role&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="s2">&#34;uma_authorization&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">},</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;resource_access&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;account&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;roles&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;manage-account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;manage-account-links&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;view-profile&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><br>
<p>At this checkpoint in the tutorial, Keycloak is sufficiently configured for token introspection.</p>
<hr>
<h2 
id="amc-config">Configure API Connectivity Manager  <a class="headerlink float-right" href="#amc-config" title="Configure API Connectivity Manager"><i class="fas fa-link fa-xs"></i></a>
</h2><p>In this section, we will use the API Connectivity Manager Rest API to set up a proxy in API Connectivity Manager. You&rsquo;ll need to pass the NGINX Management Suite user credentials in the Basic Authentication header for each REST request.</p>
<h3 
id="create-workspace-environment">Creating Workspaces &amp; Environment  <a class="headerlink float-right" href="#create-workspace-environment" title="Creating Workspaces &amp; Environment"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>To create an Infrastructure Workspace with a minimum configuration, send the following JSON request to the <code>/infrastructure/workspaces</code> endpoint:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4c37c90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4c37c90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/infrastructure/workspaces</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/infrastructure/workspaces</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4c610b8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4c610b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;infra-ws&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;infra-ws&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>To create an Environment with a minimum configuration, send the following JSON request to the <code>/infrastructure/workspaces/infra-ws/environments</code> endpoint. The <code>proxyClusterName</code>, <code>test-ig</code>, is the name of the Instance Group that the data plane host was added to when you <a href="#install-agent">installed the NGINX Agent</a> above. The <code>hostnames</code> array should contain the hostname of the data plane host.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4c91628&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4c91628">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/infrastructure/workspaces/infra-ws/environments</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/infrastructure/workspaces/infra-ws/environments</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4cca450&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4cca450">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;demo-env&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxies&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;proxyClusterName&#34;</span><span class="p">:</span> <span class="s2">&#34;test-ig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;hostnames&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;data-host&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;demo-env&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxies&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;proxyClusterName&#34;</span><span class="p">:</span> <span class="s2">&#34;test-ig&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;hostnames&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;data-host&#34;</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>To create a Service Workspace with a minimum configuration, send the following JSON request to the <code>/services/workspaces</code> endpoint.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4cf1938&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4cf1938">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/services/workspaces</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/services/workspaces</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4d1e7f8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4d1e7f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;service-ws&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;service-ws&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="create-basic-api-proxy">Create a Basic API Proxy  <a class="headerlink float-right" href="#create-basic-api-proxy" title="Create a Basic API Proxy"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>To create an API proxy with a minimum configuration and no non-default policies, send the following JSON request to the <code>/services/workspaces/service-ws/proxies</code> endpoint. The Proxy service target is our echo server.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4d56680&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4d56680">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4de2c98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4de2c98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>To test whether the API Proxy and backend echo server are working correctly, send a custom header and dummy JSON body to show these proxied values in the echo server response.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4e17088&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4e17088">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">   X-NGINX-Test: true</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">   X-NGINX-Test: true</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4e3fce0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4e3fce0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;testKey&#34;</span><span class="p">:</span> <span class="s2">&#34;testValue&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;testKey&#34;</span><span class="p">:</span> <span class="s2">&#34;testValue&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p><strong>Expected Result</strong></p>
<p>If everything is configured correctly in API Connectivity Manager and the echo server, the response should be similar to the following example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4eb0990&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4eb0990">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: 192.0.2.4
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: c241b72519e71cf7bce9262910ffbe40
</span></span><span class="line"><span class="cl">X-Real-Ip: 192.0.2.1
</span></span><span class="line"><span class="cl">X-NGINX-Test: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;testKey&#34;</span>: <span class="s2">&#34;testValue&#34;</span><span class="o">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: 192.0.2.4
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: c241b72519e71cf7bce9262910ffbe40
</span></span><span class="line"><span class="cl">X-Real-Ip: 192.0.2.1
</span></span><span class="line"><span class="cl">X-NGINX-Test: <span class="nb">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">{</span><span class="s2">&#34;testKey&#34;</span>: <span class="s2">&#34;testValue&#34;</span><span class="o">}</span></span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="upsert-oauth2-introspection-policy">Upsert OAuth2 Introspection Policy  <a class="headerlink float-right" href="#upsert-oauth2-introspection-policy" title="Upsert OAuth2 Introspection Policy"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Upsert the API proxy with an OAuth2 Introspection policy. The default <code>action.introspectionResponse</code> type <code>application/json</code> is used, so you don&rsquo;t need to define it in the API request body.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> This shortened request body removes all the default API proxy policies. To maintain these default policies, perform a <code>GET</code> request on the proxy before the upsert and copy the policy configuration from the response.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4ee2670&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4ee2670">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4f759e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4f759e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="test-introspection-policy">Testing the Introspection Policy  <a class="headerlink float-right" href="#test-introspection-policy" title="Testing the Introspection Policy"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Using the same echo server request from the previous section, test the echo server again:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4fa5b70&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff4fa5b70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api</span></span></code></pre></div>
</div><p>If you&rsquo;ve successfully configured and applied the OAuth2 Introspection policy, the request is blocked from reaching the backend, and <code>401 Unauthorized</code> is returned.</p>
<p>JSON Response:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff4fce7c8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff4fce7c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Unauthorized&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;401&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Unauthorized&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;401&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Using the Keycloak user you created in the <a href="#configure-user">Configure a User</a> section above, obtain an access token from Keycloak. Follow the steps you completed in the <a href="#generate-user-access-token">Generate a User Access Token</a> section.</p>
</li>
<li>
<p>Copy the <code>access_token</code> in the JSON response that&rsquo;s returned from Keycloak.</p>
</li>
<li>
<p>In the next request to the echo server, add a request header with the following details:</p>
<ul>
<li>
<p>key: <code>Authorization</code></p>
</li>
<li>
<p>value: <code>Bearer &lt;ACCESS_TOKEN&gt;</code>, where <code>&lt;ACCESS_TOKEN&gt;</code> is the token you copied in step 3.</p>
<p>The <code>&lt;ACCESS_TOKEN&gt;</code> is prefixed with <code>Bearer</code> because it&rsquo;s passed as a <a href="https://www.rfc-editor.org/rfc/rfc6750" target="_blank" rel="noopener">bearer token</a> to the API proxy.</p>
</li>
</ul>
<p>If the OAuth2 Introspection policy has been configured and applied successfully, the request is blocked from reaching the backend, and <code>401 Unauthorized</code> is returned.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5011230&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5011230">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
</div><p>The access token is taken from the <code>Authorization</code> header and introspected against the Keycloak introspection endpoint defined in the policy configuration. If the OAuth2 server responds with <code>&quot;active&quot;: true</code> in the introspection response, the request proceeds to the backend. The response should look like the following example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff50b3008&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff50b3008">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_a4334620-226b-491d-8503-e0724bdf5521
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: ffc5dc656e220a20fa57835e0653f19f
</span></span><span class="line"><span class="cl">X-Token-Exp: <span class="m">1666003414</span>
</span></span><span class="line"><span class="cl">X-Token-Scope: openid email profile
</span></span><span class="line"><span class="cl">X-Token-Username: nginx-user</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_a4334620-226b-491d-8503-e0724bdf5521
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: ffc5dc656e220a20fa57835e0653f19f
</span></span><span class="line"><span class="cl">X-Token-Exp: <span class="m">1666003414</span>
</span></span><span class="line"><span class="cl">X-Token-Scope: openid email profile
</span></span><span class="line"><span class="cl">X-Token-Username: nginx-user</span></span></code></pre></div>
</div></li>
</ol>
<p>There are a few things to note here:</p>
<ul>
<li>The default headers changed because we removed the default request headers policy when upserting the Introspection policy. This won&rsquo;t happen in environments where default policies are included in the upsert request, in which case, the default request headers are forwarded to the backend services.</li>
<li>There are new headers proxied to the backend <code>X-Token-Exp</code>, <code>X-Token-Scope</code>, and <code>X-Token-Scope</code>. These are the default claims defined in the policy configuration value <code>action.forwardedClaimsInProxyHeader</code>, and values are taken from the Identify Provider (IdP) introspection response to the in-flight request.</li>
<li>There is no <code>Authorization</code> header in the request forwarded to the backend. This is because NGINX strips the incoming user access token from the header or query parameters regardless of the key used.</li>
</ul>
<p>If you pass an inactive or invalid token and perform the same request above, the request is blocked from reaching the backend, and <code>403 Forbidden</code> is returned.`</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff50d4730&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff50d4730">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Forbidden&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;403&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;message&#34;</span><span class="p">:</span> <span class="s2">&#34;Forbidden&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;403&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>You can check the logs on the data host to determine the cause of the <code>403 Forbidden</code> response. There may be several reasons for a forbidden response message; however, the user only sees <code>403 Forbidden</code> in all cases, except where no access token is provided. In that case, the response is <code>401 Not Authorized</code>.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff51209f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff51209f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /var/log/nginx/data-host-error.log
</span></span><span class="line"><span class="cl">2022/10/17 10:23:11 <span class="o">[</span>error<span class="o">]</span> 35643#35643: *15 js: OAuth introspection access_token not provided.
</span></span><span class="line"><span class="cl">2022/10/17 11:24:30 <span class="o">[</span>error<span class="o">]</span> 39542#39542: *49 js: OAuth token introspection found inactive token.</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">cat /var/log/nginx/data-host-error.log
</span></span><span class="line"><span class="cl">2022/10/17 10:23:11 <span class="o">[</span>error<span class="o">]</span> 35643#35643: *15 js: OAuth introspection access_token not provided.
</span></span><span class="line"><span class="cl">2022/10/17 11:24:30 <span class="o">[</span>error<span class="o">]</span> 39542#39542: *49 js: OAuth token introspection found inactive token.</span></span></code></pre></div>
</div><h3 
id="custom-token-placement-key">Custom Token Placement &amp; Key  <a class="headerlink float-right" href="#custom-token-placement-key" title="Custom Token Placement &amp; Key"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You can configure the Introspection policy to let users pass their access token as a header or query parameter using any key name. By default, the access token is given in the <code>Authorization</code> header as a bearer token. The <code>Bearer</code> prefix is required when the access token is passed in the <code>Authorization</code> header. If the header is changed from this default <code>Authorization</code> value, passing a <code>Bearer</code> prefix will render the request invalid.</p>
<p><code>action.clientTokenSuppliedIn</code> configures how the access token is passed in the user request; <code>action.clientTokenName</code>configures the key under which the access token is extracted from the user request.</p>
<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration, where the access token is passed in the request headers as <code>apiAccessToken</code>. The default value for <code>action.clientTokenSuppliedIn</code> is <code>HEADER</code>, so you don&rsquo;t need to include it in the API request body.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff514ec38&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff514ec38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div><p><strong>JSON Request</strong></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff51cb850&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff51cb850">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenName&#34;</span><span class="p">:</span> <span class="s2">&#34;apiAccessToken&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenName&#34;</span><span class="p">:</span> <span class="s2">&#34;apiAccessToken&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>In the next request to the echo server, change the request header so the access token is passed in <code>apiAccessToken</code>.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff523ff98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff523ff98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  apiAccessToken: <span class="s1">&#39;&lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  apiAccessToken: <span class="s1">&#39;&lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
</div><p>The request should proceed to the backend service as expected, and the echo server should respond in turn.</p>
</li>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration, where the access token is passed in the query arguments as <code>queryAuthz</code> with <code>action.clientTokenSuppliedIn</code> set to <code>QUERY</code>.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5256ec8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5256ec8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff52f9c40&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff52f9c40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenSuppliedIn&#34;</span><span class="p">:</span> <span class="s2">&#34;QUERY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenName&#34;</span><span class="p">:</span> <span class="s2">&#34;queryAuthz&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenSuppliedIn&#34;</span><span class="p">:</span> <span class="s2">&#34;QUERY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;clientTokenName&#34;</span><span class="p">:</span> <span class="s2">&#34;queryAuthz&#34;</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>In the next request to the echo server, remove the custom request header <code>apiAccessToken</code> and pass the access token in the query argument <code>queryAuthz</code>.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff53462e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff53462e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api?queryAuthz<span class="o">=</span>&lt;JWT_token&gt;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api?queryAuthz<span class="o">=</span>&lt;JWT_token&gt;</span></span></code></pre></div>
</div><p>The request should proceed to the backend service as expected, and the echo server should respond in turn. Similar to passing the access token as a header, the user&rsquo;s access token is stripped from the in-flight request before it&rsquo;s forwarded to the backend service.</p>
</li>
</ol>
<h3 
id="token-caching">Token Caching  <a class="headerlink float-right" href="#token-caching" title="Token Caching"><i class="fas fa-link fa-xs"></i></a>
</h3><p>OAuth2 token introspection is provided by the Identify Provider (IdP) at a JSON/REST endpoint, so the standard response is a JSON object with HTTP status 200. When this response is keyed against the access token, it becomes highly cacheable.</p>
<p>You can configure NGINX to cache a copy of the introspection response for each access token. Then, the next time the same access token is presented, NGINX serves the cached introspection response instead of making an API call to the IdP. Token caching vastly improves overall latency for subsequent requests. You can manage how long cached responses are used to mitigate the risk of accepting an expired or recently revoked access token. For example, suppose an API client typically makes a burst of several API calls over a short period. In that case, a cache validity of 10 seconds might be sufficient to provide a measurable improvement in user experience.</p>
<h4 
id="security-considerations">Security Considerations  <a class="headerlink float-right" href="#security-considerations" title="Security Considerations"><i class="fas fa-link fa-xs"></i></a>
</h4><blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> <p>There are some security considerations to keep in mind when enabling token caching. For example, a shorter cache expiration time is more secure since the resource servers must query the introspection endpoint more frequently; however, the increased number of queries may put a load on the endpoint. Longer expiration times, by comparison, open a window where a token may actually be expired or revoked but still be able to be used at a resource server for the remaining cache time.</p>
<p>You can mitigate these situations by never caching the value beyond the token&rsquo;s expiration time. For example, in Keycloak, the default token duration is <strong>300 seconds</strong>. This should be the upper limit of token caching in the Introspection policy configuration.</p>
</div>
</blockquote>

<h4 
id="token-caching-setup">Token Caching Setup  <a class="headerlink float-right" href="#token-caching-setup" title="Token Caching Setup"><i class="fas fa-link fa-xs"></i></a>
</h4><p>You can configure token caching in the Introspection policy by setting the <code>action.cacheIntrospectionResponse</code> value. An NGINX unit-of-time measurement is expected in seconds, minutes, or hours. By default, token caching is enabled for a five-minute (<code>5m</code>) cache duration. Setting the value to <code>0s</code>, <code>0m</code>, or <code>0h</code> disables caching.</p>
<ol>
<li>
<p>Upsert the proxy with an Introspection policy configuration to set a token cache duration of ten seconds (<code>10s</code>).</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5399308&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5399308">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5439d58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5439d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;cacheIntrospectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;10s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;cacheIntrospectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;10s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send a request to the echo server API proxy with the provided access token. The introspection token response will be cached in the data host.</p>
</li>
<li>
<p>To verify whether token caching is successful, locate the token cache Realm on the data host. Realms follow the pattern <code>tokens_&lt;SHORT_PROXY_UUID&gt;_&lt;LABEL&gt;</code> and can be found in <code>/var/cache/nginx</code>.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff54b0f98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff54b0f98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls -l /var/cache/nginx/ <span class="p">|</span> grep tokens_
</span></span><span class="line"><span class="cl">drwx------ <span class="m">4</span> nginx nginx-agent <span class="m">4096</span> Oct <span class="m">18</span> 10:24 tokens_07b28d26_default</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">ls -l /var/cache/nginx/ <span class="p">|</span> grep tokens_
</span></span><span class="line"><span class="cl">drwx------ <span class="m">4</span> nginx nginx-agent <span class="m">4096</span> Oct <span class="m">18</span> 10:24 tokens_07b28d26_default</span></span></code></pre></div>
</div></li>
<li>
<p>To disable token caching, set <code>action.cacheIntrospectionResponse</code> to <code>0s</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff54dcad0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff54dcad0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff557a640&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff557a640">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;cacheIntrospectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;0s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;cacheIntrospectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;0s&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>All subsequent requests to this API proxy will not have introspection token responses cached.</p>
</li>
</ol>
<h3 
id="oauth2-server-hostname-resolution">OAuth2 Server Hostname Resolution  <a class="headerlink float-right" href="#oauth2-server-hostname-resolution" title="OAuth2 Server Hostname Resolution"><i class="fas fa-link fa-xs"></i></a>
</h3><p>If hostname resolution is required for resolving the OAuth2 server hostname, you can configure multiple DNS resolvers for the Introspection policy using the <code>action.resolver</code> setting.</p>
<p>You can define multiple hostnames/IP addresses and port combinations, along with <code>valid</code> and <code>timeout</code> configurations. By default, NGINX caches answers using the TTL value of a response. The <code>valid</code> parameter allows overriding the TTL value. The <code>timeout</code> parameter sets a timeout for name resolution.</p>
<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration for <code>action.introspectionEndpoint</code> that includes a hostname NGINX must resolve:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff55ac320&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff55ac320">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff56f3198&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff56f3198">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send a request to the echo server API proxy with the provided access token. The request should not proceed to the backend, and <code>403 Forbidden</code> should be returned to the user. If you look at the data host error logs, you&rsquo;ll see the root cause of the <code>403</code> response: there was an issue resolving the introspection endpoint host in the introspection sub-request.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5769820&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5769820">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cat /var/log/nginx/data-host-error.log
</span></span><span class="line"><span class="cl">2022/10/17 13:22:04 <span class="o">[</span>error<span class="o">]</span> 44933#44933: *76 js: no resolver defined to resolve hosted.idp.com, client: 192.0.2.1, server: data-host, request: <span class="s2">&#34;POST /my/test/api HTTP/1.1&#34;</span>, subrequest: <span class="s2">&#34;/_oauth2_send_introspection_request&#34;</span>, host: <span class="s2">&#34;data-host&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo cat /var/log/nginx/data-host-error.log
</span></span><span class="line"><span class="cl">2022/10/17 13:22:04 <span class="o">[</span>error<span class="o">]</span> 44933#44933: *76 js: no resolver defined to resolve hosted.idp.com, client: 192.0.2.1, server: data-host, request: <span class="s2">&#34;POST /my/test/api HTTP/1.1&#34;</span>, subrequest: <span class="s2">&#34;/_oauth2_send_introspection_request&#34;</span>, host: <span class="s2">&#34;data-host&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration for <code>action.resolver</code>. Include the DNS server(s) needed for resolving the host used for introspection. In the following example, two DNS servers are configured along with <code>valid</code> and <code>timeout</code> parameters.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5797680&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5797680">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5865760&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5865760">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;resolver&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;valid&#34;</span><span class="p">:</span> <span class="s2">&#34;30s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;timeout&#34;</span><span class="p">:</span> <span class="s2">&#34;60s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;servers&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.1&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">5353</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                     <span class="p">]</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://hosted.idp.com:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;resolver&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;valid&#34;</span><span class="p">:</span> <span class="s2">&#34;30s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;timeout&#34;</span><span class="p">:</span> <span class="s2">&#34;60s&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;servers&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.1&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">},</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;10.0.0.2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                           <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">5353</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                     <span class="p">]</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send a request to the echo server API proxy with the provided access token. The hostname should resolve, and the request should proceed to the backend as expected.</p>
</li>
</ol>
<h3 
id="forwarding-token-claims">Forwarding Token Claims in Proxy Header  <a class="headerlink float-right" href="#forwarding-token-claims" title="Forwarding Token Claims in Proxy Header"><i class="fas fa-link fa-xs"></i></a>
</h3><p>When a user access token is introspected with an OAuth server, the token introspection endpoint should respond with a JSON object with the properties listed below. Only the <code>active</code> property is required; the rest are optional.</p>
<blockquote class="tip">
  <div><strong>See Also:</strong><br/> Detailed descriptions of each claim can be found in <a href="https://datatracker.ietf.org/doc/html/rfc7662#section-2.2" target="_blank" rel="noopener">Section 2.2 of OAuth 2.0 Token Introspection Token [RFC7662]</a>.</div>
</blockquote>






<table class="table table-striped table-bordered table-v1">
  <thead>
      <tr>
          <th style="text-align: left">Claim</th>
          <th style="text-align: left">Required</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>active</code></td>
          <td style="text-align: left">REQUIRED</td>
          <td style="text-align: left">Boolean indicator of whether the presented token is <code>active</code>. The specifics of a token&rsquo;s <code>active</code> state vary depending on the authorization server&rsquo;s implementation and the information it keeps about its tokens. Generally, however, a <code>true</code> value returned for the <code>active</code> property indicates that a given token has been issued by this authorization server, has not been revoked by the resource owner, and is within its given time window of validity (for example, after its issuance time and before its expiration time).</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>scope</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">A JSON string containing a space-separated list of scopes associated with this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>client_id</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Identifier for the OAuth 2.0 client that requested this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>username</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Human-readable identifier for the resource owner who authorized this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>token_type</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Type of the token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>exp</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token will expire.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>iat</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token was issued.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>nbf</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token should not be used before.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>sub</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Subject of the token. Usually, a machine-readable identifier of the resource owner who authorized this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>aud</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Service-specific string identifier or list of string identifiers representing the intended audience for this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>iss</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">String representing the issuer of this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>jti</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">String identifier for the token.</td>
      </tr>
  </tbody>
</table>






  


<div data-mf="true" style="display: none;" class="table-v2 table table-striped table-bordered narrow">
    <table>
  <thead>
      <tr>
          <th style="text-align: left">Claim</th>
          <th style="text-align: left">Required</th>
          <th style="text-align: left">Description</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>active</code></td>
          <td style="text-align: left">REQUIRED</td>
          <td style="text-align: left">Boolean indicator of whether the presented token is <code>active</code>. The specifics of a token&rsquo;s <code>active</code> state vary depending on the authorization server&rsquo;s implementation and the information it keeps about its tokens. Generally, however, a <code>true</code> value returned for the <code>active</code> property indicates that a given token has been issued by this authorization server, has not been revoked by the resource owner, and is within its given time window of validity (for example, after its issuance time and before its expiration time).</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>scope</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">A JSON string containing a space-separated list of scopes associated with this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>client_id</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Identifier for the OAuth 2.0 client that requested this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>username</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Human-readable identifier for the resource owner who authorized this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>token_type</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Type of the token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>exp</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token will expire.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>iat</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token was issued.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>nbf</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Integer timestamp, measured in the number of seconds since January 1, 1970, UTC, indicating when this token should not be used before.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>sub</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Subject of the token. Usually, a machine-readable identifier of the resource owner who authorized this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>aud</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">Service-specific string identifier or list of string identifiers representing the intended audience for this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>iss</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">String representing the issuer of this token.</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>jti</code></td>
          <td style="text-align: left">OPTIONAL</td>
          <td style="text-align: left">String identifier for the token.</td>
      </tr>
  </tbody>
</table>

</div>
<p>With the API Connectivity Manager OAuth2 Introspection policy, extracting any claim from an IdP token introspection request and forwarding the claim to the backend service as a request header is possible. By default, the Introspection policy forwards the <code>exp</code>, <code>scope</code>, and <code>username</code> claims to the backend. When a token claim is extracted and sent to a backend service, it follows the naming pattern <code>X-Token-&lt;Claim&gt;</code>.</p>
<p>You&rsquo;ll need to consult your OAuth server&rsquo;s documentation to determine which claims you can forward to the backend. For this Keycloak example, you can examine the response from the <a href="#introspect-token-test">Introspecting a User Access Token</a> test you completed above.</p>
<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration to forward non-default claims in the proxy header. To access nested JSON object values, link the path to the value with full-stop [<code>.</code>] characters; for example, <code>resource_access.account.roles</code>. A non-existent claim called <code>fake-claim</code> has also been added.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5888210&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5888210">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5957290&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5957290">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;forwardedClaimsInProxyHeader&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;username&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;scope&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;iss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;client-id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;resource_access.account.roles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;fake-claim&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;forwardedClaimsInProxyHeader&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;username&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;exp&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;scope&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;iss&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;client-id&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;resource_access.account.roles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="s2">&#34;fake-claim&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send another request to the echo server API proxy:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff59904a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff59904a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;JWT_token&gt;&#39;</span></span></span></code></pre></div>
</div><p>The response returned from the echo server should contain the custom list of claims defined in the Introspection policy configuration. The non-existent claim is not present because the claim <code>fake-claim</code> did not exist in the token introspection response, so the related header field remained empty. By default, NGINX does not proxy empty headers to the backend; as such, it gracefully handles invalid claims without affecting user requests.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5ab63c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5ab63c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_a4334620-226b-491d-8503-e0724bdf5521
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: e537dec880a0e3eab70fe8b87f6b5838
</span></span><span class="line"><span class="cl">X-Token-Client-Id: nginx-plus
</span></span><span class="line"><span class="cl">X-Token-Exp: <span class="m">1666011139</span>
</span></span><span class="line"><span class="cl">X-Token-Iss: http://192.0.2.5:8080/realms/nginx
</span></span><span class="line"><span class="cl">X-Token-Resource-Access-Account-Roles: manage-account
</span></span><span class="line"><span class="cl">X-Token-Scope: openid email profile
</span></span><span class="line"><span class="cl">X-Token-Username: nginx-user</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_a4334620-226b-491d-8503-e0724bdf5521
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: e537dec880a0e3eab70fe8b87f6b5838
</span></span><span class="line"><span class="cl">X-Token-Client-Id: nginx-plus
</span></span><span class="line"><span class="cl">X-Token-Exp: <span class="m">1666011139</span>
</span></span><span class="line"><span class="cl">X-Token-Iss: http://192.0.2.5:8080/realms/nginx
</span></span><span class="line"><span class="cl">X-Token-Resource-Access-Account-Roles: manage-account
</span></span><span class="line"><span class="cl">X-Token-Scope: openid email profile
</span></span><span class="line"><span class="cl">X-Token-Username: nginx-user</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="verifying-token-claims">Verifying Introspected Token Claim Values  <a class="headerlink float-right" href="#verifying-token-claims" title="Verifying Introspected Token Claim Values"><i class="fas fa-link fa-xs"></i></a>
</h3><p>From API Connectivity Manager 1.4.0, API admins can configure Introspection token claim verification whereby NGINX will assert the value of an introspected token claim against values provided by the API admin. If these values match, the request proceeds to the backend, if not the request is denied and <code>403 Forbidden</code> is returned.</p>
<p>It is possible to verify string, integer, boolean, and array of strings data-types. Delimited strings, commonly encountered in the scope claim, are also supported. To access nested JSON object values, link the path to the value with full-stop [<code>.</code>] characters; for example, <code>resource_access.account.roles</code>. Both reserved and custom claims are supported, the only requirement is they are string data type.</p>
<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration to include claim verification.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5afc4d8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5afc4d8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5c9e840&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5c9e840">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;verifyClaims&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;aud&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;account&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;scope&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;delimiter&#34;</span><span class="p">:</span> <span class="s2">&#34;SPACE&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;acr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;INTEGER&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;email_verified&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;BOOLEAN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;resource_access.account.roles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;manage-account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;manage-account-links&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;view-profile&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">]</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;verifyClaims&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;aud&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;account&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;scope&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;STRING&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="s2">&#34;openid profile email&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;delimiter&#34;</span><span class="p">:</span> <span class="s2">&#34;SPACE&#34;</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;acr&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;INTEGER&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;email_verified&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;BOOLEAN&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">                            <span class="p">},</span>
</span></span><span class="line"><span class="cl">                            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;claim&#34;</span><span class="p">:</span> <span class="s2">&#34;resource_access.account.roles&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;ARRAY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                <span class="nt">&#34;value&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;manage-account&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;manage-account-links&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                                    <span class="s2">&#34;view-profile&#34;</span>
</span></span><span class="line"><span class="cl">                                <span class="p">]</span>
</span></span><span class="line"><span class="cl">                            <span class="p">}</span>
</span></span><span class="line"><span class="cl">                        <span class="p">]</span>
</span></span><span class="line"><span class="cl">                    <span class="p">},</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="p">{</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                        <span class="p">}</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
</ol>
<h4 
id="claim-verification-examples">Claim Verification Examples  <a class="headerlink float-right" href="#claim-verification-examples" title="Claim Verification Examples"><i class="fas fa-link fa-xs"></i></a>
</h4><p>To demonstrate claim verification and the various permutations of what may be encountered, simple examples with various go/no go scenarios will be presented. In these examples the <strong>expected</strong> claim value from the policy configuration will be presented along with the <strong>actual</strong> introspected token claim value, the result, and if verification fails the reason why.</p>
<p>It should be noted that if a claim is defined in the policy configuration but does not exist in an introspected token response, verification instantly fails and the request will not proceed to the backend.</p>
<p>If a claim verification failure is encountered the end user will get a <code>403 Forbidden</code> response, in the data-path error logs only the claim name that failed will be logged. For security reasons and the highly sensitive nature of the data in token introspection responses the claim values from the failed claim verification are not logged. To debug these failures, manually introspect a user&rsquo;s token and verify the contents against the policy configuration for claim verification.</p>





<table class="table table-striped table-bordered table-v1">
  <thead>
      <tr>
          <th style="text-align: left">Type</th>
          <th style="text-align: left">Expected Value</th>
          <th style="text-align: left">Actual Value</th>
          <th style="text-align: left">Result</th>
          <th style="text-align: left">Failure Reason</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;monitor&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;Account&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match - case sensitive</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;report&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">The expected value could not be found</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid email profile&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile email account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid+email+profile&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Delimiters do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Could not find &ldquo;email&rdquo;</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>[&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Expected delimited string</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>&quot;42&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>43</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>&quot;TRUE&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>false</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;report&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">The expected value could not be found</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;monitor&quot;, &quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;, &quot;report&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Could not find &ldquo;monitor&rdquo;</td>
      </tr>
  </tbody>
</table>






  


<div data-mf="true" style="display: none;" class="table-v2 table table-striped table-bordered narrow">
    <table>
  <thead>
      <tr>
          <th style="text-align: left">Type</th>
          <th style="text-align: left">Expected Value</th>
          <th style="text-align: left">Actual Value</th>
          <th style="text-align: left">Result</th>
          <th style="text-align: left">Failure Reason</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;monitor&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>&quot;Account&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match - case sensitive</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left"><code>[&quot;report&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">The expected value could not be found</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid email profile&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile email account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid+email+profile&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Delimiters do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>&quot;openid profile&quot;</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Could not find &ldquo;email&rdquo;</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>string</code></td>
          <td style="text-align: left"><code>&quot;openid profile email&quot;</code></td>
          <td style="text-align: left"><code>[&quot;openid&quot;, &quot;profile&quot;, &quot;email&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Expected delimited string</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>&quot;42&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>integer</code></td>
          <td style="text-align: left"><code>42</code></td>
          <td style="text-align: left"><code>43</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>&quot;TRUE&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>boolean</code></td>
          <td style="text-align: left"><code>true</code></td>
          <td style="text-align: left"><code>false</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>&quot;account&quot;</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Values do not match</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;report&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">The expected value could not be found</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;monitor&quot;, &quot;account&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;, &quot;report&quot;]</code></td>
          <td style="text-align: left">Pass</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><code>array</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;, &quot;monitor&quot;]</code></td>
          <td style="text-align: left"><code>[&quot;account&quot;]</code></td>
          <td style="text-align: left">Fail</td>
          <td style="text-align: left">Could not find &ldquo;monitor&rdquo;</td>
      </tr>
  </tbody>
</table>

</div>
<h3 
id="custom-error-return-codes">Custom Error Return Codes  <a class="headerlink float-right" href="#custom-error-return-codes" title="Custom Error Return Codes"><i class="fas fa-link fa-xs"></i></a>
</h3><p>When users fail to pass an access token in requests to an API Proxy configured with an Introspection policy, they get back a <code>401 Unauthorized</code> response. If they try with an inactive or non-existent token, or if there&rsquo;s a problem with the introspection request or response, they get back a <code>403 Forbidden</code> response.</p>
<p>You can change the <code>401</code> and <code>403</code> response codes by configuring the <code>action.errorReturnConditions</code> setting.</p>
<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration to include custom error return codes. In this example, we want to return <code>410</code> when the token is inactive or no match is found, and <code>418</code> when no access token is provided.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5cef150&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5cef150">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5e0d370&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff5e0d370">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;errorReturnConditions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;noMatch&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;returnCode&#34;</span><span class="p">:</span> <span class="mi">418</span>
</span></span><span class="line"><span class="cl">                     <span class="p">},</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;notSupplied&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;returnCode&#34;</span><span class="p">:</span> <span class="mi">410</span>
</span></span><span class="line"><span class="cl">                     <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;http://192.0.2.5:8080/realms/nginx/protocol/openid-connect/token/introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;errorReturnConditions&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;noMatch&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;returnCode&#34;</span><span class="p">:</span> <span class="mi">418</span>
</span></span><span class="line"><span class="cl">                     <span class="p">},</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;notSupplied&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;returnCode&#34;</span><span class="p">:</span> <span class="mi">410</span>
</span></span><span class="line"><span class="cl">                     <span class="p">}</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> To edit the response message and format for these custom error codes, add them to the default global policy <code>error-response-format</code> with the related <code>errorCode</code> and <code>errorMessage</code>.</div>
</blockquote>

</li>
<li>
<p>Send a request to the echo server API proxy without providing an access token. The request should not go to the backend, and the API proxy should respond with the status code <code>410 Gone</code>.</p>
</li>
<li>
<p>Send a request to the echo server API proxy with an invalid or inactive access token. The request should not go to the backend, and the API proxy should respond with the status code <code>418 I'm a teapot</code>.</p>
</li>
</ol>
<h3 
id="introspection-jwt-response-type--token-forwarding">Introspection JWT Response Type &amp; Token Forwarding  <a class="headerlink float-right" href="#introspection-jwt-response-type--token-forwarding" title="Introspection JWT Response Type &amp; Token Forwarding"><i class="fas fa-link fa-xs"></i></a>
</h3><p><a href="https://datatracker.ietf.org/doc/html/rfc7662" target="_blank" rel="noopener">OAuth 2.0 Token Introspection [RFC7662]</a> specifies how a protected resource can query an OAuth 2.0 authorization server to determine the state of an access token, and obtain data associated with the access token. This method allows deployments to implement opaque access tokens in an interoperable manner.</p>
<p>The introspection response, as specified in OAuth 2.0 Token Introspection [RFC7662], is a plain JSON object. However, there are use cases where the resource server may require stronger assurance that the authorization server issued the token introspection response for an access token, including cases where the authorization server assumes liability for the content of the token introspection response.</p>
<p>An example is a resource server using verified personal data to create certificates, which are then used to create qualified electronic signatures. In such use cases, it may be helpful or even required to return a signed <a href="https://www.rfc-editor.org/rfc/rfc7519" target="_blank" rel="noopener">JSON Web token (JWT) [RFC7519]</a> as the introspection response.</p>
<blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> <p>The introspection response type <code>application/jwt</code>, configured using <code>action.introspectionResponse</code>, has not finalized its security protocol specification at the time of writing, and it remains in <strong>DRAFT</strong> status. While in <strong>DRAFT</strong> status, the specification may change at any time, and API Connectivity Manager may change to meet the requirements of the specification. We recommend using the default OAuth2 Introspection response type <code>application/json</code> for all <strong>production</strong> scenarios.</p>
<p>For reference, see <a href="https://datatracker.ietf.org/doc/html/draft-ietf-oauth-jwt-introspection-response" target="_blank" rel="noopener">JWT Response for OAuth Token Introspection</a>.</p>
</div>
</blockquote>

<blockquote class="note">
  <div><strong>Note:</strong><br/> Not all OAuth2 servers support the <code>application/jwt</code> response type; Keycloak, for example, does not. Check your OAuth2 server documentation to verify support for this introspection response type.</div>
</blockquote>

<ol>
<li>
<p>Upsert the proxy with an updated Introspection policy configuration that sets the <code>action.introspectionResponse</code> parameter to <code>application/jwt</code>.</p>
<p>In the following example, the OAuth2 server is changed from Keycloak to a platform that supports the <code>application/jwt</code> response type. For simplicity, the <code>nginx-plus</code> client credentials are the same.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff5e77a90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff5e77a90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff6319f08&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff6319f08">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://192.0.2.5:8080/oauth/v2/oauth-introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/jwt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://192.0.2.5:8080/oauth/v2/oauth-introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/jwt&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send a request to the echo server API proxy with the provided access token. The request should proceed to the backend as expected. The difference in responses is abstracted away from the end-user; token introspection is successful if the user passes an active access token. This change becomes apparent through token forwarding, which we discuss in the following steps.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff63b5b38&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff63b5b38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
</div></li>
<li>
<p>When <code>action.introspectionResponse</code> is configured as <code>application/jwt</code>, the configuration parameter <code>action.forwardedClaimsInProxyHeader</code> is not valid. For <code>application/jwt</code> responses, the configuration value <code>action.forwardToken</code> is used to forward the entire JWT token from the introspection request to the backend. This allows backend services to decode and parse the token to determine how to further process an in-flight user request after it has been introspected and routed by the API proxy.</p>
<p>Upsert the proxy with an updated Introspection policy configuration parameter <code>action.forwardToken</code> set to <code>true</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff63d66a8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1ff63d66a8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">PUT https://192.0.2.2/api/acm/v1/services/workspaces/service-ws/proxies/test-proxy</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff65163d8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff65163d8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://192.0.2.5:8080/oauth/v2/oauth-introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/jwt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;forwardToken&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;test-proxy&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;v1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&#34;proxyConfig&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;data-host&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ingress&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePath&#34;</span><span class="p">:</span> <span class="s2">&#34;/&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;basePathVersionAppendRule&#34;</span><span class="p">:</span> <span class="s2">&#34;NONE&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;backends&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceName&#34;</span><span class="p">:</span> <span class="s2">&#34;backend-echo-svc&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;serviceTargets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">               <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;hostname&#34;</span><span class="p">:</span> <span class="s2">&#34;192.0.2.4&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;listener&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;enableTLS&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;port&#34;</span><span class="p">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;transportProtocol&#34;</span><span class="p">:</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">         <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;policies&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">         <span class="nt">&#34;oauth2-introspection&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionEndpoint&#34;</span><span class="p">:</span> <span class="s2">&#34;https://192.0.2.5:8080/oauth/v2/oauth-introspect&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">&#34;introspectionResponse&#34;</span><span class="p">:</span> <span class="s2">&#34;application/jwt&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&#34;forwardToken&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">               <span class="p">},</span>
</span></span><span class="line"><span class="cl">               <span class="nt">&#34;data&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                  <span class="p">{</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientAppID&#34;</span><span class="p">:</span> <span class="s2">&#34;nginx-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                     <span class="nt">&#34;clientSecret&#34;</span><span class="p">:</span> <span class="s2">&#34;&lt;client secret&gt;&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">}</span>
</span></span><span class="line"><span class="cl">               <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">         <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Send a request to the echo server API proxy with the provided access token. When the API proxy parses the user access token and sends it to the OAuth2 Server for introspection, the response JWT token is added to the in-flight request headers as a bearer token in the <code>Authorization</code> header.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff663da68&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff663da68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Authorization: Bearer &lt;access token&gt;
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Authorization: Bearer &lt;access token&gt;
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="opaque-tokens">Opaque Tokens  <a class="headerlink float-right" href="#opaque-tokens" title="Opaque Tokens"><i class="fas fa-link fa-xs"></i></a>
</h3><p>An opaque token, also known as a phantom token, is a random, unique string of characters issued by an OAuth2 server token service as an alternative to JWT access tokens. Opaque tokens are pass-by-reference tokens, meaning they do not carry information and can only be further processed by the token service that issued them. Standard JWT access tokens can be decoded to view any included information. Opaque tokens offer an extra level of security for in-flight requests.</p>
<p>Opaque tokens are supported out-of-the-box with the API Connectivity Manager OAuth2 Introspection policy. Just pass the opaque token in place of the standard access token when a user sends a request to an API proxy with token introspection configured.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Not all OAuth2 Servers support opaque tokens; Keycloak, for example, does not. Check your OAuth2 server documentation to verify support for this token format.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff66977e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff66977e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;OAuth 2 token&gt;&#39;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">POST https://192.0.2.4/my/test/api
</span></span><span class="line"><span class="cl">HEADERS:
</span></span><span class="line"><span class="cl">  Authorization: <span class="s1">&#39;Bearer &lt;OAuth 2 token&gt;&#39;</span></span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1ff6711520&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1ff6711520">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">Request served by echo-host
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">HTTP/1.0 POST /my/test/api
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Host: default_http_07b28d26-9641-4a67-a422-0c4e14f27b03
</span></span><span class="line"><span class="cl">Accept: */*
</span></span><span class="line"><span class="cl">Accept-Encoding: gzip, deflate, br
</span></span><span class="line"><span class="cl">Cache-Control: no-cache
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Length: <span class="m">30</span>
</span></span><span class="line"><span class="cl">Content-Type: application/json
</span></span><span class="line"><span class="cl">X-Correlation-Id: 00342cadec0651b6643fcf092246535f</span></span></code></pre></div>
</div>
        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nms/acm/tutorials/introspection-keycloak.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nms/acm/tutorials/introspection-keycloak.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=OAuth2%20Introspection%20with%20Keycloak&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		
		
		<li style="flex:1; text-align: left; white-space: nowrap;"><a href="http://localhost:1313/nginx-management-suite/acm/tutorials/aws-deploy/" class="" title="Previous -- Amazon Web Services Deployment Guide "><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.378 46.5L1.94 25.06C1.80067 24.9209 1.69014 24.7556 1.61472 24.5738C1.53931 24.3919 1.50049 24.1969 1.50049 24C1.50049 23.8031 1.53931 23.6081 1.61472 23.4262C1.69014 23.2444 1.80067 23.0791 1.94 22.94L23.378 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M45.878 46.5L24.44 25.06C24.3007 24.9209 24.1901 24.7556 24.1147 24.5738C24.0393 24.3919 24.0005 24.1969 24.0005 24C24.0005 23.8031 24.0393 23.6081 24.1147 23.4262C24.1901 23.2444 24.3007 23.0791 24.44 22.94L45.878 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		

		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#what-is-oauth2">What is OAuth2?</a></li>
    <li><a href="#before-you-begin">Before You Begin</a></li>
    <li><a href="#host-setup">Host Setup</a>
      <ul>
        <li><a href="#install-nsm-acm">Install NGINX Management Suite &amp; API Connectivity Manager</a></li>
        <li><a href="#install-agent">Install NGINX Agent on Data Plane Host</a></li>
        <li><a href="#install-echo-server">Install Echo Server</a></li>
        <li><a href="#install-auth-server">Install Authorization Server</a></li>
      </ul>
    </li>
    <li><a href="#configure-keycloak">Configure Keycloak</a>
      <ul>
        <li><a href="#accessing-the-keycloak-ui">Accessing the Keycloak UI</a></li>
        <li><a href="#configure-realm">Configure a Realm</a></li>
        <li><a href="#configure-user">Configure a User</a></li>
        <li><a href="#configure-client">Configure a Client</a></li>
        <li><a href="#configure-custom-role">Configure a Custom Role</a></li>
      </ul>
    </li>
    <li><a href="#test-oauth2-token-introspection">Test OAuth2 Token Introspection</a>
      <ul>
        <li><a href="#get-keycloak-introspection-endpoints">Get the Keycloak Token Introspection Endpoints</a></li>
        <li><a href="#generate-user-access-token">Generate a User Access Token</a></li>
        <li><a href="#introspect-token-test">Introspecting a User Access Token</a></li>
      </ul>
    </li>
    <li><a href="#amc-config">Configure API Connectivity Manager</a>
      <ul>
        <li><a href="#create-workspace-environment">Creating Workspaces &amp; Environment</a></li>
        <li><a href="#create-basic-api-proxy">Create a Basic API Proxy</a></li>
        <li><a href="#upsert-oauth2-introspection-policy">Upsert OAuth2 Introspection Policy</a></li>
        <li><a href="#test-introspection-policy">Testing the Introspection Policy</a></li>
        <li><a href="#custom-token-placement-key">Custom Token Placement &amp; Key</a></li>
        <li><a href="#token-caching">Token Caching</a></li>
        <li><a href="#oauth2-server-hostname-resolution">OAuth2 Server Hostname Resolution</a></li>
        <li><a href="#forwarding-token-claims">Forwarding Token Claims in Proxy Header</a></li>
        <li><a href="#verifying-token-claims">Verifying Introspected Token Claim Values</a></li>
        <li><a href="#custom-error-return-codes">Custom Error Return Codes</a></li>
        <li><a href="#introspection-jwt-response-type--token-forwarding">Introspection JWT Response Type &amp; Token Forwarding</a></li>
        <li><a href="#opaque-tokens">Opaque Tokens</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


