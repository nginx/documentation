<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Disaster recovery | DEV -- docs-nginx-com</title>






<link rel="canonical" href="http://localhost:1313/nginxaas/azure/disaster-recovery/">







<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="" />
<meta name="twitter:title" content="Disaster recovery" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="06/05/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginxaas/azure/">NGINXaaS for Azure</a><i class="fas fa-chevron-right"></i></li>
                
            
                Disaster recovery
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginxaas/azure/disaster-recovery/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginxaas/azure/" alt="NGINXaaS for Azure"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-for-Azure-icon.svg"
                        alt="NGINXaaS for Azure">
                    NGINXaaS for Azure</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/overview/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--overview" aria-controls="nginxaas-azure--overview">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Overview</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--overview" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/overview/overview/"
                                                                href="http://localhost:1313/nginxaas/azure/overview/overview/">Overview and architecture</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/overview/feature-comparison/"
                                                                href="http://localhost:1313/nginxaas/azure/overview/feature-comparison/">Feature comparison</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/getting-started/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--getting-started" aria-controls="nginxaas-azure--getting-started">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Getting started</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--getting-started" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/prerequisites/"
                                                                href="http://localhost:1313/nginxaas/azure/getting-started/prerequisites/">Overview and prerequisites</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/create-deployment/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginxaas-azure--getting-started--create-a-deployment">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Create a deployment</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginxaas-azure--getting-started--create-a-deployment" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/create-deployment/deploy-azure-portal/" href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-azure-portal/">Deploy using the Azure portal</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/create-deployment/deploy-azure-cli/" href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-azure-cli/">Deploy using the Azure CLI</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/create-deployment/deploy-terraform/" href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-terraform/">Deploy using Terraform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/managed-identity-portal/"
                                                                href="http://localhost:1313/nginxaas/azure/getting-started/managed-identity-portal/">Assign Managed Identities</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/ssl-tls-certificates/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginxaas-azure--getting-started--add-ssl-tls-certificates">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Add SSL-TLS certificates</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginxaas-azure--getting-started--add-ssl-tls-certificates" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/ssl-tls-certificates/overview/" href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/overview/">Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-portal/" href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-portal/">Add certificates using the Azure portal</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli/" href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli/">Add certificates using the Azure CLI</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform/" href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform/">Add certificates using Terraform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/nginx-configuration/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginxaas-azure--getting-started--upload-an-nginx-configuration">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Upload an NGINX configuration</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginxaas-azure--getting-started--upload-an-nginx-configuration" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/nginx-configuration/overview/" href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/overview/">Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-portal/" href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-portal/">Upload using the Azure portal</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-azure-cli/" href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-azure-cli/">Upload using the Azure CLI</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/getting-started/nginx-configuration/nginx-configurations-terraform/" href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configurations-terraform/">Upload using Terraform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/getting-started/migrate-from-standard/"
                                                                href="http://localhost:1313/nginxaas/azure/getting-started/migrate-from-standard/">Migrate from Standard to Standard V2</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/app-protect/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--nginx-app-protect-waf" aria-controls="nginxaas-azure--nginx-app-protect-waf">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>NGINX App Protect WAF</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--nginx-app-protect-waf" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/app-protect/enable-waf/"
                                                                href="http://localhost:1313/nginxaas/azure/app-protect/enable-waf/">Enable App Protect WAF</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/app-protect/configure-waf/"
                                                                href="http://localhost:1313/nginxaas/azure/app-protect/configure-waf/">Configure App Protect WAF</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/app-protect/enable-logging/"
                                                                href="http://localhost:1313/nginxaas/azure/app-protect/enable-logging/">Enable App Protect WAF Logs</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/app-protect/disable-waf/"
                                                                href="http://localhost:1313/nginxaas/azure/app-protect/disable-waf/">Disable App Protect WAF</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginxaas/azure/loadbalancer-kubernetes/" href="http://localhost:1313/nginxaas/azure/loadbalancer-kubernetes/">NGINXaaS Load Balancer for Kubernetes</a>
                </li>
                
                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/monitoring/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--logging-and-monitoring" aria-controls="nginxaas-azure--logging-and-monitoring">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Logging and monitoring</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--logging-and-monitoring" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/monitoring/enable-monitoring/"
                                                                href="http://localhost:1313/nginxaas/azure/monitoring/enable-monitoring/">Enable monitoring</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/monitoring/configure-alerts/"
                                                                href="http://localhost:1313/nginxaas/azure/monitoring/configure-alerts/">Configure alerts</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/monitoring/enable-logging/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginxaas-azure--monitoring--enable-nginx-logs">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Enable NGINX logs</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginxaas-azure--monitoring--enable-nginx-logs" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/monitoring/enable-logging/logging-using-portal/" href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-portal/">Enable NGINX logs using Azure Portal</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/monitoring/enable-logging/logging-using-cli/" href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-cli/">Enable NGINX logs using CLI</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/monitoring/enable-logging/logging-using-terraform/" href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-terraform/">Enable NGINX logs using Terraform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/monitoring/metrics-catalog/"
                                                                href="http://localhost:1313/nginxaas/azure/monitoring/metrics-catalog/">Metrics catalog</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/billing/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--marketplace-billing" aria-controls="nginxaas-azure--marketplace-billing">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Marketplace billing</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--marketplace-billing" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/billing/overview/"
                                                                href="http://localhost:1313/nginxaas/azure/billing/overview/">Billing overview</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/billing/usage-and-cost-estimator/"
                                                                href="http://localhost:1313/nginxaas/azure/billing/usage-and-cost-estimator/">Usage and cost estimator</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/client-tools/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--client-tools" aria-controls="nginxaas-azure--client-tools">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Client tools</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--client-tools" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/client-tools/templates/"
                                                                href="http://localhost:1313/nginxaas/azure/client-tools/templates/">Azure Resource Manager templates</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/client-tools/sdk/"
                                                                href="http://localhost:1313/nginxaas/azure/client-tools/sdk/">Azure SDK</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/client-tools/cli/"
                                                                href="http://localhost:1313/nginxaas/azure/client-tools/cli/">Azure CLI</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/quickstart/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--quickstart-guides" aria-controls="nginxaas-azure--quickstart-guides">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Quickstart guides</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--quickstart-guides" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/runtime-state-sharing/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/runtime-state-sharing/">Runtime State Sharing</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/scaling/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/scaling/">Scaling guidance</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/upgrade-channels/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/upgrade-channels/">Upgrade channels</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/basic-caching/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/basic-caching/">Enable content caching</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/hosting-static-content/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/hosting-static-content/">Hosting static content</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/rate-limiting/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/rate-limiting/">Enable rate limiting</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/njs-support/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/njs-support/">Use the njs Scripting language</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/recreate/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/recreate/">Recreating a deployment</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quicksart/security-controls/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginxaas-azure--quickstart--security-controls">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Security controls</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginxaas-azure--quickstart--security-controls" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/quickstart/security-controls/certificates/" href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/certificates/">Use a certificate from Azure Key Vault</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/security-controls/auth-basic/" href="http://localhost:1313/nginxaas/azure/security-controls/auth-basic/">Restricting access with HTTP basic authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/quickstart/security-controls/jwt/" href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/jwt/">Setting up JWT authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/quickstart/security-controls/securing-upstream-traffic/" href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/securing-upstream-traffic/">Securing upstream traffic</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/quickstart/security-controls/oidc/" href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/oidc/">Set up OIDC authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginxaas/azure/quickstart/security-controls/private-link-to-upstreams/" href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/private-link-to-upstreams/">Connect to upstreams with Azure Private Link</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/quickstart/geoip2/"
                                                                href="http://localhost:1313/nginxaas/azure/quickstart/geoip2/">GeoIP2</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginxaas/azure/disaster-recovery/" href="http://localhost:1313/nginxaas/azure/disaster-recovery/">Disaster recovery</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginxaas/azure/get-help/" href="http://localhost:1313/nginxaas/azure/get-help/">Get help</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginxaas/azure/changelog/" href="http://localhost:1313/nginxaas/azure/changelog/">Changelog</a>
                </li>
                
                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginxaas/azure/changelog-archive/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginxaas-azure--changelog-archive" aria-controls="nginxaas-azure--changelog-archive">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Changelog archive</a>
                            </li>
                        </div>
                        <div id="nginxaas-azure--changelog-archive" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/changelog-archive/changelog-2024/"
                                                                href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2024/">2024</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/changelog-archive/changelog-2023/"
                                                                href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2023/">2023</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginxaas/azure/changelog-archive/changelog-2022/"
                                                                href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2022/">2022</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginxaas/azure/known-issues/" href="http://localhost:1313/nginxaas/azure/known-issues/">Known issues</a>
                </li>
                
                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name">NGINX as a Service for Azure</div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-b1e3e074d58fcbbdd10c50a65ab40dd8" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-b1e3e074d58fcbbdd10c50a65ab40dd8" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Overview 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/overview/overview/" style="">Overview and architecture </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/overview/feature-comparison/" style="">Feature comparison </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-24a8fc5618e7ed45d84bfc2edaff214b" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-24a8fc5618e7ed45d84bfc2edaff214b" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Getting started 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/prerequisites/" style="">Overview and prerequisites </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-04d1d4bfaff48e09dee8d38659107858" class="toggle-checkbox" style="display: none;">
            <label for="toggle-04d1d4bfaff48e09dee8d38659107858" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Create a deployment 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-azure-portal/" style="">Deploy using the Azure portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-azure-cli/" style="">Deploy using the Azure CLI </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-terraform/" style="">Deploy using Terraform </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/managed-identity-portal/" style="">Assign Managed Identities </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-239bf8bc73b4f270d8f94e7a0c5b37af" class="toggle-checkbox" style="display: none;">
            <label for="toggle-239bf8bc73b4f270d8f94e7a0c5b37af" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Add SSL-TLS certificates 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/overview/" style="">Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-portal/" style="">Add certificates using the Azure portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-azure-cli/" style="">Add certificates using the Azure CLI </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/ssl-tls-certificates/ssl-tls-certificates-terraform/" style="">Add certificates using Terraform </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-0d1b956b964a1429129d3ad26bd2cb58" class="toggle-checkbox" style="display: none;">
            <label for="toggle-0d1b956b964a1429129d3ad26bd2cb58" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Upload an NGINX configuration 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/overview/" style="">Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-portal/" style="">Upload using the Azure portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configuration-azure-cli/" style="">Upload using the Azure CLI </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/nginx-configuration/nginx-configurations-terraform/" style="">Upload using Terraform </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/getting-started/migrate-from-standard/" style="">Migrate from Standard to Standard V2 </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-33a5cf470d62434a11af8bef0f5f5294" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-33a5cf470d62434a11af8bef0f5f5294" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        NGINX App Protect WAF 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/app-protect/enable-waf/" style="">Enable App Protect WAF </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/app-protect/configure-waf/" style="">Configure App Protect WAF </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/app-protect/enable-logging/" style="">Enable App Protect WAF Logs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/app-protect/disable-waf/" style="">Disable App Protect WAF </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginxaas/azure/loadbalancer-kubernetes/" style="">NGINXaaS Load Balancer for Kubernetes </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-7bf932b51f83e6871bfe46af8d131d95" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-7bf932b51f83e6871bfe46af8d131d95" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Logging and monitoring 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/enable-monitoring/" style="">Enable monitoring </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/configure-alerts/" style="">Configure alerts </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-26757c8aaa8fd20af9231ebfc678066a" class="toggle-checkbox" style="display: none;">
            <label for="toggle-26757c8aaa8fd20af9231ebfc678066a" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Enable NGINX logs 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-portal/" style="">Enable NGINX logs using Azure Portal </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-cli/" style="">Enable NGINX logs using CLI </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/enable-logging/logging-using-terraform/" style="">Enable NGINX logs using Terraform </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/monitoring/metrics-catalog/" style="">Metrics catalog </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-5a8d9766fbb65e8678bc133d88584ff8" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-5a8d9766fbb65e8678bc133d88584ff8" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Marketplace billing 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/billing/overview/" style="">Billing overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/billing/usage-and-cost-estimator/" style="">Usage and cost estimator </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-36f5fc9e9cbbf3dfecaac80efb09db9a" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-36f5fc9e9cbbf3dfecaac80efb09db9a" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Client tools 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/client-tools/templates/" style="">Azure Resource Manager templates </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/client-tools/sdk/" style="">Azure SDK </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/client-tools/cli/" style="">Azure CLI </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-4cee14fd5f479447cf99a9be803e0589" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-4cee14fd5f479447cf99a9be803e0589" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Quickstart guides 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/runtime-state-sharing/" style="">Runtime State Sharing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/scaling/" style="">Scaling guidance </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/upgrade-channels/" style="">Upgrade channels </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/basic-caching/" style="">Enable content caching </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/hosting-static-content/" style="">Hosting static content </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/rate-limiting/" style="">Enable rate limiting </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/njs-support/" style="">Use the njs Scripting language </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/recreate/" style="">Recreating a deployment </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-a11b6eed6d79756be9583ebae901417d" class="toggle-checkbox" style="display: none;">
            <label for="toggle-a11b6eed6d79756be9583ebae901417d" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Security controls 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/certificates/" style="">Use a certificate from Azure Key Vault </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/security-controls/auth-basic/" style="">Restricting access with HTTP basic authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/jwt/" style="">Setting up JWT authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/securing-upstream-traffic/" style="">Securing upstream traffic </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/oidc/" style="">Set up OIDC authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/security-controls/private-link-to-upstreams/" style="">Connect to upstreams with Azure Private Link </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/quickstart/geoip2/" style="">GeoIP2 </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                          
                        <span class="parent-box current"></span>                 
                    
                    <a href="http://localhost:1313/nginxaas/azure/disaster-recovery/" style="font-weight: bold;">Disaster recovery </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginxaas/azure/get-help/" style="">Get help </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginxaas/azure/changelog/" style="">Changelog </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-859d338d0f258b9da7d78a0ebc3a15b3" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-859d338d0f258b9da7d78a0ebc3a15b3" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Changelog archive 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2024/" style="">2024 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2023/" style="">2023 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginxaas/azure/changelog-archive/changelog-2022/" style="">2022 </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginxaas/azure/known-issues/" style="">Known issues </a> 
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginxaas/azure/">NGINXaaS for Azure</a><i class="fas fa-chevron-right"></i></li>
                
            
                Disaster recovery
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>Disaster recovery</h1>
        <p>This guide describes how to configure disaster recovery (DR) for F5 NGINX as a Service for Azure deployments in separate (ideally <a href="https://learn.microsoft.com/en-us/azure/reliability/regions-paired" target="_blank" rel="noopener">paired</a>) Azure regions, ensuring upstream access remains available even if the primary NGINXaaS deployment in a region fails. The deployment architecture ensures users can access backend application servers (upstreams) continuously from an alternative region if the primary NGINXaaS deployment becomes unavailable. The solution leverages Terraform, Azure Traffic Manager, Azure Virtual Network (VNet) peering, and unique subnets to support failover.</p>
<hr>
<p><strong>Architecture Overview</strong></p>
<figure><img class="figure-bitmap" src="/nginxaas-azure/n4a-dr-topology.png"
    alt="The diagram illustrates the configuration of F5 NGINXaaS for Azure deployments for disaster recovery. It shows how the end users can still access the applications provided by AppServer - Primary1 and AppServer - Primary2 if the primary NGINXaaS deployment goes down.">
</figure>
<ul>
<li>Each region has its own VNet, subnet, and NGINXaaS for Azure deployment.</li>
<li>The NGINXaaS for Azure deployment needs to have a public frontend to leverage Azure Traffic Manager.</li>
<li>Cross region connectivity ensures that upstreams are reachable from either deployment. We use VNet peering in this guide to establish that connectivity.</li>
<li>Upstreams (for example, VMs) are accessible from either NGINX deployment.</li>
</ul>
<hr>
<h2 
id="prerequisites">Prerequisites  <a class="headerlink float-right" href="#prerequisites" title="Prerequisites"><i class="fas fa-link fa-xs"></i></a>
</h2><ul>
<li>Two Azure regions selected for DR.</li>
<li>Unique, non-overlapping VNet and subnet address spaces for each region.</li>
<li>Terraform 1.3+ and AzureRM provider 4.23+.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> <p>Each NGINX deployment <strong>must run on separate subnets and non-overlapping address spaces</strong>. This is critical for <a href="https://learn.microsoft.com/en-us/azure/virtual-network/how-to-configure-subnet-peering" target="_blank" rel="noopener">Virtual Network (VNet) peering</a> between the two regions. For example:</p>
<ul>
<li>Primary Region Virtual Network Address Space: <code>10.0.0.0/16</code></li>
<li>Secondary Region Virtual Network Address Space: <code>172.16.0.0/16</code></li>
</ul></div>
</blockquote>

<hr>
<h2 
id="configure-disaster-recovery">Configure disaster recovery  <a class="headerlink float-right" href="#configure-disaster-recovery" title="Configure disaster recovery"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="step-1-terrraform-setup">Step 1: Terrraform setup  <a class="headerlink float-right" href="#step-1-terrraform-setup" title="Step 1: Terrraform setup"><i class="fas fa-link fa-xs"></i></a>
</h3><p>To get started, please review the <a href="http://localhost:1313/nginxaas/azure/getting-started/create-deployment/deploy-terraform/#prerequisites">Terraform prerequisites</a> for NGINX as a Service for Azure.
The following steps outline Terraform resources required to set up the disaster recovery topology; these resources can be placed in a <code>main.tf</code> file, variables used by these resources can go into <code>variables.tf</code>, and outputs you need to collect can be defined in <code>outputs.tf</code>. The directory structure looks as follows:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbc4c9388&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbc4c9388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- main.tf
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- outputs.tf
</span></span><span class="line"><span class="cl"><span class="sb">`</span>-- variables.tf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ tree
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- main.tf
</span></span><span class="line"><span class="cl"><span class="p">|</span>-- outputs.tf
</span></span><span class="line"><span class="cl"><span class="sb">`</span>-- variables.tf</span></span></code></pre></div>
</div><p>To execute the Terraform code, <code>cd</code> into the directory with these files and run:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbc50fc70&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbc50fc70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform init
</span></span><span class="line"><span class="cl">terraform plan
</span></span><span class="line"><span class="cl">terraform apply --auto-approve</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">terraform init
</span></span><span class="line"><span class="cl">terraform plan
</span></span><span class="line"><span class="cl">terraform apply --auto-approve</span></span></code></pre></div>
</div><h3 
id="step-2-deploy-prerequisite-infrastructure">Step 2: Deploy prerequisite infrastructure  <a class="headerlink float-right" href="#step-2-deploy-prerequisite-infrastructure" title="Step 2: Deploy prerequisite infrastructure"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Each region requires its own VNet, subnet(s), public IP and network security group.</p>
<details closed>
<summary style="font-weight:bold">This sample Terraform code creates the prerequisite resources.</summary>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">hcl</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbc7fd4a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbc7fd4a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="c1"># Primary Region
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_resource_group&#34; &#34;primary_resource_group&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_public_ip&#34; &#34;primary_pip&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network&#34; &#34;primary_virtual_network&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  address_space</span> <span class="o">=</span> <span class="p">[</span><span class="k">var</span><span class="p">.</span><span class="k">primary_vnet_addr_space</span><span class="p">]</span><span class="c1"> # - 10.0.0.0/16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span>      <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;primary_subnet_1&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">)]</span><span class="c1"> # - 10.0.0.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">service_delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">      name</span> <span class="o">=</span> <span class="s2">&#34;NGINX.NGINXPLUS/nginxDeployments&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">      actions</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Microsoft.Network/virtualNetworks/subnets/join/action&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_security_group&#34; &#34;primary_virtual_network_nsg&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">security_rule</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    priority</span>  <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">    direction</span> <span class="o">=</span> <span class="s2">&#34;Inbound&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    access</span>    <span class="o">=</span> <span class="s2">&#34;Allow&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>  <span class="o">=</span> <span class="s2">&#34;Tcp&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet_network_security_group_association&#34; &#34;primary_virtual_network_nsg_association&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  subnet_id</span>                 <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">primary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  network_security_group_id</span> <span class="o">=</span> <span class="k">azurerm_network_security_group</span><span class="p">.</span><span class="k">primary_virtual_network_nsg</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1"># Secondary Region
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_resource_group&#34; &#34;secondary_resource_group&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_public_ip&#34; &#34;secondary_pip&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network&#34; &#34;secondary_virtual_network&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  address_space</span> <span class="o">=</span> <span class="p">[</span><span class="k">var</span><span class="p">.</span><span class="k">secondary_vnet_addr_space</span><span class="p">]</span><span class="c1"> # - 172.16.0.0/16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span>      <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;secondary_subnet_1&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">)]</span><span class="c1"> # - 172.16.0.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">service_delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">      name</span> <span class="o">=</span> <span class="s2">&#34;NGINX.NGINXPLUS/nginxDeployments&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">      actions</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Microsoft.Network/virtualNetworks/subnets/join/action&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_security_group&#34; &#34;secondary_virtual_network_nsg&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">security_rule</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    priority</span>  <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">    direction</span> <span class="o">=</span> <span class="s2">&#34;Inbound&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    access</span>    <span class="o">=</span> <span class="s2">&#34;Allow&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>  <span class="o">=</span> <span class="s2">&#34;Tcp&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet_network_security_group_association&#34; &#34;secondary_virtual_network_nsg_association&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  subnet_id</span>                 <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">secondary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  network_security_group_id</span> <span class="o">=</span> <span class="k">azurerm_network_security_group</span><span class="p">.</span><span class="k">secondary_virtual_network_nsg</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="c1"># Primary Region
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_resource_group&#34; &#34;primary_resource_group&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_public_ip&#34; &#34;primary_pip&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network&#34; &#34;primary_virtual_network&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  address_space</span> <span class="o">=</span> <span class="p">[</span><span class="k">var</span><span class="p">.</span><span class="k">primary_vnet_addr_space</span><span class="p">]</span><span class="c1"> # - 10.0.0.0/16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span>      <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;primary_subnet_1&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">)]</span><span class="c1"> # - 10.0.0.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">service_delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">      name</span> <span class="o">=</span> <span class="s2">&#34;NGINX.NGINXPLUS/nginxDeployments&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">      actions</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Microsoft.Network/virtualNetworks/subnets/join/action&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_security_group&#34; &#34;primary_virtual_network_nsg&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">security_rule</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    priority</span>  <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">    direction</span> <span class="o">=</span> <span class="s2">&#34;Inbound&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    access</span>    <span class="o">=</span> <span class="s2">&#34;Allow&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>  <span class="o">=</span> <span class="s2">&#34;Tcp&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet_network_security_group_association&#34; &#34;primary_virtual_network_nsg_association&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  subnet_id</span>                 <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">primary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  network_security_group_id</span> <span class="o">=</span> <span class="k">azurerm_network_security_group</span><span class="p">.</span><span class="k">primary_virtual_network_nsg</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1"># Secondary Region
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_resource_group&#34; &#34;secondary_resource_group&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_public_ip&#34; &#34;secondary_pip&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network&#34; &#34;secondary_virtual_network&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  address_space</span> <span class="o">=</span> <span class="p">[</span><span class="k">var</span><span class="p">.</span><span class="k">secondary_vnet_addr_space</span><span class="p">]</span><span class="c1"> # - 172.16.0.0/16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span>      <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;secondary_subnet_1&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">0</span><span class="p">)]</span><span class="c1"> # - 172.16.0.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span> <span class="o">=</span> <span class="s2">&#34;nginx&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">service_delegation</span> {
</span></span><span class="line"><span class="cl"><span class="n">      name</span> <span class="o">=</span> <span class="s2">&#34;NGINX.NGINXPLUS/nginxDeployments&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">      actions</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Microsoft.Network/virtualNetworks/subnets/join/action&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_security_group&#34; &#34;secondary_virtual_network_nsg&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  location</span> <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">security_rule</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    priority</span>  <span class="o">=</span> <span class="m">100</span>
</span></span><span class="line"><span class="cl"><span class="n">    direction</span> <span class="o">=</span> <span class="s2">&#34;Inbound&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    access</span>    <span class="o">=</span> <span class="s2">&#34;Allow&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>  <span class="o">=</span> <span class="s2">&#34;Tcp&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet_network_security_group_association&#34; &#34;secondary_virtual_network_nsg_association&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  subnet_id</span>                 <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">secondary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  network_security_group_id</span> <span class="o">=</span> <span class="k">azurerm_network_security_group</span><span class="p">.</span><span class="k">secondary_virtual_network_nsg</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
</div></details>
<hr>
<h3 
id="step-3-configure-app-servers-upstreams">Step 3: Configure app servers (upstreams)  <a class="headerlink float-right" href="#step-3-configure-app-servers-upstreams" title="Step 3: Configure app servers (upstreams)"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You may already have upstreams in the primary region that you wish to reverse proxy using NGINXaaS. For the sake of completion, the following example shows creation of Primary Subnet 2, NICs for the upstreams and the upstreams themselves. The upstream VMs need to be in a subnet separate from the NGINXaaS deployment subnet in the <strong>primary region</strong>.</p>
<details closed>
<summary style="font-weight:bold">This sample Terraform code creates and configures the upstreams.</summary>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">hcl</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbc9ade80&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbc9ade80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;primary_subnet_2&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">1</span><span class="p">)]</span><span class="c1"> # - 10.0.1.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_interface&#34; &#34;app_server_nic&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  count</span>               <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-vm${count.index + 1}-nic&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">ip_configuration</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span>                          <span class="o">=</span> <span class="s2">&#34;internal&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span>                     <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">upstreams</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">    private_ip_address_allocation</span> <span class="o">=</span> <span class="s2">&#34;Dynamic&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_linux_virtual_machine&#34; &#34;nginx_upstream_vm&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  count</span>               <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-upstream${count.index + 1}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  network_interface_ids</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">azurerm_network_interface</span><span class="p">.</span><span class="k">app_server_nic</span><span class="p">[</span><span class="k">count</span><span class="p">.</span><span class="k">index</span><span class="p">].</span><span class="k">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">source_image_reference</span> {
</span></span><span class="line"><span class="cl"><span class="n">    publisher</span> <span class="o">=</span> <span class="s2">&#34;Canonical&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    offer</span>     <span class="o">=</span> <span class="s2">&#34;0001-com-ubuntu-server-jammy&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    sku</span>       <span class="o">=</span> <span class="s2">&#34;22_04-lts-gen2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    version</span>   <span class="o">=</span> <span class="s2">&#34;latest&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  custom_data</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOF</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    #!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">sudo</span> <span class="k">apt</span> <span class="k">update</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">apt</span> <span class="k">install</span> <span class="k">nginx</span> <span class="err">-</span><span class="k">y</span>
</span></span><span class="line"><span class="cl"><span class="n">    VM_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="k">hostname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    IP</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="k">ip</span> <span class="k">addr</span> <span class="k">show</span> <span class="err">$</span><span class="p">(</span><span class="k">ip</span> <span class="k">route</span> <span class="k">show</span> <span class="k">default</span> <span class="err">|</span> <span class="k">awk</span> <span class="err">&#39;/</span><span class="k">default</span><span class="err">/</span> {<span class="k">print</span> <span class="err">$</span><span class="m">5</span>}<span class="err">&#39;</span><span class="p">)</span> <span class="err">|</span> <span class="k">awk</span> <span class="err">&#39;/</span><span class="k">inet</span> <span class="err">/</span> {<span class="k">print</span> <span class="err">$</span><span class="m">2</span>}<span class="err">&#39;</span> <span class="err">|</span> <span class="k">cut</span> <span class="err">-</span><span class="k">d</span><span class="err">/</span> <span class="err">-</span><span class="k">f1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;Hello from $VM_ID: $IP&#34;</span> <span class="err">|</span> <span class="k">sudo</span> <span class="k">tee</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">www</span><span class="err">/</span><span class="k">html</span><span class="err">/</span><span class="k">index</span><span class="p">.</span><span class="k">html</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">systemctl</span> <span class="k">enable</span> <span class="k">nginx</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">systemctl</span> <span class="k">restart</span> <span class="k">nginx</span>
</span></span><span class="line"><span class="cl">  <span class="k">EOF</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_subnet&#34; &#34;primary_subnet_2&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  virtual_network_name</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  address_prefixes</span>     <span class="o">=</span> <span class="p">[</span><span class="k">cidrsubnet</span><span class="p">(</span><span class="k">var</span><span class="p">.</span><span class="k">vnet_addr_space</span><span class="p">,</span> <span class="m">8</span><span class="p">,</span> <span class="m">1</span><span class="p">)]</span><span class="c1"> # - 10.0.1.0/24
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_network_interface&#34; &#34;app_server_nic&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  count</span>               <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-vm${count.index + 1}-nic&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">ip_configuration</span> {
</span></span><span class="line"><span class="cl"><span class="n">    name</span>                          <span class="o">=</span> <span class="s2">&#34;internal&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span>                     <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">upstreams</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">    private_ip_address_allocation</span> <span class="o">=</span> <span class="s2">&#34;Dynamic&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_linux_virtual_machine&#34; &#34;nginx_upstream_vm&#34;</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  count</span>               <span class="o">=</span> <span class="m">2</span>
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-upstream${count.index + 1}&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  network_interface_ids</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">azurerm_network_interface</span><span class="p">.</span><span class="k">app_server_nic</span><span class="p">[</span><span class="k">count</span><span class="p">.</span><span class="k">index</span><span class="p">].</span><span class="k">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">source_image_reference</span> {
</span></span><span class="line"><span class="cl"><span class="n">    publisher</span> <span class="o">=</span> <span class="s2">&#34;Canonical&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    offer</span>     <span class="o">=</span> <span class="s2">&#34;0001-com-ubuntu-server-jammy&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    sku</span>       <span class="o">=</span> <span class="s2">&#34;22_04-lts-gen2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    version</span>   <span class="o">=</span> <span class="s2">&#34;latest&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">  custom_data</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOF</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    #!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">sudo</span> <span class="k">apt</span> <span class="k">update</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">apt</span> <span class="k">install</span> <span class="k">nginx</span> <span class="err">-</span><span class="k">y</span>
</span></span><span class="line"><span class="cl"><span class="n">    VM_ID</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="k">hostname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    IP</span><span class="o">=</span><span class="err">$</span><span class="p">(</span><span class="k">ip</span> <span class="k">addr</span> <span class="k">show</span> <span class="err">$</span><span class="p">(</span><span class="k">ip</span> <span class="k">route</span> <span class="k">show</span> <span class="k">default</span> <span class="err">|</span> <span class="k">awk</span> <span class="err">&#39;/</span><span class="k">default</span><span class="err">/</span> {<span class="k">print</span> <span class="err">$</span><span class="m">5</span>}<span class="err">&#39;</span><span class="p">)</span> <span class="err">|</span> <span class="k">awk</span> <span class="err">&#39;/</span><span class="k">inet</span> <span class="err">/</span> {<span class="k">print</span> <span class="err">$</span><span class="m">2</span>}<span class="err">&#39;</span> <span class="err">|</span> <span class="k">cut</span> <span class="err">-</span><span class="k">d</span><span class="err">/</span> <span class="err">-</span><span class="k">f1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">echo</span> <span class="s2">&#34;Hello from $VM_ID: $IP&#34;</span> <span class="err">|</span> <span class="k">sudo</span> <span class="k">tee</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">www</span><span class="err">/</span><span class="k">html</span><span class="err">/</span><span class="k">index</span><span class="p">.</span><span class="k">html</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">systemctl</span> <span class="k">enable</span> <span class="k">nginx</span>
</span></span><span class="line"><span class="cl">    <span class="k">sudo</span> <span class="k">systemctl</span> <span class="k">restart</span> <span class="k">nginx</span>
</span></span><span class="line"><span class="cl">  <span class="k">EOF</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
</div></details>
<br>
<blockquote>
<p><strong>Note</strong>: As a best practice, maintain identical upstream resources in your secondary region as in your primary region to ensure full protection and availability in the event of a region-wide outage or disaster.</p>
</blockquote>
<hr>
<h3 
id="step-4-peer-the-vnets">Step 4: Peer the VNets  <a class="headerlink float-right" href="#step-4-peer-the-vnets" title="Step 4: Peer the VNets"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Peer the virtual networks so that the upstream app servers are accessible from either primary or secondary NGINXaaS deployment.</p>
<details closed>
<summary style="font-weight:bold">This sample Terraform code configures peering for the virtual networks.</summary>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">hcl</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbca70f98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbca70f98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network_peering&#34; &#34;primary_vnet_to_secondary_vnet&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                      <span class="o">=</span> <span class="s2">&#34;peering-primary-vnet-to-secondary-vnet&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  virtual_network_name</span>      <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  remote_virtual_network_id</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network_peering&#34; &#34;secondary_vnet_to_primary_vnet&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                      <span class="o">=</span> <span class="s2">&#34;peering-secondary-vnet-to-primary-vnet&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">resource_group_secondary</span>
</span></span><span class="line"><span class="cl"><span class="n">  virtual_network_name</span>      <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  remote_virtual_network_id</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network_peering&#34; &#34;primary_vnet_to_secondary_vnet&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                      <span class="o">=</span> <span class="s2">&#34;peering-primary-vnet-to-secondary-vnet&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  virtual_network_name</span>      <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  remote_virtual_network_id</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_virtual_network_peering&#34; &#34;secondary_vnet_to_primary_vnet&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                      <span class="o">=</span> <span class="s2">&#34;peering-secondary-vnet-to-primary-vnet&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span>       <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">resource_group_secondary</span>
</span></span><span class="line"><span class="cl"><span class="n">  virtual_network_name</span>      <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">secondary_virtual_network</span><span class="p">.</span><span class="k">name</span>
</span></span><span class="line"><span class="cl"><span class="n">  remote_virtual_network_id</span> <span class="o">=</span> <span class="k">azurerm_virtual_network</span><span class="p">.</span><span class="k">primary_virtual_network</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
</div></details>
<br>
<ul>
<li>
<p><strong>Subnet Peering for Overlapping VNets:</strong>
If overlapping address spaces are unavoidable, use subnet-level peering to selectively peer only the required subnets.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> As of May 2025, subnet peering is not available by default for all subscriptions. To use this feature, you must have the subscription on which you want to configure subnet peering be registered with Azure. Please review the configuration details and limitations in this <a href="https://learn.microsoft.com/en-us/azure/virtual-network/how-to-configure-subnet-peering" target="_blank" rel="noopener">document</a>.</div>
</blockquote>

</li>
</ul>
<hr>
<h3 
id="step-5-deploy-nginxaas-for-azure-in-each-region">Step 5: Deploy NGINXaaS for Azure in each region  <a class="headerlink float-right" href="#step-5-deploy-nginxaas-for-azure-in-each-region" title="Step 5: Deploy NGINXaaS for Azure in each region"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Reverse proxy your upstreams using NGINXaaS. Since the virtual networks are peered, both deployments would be able to access the upstreams.</p>
<details closed>
<summary style="font-weight:bold">This sample Terraform code deploys and configures both primary and secondary NGINXaaS deployments.</summary>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">hcl</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbce992f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbce992f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_deployment&#34; &#34;primary_nginxaas_deployment&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_deployment_name</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">network_interface</span> {
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span> <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">primary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_configuration&#34; &#34;primary_nginxaas_config&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  nginx_deployment_id</span> <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">primary_nginxaas_deployment</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  root_file</span>           <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">config_file</span> {
</span></span><span class="line"><span class="cl"><span class="n">    content</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOT</span>
</span></span><span class="line"><span class="cl"><span class="k">user</span> <span class="k">nginx</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="k">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="m">8192</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="err">/</span><span class="k">run</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">nginx</span><span class="p">.</span><span class="k">pid</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> {
</span></span><span class="line"><span class="cl">    <span class="k">worker_connections</span> <span class="m">4000</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">log</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">error</span><span class="p">.</span><span class="k">log</span> <span class="k">error</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> {
</span></span><span class="line"><span class="cl">    <span class="k">upstream</span> <span class="k">backend_servers</span> {
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">1</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">2</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">keepalive</span> <span class="m">16</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">server</span> {
</span></span><span class="line"><span class="cl">        <span class="k">listen</span> <span class="m">80</span> <span class="k">default_server</span><span class="err">;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">        # /health will be used for Azure Traffic Manager Profile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">location</span> <span class="err">/</span><span class="k">health</span> {
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="m">200</span> <span class="err">&#39;</span><span class="k">nginx</span> <span class="k">proxy</span> <span class="k">alive</span><span class="err">&#39;;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">location</span> <span class="err">/</span> {
</span></span><span class="line"><span class="cl">            <span class="k">proxy_pass</span> <span class="k">http</span><span class="err">://</span><span class="k">backend_servers</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">Host</span> <span class="err">$</span><span class="k">host</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Real</span><span class="err">-</span><span class="k">IP</span> <span class="err">$</span><span class="k">remote_addr</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Forwarded</span><span class="err">-</span><span class="k">For</span> <span class="err">$</span><span class="k">proxy_add_x_forwarded_for</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_next_upstream</span> <span class="k">error</span> <span class="k">timeout</span> <span class="k">http_500</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_http_version</span> <span class="m">1</span><span class="p">.</span><span class="m">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span>   <span class="s2">&#34;Connection&#34; &#34;&#34;</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"><span class="k">EOT</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    virtual_path</span> <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1"># The secondary NGINXaaS deployment is identical to primary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_deployment&#34; &#34;secondary_nginxaas_deployment&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">secondary_deployment_name</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">secondary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">network_interface</span> {
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span> <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">secondary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_configuration&#34; &#34;secondary_nginxaas_config&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  nginx_deployment_id</span> <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">secondary_nginxaas_deployment</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  root_file</span>           <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">config_file</span> {
</span></span><span class="line"><span class="cl"><span class="n">    content</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOT</span>
</span></span><span class="line"><span class="cl"><span class="k">user</span> <span class="k">nginx</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="k">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="m">8192</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="err">/</span><span class="k">run</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">nginx</span><span class="p">.</span><span class="k">pid</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> {
</span></span><span class="line"><span class="cl">    <span class="k">worker_connections</span> <span class="m">4000</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">log</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">error</span><span class="p">.</span><span class="k">log</span> <span class="k">error</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> {
</span></span><span class="line"><span class="cl">    <span class="k">upstream</span> <span class="k">backend_servers</span> {
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">1</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">2</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">keepalive</span> <span class="m">16</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">server</span> {
</span></span><span class="line"><span class="cl">        <span class="k">listen</span> <span class="m">80</span> <span class="k">default_server</span><span class="err">;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">        # /health will be used for Azure Traffic Manager Profile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">location</span> <span class="err">/</span><span class="k">health</span> {
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="m">200</span> <span class="err">&#39;</span><span class="k">nginx</span> <span class="k">proxy</span> <span class="k">alive</span><span class="err">&#39;;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">location</span> <span class="err">/</span> {
</span></span><span class="line"><span class="cl">            <span class="k">proxy_pass</span> <span class="k">http</span><span class="err">://</span><span class="k">backend_servers</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">Host</span> <span class="err">$</span><span class="k">host</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Real</span><span class="err">-</span><span class="k">IP</span> <span class="err">$</span><span class="k">remote_addr</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Forwarded</span><span class="err">-</span><span class="k">For</span> <span class="err">$</span><span class="k">proxy_add_x_forwarded_for</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_next_upstream</span> <span class="k">error</span> <span class="k">timeout</span> <span class="k">http_500</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_http_version</span> <span class="m">1</span><span class="p">.</span><span class="m">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span>   <span class="s2">&#34;Connection&#34; &#34;&#34;</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"><span class="k">EOT</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    virtual_path</span> <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_deployment&#34; &#34;primary_nginxaas_deployment&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_deployment_name</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">primary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;eastus&#34;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">network_interface</span> {
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span> <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">primary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_configuration&#34; &#34;primary_nginxaas_config&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  nginx_deployment_id</span> <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">primary_nginxaas_deployment</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  root_file</span>           <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">config_file</span> {
</span></span><span class="line"><span class="cl"><span class="n">    content</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOT</span>
</span></span><span class="line"><span class="cl"><span class="k">user</span> <span class="k">nginx</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="k">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="m">8192</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="err">/</span><span class="k">run</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">nginx</span><span class="p">.</span><span class="k">pid</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> {
</span></span><span class="line"><span class="cl">    <span class="k">worker_connections</span> <span class="m">4000</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">log</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">error</span><span class="p">.</span><span class="k">log</span> <span class="k">error</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> {
</span></span><span class="line"><span class="cl">    <span class="k">upstream</span> <span class="k">backend_servers</span> {
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">1</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">2</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">keepalive</span> <span class="m">16</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">server</span> {
</span></span><span class="line"><span class="cl">        <span class="k">listen</span> <span class="m">80</span> <span class="k">default_server</span><span class="err">;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">        # /health will be used for Azure Traffic Manager Profile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">location</span> <span class="err">/</span><span class="k">health</span> {
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="m">200</span> <span class="err">&#39;</span><span class="k">nginx</span> <span class="k">proxy</span> <span class="k">alive</span><span class="err">&#39;;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">location</span> <span class="err">/</span> {
</span></span><span class="line"><span class="cl">            <span class="k">proxy_pass</span> <span class="k">http</span><span class="err">://</span><span class="k">backend_servers</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">Host</span> <span class="err">$</span><span class="k">host</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Real</span><span class="err">-</span><span class="k">IP</span> <span class="err">$</span><span class="k">remote_addr</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Forwarded</span><span class="err">-</span><span class="k">For</span> <span class="err">$</span><span class="k">proxy_add_x_forwarded_for</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_next_upstream</span> <span class="k">error</span> <span class="k">timeout</span> <span class="k">http_500</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_http_version</span> <span class="m">1</span><span class="p">.</span><span class="m">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span>   <span class="s2">&#34;Connection&#34; &#34;&#34;</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"><span class="k">EOT</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    virtual_path</span> <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1"># The secondary NGINXaaS deployment is identical to primary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_deployment&#34; &#34;secondary_nginxaas_deployment&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">secondary_deployment_name</span>
</span></span><span class="line"><span class="cl"><span class="n">  resource_group_name</span> <span class="o">=</span> <span class="k">var</span><span class="p">.</span><span class="k">secondary_resource_group</span>
</span></span><span class="line"><span class="cl"><span class="n">  location</span>            <span class="o">=</span> <span class="s2">&#34;centralus&#34;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">  # ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">network_interface</span> {
</span></span><span class="line"><span class="cl"><span class="n">    subnet_id</span> <span class="o">=</span> <span class="k">azurerm_subnet</span><span class="p">.</span><span class="k">secondary_subnet_1</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_nginx_configuration&#34; &#34;secondary_nginxaas_config&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  nginx_deployment_id</span> <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">secondary_nginxaas_deployment</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  root_file</span>           <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">config_file</span> {
</span></span><span class="line"><span class="cl"><span class="n">    content</span> <span class="o">=</span> <span class="k">base64encode</span><span class="p">(</span><span class="err">&lt;&lt;-</span><span class="k">EOT</span>
</span></span><span class="line"><span class="cl"><span class="k">user</span> <span class="k">nginx</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="k">auto</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="m">8192</span><span class="err">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="err">/</span><span class="k">run</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">nginx</span><span class="p">.</span><span class="k">pid</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> {
</span></span><span class="line"><span class="cl">    <span class="k">worker_connections</span> <span class="m">4000</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="err">/</span><span class="k">var</span><span class="err">/</span><span class="k">log</span><span class="err">/</span><span class="k">nginx</span><span class="err">/</span><span class="k">error</span><span class="p">.</span><span class="k">log</span> <span class="k">error</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> {
</span></span><span class="line"><span class="cl">    <span class="k">upstream</span> <span class="k">backend_servers</span> {
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">1</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">server</span> <span class="err">&lt;</span><span class="k">Upstream</span><span class="err">-</span><span class="m">2</span><span class="err">-</span><span class="k">private</span><span class="err">-</span><span class="k">ip</span><span class="err">&gt;:</span><span class="m">80</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">keepalive</span> <span class="m">16</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">    <span class="k">server</span> {
</span></span><span class="line"><span class="cl">        <span class="k">listen</span> <span class="m">80</span> <span class="k">default_server</span><span class="err">;</span><span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">        # /health will be used for Azure Traffic Manager Profile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">location</span> <span class="err">/</span><span class="k">health</span> {
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="m">200</span> <span class="err">&#39;</span><span class="k">nginx</span> <span class="k">proxy</span> <span class="k">alive</span><span class="err">&#39;;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">        <span class="k">location</span> <span class="err">/</span> {
</span></span><span class="line"><span class="cl">            <span class="k">proxy_pass</span> <span class="k">http</span><span class="err">://</span><span class="k">backend_servers</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">Host</span> <span class="err">$</span><span class="k">host</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Real</span><span class="err">-</span><span class="k">IP</span> <span class="err">$</span><span class="k">remote_addr</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span> <span class="k">X</span><span class="err">-</span><span class="k">Forwarded</span><span class="err">-</span><span class="k">For</span> <span class="err">$</span><span class="k">proxy_add_x_forwarded_for</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_next_upstream</span> <span class="k">error</span> <span class="k">timeout</span> <span class="k">http_500</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_http_version</span> <span class="m">1</span><span class="p">.</span><span class="m">1</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">proxy_set_header</span>   <span class="s2">&#34;Connection&#34; &#34;&#34;</span><span class="err">;</span>
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"><span class="k">EOT</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">    virtual_path</span> <span class="o">=</span> <span class="s2">&#34;/etc/nginx/nginx.conf&#34;</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
</div></details>
<hr>
<h3 
id="step-6-dns-and-failover">Step 6: DNS and failover  <a class="headerlink float-right" href="#step-6-dns-and-failover" title="Step 6: DNS and failover"><i class="fas fa-link fa-xs"></i></a>
</h3><ul>
<li>Use Azure Traffic Manager to direct traffic to the primary NGINXaaS deployment.</li>
<li>When the primary deployment is detected as being unhealthy, Azure Traffic Manager updates the public DNS record of your service to point to the public IP of the NGINXaaS deployment in the secondary region.</li>
</ul>
<details closed>
<summary style="font-weight:bold">This sample Terraform code configures Azure Traffic Manager to point to both NGINXaaS deployments.</summary>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">hcl</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fbcf7ac50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fbcf7ac50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_profile&#34; &#34;nginxaas_failover_monitor&#34;</span> {
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">  traffic_routing_method</span> <span class="o">=</span> <span class="s2">&#34;Priority&#34;</span><span class="c1"> # Chooses one deployment or the other
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">dns_config</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # relative_name needs to be globally unique
</span></span></span><span class="line"><span class="cl"><span class="c1">    # &lt;relative_name&gt;.trafficmanager.net resolves to the public IP of either NGINXaaS deployment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    relative_name</span> <span class="o">=</span> <span class="s2">&#34;nginxaas-global-record&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    ttl</span>           <span class="o">=</span> <span class="m">60</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">monitor_config</span> {
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>                     <span class="o">=</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    port</span>                         <span class="o">=</span> <span class="m">80</span>
</span></span><span class="line"><span class="cl"><span class="n">    path</span>                         <span class="o">=</span> <span class="s2">&#34;/health&#34;</span><span class="c1"> #endpoint implemented in NGINXaaS configuration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    interval_in_seconds</span>          <span class="o">=</span> <span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="n">    timeout_in_seconds</span>           <span class="o">=</span> <span class="m">9</span>
</span></span><span class="line"><span class="cl"><span class="n">    tolerated_number_of_failures</span> <span class="o">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_external_endpoint&#34; &#34;primary&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-primary&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  profile_id</span>          <span class="o">=</span> <span class="k">azurerm_traffic_manager_profile</span><span class="p">.</span><span class="k">nginxaas_failover_monitor</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  priority</span>            <span class="o">=</span> <span class="m">10</span><span class="c1"> # Lower number results in higher priority
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  target</span>              <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">primary_nginxaas_deployment</span><span class="p">.</span><span class="k">ip_address</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_external_endpoint&#34; &#34;secondary&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-secondary&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  profile_id</span>          <span class="o">=</span> <span class="k">azurerm_traffic_manager_profile</span><span class="p">.</span><span class="k">nginxaas_failover_monitor</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  priority</span>            <span class="o">=</span> <span class="m">20</span>
</span></span><span class="line"><span class="cl"><span class="n">  target</span>              <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">secondary_nginxaas_deployment</span><span class="p">.</span><span class="k">ip_address</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-hcl" data-lang="hcl"><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_profile&#34; &#34;nginxaas_failover_monitor&#34;</span> {
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="n">  traffic_routing_method</span> <span class="o">=</span> <span class="s2">&#34;Priority&#34;</span><span class="c1"> # Chooses one deployment or the other
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">dns_config</span> {<span class="c1">
</span></span></span><span class="line"><span class="cl"><span class="c1">    # relative_name needs to be globally unique
</span></span></span><span class="line"><span class="cl"><span class="c1">    # &lt;relative_name&gt;.trafficmanager.net resolves to the public IP of either NGINXaaS deployment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    relative_name</span> <span class="o">=</span> <span class="s2">&#34;nginxaas-global-record&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    ttl</span>           <span class="o">=</span> <span class="m">60</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">monitor_config</span> {
</span></span><span class="line"><span class="cl"><span class="n">    protocol</span>                     <span class="o">=</span> <span class="s2">&#34;HTTP&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">    port</span>                         <span class="o">=</span> <span class="m">80</span>
</span></span><span class="line"><span class="cl"><span class="n">    path</span>                         <span class="o">=</span> <span class="s2">&#34;/health&#34;</span><span class="c1"> #endpoint implemented in NGINXaaS configuration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">    interval_in_seconds</span>          <span class="o">=</span> <span class="m">30</span>
</span></span><span class="line"><span class="cl"><span class="n">    timeout_in_seconds</span>           <span class="o">=</span> <span class="m">9</span>
</span></span><span class="line"><span class="cl"><span class="n">    tolerated_number_of_failures</span> <span class="o">=</span> <span class="m">3</span>
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_external_endpoint&#34; &#34;primary&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-primary&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  profile_id</span>          <span class="o">=</span> <span class="k">azurerm_traffic_manager_profile</span><span class="p">.</span><span class="k">nginxaas_failover_monitor</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  priority</span>            <span class="o">=</span> <span class="m">10</span><span class="c1"> # Lower number results in higher priority
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">  target</span>              <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">primary_nginxaas_deployment</span><span class="p">.</span><span class="k">ip_address</span>
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">resource</span> <span class="s2">&#34;azurerm_traffic_manager_external_endpoint&#34; &#34;secondary&#34;</span> {
</span></span><span class="line"><span class="cl"><span class="n">  name</span>                <span class="o">=</span> <span class="s2">&#34;nginx-secondary&#34;</span>
</span></span><span class="line"><span class="cl"><span class="n">  profile_id</span>          <span class="o">=</span> <span class="k">azurerm_traffic_manager_profile</span><span class="p">.</span><span class="k">nginxaas_failover_monitor</span><span class="p">.</span><span class="k">id</span>
</span></span><span class="line"><span class="cl"><span class="n">  priority</span>            <span class="o">=</span> <span class="m">20</span>
</span></span><span class="line"><span class="cl"><span class="n">  target</span>              <span class="o">=</span> <span class="k">azurerm_nginx_deployment</span><span class="p">.</span><span class="k">secondary_nginxaas_deployment</span><span class="p">.</span><span class="k">ip_address</span>
</span></span><span class="line"><span class="cl">}</span></span></code></pre></div>
</div></details>
<hr>
<h2 
id="failover-process">Failover process  <a class="headerlink float-right" href="#failover-process" title="Failover process"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li><strong>Monitor</strong>: <code>/health</code> endpoint continuously monitors NGINXaaS deployment reachability in both regions.</li>
<li><strong>Failover</strong>: If the primary region deployment is deemed unhealthy, Azure Traffic Manager updates the DNS record for the service to route traffic to the secondary region&rsquo;s NGINXaaS deployment.</li>
<li><strong>Recovery</strong>: Once the primary region deployment recovers, Azure Traffic Manager automatically restores DNS records to the primary endpoint when its health probes detect recovery and confirm the primary endpoint is healthy again.</li>
</ol>
<hr>
<h2 
id="summary">Summary  <a class="headerlink float-right" href="#summary" title="Summary"><i class="fas fa-link fa-xs"></i></a>
</h2><p>By deploying NGINXaaS in separate regions with unique subnets and peered VNets, and configuring upstreams and DNS for failover, this topology ensures high availability and DR for your applications. Lastly, always monitor and test your failover paths.</p>

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nginxaas-azure/disaster-recovery.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nginxaas-azure/disaster-recovery.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=Disaster%20recovery&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		
		
		<li style="flex:1; text-align: left; white-space: nowrap;"><a href="http://localhost:1313/nginxaas/azure/loadbalancer-kubernetes/" class="" title="Previous -- NGINXaaS Load Balancer for Kubernetes "><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.378 46.5L1.94 25.06C1.80067 24.9209 1.69014 24.7556 1.61472 24.5738C1.53931 24.3919 1.50049 24.1969 1.50049 24C1.50049 23.8031 1.53931 23.6081 1.61472 23.4262C1.69014 23.2444 1.80067 23.0791 1.94 22.94L23.378 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M45.878 46.5L24.44 25.06C24.3007 24.9209 24.1901 24.7556 24.1147 24.5738C24.0393 24.3919 24.0005 24.1969 24.0005 24C24.0005 23.8031 24.0393 23.6081 24.1147 23.4262C24.1901 23.2444 24.3007 23.0791 24.44 22.94L45.878 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		

		
			<li style="flex:1; text-align: right; white-space: nowrap;"><a href="http://localhost:1313/nginxaas/azure/get-help/" class="" title="Next -- Get help"><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24.622 1.5L46.06 22.94C46.1993 23.0791 46.3099 23.2444 46.3853 23.4262C46.4607 23.6081 46.4995 23.8031 46.4995 24C46.4995 24.1969 46.4607 24.3919 46.3853 24.5738C46.3099 24.7556 46.1993 24.9209 46.06 25.06L24.622 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.122 1.5L23.56 22.94C23.6993 23.0791 23.8099 23.2444 23.8853 23.4262C23.9607 23.6081 23.9995 23.8031 23.9995 24C23.9995 24.1969 23.9607 24.3919 23.8853 24.5738C23.8099 24.7556 23.6993 24.9209 23.56 25.06L2.122 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#configure-disaster-recovery">Configure disaster recovery</a>
      <ul>
        <li><a href="#step-1-terrraform-setup">Step 1: Terrraform setup</a></li>
        <li><a href="#step-2-deploy-prerequisite-infrastructure">Step 2: Deploy prerequisite infrastructure</a></li>
        <li><a href="#step-3-configure-app-servers-upstreams">Step 3: Configure app servers (upstreams)</a></li>
        <li><a href="#step-4-peer-the-vnets">Step 4: Peer the VNets</a></li>
        <li><a href="#step-5-deploy-nginxaas-for-azure-in-each-region">Step 5: Deploy NGINXaaS for Azure in each region</a></li>
        <li><a href="#step-6-dns-and-failover">Step 6: DNS and failover</a></li>
      </ul>
    </li>
    <li><a href="#failover-process">Failover process</a></li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          ©2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>©2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


