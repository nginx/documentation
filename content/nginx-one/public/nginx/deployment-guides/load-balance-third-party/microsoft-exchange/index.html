<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Load Balancing Microsoft Exchange Servers with NGINX Plus | DEV -- docs-nginx-com</title>


<meta name="description" content="Load balance Microsoft Exchange servers with the advanced features in F5 NGINX Plus, following our step-by-step setup instructions.">





<link rel="canonical" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/">







<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Load balance Microsoft Exchange servers with the advanced features in F5 NGINX Plus, following our step-by-step setup instructions." />
<meta name="twitter:title" content="Load Balancing Microsoft Exchange Servers with NGINX Plus" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="27/05/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/">F5 NGINX Plus</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/">Deployment Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/load-balance-third-party/">Load Balancing Third-Party Servers</a><i class="fas fa-chevron-right"></i></li>
                
            
                Load Balancing Microsoft Exchange Servers with NGINX Plus
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx/" alt="F5 NGINX Plus"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-Plus-product-icon-RGB.svg"
                        alt="F5 NGINX Plus">
                    F5 NGINX Plus</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx/admin-guide/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginx--admin-guide" aria-controls="nginx--admin-guide">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Admin Guide</a>
                            </li>
                        </div>
                        <div id="nginx--admin-guide" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/installing-nginx/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--installing-nginx-and-nginx-plus">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Installing NGINX and NGINX Plus</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--installing-nginx-and-nginx-plus" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/">Installing NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-open-source/">Installing NGINX Open Source</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/">Installing NGINX Plus AMIs on Amazon EC2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/">Install NGINX Plus on the Google Cloud Platform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/">Installing NGINX Plus on Microsoft Azure</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-docker/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-docker/">Deploying NGINX and NGINX Plus with Docker</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/basic-functionality/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--basic-functionality">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Basic Functionality</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--basic-functionality" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/basic-functionality/runtime-control/" href="http://localhost:1313/nginx/admin-guide/basic-functionality/runtime-control/">Control NGINX Processes at Runtime</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/basic-functionality/managing-configuration-files/" href="http://localhost:1313/nginx/admin-guide/basic-functionality/managing-configuration-files/">Create NGINX Plus and NGINX Configuration Files</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/load-balancer/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--load-balancer">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Load Balancer</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--load-balancer" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/http-load-balancer/" href="http://localhost:1313/nginx/admin-guide/load-balancer/http-load-balancer/">HTTP Load Balancing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/">TCP and UDP Load Balancing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/http-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/http-health-check/">HTTP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/tcp-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-health-check/">TCP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/udp-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/udp-health-check/">UDP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/grpc-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/grpc-health-check/">gRPC Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/dynamic-configuration-api/" href="http://localhost:1313/nginx/admin-guide/load-balancer/dynamic-configuration-api/">Dynamic Configuration of Upstreams with the NGINX Plus API</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/using-proxy-protocol/" href="http://localhost:1313/nginx/admin-guide/load-balancer/using-proxy-protocol/">Accepting the PROXY Protocol</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/content-cache/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--content-cache">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Content Cache</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--content-cache" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/content-cache/content-caching/" href="http://localhost:1313/nginx/admin-guide/content-cache/content-caching/">NGINX Content Caching</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/web-server/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--web-server">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Web Server</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--web-server" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/web-server/" href="http://localhost:1313/nginx/admin-guide/web-server/web-server/">Configuring NGINX and NGINX Plus as a Web Server</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/serving-static-content/" href="http://localhost:1313/nginx/admin-guide/web-server/serving-static-content/">Serve Static Content</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/reverse-proxy/" href="http://localhost:1313/nginx/admin-guide/web-server/reverse-proxy/">NGINX Reverse Proxy</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/compression/" href="http://localhost:1313/nginx/admin-guide/web-server/compression/">Compression and Decompression</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/app-gateway-uwsgi-django/" href="http://localhost:1313/nginx/admin-guide/web-server/app-gateway-uwsgi-django/">Using NGINX and NGINX Plus as an Application Gateway with uWSGI and Django</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/security-controls/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--security-controls">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Security Controls</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--security-controls" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/terminating-ssl-http/" href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-http/">NGINX SSL Termination</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/terminating-ssl-tcp/" href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-tcp/">SSL Termination for TCP Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-http-basic-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-http-basic-authentication/">Restricting Access with HTTP Basic Authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-subrequest-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-subrequest-authentication/">Authentication Based on Subrequest Result</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-jwt-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-jwt-authentication/">Setting up JWT Authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-oidc/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-oidc/">Single Sign-On with OpenID Connect and Identity Providers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-proxied-http/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-http/">Limiting Access to Proxied HTTP Resources</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/">Restricting Access to Proxied TCP Resources</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-by-geoip/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-by-geoip/">Restricting Access by Geographical Location</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/securing-http-traffic-upstream/" href="http://localhost:1313/nginx/admin-guide/security-controls/securing-http-traffic-upstream/">Securing HTTP Traffic to Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/" href="http://localhost:1313/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/">Securing TCP Traffic to Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/denylisting-ip-addresses/" href="http://localhost:1313/nginx/admin-guide/security-controls/denylisting-ip-addresses/">Dynamic Denylisting of IP Addresses</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/monitoring/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--monitoring">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Monitoring</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--monitoring" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/live-activity-monitoring/" href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/">Live Activity Monitoring</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/logging/" href="http://localhost:1313/nginx/admin-guide/monitoring/logging/">Configuring Logging</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/debugging/" href="http://localhost:1313/nginx/admin-guide/monitoring/debugging/">Debugging NGINX</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/diagnostic-package/" href="http://localhost:1313/nginx/admin-guide/monitoring/diagnostic-package/">NGINX Diagnostic Package</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/new-relic-plugin/" href="http://localhost:1313/nginx/admin-guide/monitoring/new-relic-plugin/">Monitoring NGINX and NGINX Plus with the New Relic Plug-In</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/high-availability/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--high-availability">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>High Availability</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--high-availability" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/ha-keepalived/" href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived/">High Availability Support for NGINX Plus in On-Premises Deployments</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/ha-keepalived-nodes/" href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived-nodes/">Configuring Active-Active High Availability and Additional Passive Nodes with keepalived</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/configuration-sharing/" href="http://localhost:1313/nginx/admin-guide/high-availability/configuration-sharing/">Synchronizing NGINX Configuration in a Cluster</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/zone_sync/" href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync/">Runtime State Sharing in a Cluster</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/zone_sync_details/" href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync_details/">How NGINX Plus Performs Zone Synchronization</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/dynamic-modules/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--dynamic-modules">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Dynamic Modules</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--dynamic-modules" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/dynamic-modules/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/dynamic-modules/">Dynamic Modules</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/brotli/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/brotli/">Brotli</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/cookie-flag/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/cookie-flag/">Cookie-Flag</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/encrypted-session/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/encrypted-session/">Encrypted-Session</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/fips/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/fips/">FIPS Status Check</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/geoip/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip/">GeoIP</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/geoip2/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip2/">GeoIP2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/headers-more/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/headers-more/">Headers-More</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/http-substitutions-filter/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/http-substitutions-filter/">HTTP Substitutions Filter</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/image-filter/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/image-filter/">Image-Filter</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/lua/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/lua/">Lua</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/ndk/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/ndk/">NGINX Developer Kit</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/nginx-waf/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginx-waf/">NGINX ModSecurity WAF</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/nginscript/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginscript/">njs Scripting Language</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/opentelemetry/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentelemetry/">OpenTelemetry</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/opentracing/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentracing/">OpenTracing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/perl/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/perl/">Perl</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/passenger-open-source/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/passenger-open-source/">Phusion Passenger Open Source</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/prometheus-njs/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/prometheus-njs/">Prometheus-njs</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/rtmp/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/rtmp/">RTMP</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/set-misc/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/set-misc/">Set-Misc</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/spnego/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/spnego/">SPNEGO</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/uninstall/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/uninstall/">Uninstalling a dynamic module</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/xslt/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/xslt/">XSLT</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/mail-proxy/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--mail-proxy">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Mail Proxy</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--mail-proxy" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/mail-proxy/mail-proxy/" href="http://localhost:1313/nginx/admin-guide/mail-proxy/mail-proxy/">Configure NGINX as a Mail Proxy Server</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx/deployment-guides/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginx--deployment-guides" aria-controls="nginx--deployment-guides">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Deployment Guides</a>
                            </li>
                        </div>
                        <div id="nginx--deployment-guides" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/amazon-web-services/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--amazon-web-services">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Amazon Web Services</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--amazon-web-services" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/">Active-Active HA for NGINX Plus on AWS Using AWS Network Load Balancer</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/">Active-Passive HA for NGINX Plus on AWS Using Elastic IP Addresses</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/">Using NGINX or NGINX Plus as the Ingress Controller for Amazon Elastic Kubernetes Services</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/">Create Amazon EC2 Instances for NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/global-server-load-balancing/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--global-server-load-balancing">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Global Server Load Balancing</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--global-server-load-balancing" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/" href="http://localhost:1313/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/">Global Server Load Balancing with NS1 and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/google-cloud-platform/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--google-cloud-platform">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Google Cloud Platform</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--google-cloud-platform" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/" href="http://localhost:1313/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/">All-Active HA for NGINX Plus on the Google Cloud Platform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--load-balancing-third-party-servers">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Load Balancing Third-Party Servers</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--load-balancing-third-party-servers" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/apache-tomcat/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/apache-tomcat/">Load Balancing Apache Tomcat Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/">Load Balancing Microsoft Exchange Servers with NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/node-js/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/node-js/">Load Balancing Node.js Application Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/">Load Balancing Oracle E-Business Suite with NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/">Load Balancing Oracle WebLogic Server with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/wildfly/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/wildfly/">Load Balancing Wildfly and JBoss Application Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/microsoft-azure/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--microsoft-azure">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Microsoft Azure</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--microsoft-azure" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/" href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/">Active-Active HA for NGINX Plus on Microsoft Azure Using the Azure Standard Load Balancer</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/" href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/">Creating Microsoft Azure Virtual Machines for NGINX Open Source and F5 NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--migrate-hardware-adcs">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Migrate Hardware ADCs</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--migrate-hardware-adcs" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/" href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/">Migrating Load Balancer Configuration from Citrix ADC to NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/" href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/">Migrating Load Balancer Configuration from F5 BIG-IP LTM to F5 NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/single-sign-on/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--set-up-single-sign-on-for-proxied-applications">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Set Up Single Sign-On for Proxied Applications</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--set-up-single-sign-on-for-proxied-applications" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/auth0/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/auth0/">Single Sign-On With Auth0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/cognito/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/cognito/">Single Sign-On with Amazon Cognito</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/active-directory-federation-services/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/active-directory-federation-services/">Single Sign-On with Microsoft Active Directory FS</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/entra-id/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/entra-id/">Single Sign-On with Microsoft Entra ID</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/keycloak/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/keycloak/">Single Sign-On with Keycloak</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/onelogin/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/onelogin/">Single Sign-On with OneLogin</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/okta/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/okta/">Single Sign-On with Okta</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/ping-identity/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/ping-identity/">Single Sign-On with Ping Identity</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx/deployment-guides/single-signon/oidc-njs/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nginx--single-sign-on--legacy-njs-based-single-sign-on-solutions">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Legacy njs-based Single Sign-On Solutions</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nginx--single-sign-on--legacy-njs-based-single-sign-on-solutions" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/">Single Sign-On with Amazon Cognito and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/">Single Sign-On With Auth0 and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/">Single Sign-On with Keycloak and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/">Single Sign-On with Microsoft AD FS and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/okta/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/okta/">Single Sign-On with Okta and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/">Single Sign-On with OneLogin and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/">Single Sign-On with Ping Identity and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/setting-up-nginx-demo-environment/"
                                                                href="http://localhost:1313/nginx/deployment-guides/setting-up-nginx-demo-environment/">Setting up an NGINX demo environment</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/releases/" href="http://localhost:1313/nginx/releases/">Releases</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/technical-specs/" href="http://localhost:1313/nginx/technical-specs/">Technical Specs</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/open-source-components/" href="http://localhost:1313/nginx/open-source-components/">Open Source Components</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/fips-compliance-nginx-plus/" href="http://localhost:1313/nginx/fips-compliance-nginx-plus/">NGINX Plus FIPS Compliance</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/directives/" href="http://localhost:1313/nginx/directives/">NGINX Directives Index</a>
                </li>
                
                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name">NGINX Plus</div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-d8b0ed076d8ee224a3aef5fe811e3a69" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-d8b0ed076d8ee224a3aef5fe811e3a69" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Admin Guide 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-34ba13d39918e960bfd91478931ee142" class="toggle-checkbox" style="display: none;">
            <label for="toggle-34ba13d39918e960bfd91478931ee142" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Installing NGINX and NGINX Plus 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/" style="">Installing NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" style="">Installing NGINX Open Source </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/" style="">Installing NGINX Plus AMIs on Amazon EC2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/" style="">Install NGINX Plus on the Google Cloud Platform </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/" style="">Installing NGINX Plus on Microsoft Azure </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-docker/" style="">Deploying NGINX and NGINX Plus with Docker </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-4fed1bc24136a50ced01c75c6f2619a2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-4fed1bc24136a50ced01c75c6f2619a2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Basic Functionality 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/basic-functionality/runtime-control/" style="">Control NGINX Processes at Runtime </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/basic-functionality/managing-configuration-files/" style="">Create NGINX Plus and NGINX Configuration Files </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-a0b990a08877f2414420dd3fab30a616" class="toggle-checkbox" style="display: none;">
            <label for="toggle-a0b990a08877f2414420dd3fab30a616" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Load Balancer 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/http-load-balancer/" style="">HTTP Load Balancing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" style="">TCP and UDP Load Balancing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/http-health-check/" style="">HTTP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-health-check/" style="">TCP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/udp-health-check/" style="">UDP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/grpc-health-check/" style="">gRPC Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/dynamic-configuration-api/" style="">Dynamic Configuration of Upstreams with the NGINX Plus API </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/using-proxy-protocol/" style="">Accepting the PROXY Protocol </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-3827dd0c2b43b01d6adb9d92730551a2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-3827dd0c2b43b01d6adb9d92730551a2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Content Cache 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/content-cache/content-caching/" style="">NGINX Content Caching </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-bc8955a748a8c048c742c5efe92af86f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-bc8955a748a8c048c742c5efe92af86f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Web Server 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/web-server/" style="">Configuring NGINX and NGINX Plus as a Web Server </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/serving-static-content/" style="">Serve Static Content </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/reverse-proxy/" style="">NGINX Reverse Proxy </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/compression/" style="">Compression and Decompression </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/app-gateway-uwsgi-django/" style="">Using NGINX and NGINX Plus as an Application Gateway with uWSGI and Django </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-bdec90cc0d849dbcf048e137054cd075" class="toggle-checkbox" style="display: none;">
            <label for="toggle-bdec90cc0d849dbcf048e137054cd075" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Security Controls 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-http/" style="">NGINX SSL Termination </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-tcp/" style="">SSL Termination for TCP Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-http-basic-authentication/" style="">Restricting Access with HTTP Basic Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-subrequest-authentication/" style="">Authentication Based on Subrequest Result </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-jwt-authentication/" style="">Setting up JWT Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-oidc/" style="">Single Sign-On with OpenID Connect and Identity Providers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-http/" style="">Limiting Access to Proxied HTTP Resources </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/" style="">Restricting Access to Proxied TCP Resources </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-by-geoip/" style="">Restricting Access by Geographical Location </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/securing-http-traffic-upstream/" style="">Securing HTTP Traffic to Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/" style="">Securing TCP Traffic to Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/denylisting-ip-addresses/" style="">Dynamic Denylisting of IP Addresses </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-4115092e5ba91d2d8fd1b7bf0bf88aa9" class="toggle-checkbox" style="display: none;">
            <label for="toggle-4115092e5ba91d2d8fd1b7bf0bf88aa9" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Monitoring 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/" style="">Live Activity Monitoring </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/logging/" style="">Configuring Logging </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/debugging/" style="">Debugging NGINX </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/diagnostic-package/" style="">NGINX Diagnostic Package </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/new-relic-plugin/" style="">Monitoring NGINX and NGINX Plus with the New Relic Plug-In </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-58f36bce08139196af7dbd68b048562d" class="toggle-checkbox" style="display: none;">
            <label for="toggle-58f36bce08139196af7dbd68b048562d" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                High Availability 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived/" style="">High Availability Support for NGINX Plus in On-Premises Deployments </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived-nodes/" style="">Configuring Active-Active High Availability and Additional Passive Nodes with keepalived </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/configuration-sharing/" style="">Synchronizing NGINX Configuration in a Cluster </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync/" style="">Runtime State Sharing in a Cluster </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync_details/" style="">How NGINX Plus Performs Zone Synchronization </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-d9475b942e664d5a02f3c7e0832be30f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-d9475b942e664d5a02f3c7e0832be30f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Dynamic Modules 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/dynamic-modules/" style="">Dynamic Modules </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/brotli/" style="">Brotli </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/cookie-flag/" style="">Cookie-Flag </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/encrypted-session/" style="">Encrypted-Session </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/fips/" style="">FIPS Status Check </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip/" style="">GeoIP </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip2/" style="">GeoIP2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/headers-more/" style="">Headers-More </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/http-substitutions-filter/" style="">HTTP Substitutions Filter </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/image-filter/" style="">Image-Filter </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/lua/" style="">Lua </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/ndk/" style="">NGINX Developer Kit </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginx-waf/" style="">NGINX ModSecurity WAF </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginscript/" style="">njs Scripting Language </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentelemetry/" style="">OpenTelemetry </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentracing/" style="">OpenTracing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/perl/" style="">Perl </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/passenger-open-source/" style="">Phusion Passenger Open Source </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/prometheus-njs/" style="">Prometheus-njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/rtmp/" style="">RTMP </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/set-misc/" style="">Set-Misc </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/spnego/" style="">SPNEGO </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/uninstall/" style="">Uninstalling a dynamic module </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/xslt/" style="">XSLT </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-0e96b7a1b81ada95980c6f8945f7298a" class="toggle-checkbox" style="display: none;">
            <label for="toggle-0e96b7a1b81ada95980c6f8945f7298a" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Mail Proxy 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/mail-proxy/mail-proxy/" style="">Configure NGINX as a Mail Proxy Server </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-ad2e544081d8a2dc550608bf96863673" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-ad2e544081d8a2dc550608bf96863673" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Deployment Guides 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-5e13f0d338ace88d49a9d6caa7010fc4" class="toggle-checkbox" style="display: none;">
            <label for="toggle-5e13f0d338ace88d49a9d6caa7010fc4" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Amazon Web Services 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/" style="">Active-Active HA for NGINX Plus on AWS Using AWS Network Load Balancer </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/" style="">Active-Passive HA for NGINX Plus on AWS Using Elastic IP Addresses </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/" style="">Using NGINX or NGINX Plus as the Ingress Controller for Amazon Elastic Kubernetes Services </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/" style="">Create Amazon EC2 Instances for NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-22d3c4602e6471d3cb1277bf845bc7a5" class="toggle-checkbox" style="display: none;">
            <label for="toggle-22d3c4602e6471d3cb1277bf845bc7a5" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Global Server Load Balancing 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/" style="">Global Server Load Balancing with NS1 and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-539116910b30b117ba27575318b0e1d8" class="toggle-checkbox" style="display: none;">
            <label for="toggle-539116910b30b117ba27575318b0e1d8" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Google Cloud Platform 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/" style="">All-Active HA for NGINX Plus on the Google Cloud Platform </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-eea80951fd0bc0c7385d3863c701b40f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-eea80951fd0bc0c7385d3863c701b40f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Load Balancing Third-Party Servers 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/apache-tomcat/" style="">Load Balancing Apache Tomcat Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/" style="font-weight: bold;">Load Balancing Microsoft Exchange Servers with NGINX Plus </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#about-nginx-plus">About NGINX Plus</a></li>
    <li><a href="#using-this-guide">Using This Guide</a>
      <ul>
        <li><a href="#about-sample-values-and-copying-of-text">About Sample Values and Copying of Text</a></li>
      </ul>
    </li>
    <li><a href="#prerequisites-and-system-requirements">Prerequisites and System Requirements</a></li>
    <li><a href="#configuring-dns-exchange-and-firewalls">Configuring DNS, Exchange, and Firewalls</a>
      <ul>
        <li><a href="#configuring-dns">Configuring DNS</a></li>
        <li><a href="#configuring-exchange">Configuring Exchange</a></li>
        <li><a href="#configuring-firewalls">Configuring Firewalls</a></li>
      </ul>
    </li>
    <li><a href="#configuring-an-ssltls-certificate-for-client-traffic">Configuring an SSL/TLS Certificate for Client Traffic</a>
      <ul>
        <li><a href="#generating-a-certificate-request-with-the-openssl-command">Generating a Certificate Request with the openssl Command</a></li>
        <li><a href="#exporting-and-converting-an-ssltls-certificate-from-an-iis-server">Exporting and Converting an SSL/TLS Certificate from an IIS Server</a></li>
      </ul>
    </li>
    <li><a href="#configuring-nginx-plus">Configuring NGINX Plus</a>
      <ul>
        <li><a href="#installing-nginx-plus">Installing NGINX Plus</a></li>
        <li><a href="#creating-and-modifying-configuration-files">Creating and Modifying Configuration Files</a></li>
        <li><a href="#configuring-global-settings">Configuring Global Settings</a></li>
        <li><a href="#configuring-tcp-load-balancing">Configuring TCP Load Balancing</a></li>
        <li><a href="#configuring-global-http-and-https-settings">Configuring Global HTTP and HTTPS Settings</a></li>
        <li><a href="#configuring-virtual-servers-for-http-and-https-traffic">Configuring Virtual Servers for HTTP and HTTPS Traffic</a></li>
        <li><a href="#configuring-http2-support">Configuring HTTP/2 Support</a></li>
      </ul>
    </li>
    <li><a href="#completing-the-configuration-of-load-balancing">Completing the Configuration of Load Balancing</a>
      <ul>
        <li><a href="#completing-the-configuration-of-basic-load-balancing">Completing the Configuration of Basic Load Balancing</a></li>
        <li><a href="#full-configuration-for-basic-load-balancing">Full Configuration for Basic Load Balancing</a></li>
        <li><a href="#completing-the-configuration-of-enhanced-load-balancing">Completing the Configuration of Enhanced Load Balancing</a></li>
        <li><a href="#full-configuration-for-enhanced-load-balancing">Full Configuration for Enhanced Load Balancing</a></li>
        <li><a href="#revision-history">Revision History</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/node-js/" style="">Load Balancing Node.js Application Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/" style="">Load Balancing Oracle E-Business Suite with NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/" style="">Load Balancing Oracle WebLogic Server with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/wildfly/" style="">Load Balancing Wildfly and JBoss Application Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-deab0f7f4195e0ebfdd9a46bf3c45873" class="toggle-checkbox" style="display: none;">
            <label for="toggle-deab0f7f4195e0ebfdd9a46bf3c45873" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Microsoft Azure 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/" style="">Active-Active HA for NGINX Plus on Microsoft Azure Using the Azure Standard Load Balancer </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/" style="">Creating Microsoft Azure Virtual Machines for NGINX Open Source and F5 NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-9d116931baf1693c0ecb4484238d72ce" class="toggle-checkbox" style="display: none;">
            <label for="toggle-9d116931baf1693c0ecb4484238d72ce" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Migrate Hardware ADCs 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/" style="">Migrating Load Balancer Configuration from Citrix ADC to NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/" style="">Migrating Load Balancer Configuration from F5 BIG-IP LTM to F5 NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-1b645490e7b8fc3e2dbc02de30e692bb" class="toggle-checkbox" style="display: none;">
            <label for="toggle-1b645490e7b8fc3e2dbc02de30e692bb" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Set Up Single Sign-On for Proxied Applications 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/auth0/" style="">Single Sign-On With Auth0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/cognito/" style="">Single Sign-On with Amazon Cognito </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/active-directory-federation-services/" style="">Single Sign-On with Microsoft Active Directory FS </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/entra-id/" style="">Single Sign-On with Microsoft Entra ID </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/keycloak/" style="">Single Sign-On with Keycloak </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/onelogin/" style="">Single Sign-On with OneLogin </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/okta/" style="">Single Sign-On with Okta </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/ping-identity/" style="">Single Sign-On with Ping Identity </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-078a70b7a7961256b5a3c59fcd9c4eb2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-078a70b7a7961256b5a3c59fcd9c4eb2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Legacy njs-based Single Sign-On Solutions 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/" style="">Single Sign-On with Amazon Cognito and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/" style="">Single Sign-On With Auth0 and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/" style="">Single Sign-On with Keycloak and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/" style="">Single Sign-On with Microsoft AD FS and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/okta/" style="">Single Sign-On with Okta and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/" style="">Single Sign-On with OneLogin and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/" style="">Single Sign-On with Ping Identity and njs </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/setting-up-nginx-demo-environment/" style="">Setting up an NGINX demo environment </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/releases/" style="">Releases </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/technical-specs/" style="">Technical Specs </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/open-source-components/" style="">Open Source Components </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/fips-compliance-nginx-plus/" style="">NGINX Plus FIPS Compliance </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/directives/" style="">NGINX Directives Index </a> 
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/">F5 NGINX Plus</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/">Deployment Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/load-balance-third-party/">Load Balancing Third-Party Servers</a><i class="fas fa-chevron-right"></i></li>
                
            
                Load Balancing Microsoft Exchange Servers with NGINX Plus
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>Load Balancing Microsoft Exchange Servers with NGINX Plus</h1>
        <p>This deployment guide explains how to use F5 NGINX Plus to load balance traffic across a pool of MicrosoftExchange<sup>TM</sup> servers. You can deploy Exchange and NGINXPlus on premises, in a private cloud, or in public clouds including Amazon Web Services(AWS), the Google Cloud Platform, and Microsoft Azure. The guide covers the different installation types, and provides complete instructions for customizing both NGINXPlus and Exchange as required.</p>
<p><span id="about-nginx"></span></p>
<h2 
id="about-nginx-plus">About NGINX Plus  <a class="headerlink float-right" href="#about-nginx-plus" title="About NGINX Plus"><i class="fas fa-link fa-xs"></i></a>
</h2><p><a href="https://www.f5.com/products/nginx/nginx-plus" target="_blank" rel="noopener">NGINXPlus</a> is the commercially supported version of the <a href="https://nginx.org/en" target="_blank" rel="noopener">NGINX Open Source</a> software. NGINXPlus is a complete application delivery platform, extending the power of NGINX Open Source with a host of enterpriseready capabilities that enhance a MicrosoftExchange server deployment and are instrumental to building web applications at scale:</p>
<ul>
<li><a href="https://www.nginx.com/products/nginx/load-balancing/" target="_blank" rel="noopener">Fullfeatured HTTP, TCP, and UDP load balancing</a></li>
<li><a href="https://www.nginx.com/products/nginx/load-balancing/#session-persistence" target="_blank" rel="noopener">Intelligent session persistence</a></li>
<li><a href="http://localhost:1313/nginx/admin-guide/web-server/reverse-proxy/">Highperformance reverse proxy</a></li>
<li><a href="http://localhost:1313/nginx/admin-guide/content-cache/content-caching/">Caching and offload of dynamic and static content</a></li>
<li><a href="https://www.nginx.com/products/nginx/streaming-media/" target="_blank" rel="noopener">Adaptive streaming to deliver audio and video to any device</a></li>
<li><a href="https://docs.nginx.com/nginx/admin-guide/load-balancer/http-health-check/" target="_blank" rel="noopener">Application-aware health checks</a> and <a href="https://docs.nginx.com/nginx/admin-guide/high-availability/" target="_blank" rel="noopener">high availability</a></li>
<li><a href="https://www.nginx.com/products/nginx/live-activity-monitoring/" target="_blank" rel="noopener">Advanced activity monitoring available via a dashboard or API</a></li>
<li><a href="https://www.nginx.com/products/nginx/load-balancing/#load-balancing-api" target="_blank" rel="noopener">Management and realtime configuration changes with DevOpsfriendly tools</a></li>
</ul>
<p><span style="white-space: nowrap;"><a href="https://www.nginx.com/blog/nginx-plus-r6-released/#tcp-load-balancing" target="_blank" rel="noopener">NGINX Plus Release 6 R6</a></span> introduced fullfeatured load balancing of TCP traffic, with support extended to UDP in <a href="https://www.nginx.com/blog/nginx-plus-r9-released/#udp-lb" target="_blank" rel="noopener"><span style="white-space: nowrap;">NGINX Plus R9</span></a> and continuing enhancements for both protocols included in subsequent releases (for details, see <a href="http://localhost:1313/nginx/releases/">NGINXPlus Releases</a>. Because NGINXPlus load balances TCP, HTTP, and HTTPS traffic, it&rsquo;s ideal for MicrosoftExchange deployments, which use all three protocols.</p>
<p><span id="using-guide"></span></p>
<h2 
id="using-this-guide">Using This Guide  <a class="headerlink float-right" href="#using-this-guide" title="Using This Guide"><i class="fas fa-link fa-xs"></i></a>
</h2><p>After reviewing <a href="#prereqs">Prerequisites and System Requirements</a>, perform the instructions in these sections:</p>
<ul>
<li><a href="#dns-exchange-firewall">Configuring DNS, Exchange, and Firewalls</a></li>
<li><a href="#tls-certificate">Configuring an SSL/TLS Certificate for Client Traffic</a></li>
<li><a href="#config">Configuring NGINXPlus</a></li>
<li><a href="#config-completing">Completing the Configuration of Load Balancing</a></li>
</ul>
<p>In the final section, you choose between basic Exchange load balancing and an enhanced configuration with greater fault tolerance, application health checks, and live activity monitoring.</p>
<h3 
id="about-sample-values-and-copying-of-text">About Sample Values and Copying of Text  <a class="headerlink float-right" href="#about-sample-values-and-copying-of-text" title="About Sample Values and Copying of Text"><i class="fas fa-link fa-xs"></i></a>
</h3><ul>
<li><code>company.com</code> is used as a sample organization name (mostly in key names and DNS entries). Replace it with your organization&rsquo;s name.</li>
<li>Many NGINXPlus configuration blocks in this guide list two sample client access servers (CASs) with IP addresses 10.0.0.237 and 10.0.0.238. Replace these addresses with the IP addresses of your CASs. Include a line in the configuration block for each CAS if you have more or fewer than two. In contrast, port numbers are obligatory values except where noted.</li>
<li>For readability reasons, some commands appear on multiple lines. If you want to copy and paste them into a terminal window, we recommend that you first copy them into a text editor, where you can substitute the object names that are appropriate for your deployment and remove any extraneous formatting characters that your browser might insert.</li>
<li>We recommend that you do not copy text from the configuration snippets in this guide into your configuration files. For the recommended way to create configuration files, see <a href="#config-files">Creating and Modifying Configuration Files</a>.</li>
</ul>
<p><span id="prereqs"></span></p>
<h2 
id="prerequisites-and-system-requirements">Prerequisites and System Requirements  <a class="headerlink float-right" href="#prerequisites-and-system-requirements" title="Prerequisites and System Requirements"><i class="fas fa-link fa-xs"></i></a>
</h2><ul>
<li>
<p>Microsoft Exchange2013 or later, installed and configured on a system running Windows Server2012 or later. The load balancing functionality is not supported for earlier versions of MicrosoftExchange.</p>
<p>Exchange CASs can be configured for <a href="https://tools.ietf.org/html/rfc7617" target="_blank" rel="noopener">HTTP Basic authentication</a>, as specified in this guide.</p>
</li>
<li>
<p>A Linux system to host NGINXPlus (in onpremises and privatecloud deployments). To avoid potential conflicts with other applications, we recommend that you install NGINXPlus on a fresh system. For the list of Linux distributions supported by NGINXPlus, see <a href="http://localhost:1313/nginx/technical-specs/">NGINXPlus Technical Specifications</a>.</p>
</li>
<li>
<p><span style="white-space: nowrap;">NGINX Plus R7</span> or later. TCP load balancing is available in <span style="white-space: nowrap;">NGINX Plus R6</span> and later. Support for the <span style="white-space: nowrap;">Microsoft NT LAN Manager</span> (NTLM) is available in <span style="white-space: nowrap;">NGINX Plus R7</span> and later.</p>
</li>
</ul>
<p>The instructions assume you have basic Linux system administration skills, including the following. Full instructions are not provided for these tasks.</p>
<ul>
<li>Installing Linux software from vendorsupplied packages</li>
<li>Editing configuration files</li>
<li>Copying files between a central administrative system and Linux servers</li>
<li>Running basic commands to start and stop services</li>
<li>Reading log files</li>
</ul>
<p>Similarly, the instructions assume you have basic Windows system administration skills, including the following.</p>
<ul>
<li>Logging in to a system through Microsoft Remote Desktop</li>
<li>Running PowerShell commands</li>
<li>Restarting Internet Information Services(IIS) services</li>
</ul>
<p><span id="dns-exchange-firewall"></span></p>
<h2 
id="configuring-dns-exchange-and-firewalls">Configuring DNS, Exchange, and Firewalls  <a class="headerlink float-right" href="#configuring-dns-exchange-and-firewalls" title="Configuring DNS, Exchange, and Firewalls"><i class="fas fa-link fa-xs"></i></a>
</h2><p>To prepare for the configuration of NGINXPlus as your Exchange load balancer, first perform the steps in these sections:</p>
<ul>
<li><a href="#dns">Configuring DNS</a></li>
<li><a href="#exchange">Configuring Exchange</a></li>
<li><a href="#firewall">Configuring Firewalls</a></li>
</ul>
<p><span id="dns"></span></p>
<h3 
id="configuring-dns">Configuring DNS  <a class="headerlink float-right" href="#configuring-dns" title="Configuring DNS"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Exchange requires the following Domain Name System (DNS) records for normal operation. Create or modify them as necessary.</p>
<ul>
<li>
<p>An <code>MX</code> record for mail delivery.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e1db00&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2e1db00">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">company.com.   300     MX    10  mail.company.com
</span></span><span class="line"><span class="cl">```</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">company.com.   300     MX    10  mail.company.com
</span></span><span class="line"><span class="cl">```</span></span></code></pre></div>
</div></li>
<li>
<p>An <code>A</code> record for the main email server. Replace <code>X.X.X.X</code> with the public IP address of your NGINXPlus server.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e4a1f0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2e4a1f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mail.company.com.    60    A    X.X.X.X</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mail.company.com.    60    A    X.X.X.X</span></span></code></pre></div>
</div></li>
<li>
<p>A <code>TXT</code> record for Sender Policy Framework (SPF). Replace <code>X.X.X.X</code> with the public IP address of your NGINXPlus server. For more information about SPF records, see the <a href="https://docs.microsoft.com/en-us/microsoft-365/security/office-365-security/set-up-spf-in-office-365-to-help-prevent-spoofing" target="_blank" rel="noopener">Microsoft documentation</a>.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e7a378&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2e7a378">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">company.com.    300    TXT    &#34;v=spf1  mx  a  ip4:X.X.X.X/32  -all&#34;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">company.com.    300    TXT    &#34;v=spf1  mx  a  ip4:X.X.X.X/32  -all&#34;</span></span></code></pre></div>
</div></li>
<li>
<p>An <code>SRV</code> record for the Autodiscover service.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2ea9948&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2ea9948">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_autodiscover._tcp.company.com.    60    SRV    1  10  443  mail.company.com</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">_autodiscover._tcp.company.com.    60    SRV    1  10  443  mail.company.com</span></span></code></pre></div>
</div></li>
</ul>
<p><span id="exchange"></span></p>
<h3 
id="configuring-exchange">Configuring Exchange  <a class="headerlink float-right" href="#configuring-exchange" title="Configuring Exchange"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Use Exchange Management Shell (PowerShell) to configure Exchange on each CAS. When running the <code>Set</code> command, you must always specify the CAS name and directory (together referred to as the <em>identity</em>) for the object being configured. You can either include the <span style="white-space: nowrap;"><code>-Identity</code></span> flag on the <code>Set</code> command line, or type the identity at the prompt that appears if you don&rsquo;t include the <span style="white-space: nowrap;"><code>-Identity</code></span> flag (as in the commands in this section).</p>
<p>To obtain an identity if you don&rsquo;t know it, run the <code>Get</code> command that corresponds to the <code>Set</code> command you need to run. Include the <code>fl</code> (formatted list) keyword on the <code>Get</code> command line to view the complete output from the command. For example, to obtain identity information for the <span style="white-space: nowrap;"><code>Set-OutlookAnywhere</code></span> command, run this command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2ed9300&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2ed9300">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Get-OutlookAnywhere | fl</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Get-OutlookAnywhere | fl</span></span></code></pre></div>
</div><p>Identities are case insensitive, and generally include spaces, parentheses, and backslashes, as in these examples for a CAS called <strong>CAS01</strong>.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f05220&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2f05220">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CAS01\Rpc (Default Web Site)
</span></span><span class="line"><span class="cl">CAS01\mapi (Default Web Site)
</span></span><span class="line"><span class="cl">CAS01\Autodiscover (Default Web Site)</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">CAS01\Rpc (Default Web Site)
</span></span><span class="line"><span class="cl">CAS01\mapi (Default Web Site)
</span></span><span class="line"><span class="cl">CAS01\Autodiscover (Default Web Site)</span></span></code></pre></div>
</div><p>Repeat these commands on each CAS in your deployment:</p>
<ol>
<li>
<p>Working on the CAS, log in to PowerShell under an account with administrative privileges.</p>
</li>
<li>
<p>Open the Start menu and run the Exchange Management Shell, which is a terminal window.</p>
</li>
<li>
<p>Configure the external hostname for Outlook Anywhere.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f31cf8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2f31cf8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OutlookAnywhere -ExternalHostname mail.company.com</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OutlookAnywhere -ExternalHostname mail.company.com</span></span></code></pre></div>
</div></li>
<li>
<p>Configure the desired authentication methods for Outlook Anywhere. This sample command configures <a href="https://tools.ietf.org/html/rfc7617" target="_blank" rel="noopener">HTTP Basic authentication</a>.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f69798&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2f69798">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OutlookAnywhere -ExternalClientsRequireSsl 1
</span></span><span class="line"><span class="cl">-DefaultAuthenticationMethod basic
</span></span><span class="line"><span class="cl">-ExternalClientAuthenticationMethod basic
</span></span><span class="line"><span class="cl">-IISAuthenticationMethods basic
</span></span><span class="line"><span class="cl">-InternalClientAuthenticationMethod basic</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OutlookAnywhere -ExternalClientsRequireSsl 1
</span></span><span class="line"><span class="cl">-DefaultAuthenticationMethod basic
</span></span><span class="line"><span class="cl">-ExternalClientAuthenticationMethod basic
</span></span><span class="line"><span class="cl">-IISAuthenticationMethods basic
</span></span><span class="line"><span class="cl">-InternalClientAuthenticationMethod basic</span></span></code></pre></div>
</div></li>
<li>
<p>Configure the desired authentication methods for Autodiscover. This sample command configures HTTP Basic authentication.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2fa1238&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2fa1238">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-AutodiscoverVirtualDirectory
</span></span><span class="line"><span class="cl">-LiveIdNegotiateAuthentication 0
</span></span><span class="line"><span class="cl">-WSSecurityAuthentication 0 -LiveIdBasicAuthentication 0
</span></span><span class="line"><span class="cl">-BasicAuthentication 1 -DigestAuthentication 0
</span></span><span class="line"><span class="cl">-WindowsAuthentication 0 -OAuthAuthentication 0
</span></span><span class="line"><span class="cl">-AdfsAuthentication 0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-AutodiscoverVirtualDirectory
</span></span><span class="line"><span class="cl">-LiveIdNegotiateAuthentication 0
</span></span><span class="line"><span class="cl">-WSSecurityAuthentication 0 -LiveIdBasicAuthentication 0
</span></span><span class="line"><span class="cl">-BasicAuthentication 1 -DigestAuthentication 0
</span></span><span class="line"><span class="cl">-WindowsAuthentication 0 -OAuthAuthentication 0
</span></span><span class="line"><span class="cl">-AdfsAuthentication 0</span></span></code></pre></div>
</div></li>
<li>
<p>Configure the desired authentication methods for Offline Address Book(OAB). This sample command configures HTTP Basic authentication.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2fcb600&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2fcb600">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OabVirtualDirectory -WindowsAuthentication 0
</span></span><span class="line"><span class="cl">-BasicAuthentication 1
</span></span><span class="line"><span class="cl">-ExternalUrl https://mail.company.com/OAB</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OabVirtualDirectory -WindowsAuthentication 0
</span></span><span class="line"><span class="cl">-BasicAuthentication 1
</span></span><span class="line"><span class="cl">-ExternalUrl https://mail.company.com/OAB</span></span></code></pre></div>
</div></li>
<li>
<p>If Exchange2013 Service <span style="white-space: nowrap;">Pack 1 (SP 1)</span> or later is installed, configure the desired authentication methods for MAPI over HTTP. This sample command configures HTTP Basic authentication. (Note that MAP over HTTP is not available in Exchange2013 without SP1.)</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2ffb788&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2ffb788">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-MapiVirtualDirectory
</span></span><span class="line"><span class="cl">-InternalURL http://mail.company.com/mapi
</span></span><span class="line"><span class="cl">-ExternalURL https://mail.company.com/mapi
</span></span><span class="line"><span class="cl">-IISAuthenticationMethods Basic</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-MapiVirtualDirectory
</span></span><span class="line"><span class="cl">-InternalURL http://mail.company.com/mapi
</span></span><span class="line"><span class="cl">-ExternalURL https://mail.company.com/mapi
</span></span><span class="line"><span class="cl">-IISAuthenticationMethods Basic</span></span></code></pre></div>
</div></li>
<li>
<p>If <span style="white-space: nowrap;">Exchange 2013 SP 1</span> or later is installed, enable MAPI Over HTTP.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb301d680&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb301d680">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OrganizationConfig -MapiHTTPEnabled</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">C:\&gt; Set-OrganizationConfig -MapiHTTPEnabled</span></span></code></pre></div>
</div></li>
</ol>
<p><span id="firewall"></span></p>
<h3 
id="configuring-firewalls">Configuring Firewalls  <a class="headerlink float-right" href="#configuring-firewalls" title="Configuring Firewalls"><i class="fas fa-link fa-xs"></i></a>
</h3><p>If there is a firewall between the NGINXPlus server and other applications in your Exchange deployment, configure it to pass through traffic on the ports specified in the table. The columns represent the three types of applications that communicate with the NGINXPlus server email clients, the NGINXPlus live activity monitoring dashboard on your administrative network, and CASs and the <strong>x</strong> indicates that the port must be open.</p>





<table class="table table-bordered table-striped table-responsive table-sm table-v1">
  <thead>
      <tr>
          <th style="text-align: left"><strong>Port</strong></th>
          <th style="text-align: left"><strong>Protocol</strong></th>
          <th style="text-align: left"><strong>Email clients</strong></th>
          <th style="text-align: left"><strong>Admin network</strong></th>
          <th style="text-align: left"><strong>CASs</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">25</td>
          <td style="text-align: left">SMTP</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
      </tr>
      <tr>
          <td style="text-align: left">80</td>
          <td style="text-align: left">HTTP</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">443</td>
          <td style="text-align: left">HTTPS</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">993</td>
          <td style="text-align: left">IMAPS</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">8080</td>
          <td style="text-align: left">HTTP (NGINXPlus dashboard)</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
  </tbody>
</table>






  


<div data-mf="true" style="display: none;" class="table-v2 table table-bordered table-striped table-responsive table-sm narrow">
    <table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>Port</strong></th>
          <th style="text-align: left"><strong>Protocol</strong></th>
          <th style="text-align: left"><strong>Email clients</strong></th>
          <th style="text-align: left"><strong>Admin network</strong></th>
          <th style="text-align: left"><strong>CASs</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">25</td>
          <td style="text-align: left">SMTP</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
      </tr>
      <tr>
          <td style="text-align: left">80</td>
          <td style="text-align: left">HTTP</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">443</td>
          <td style="text-align: left">HTTPS</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">993</td>
          <td style="text-align: left">IMAPS</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">8080</td>
          <td style="text-align: left">HTTP (NGINXPlus dashboard)</td>
          <td style="text-align: left">x</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
  </tbody>
</table>

</div>
<p><span id="tls-certificate"></span></p>
<h2 
id="configuring-an-ssltls-certificate-for-client-traffic">Configuring an SSL/TLS Certificate for Client Traffic  <a class="headerlink float-right" href="#configuring-an-ssltls-certificate-for-client-traffic" title="Configuring an SSL/TLS Certificate for Client Traffic"><i class="fas fa-link fa-xs"></i></a>
</h2><p>To enable SSL/TLS encryption of traffic between NGINXPlus and Exchange clients, you need to configure a server certificate for NGINXPlus.</p>
<p>There are several ways to obtain the required certificate, including the following. For your convenience, <span style="white-space: nowrap;">step-by-step</span> instructions are provided for the second and third options.</p>
<ul>
<li>If you already have an SSL/TLS server certificate installed on another UNIX or Linux system (including systems running NGINX Open Source, NGINXPlus, or Apache HTTP Server), copy it to the <strong>/etc/nginx/ssl</strong> directory on the NGINXPlus server.</li>
<li>Request a new certificate from a certificate authority (CA) or your organization&rsquo;s security group, as described in <a href="#certificate-request">Generating a Certificate Request with the openssl Command</a>.</li>
<li>If you already have an SSL/TLS certificate on a Windows system, see <a href="#certificate-iis">Exporting and Converting an SSL/TLS Certificate from an IIS Server</a>.</li>
</ul>
<p><span id="certificate-request"></span></p>
<h3 
id="generating-a-certificate-request-with-the-openssl-command">Generating a Certificate Request with the openssl Command  <a class="headerlink float-right" href="#generating-a-certificate-request-with-the-openssl-command" title="Generating a Certificate Request with the openssl Command"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Log in as the root user on a machine that has the <code>openssl</code> software installed.</p>
</li>
<li>
<p>Create a private key to be packaged in the certificate.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3044b68&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb3044b68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl genrsa -out ~/company.com.key <span class="m">2048</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl genrsa -out ~/company.com.key <span class="m">2048</span></span></span></code></pre></div>
</div></li>
<li>
<p>Create a backup of the key file in a secure location. If you lose the key, the certificate becomes unusable.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb305e978&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb305e978">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# cp ~/company.com.key &lt;SECURE-DIR&gt;/company.com.key.backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# cp ~/company.com.key &lt;SECURE-DIR&gt;/company.com.key.backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create a Certificate Signing Request (CSR) file.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb307d990&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb307d990">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl req -new -sha256 -key ~/company.com.key -out ~/company.com.csr</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl req -new -sha256 -key ~/company.com.key -out ~/company.com.csr</span></span></code></pre></div>
</div></li>
<li>
<p>Request a certificate from a CA or your internal security group, providing the CSR file (<strong>company.com.csr</strong>). As a reminder, never share private keys (<strong>.key</strong> files) directly with third parties.</p>
<p>The certificate needs to be PEM format rather than in the Windowscompatible PFX format. If you request the certificate from a CA website yourself, choose NGINX or Apache (if available) when asked to select the server platform for which to generate the certificate.</p>
</li>
<li>
<p>Copy or move the certificate file and associated key files to the <strong>/etc/nginx/ssl</strong> directory on the NGINXPlus server.</p>
</li>
</ol>
<p>In the configuration files for Exchange load balancing that you can download from the NGINX website, the filenames for the certificate and private key are <strong>company.com.crt</strong> and <strong>company.com.key</strong>. For a discussion of the file and download instructions, see <a href="#config-files">Creating and Modifying Configuration Files</a>.</p>
<p><span id="certificate-iis"></span></p>
<h3 
id="exporting-and-converting-an-ssltls-certificate-from-an-iis-server">Exporting and Converting an SSL/TLS Certificate from an IIS Server  <a class="headerlink float-right" href="#exporting-and-converting-an-ssltls-certificate-from-an-iis-server" title="Exporting and Converting an SSL/TLS Certificate from an IIS Server"><i class="fas fa-link fa-xs"></i></a>
</h3><p>On Windows systems, SSL/TLS certificates are packaged in a PublicKey Cryptography Standards (PKCS) archive file with extension <strong>.pfx</strong>. You need to export the <strong>.pfx</strong> file and convert the contents to the Linuxcompatible PEM format.</p>
<p>Working in the Microsoft Management Console, perform these steps:</p>
<ol>
<li>
<p>Open the <strong>Certificates</strong> snapin.</p>
</li>
<li>
<p>In the lefthand navigation pane, click the <strong>Certificates</strong> folder in the logical store for the certificate you want to export (in the following figure, it is <span style="white-space: nowrap; font-weight: bold;">Personal &gt; Certificates</span>).</p>
</li>
<li>
<p>In the main pane, rightclick the certificate to be exported (in the following figure, it is <strong>cas01.company.com</strong>).</p>
</li>
<li>
<p>On the menu that pops up, select <strong>All Tasks</strong>, then click <strong>Export</strong>.</p>
<p><p class="md__image">
    <img src="/nginx/images/oracle-ebs-iis-certlm.png" alt="Certificates snap-in to Microsoft Management Console, used to export SSL/TLS certificate"  />
</p></p>
</li>
<li>
<p>In the Certificate Export Wizard window that pops up, click <strong>Yes, export the private key</strong>. (This option appears only if the private key is marked as exportable and you have access to it.)</p>
</li>
<li>
<p>If prompted for a password (used to encrypt the <strong>.pfx</strong> file before export), type it in the <strong>Password</strong> and <strong>Confirm</strong> fields. (Remember the password, as you need to provide it when importing the bundle to NGINXPlus.)</p>
</li>
<li>
<p>Click <strong>Next</strong>.</p>
</li>
<li>
<p>In <strong>File name</strong> field, type the filename and path to the location for storing the exported file (certificate and private key). Click <strong>Next</strong>, then <strong>Finish</strong>.</p>
</li>
<li>
<p>Copy the <strong>.pfx</strong> file to the NGINXPlus server.</p>
</li>
</ol>
<p>Working on the NGINXPlus server (which must have the <code>openssl</code> software installed), perform these steps:</p>
<ol>
<li>
<p>Log in as the root user.</p>
</li>
<li>
<p>Extract the private key file from the <strong>.pfx</strong> file. You are prompted first for the password protecting the <strong>.pfx</strong> file (see Step6 above), then for a new password used to encrypt the private key file being created (<strong>company.com.key.encrypted</strong> in the following sample command).</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3120708&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb3120708">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl pkcs12 -in exported-certs.pfx -nocerts -out company.com.key.encrypted</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl pkcs12 -in exported-certs.pfx -nocerts -out company.com.key.encrypted</span></span></code></pre></div>
</div></li>
<li>
<p>Decrypt the key file. At the prompt, type the password you created in the previous step for the private key file.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3156268&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb3156268">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl rsa -in company.com.key.encrypted -out company.com.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl rsa -in company.com.key.encrypted -out company.com.key</span></span></code></pre></div>
</div></li>
<li>
<p>Extract the certificate file.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb318cd68&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb318cd68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl pkcs12 -in exported-cert.pfx -clcerts -nokeys -out company.com.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">root# openssl pkcs12 -in exported-cert.pfx -clcerts -nokeys -out company.com.crt</span></span></code></pre></div>
</div></li>
<li>
<p>Copy or move the certificate file and associated key files to the <strong>/etc/nginx/ssl</strong> directory on the NGINXPlus server.</p>
<p>In the configuration files for Exchange load balancing that you can download from the NGINX website, the filenames for the certificate and private key are <strong>company.com.crt</strong> and <strong>company.com.key</strong>. For a discussion of the file and download instructions, see <a href="#config-files">Creating and Modifying Configuration Files</a>.</p>
</li>
</ol>
<p><span id="config"></span></p>
<h2 
id="configuring-nginx-plus">Configuring NGINX Plus  <a class="headerlink float-right" href="#configuring-nginx-plus" title="Configuring NGINX Plus"><i class="fas fa-link fa-xs"></i></a>
</h2><p>You can set up NGINXPlus as your Exchange load balancer in either a basic or enhanced configuration. Basic configuration provides complete loadbalancing and reverseproxy functions. The enhanced configuration adds the following features to make your deployment more reliable and easier to manage:</p>
<ul>
<li>Finegrained URL location control Exchange CASs interact with the various applications used by clients on different types of devices. Creating a separate <code>location</code> block for each application isolates the effect of an application outage to users of that application only. Other applications on the CAS continue to run normally.</li>
<li>Health checks Exchange includes a healthcheck mechanism for several applications that integrates easily with NGINXPlus health checks.</li>
<li>Live activity monitoring NGINXPlus includes a dashboard that provides key load and performance metrics in real time, including TCP metrics in <span style="white-space: nowrap;">NGINX Plus R6</span> and later.</li>
</ul>
<p>For more information about these features in an Exchange load balancer, see <a href="#config-enhanced">Completing the Configuration of Enhanced Load Balancing</a>.</p>
<p>The instructions in these sections are mandatory:</p>
<ul>
<li><a href="#installing">Installing NGINXPlus</a></li>
<li><a href="#config-files">Creating and Modifying Configuration Files</a></li>
<li><a href="#global-settings">Configuring Global Settings</a></li>
<li><a href="#tcp-load-balancing">Configuring TCP Load Balancing</a></li>
<li><a href="#global-http">Configuring Global HTTP and HTTPS Settings</a></li>
<li><a href="#virtual-servers">Configuring Virtual Servers for HTTP and HTTPS Traffic</a></li>
</ul>
<p>Optionally, you can enable support for HTTP/2 in <a href="#http2">Configuring HTTP/2 Support</a>.</p>
<p><span id="installing"></span></p>
<h3 
id="installing-nginx-plus">Installing NGINX Plus  <a class="headerlink float-right" href="#installing-nginx-plus" title="Installing NGINX Plus"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You can install NGINXPlus on premises, in a private cloud, or in a public cloud such as the Amazon Elastic Compute Cloud (EC2), the Google Cloud Platform, or Microsoft Azure. See the instructions for your installation type:</p>
<ul>
<li>Onpremises or private cloud <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/">Installing NGINXPlus</a></li>
<li>Amazon EC2 <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/">Installing NGINXPlus AMIs on Amazon EC2</a></li>
<li>Google Compute Cloud <a href="/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/">Installing NGINXPlus on the Google Cloud Platform</a></li>
<li>Microsoft Azure <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/">Installing NGINXPlus on Microsoft Azure</a></li>
</ul>
<p><span id="config-files"></span></p>
<h3 
id="creating-and-modifying-configuration-files">Creating and Modifying Configuration Files  <a class="headerlink float-right" href="#creating-and-modifying-configuration-files" title="Creating and Modifying Configuration Files"><i class="fas fa-link fa-xs"></i></a>
</h3><p>To reduce errors, this guide has you copy directives from files provided by NGINX into your configuration files, instead of using a text editor to type in the directives yourself. Then you go through the sections in this guide (starting with <a href="#global-settings">Configuring Global Settings</a>) to learn how to modify the directives as required for your deployment.</p>
<p>As provided, there is one file for basic load balancing and one file for enhanced load balancing. If you are installing and configuring NGINXPlus on a fresh Linux system and using it only to load balance Exchange traffic, you can use the provided file as your main NGINXPlus configuration file, which by convention is called <strong>/etc/nginx/nginx.conf</strong>.</p>
<p>We recommend, however, that instead of a single configuration file you use the scheme that is set up automatically when you install an NGINXPlus package especially if you already have an existing NGINX Open Source or NGINXPlus deployment or plan to expand your use of NGINXPlus to other purposes in future. In the conventional scheme, the main configuration file is still called <strong>/etc/nginx/nginx.conf</strong>, but instead of including all directives in it, you create separate configuration files for different functions and store the files in the <strong>/etc/nginx/conf.d</strong> directory. You then use the <a href="https://nginx.org/en/docs/ngx_core_module.html#include" target="_blank" rel="noopener">include</a> directive in the appropriate contexts of the main file to read in the contents of the functionspecific files.</p>
<p>To download the complete configuration file for basic or enhanced load balancing from the NGINX website, run the appropriate commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3209598&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3209598">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl">root# curl https://www.nginx.com/resource/conf/exchange-basic.conf &gt; exchange-basic.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl">root# curl https://www.nginx.com/resource/conf/exchange-basic.conf &gt; exchange-basic.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3238780&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3238780">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl">root# curl https://www.nginx.com/resource/conf/exchange-enhanced.conf &gt; exchange-enhanced.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl">root# curl https://www.nginx.com/resource/conf/exchange-enhanced.conf &gt; exchange-enhanced.conf</span></span></code></pre></div>
</div><p>(You can also access the URL in a browser and download the file.)</p>
<p>To set up the conventional configuration scheme, perform these steps:</p>
<ol>
<li>
<p>In the main <strong>nginx.conf</strong> file, add <code>http</code> and <code>stream</code> configuration blocks, if they do not already exist. (The standard placement is below any global directives; see <a href="#global-settings">Configuring Global Settings</a>.) Add the indicated <code>include</code> directives (you can change the filenames if you wish).</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3270608&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3270608">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/exchange-http.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/exchange-stream.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/exchange-http.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/exchange-stream.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/ngx_core_module.html#include" target="_blank" rel="noopener">include</a></p>
<p>You can also use wildcard notation to read all functionspecific files for either HTTP or TCP traffic into the appropriate context block. For example, if you name all HTTP configuration files <strong><em>function</em>http.conf</strong> and all TCP configuration files <strong><em>function</em>stream.conf</strong> (the filenames we specify in this section conform to this pattern), the wildcarded <code>include</code> directives are:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb328fdf0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb328fdf0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/*-http.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/*-stream.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/*-http.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">conf.d/*-stream.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>In the <strong>/etc/nginx/conf.d</strong> directory, create a new file called <strong>exchangehttp.conf</strong> for directives that pertain to Exchange HTTP and HTTPS traffic (or substitute the name you chose in Step1). Copy in the directives from the <code>http</code> configuration block in the downloaded configuration file. Remember not to copy the first line <span style="white-space: nowrap;">(<code>http</code> <code>{</code>)</span> or the closing curly brace (<code>}</code>) for the block, because the <code>http</code> block you created in Step1 already has them.</p>
</li>
<li>
<p>Also in the <strong>/etc/nginx/conf.d</strong> directory, create a new file called <strong>exchangestream.conf</strong> for directives that pertain to Exchange TCP traffic (or substitute the name you chose in Step1). Copy in the directives from the <code>stream</code> configuration block in the dowloaded configuration file. Again, do not copy the first line <span style="white-space: nowrap;">(<code>stream</code> <code>{</code>)</span> or the closing curly brace (<code>}</code>).</p>
</li>
</ol>
<p>For reference purposes, the text of the full configuration files is included in this document:</p>
<ul>
<li><a href="#full-configuration-basic">Full Configuration for Basic Load Balancing</a></li>
<li><a href="#full-configuration-enhanced">Full Configuration for Enhanced Load Balancing</a></li>
</ul>
<p>We recommend, however, that you do not copy text directly from this document. It does not necessarily use the same mechanisms for positioning text (such as line breaks and white space) as text editors do. In text copied into an editor, lines might run together and indenting of child statements in configuration blocks might be missing or inconsistent. The absence of formatting does not present a problem for NGINXPlus, because (like many compilers) it ignores white space during parsing, relying solely on semicolons and curly braces as delimiters. The absence of white space does, however, make it more difficult for humans to interpret the configuration and modify it without making mistakes.</p>
<p><span id="reloading"></span></p>
<h4 
id="about-reloading-updated-configuration">About Reloading Updated Configuration  <a class="headerlink float-right" href="#about-reloading-updated-configuration" title="About Reloading Updated Configuration"><i class="fas fa-link fa-xs"></i></a>
</h4><p>We recommend that each time you complete a set of updates to the configuration, you run the <span style="white-space: nowrap;"><code>nginx -t</code></span> command to test the configuration file for syntactic validity.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb32ad698&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb32ad698">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# nginx -t
</span></span><span class="line"><span class="cl">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span class="line"><span class="cl">nginx: configuration file /etc/nginx/nginx.conf test is successful</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# nginx -t
</span></span><span class="line"><span class="cl">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
</span></span><span class="line"><span class="cl">nginx: configuration file /etc/nginx/nginx.conf test is successful</span></span></code></pre></div>
</div><p>To tell NGINXPlus to start using the new configuration, run one of the following commands:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb32cfd60&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb32cfd60">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">root</span><span class="c1"># nginx -s reload</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">root</span><span class="c1"># nginx -s reload</span></span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb32e3db0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb32e3db0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">root</span><span class="c1"># service nginx reload</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">root</span><span class="c1"># service nginx reload</span></span></span></code></pre></div>
</div><p><span id="global-settings"></span></p>
<h3 
id="configuring-global-settings">Configuring Global Settings  <a class="headerlink float-right" href="#configuring-global-settings" title="Configuring Global Settings"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Verify that the main <strong>nginx.conf</strong> file includes these global directives, adding them as necessary.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3307418&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3307418">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If using the standard configuration scheme, the &#39;http&#39; and &#39;stream&#39; blocks are
</span></span></span><span class="line"><span class="cl"><span class="c1"># usually placed here and enclose &#39;include&#39; directives that refer to files in
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">#</span> <span class="k">the</span> <span class="s">conf.d</span> <span class="s">directory.</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If using the standard configuration scheme, the &#39;http&#39; and &#39;stream&#39; blocks are
</span></span></span><span class="line"><span class="cl"><span class="c1"># usually placed here and enclose &#39;include&#39; directives that refer to files in
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">#</span> <span class="k">the</span> <span class="s">conf.d</span> <span class="s">directory.</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/ngx_core_module.html#error_log" target="_blank" rel="noopener">error_log</a>, <a href="https://nginx.org/en/docs/ngx_core_module.html#events" target="_blank" rel="noopener">events</a>, <a href="https://nginx.org/en/docs/ngx_core_module.html#pid" target="_blank" rel="noopener">pid</a>, <a href="https://nginx.org/en/docs/ngx_core_module.html#user" target="_blank" rel="noopener">user</a>, <a href="https://nginx.org/en/docs/ngx_core_module.html#worker_connections" target="_blank" rel="noopener">worker_connections</a>, <a href="https://nginx.org/en/docs/ngx_core_module.html#worker_processes" target="_blank" rel="noopener">worker_processes</a></p>
<p><span id="tcp-load-balancing"></span></p>
<h3 
id="configuring-tcp-load-balancing">Configuring TCP Load Balancing  <a class="headerlink float-right" href="#configuring-tcp-load-balancing" title="Configuring TCP Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h3><p>The directives in the toplevel <code>stream</code> configuration block configure TCP load balancing, and are the same for both basic and enhanced load balancing. Modify them as indicated:</p>
<ol>
<li>
<p>In the <code>upstream</code> block that defines the group of loadbalanced Internet Message Access Protocol(IMAP) servers, include a <code>server</code> directive for each of your CASs. For information about the <code>zone</code> directive, see .</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3337988&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3337988">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>In the <code>upstream</code> block that defines the group of loadbalanced Simple Mail Transfer Protocol (SMTP) servers, include a <code>server</code> directive for each of your CASs.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb33584f8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb33584f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>This <code>server</code> block defines the virtual server that proxies traffic on port 993 to the <strong>exchangeimaps</strong> upstream group configured in Step1.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3370f80&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3370f80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#listen" target="_blank" rel="noopener">listen</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_proxy_module.html#proxy_pass" target="_blank" rel="noopener">proxy_pass</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_status_module.html#status_zone" target="_blank" rel="noopener">status_zone</a></p>
</li>
<li>
<p>This <code>server</code> block defines the virtual server that proxies traffic on port 25 to the <strong>exchangesmtp</strong> upstream group configured in Step2. If you wish to change the port number from 25 (for example, to 587), change the <code>listen</code> directive.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb339bb18&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb339bb18">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;stream&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
</ol>
<p>The <code>status_zone</code> directives create an entry for each virtual server on the <strong>TCP Zones</strong> tab of the NGINXPlus live activity monitoring dashboard, which you activate as part of <a href="#config-enhanced">enhanced load balancing</a>. We recommend including the directives even in a basic configuration, in case you decide to enable monitoring in the future.</p>
<p>Similarly, the <code>zone</code> directives create an entry for each upstream group on the <strong>TCP Upstreams</strong> tab of the NGINXPlus live activity monitoring dashboard. They also create a shared memory zone for storing configuration and runtime state information about the servers in the upstream group, which the <code>nginx</code> worker processes on the NGINXPlus host use to improve proxying and loadbalancing efficiency.</p>
<p><span id="global-http"></span></p>
<h3 
id="configuring-global-http-and-https-settings">Configuring Global HTTP and HTTPS Settings  <a class="headerlink float-right" href="#configuring-global-http-and-https-settings" title="Configuring Global HTTP and HTTPS Settings"><i class="fas fa-link fa-xs"></i></a>
</h3><p>These directives in the toplevel <code>http</code> configuration block configure global HTTP and HTTPS settings. Modify them as indicated:</p>
<ol>
<li>
<p>These directives define the file in which access events are logged, and modify the default format of access log messages to include the <code>$upstream_addr</code> variable, which captures the address of the CAS.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb33f21e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb33f21e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#39;&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$upstream_addr&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#39;&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$upstream_addr&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#access_log" target="_blank" rel="noopener">access_log</a>, <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#log_format" target="_blank" rel="noopener">log_format</a></p>
</li>
<li>
<p>These directives set the duration of the indicated timeouts to 3 hours each, to support HTTP long polling by Exchange clients.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3424e68&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3424e68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#keepalive_timeout" target="_blank" rel="noopener">keepalive_timeout</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_read_timeout" target="_blank" rel="noopener">proxy_read_timeout</a></p>
</li>
<li>
<p>The <code>tcp_nodelay</code> directive enables use of the operating system&rsquo;s <code>TCP_NODELAY</code> option. (This option disables the aggregating of many small messages into a larger one, which is often done to reduce the number of packets being sent on the network.)</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3454c08&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3454c08">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#tcp_nodelay" target="_blank" rel="noopener">tcp_nodelay</a></p>
</li>
</ol>
<p><span id="virtual-servers"></span></p>
<h3 
id="configuring-virtual-servers-for-http-and-https-traffic">Configuring Virtual Servers for HTTP and HTTPS Traffic  <a class="headerlink float-right" href="#configuring-virtual-servers-for-http-and-https-traffic" title="Configuring Virtual Servers for HTTP and HTTPS Traffic"><i class="fas fa-link fa-xs"></i></a>
</h3><p>These directives define virtual servers for HTTP and HTTPS traffic in the toplevel <code>http</code> configuration block.</p>
<ol>
<li>
<p>Configure a <code>server</code> block that defines the port for HTTPS traffic (443) and enables NGINXPlus to accept client traffic encrypted with SSL/TLS.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb348e200&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb348e200">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#listen" target="_blank" rel="noopener">listen</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_status_module.html#status_zone" target="_blank" rel="noopener">status_zone</a></p>
<p>The <code>status_zone</code> directive creates an entry for the virtual server on the <strong>Server zones</strong> tab of the NGINXPlus live activity monitoring dashboard, which you activate as part of <a href="#config-enhanced">enhanced load balancing</a>. We recommend including the directive even in a basic configuration, in case you decide to enable monitoring in the future.</p>
</li>
<li>
<p>This directive increases the default file upload size, which is required for Microsoft RPC Over HTTP. (Note that the directive does not set the maximum size of an email message.)</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb34c2dc0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb34c2dc0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size" target="_blank" rel="noopener">client_max_body_size</a></p>
</li>
<li>
<p>These directives name the SSL certificate and private key, and disable use of any protocol less secure than TLS version1.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb34f46b8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb34f46b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate" target="_blank" rel="noopener">ssl_certificate</a>, <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_certificate_key" target="_blank" rel="noopener">ssl_certificate_key</a>, <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html#ssl_protocols" target="_blank" rel="noopener">ssl_protocols</a></p>
</li>
<li>
<p>This location block redirects traffic from the main mail page (corresponding to<strong>/</strong>) to the Outlook Web App(OWA), which IIS does not do by default:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb352e868&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb352e868">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">return</span> <span class="mi">301</span> <span class="s">/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>, <a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return" target="_blank" rel="noopener">return</a></p>
</li>
<li>
<p>(Optional) If a browser requests the <strong>favicon.ico</strong> file and it is not available, this <code>location</code> block disables logging of any resulting errors and supplies an empty image file. Many applications provide a <strong>favicon.ico</strong> file containing the icon that appears on a page&rsquo;s tab in the browser to indicate the application. IIS by default does not make the <strong>favicon.ico</strong> file available for the main mail page.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3562870&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3562870">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_log_module.html#access_log" target="_blank" rel="noopener">access_log</a>, <a href="https://nginx.org/en/docs/http/ngx_http_empty_gif_module.html#empty_gif" target="_blank" rel="noopener">empty_gif</a></p>
</li>
<li>
<p>Configure a <code>server</code> block that permanently redirects requests received on port 80 to the HTTPS server, which is defined in Step1 above.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb359aec8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb359aec8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#listen" target="_blank" rel="noopener">listen</a>, <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>, <a href="https://nginx.org/en/docs/http/ngx_http_rewrite_module.html#return" target="_blank" rel="noopener">return</a>, <a href="https://nginx.org/en/docs/stream/ngx_stream_core_module.html#server" target="_blank" rel="noopener">server</a></p>
</li>
</ol>
<p><span id="http2"></span></p>
<h3 
id="configuring-http2-support">Configuring HTTP/2 Support  <a class="headerlink float-right" href="#configuring-http2-support" title="Configuring HTTP/2 Support"><i class="fas fa-link fa-xs"></i></a>
</h3><p>HTTP/2 is fully supported in <span style="white-space: nowrap;">NGINX Plus R7</span> and later (as well as NGINX1.9.5 and later). As always, we recommend you run the latest version of software to take advantage of improvements and bug fixes.</p>
<p>In <span style="white-space: nowrap;">NGINX Plus R8</span> and later, NGINXPlus supports HTTP/2 by default, and does not support SPDY:</p>
<ul>
<li>
<p>In <span style="white-space: nowrap;">NGINX Plus R11</span> and later, the <strong>nginxplus</strong> package continues to support HTTP/2 by default, but the <strong>nginxplusextras</strong> package available in previous releases is deprecated by <a href="https://www.nginx.com/products/nginx/dynamic-modules/" target="_blank" rel="noopener">dynamic modules</a>.</p>
</li>
<li>
<p>For <span style="white-space: nowrap;">NGINX Plus R8</span> throughR10, the <strong>nginxplus</strong> and <strong>nginxplusextras</strong> packages support HTTP/2 by default.</p>
</li>
</ul>
<p>If using <span style="white-space: nowrap;">NGINX Plus R7</span>, you must install the <strong>nginxplushttp2</strong> package instead of the <strong>nginxplus</strong> or <strong>nginxplusextras</strong> package.</p>
<p>To enable HTTP/2 support, add the <code>http2</code> directive in the <code>server</code> block for HTTPS traffic that we created in <a href="#virtual-servers">Configuring Virtual Servers for HTTP and HTTPS Traffic</a>, so that it looks like this:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb35e69b8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb35e69b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">http2</span>  <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">http2</span>  <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_v2_module.html#http2" target="_blank" rel="noopener">http2</a></p>
<p>To verify that HTTP/2 translation is working, you can use the &ldquo;HTTP/2 and SPDY indicator&rdquo; plugin available for <a href="https://chrome.google.com/webstore/detail/http2-and-spdy-indicator/mpbpobfflnpcgagjijhmgnchggcjblin?hl=en" target="_blank" rel="noopener">GoogleChrome</a> and <a href="https://addons.mozilla.org/en-US/firefox/addon/http2-indicator/" target="_blank" rel="noopener">Firefox</a>.</p>
<p><span id="config-completing"></span></p>
<h2 
id="completing-the-configuration-of-load-balancing">Completing the Configuration of Load Balancing  <a class="headerlink float-right" href="#completing-the-configuration-of-load-balancing" title="Completing the Configuration of Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h2><p>The preceding instructions in <a href="#config">Configuring NGINXPlus</a> are required for both basic and enhanced load balancing. At this point, you proceed to the section for the final desired configuration:</p>
<ul>
<li><a href="#config-basic">Completing the Configuration of Basic Load Balancing</a></li>
<li><a href="#config-enhanced">Completing the Configuration of Enhanced Load Balancing</a></li>
</ul>
<p><span id="config-basic"></span></p>
<h3 
id="completing-the-configuration-of-basic-load-balancing">Completing the Configuration of Basic Load Balancing  <a class="headerlink float-right" href="#completing-the-configuration-of-basic-load-balancing" title="Completing the Configuration of Basic Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h3><p>These directives complete the configuration for basic load balancing of Exchange traffic. (To finalize enhanced load balancing instead, proceed to <a href="#config-enhanced">Completing the Configuration of Enhanced Load Balancing</a>.)</p>
<ol>
<li>
<p>In the <code>upstream</code> block that defines the group of servers across which NGINXPlus load balances HTTPS traffic, include a <code>server</code> directive for each of your CASs. With <span style="white-space: nowrap;">NGINX Plus R7</span> and later, you can include the <code>ntlm</code> directive to use <span style="white-space: nowrap;">Microsoft NT LAN Manager</span> for authentication.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3643618&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3643618">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                 <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                 <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ntlm" target="_blank" rel="noopener">ntlm</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" target="_blank" rel="noopener"><code>sticky learn</code></a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>In the <code>server</code> block for HTTPS traffic (created in <a href="#https">Configuring a Virtual Server for HTTPS Traffic</a>), this <code>location</code> block disables buffering of both uploads and downloads, as required by Microsoft RPC Over HTTP.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3696250&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3696250">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering" target="_blank" rel="noopener">proxy_buffering</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version" target="_blank" rel="noopener">proxy_http_version</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" rel="noopener">proxy_pass</a>,<a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_request_buffering" target="_blank" rel="noopener">proxy_request_buffering</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" target="_blank" rel="noopener">proxy_set_header</a></p>
</li>
</ol>
<p><span id="full-configuration-basic"></span></p>
<h3 
id="full-configuration-for-basic-load-balancing">Full Configuration for Basic Load Balancing  <a class="headerlink float-right" href="#full-configuration-for-basic-load-balancing" title="Full Configuration for Basic Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb37f4f98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb37f4f98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;http&#39; block into it, including the initial and final lines which open
</span></span></span><span class="line"><span class="cl"><span class="c1"># and close the &#39;http&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If creating a separate conf.d/exchange-http.conf file, either exclude the
</span></span></span><span class="line"><span class="cl"><span class="c1"># initial and final lines from the copied region, or copy them but comment
</span></span></span><span class="line"><span class="cl"><span class="c1"># them out in the exchange-http.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$upstream_addr&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                     <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">http2</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">&#34;/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;stream&#39; block into it, including the initial and final lines which open
</span></span></span><span class="line"><span class="cl"><span class="c1"># and close the &#39;stream&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If using a separate conf.d/exchange-stream.conf file, either exclude
</span></span></span><span class="line"><span class="cl"><span class="c1"># the initial and final lines from the copied region, or copy them but
</span></span></span><span class="line"><span class="cl"><span class="c1"># comment them out in the exchange-stream.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;http&#39; block into it, including the initial and final lines which open
</span></span></span><span class="line"><span class="cl"><span class="c1"># and close the &#39;http&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If creating a separate conf.d/exchange-http.conf file, either exclude the
</span></span></span><span class="line"><span class="cl"><span class="c1"># initial and final lines from the copied region, or copy them but comment
</span></span></span><span class="line"><span class="cl"><span class="c1"># them out in the exchange-http.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$upstream_addr&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                     <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">http2</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">&#34;/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;stream&#39; block into it, including the initial and final lines which open
</span></span></span><span class="line"><span class="cl"><span class="c1"># and close the &#39;stream&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If using a separate conf.d/exchange-stream.conf file, either exclude
</span></span></span><span class="line"><span class="cl"><span class="c1"># the initial and final lines from the copied region, or copy them but
</span></span></span><span class="line"><span class="cl"><span class="c1"># comment them out in the exchange-stream.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p><span id="config-enhanced"></span></p>
<h3 
id="completing-the-configuration-of-enhanced-load-balancing">Completing the Configuration of Enhanced Load Balancing  <a class="headerlink float-right" href="#completing-the-configuration-of-enhanced-load-balancing" title="Completing the Configuration of Enhanced Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h3><p>This section describes the configuration for enhanced load balancing of Exchange traffic. The enhancements improve the performance of your NGINXPlus deployment and make it easier to manage.</p>
<p>(To finalize basic load balancing instead, return to <a href="#config-basic">Completing the Configuration of Basic Load Balancing</a>.)</p>
<ul>
<li><a href="#app-specific-load-balancing">Configuring ApplicationSpecific Load Balancing</a></li>
<li><a href="#monitoring">Enabling the Live Activity Monitoring Dashboard</a></li>
</ul>
<p><span id="app-specific-load-balancing"></span></p>
<h4 
id="configuring-application-specific-load-balancing">Configuring Application-Specific Load Balancing  <a class="headerlink float-right" href="#configuring-application-specific-load-balancing" title="Configuring Application-Specific Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Exchange CASs interact with various applications used by clients on different types of devices. The clients access virtual directories and URIs specific to their application. To improve the performance of applications and of NGINXPlus, configure a separate <code>location</code> block for each application to enable the features listed in the table.</p>





<table class="table table-bordered table-striped table-responsive table-sm table-v1">
  <thead>
      <tr>
          <th style="text-align: left"><strong>Application</strong></th>
          <th style="text-align: left"><strong>Virtual Directory or URI</strong></th>
          <th style="text-align: left"><strong>Enhanced Features</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">ActiveSync</td>
          <td style="text-align: left"><strong>/Microsoft-Server-ActiveSync</strong></td>
          <td style="text-align: left">Exchange Control Panel</td>
      </tr>
      <tr>
          <td style="text-align: left">Health checks</td>
          <td style="text-align: left"><strong>/ecp</strong></td>
          <td style="text-align: left">Restricted access and health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">MAPI over HTTP</td>
          <td style="text-align: left"><strong>/mapi</strong></td>
          <td style="text-align: left">Health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">OWA</td>
          <td style="text-align: left"><strong>/owa</strong></td>
          <td style="text-align: left">Health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">RPC Over HTTP</td>
          <td style="text-align: left"><strong>/rpc/rpcproxy.dll</strong></td>
          <td style="text-align: left">Unbuffered upload and download; session persistence</td>
      </tr>
  </tbody>
</table>






  


<div data-mf="true" style="display: none;" class="table-v2 table table-bordered table-striped table-responsive table-sm narrow">
    <table>
  <thead>
      <tr>
          <th style="text-align: left"><strong>Application</strong></th>
          <th style="text-align: left"><strong>Virtual Directory or URI</strong></th>
          <th style="text-align: left"><strong>Enhanced Features</strong></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">ActiveSync</td>
          <td style="text-align: left"><strong>/Microsoft-Server-ActiveSync</strong></td>
          <td style="text-align: left">Exchange Control Panel</td>
      </tr>
      <tr>
          <td style="text-align: left">Health checks</td>
          <td style="text-align: left"><strong>/ecp</strong></td>
          <td style="text-align: left">Restricted access and health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">MAPI over HTTP</td>
          <td style="text-align: left"><strong>/mapi</strong></td>
          <td style="text-align: left">Health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">OWA</td>
          <td style="text-align: left"><strong>/owa</strong></td>
          <td style="text-align: left">Health checks</td>
      </tr>
      <tr>
          <td style="text-align: left">RPC Over HTTP</td>
          <td style="text-align: left"><strong>/rpc/rpcproxy.dll</strong></td>
          <td style="text-align: left">Unbuffered upload and download; session persistence</td>
      </tr>
  </tbody>
</table>

</div>
<p><span id="url-control"></span></p>
<h5 
id="configuring-granular-url-location-control">Configuring Granular URL Location Control  <a class="headerlink float-right" href="#configuring-granular-url-location-control" title="Configuring Granular URL Location Control"><i class="fas fa-link fa-xs"></i></a>
</h5><ol>
<li>
<p>In the toplevel <code>http</code> configuration block, there is a separate <code>upstream</code> block for each application, which improves Exchange&rsquo;s overall reliability by isolating the effect of outages to just the affected application. (In other words, creating separate upstream groups means that if an application or directory becomes unavailable, clients can still access the other applications and directories that are functioning and accessible.)</p>
<p>In each <code>upstream</code> block, include a <code>server</code> directive for each of your CASs. With <span style="white-space: nowrap;">NGINX Plus R7</span> and later, you can include the <code>ntlm</code> directive to use <span style="white-space: nowrap;">Microsoft NT LAN Manager</span> for authentication.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb38de210&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb38de210">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-activesync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-activesync</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-ecp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-mapi</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-owa</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-rpc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-rpc</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                 <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-activesync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-activesync</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-ecp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-mapi</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-owa</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span>  <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">exchange-rpc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">exchange-rpc</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                 <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#ntlm" target="_blank" rel="noopener">ntlm</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>In the <code>server</code> block for HTTPS traffic (created in <a href="#https">Configuring a Virtual Server for HTTPS Traffic</a>), a separate <code>location</code> block for each client application configures different handling of each type of traffic:</p>
<ul>
<li>
<p>Clients that don&rsquo;t specify an application access the main page.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3957f48&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3957f48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version" target="_blank" rel="noopener">proxy_http_version</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" rel="noopener">proxy_pass</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" target="_blank" rel="noopener">proxy_set_header</a></p>
</li>
<li>
<p>Administrators using the Exchange Control Panel (ECP) access <strong>/ecp</strong>. Presumably you want to restrict access to this location, and one of the simplest ways is to uncomment the <code>allow</code> and <code>deny</code> directives, which allow access from your administrative network (substitute its IP address and prefix for 172.16.0.0/16) and deny access to everyone else. You could also use other security methods, like SSL certificates or an additional layer of HTTP Basic authentication.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb397ade0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb397ade0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html#allow" target="_blank" rel="noopener">allow</a>, <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html#deny" target="_blank" rel="noopener">deny</a></p>
</li>
<li>
<p>Outlook 2013 SP1 clients using MAPI Over HTTP access <strong>/mapi</strong>.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb39a5d60&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb39a5d60">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Mobile clients like iPhone and Android access the ActiveSync location (<strong>/MicrosoftServerActiveSync</strong>).</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb39c0340&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb39c0340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/Microsoft-Server-ActiveSync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-activesync</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/Microsoft-Server-ActiveSync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-activesync</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Clients using a browser for webmail access the OWA location (<strong>/owa</strong>).</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb39d91b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb39d91b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Outlook Anywhere clients access the RPC Over HTTP location (<strong>/rpc/rpcproxy.dll</strong>). The two additional directives disable buffering for both upload and download of content, as required by RPC Over HTTP.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb39f4730&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb39f4730">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering" target="_blank" rel="noopener">proxy_buffering</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_request_buffering" target="_blank" rel="noopener">proxy_request_buffering</a></p>
</li>
</ul>
</li>
</ol>
<p><span id="health-check"></span></p>
<h5 
id="configuring-application-specific-health-checks">Configuring Application-Specific Health Checks  <a class="headerlink float-right" href="#configuring-application-specific-health-checks" title="Configuring Application-Specific Health Checks"><i class="fas fa-link fa-xs"></i></a>
</h5><p>For several applications, Exchange includes a healthcheck mechanism that you can easily integrate with the healthcheck feature in NGINXPlus. Specifically, you configure the NGINXPlus health check to succeed when the Exchange health check succeeds.</p>
<p>When an Exchange health check succeeds for an application, the following lines are written at the end of the application&rsquo;s <strong>healthcheck.htm</strong> file.</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3a0fcb0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3a0fcb0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">200 OK
</span></span><span class="line"><span class="cl">server-name.FQDN</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">200 OK
</span></span><span class="line"><span class="cl">server-name.FQDN</span></span></code></pre></div>
</div><p>Here&rsquo;s an example of the full contents of a <strong>healthcheck.htm</strong> file for the MAPI application:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3a34a88&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3a34a88">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# curl -v https://mail.company.com/mapi/healthcheck.htm
</span></span><span class="line"><span class="cl">&gt; GET /mapi/healthcheck.htm HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.37.1
</span></span><span class="line"><span class="cl">&gt;   Host: mail.company.com
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt;
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">* Server nginx/1.7.11 is not blacklisted
</span></span><span class="line"><span class="cl">&lt; Server: nginx/1.7.11
</span></span><span class="line"><span class="cl">&lt; Date: Thu, 02 Apr 2015 00:36:34 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Length: 34
</span></span><span class="line"><span class="cl">&lt; Connection: keep-alive
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: ASP.NET
</span></span><span class="line"><span class="cl">&lt; X-FEServer: CAS02
</span></span><span class="line"><span class="cl">&lt;
</span></span><span class="line"><span class="cl">200 OK
</span></span><span class="line"><span class="cl">CAS02.CORP.Company.com</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">root# curl -v https://mail.company.com/mapi/healthcheck.htm
</span></span><span class="line"><span class="cl">&gt; GET /mapi/healthcheck.htm HTTP/1.1
</span></span><span class="line"><span class="cl">&gt; User-Agent: curl/7.37.1
</span></span><span class="line"><span class="cl">&gt;   Host: mail.company.com
</span></span><span class="line"><span class="cl">&gt; Accept: */*
</span></span><span class="line"><span class="cl">&gt;
</span></span><span class="line"><span class="cl">&lt; HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">* Server nginx/1.7.11 is not blacklisted
</span></span><span class="line"><span class="cl">&lt; Server: nginx/1.7.11
</span></span><span class="line"><span class="cl">&lt; Date: Thu, 02 Apr 2015 00:36:34 GMT
</span></span><span class="line"><span class="cl">&lt; Content-Length: 34
</span></span><span class="line"><span class="cl">&lt; Connection: keep-alive
</span></span><span class="line"><span class="cl">&lt; X-Powered-By: ASP.NET
</span></span><span class="line"><span class="cl">&lt; X-FEServer: CAS02
</span></span><span class="line"><span class="cl">&lt;
</span></span><span class="line"><span class="cl">200 OK
</span></span><span class="line"><span class="cl">CAS02.CORP.Company.com</span></span></code></pre></div>
</div><p>These directives configure NGINXPlus health checks.</p>
<ol>
<li>
<p>In the <code>server</code> block for HTTPS traffic (described in <a href="#https">Configuring a Virtual Server for HTTPS Traffic</a>), this <code>match</code> block checks for status code <code>200</code> and the string <span style="white-space: nowrap;"><code>200 OK</code></span> in the response body.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3a4e0c8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3a4e0c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">match</span> <span class="s">exchange-health</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">body</span> <span class="p">~</span> <span class="sr">&#34;200</span> <span class="s">OK&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">match</span> <span class="s">exchange-health</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">body</span> <span class="p">~</span> <span class="sr">&#34;200</span> <span class="s">OK&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_hc_module.html#match" target="_blank" rel="noopener">match</a></p>
</li>
<li>
<p>In these <code>location</code> blocks (described in their basic form in <a href="#url-control">Configuring Granular URL Location Control</a>), the addition of <code>health_check</code> directives configures NGINXPlus health checks:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3a8e420&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3a8e420">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic location
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/ecp/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/mapi/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/owa/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic location
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/ecp/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/mapi/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/owa/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_hc_module.html#health_check" target="_blank" rel="noopener">health_check</a>, <a href="https://nginx.org/en/docs/http/ngx_http_core_module.html#location" target="_blank" rel="noopener">location</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_http_version" target="_blank" rel="noopener">proxy_http_version</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_pass" target="_blank" rel="noopener">proxy_pass</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_set_header" target="_blank" rel="noopener">proxy_set_header</a></p>
</li>
<li>
<p>Together, this <code>match</code> configuration block (in the toplevel <code>http</code> context) and this <code>health_check</code> directive (added to the existing <code>location</code> block for Outlook Anywhere clients) direct RPC traffic away from servers that don&rsquo;t have HTTP Basic authentication enabled.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3ac2428&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3ac2428">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">match</span> <span class="s">exchange-auth</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status</span> <span class="mi">401</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">header</span> <span class="s">WWW-Authenticate</span> <span class="p">~</span> <span class="sr">Basic;</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/rpc/rpcproxy.dll</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">match</span> <span class="s">exchange-auth</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">status</span> <span class="mi">401</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">header</span> <span class="s">WWW-Authenticate</span> <span class="p">~</span> <span class="sr">Basic;</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># In the &#39;server&#39; block for HTTPS traffic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="s">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">health_check</span> <span class="s">uri=/rpc/rpcproxy.dll</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                 <span class="s">match=exchange-auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_buffering" target="_blank" rel="noopener">proxy_buffering</a>, <a href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_request_buffering" target="_blank" rel="noopener">proxy_request_buffering</a></p>
</li>
</ol>
<p><span id="monitoring"></span></p>
<h4 
id="enabling-the-live-activity-monitoring-dashboard">Enabling the Live Activity Monitoring Dashboard  <a class="headerlink float-right" href="#enabling-the-live-activity-monitoring-dashboard" title="Enabling the Live Activity Monitoring Dashboard"><i class="fas fa-link fa-xs"></i></a>
</h4><p>NGINXPlus includes a live activity monitoring interface that provides key load and performance metrics in real time, including TCP metrics in <span style="white-space: nowrap;">NGINX Plus R6</span> and later. Statistics are reported through a RESTful JSON interface, making it very easy to feed the data to a custom or thirdparty monitoring tool. There is also a builtin dashboard in NGINX Plus. Follow these instructions to deploy it.</p>
<img src="/nginx/images/nginx-plus-dashboard-r19-overview.png" alt="Dashboard tab in NGINX Plus live activity monitoring dashboard" style="border:2px solid #666666; padding:2px; margin:2px;" />
<p>For more information about live activity monitoring, see the <a href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/">NGINXPlus AdminGuide</a>.</p>
<p>The quickest way to configure the module and the builtin dashboard is to download the sample configuration file from the NGINX website, and modify it as necessary. For more complete instructions, see <a href="https://www.nginx.com/blog/live-activity-monitoring-nginx-plus-3-simple-steps/" target="_blank" rel="noopener">Live Activity Monitoring of NGINXPlus in 3Simple Steps</a>.</p>
<ol>
<li>
<p>Download the <strong>status.conf</strong> file to the NGINXPlus server:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3ae8d58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3ae8d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl"># curl https://www.nginx.com/resource/conf/status.conf &gt; status.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># cd /etc/nginx/conf.d
</span></span><span class="line"><span class="cl"># curl https://www.nginx.com/resource/conf/status.conf &gt; status.conf</span></span></code></pre></div>
</div></li>
<li>
<p>Read in <strong>status.conf</strong> at the toplevel <code>http</code> configuration block in the main <strong>nginx.conf</strong> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3afae68&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3afae68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">include</span> <span class="n">conf.d/status.conf</span>;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="c1"># In the &#39;http&#39; block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">include</span> <span class="n">conf.d/status.conf</span>;</span></span></code></pre></div>
</div><p>If you are using the conventional configuration scheme and your existing <code>include</code> directives use the wildcard notation discussed in <a href="#config-files">Creating and Modifying Configuration Files</a>, you can either add a separate <code>include</code> directive for <strong>status.conf</strong> as shown above, or change the name of <strong>status.conf</strong> so it is captured by the wildcard in an existing <code>include</code> directive in the <code>http</code> block. For example, changing it to <strong>statushttp.conf</strong> means it is captured by the <code>include</code> directive for <span style="white-space: nowrap;"><code>*-http.conf</code></span>.</p>
<p>Directive documentation: <a href="https://nginx.org/en/docs/ngx_core_module.html#include" target="_blank" rel="noopener">include</a></p>
</li>
<li>
<p>Comments in <strong>status.conf</strong> explain which directives you must customize for your deployment. In particular, the default settings in the sample configuration file allow anyone on any network to access the dashboard. We strongly recommend that you restrict access to the dashboard with one or more of the following methods:</p>
<ul>
<li>
<p><strong>IP addressbased access control lists (ACLs)</strong>. In the sample configuration file, uncomment the <code>allow</code> and <code>deny</code> directives, and substitute the address of your administrative network for 10.0.0.0/8. Only users on the specified network can access the status page.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3b144a8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3b144a8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">allow</span> <span class="mi">10</span><span class="s">.0.0.0/8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">deny</span> <span class="s">all</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">allow</span> <span class="mi">10</span><span class="s">.0.0.0/8</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">deny</span> <span class="s">all</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html#allow" target="_blank" rel="noopener">allow</a>, <a href="https://nginx.org/en/docs/http/ngx_http_access_module.html#deny" target="_blank" rel="noopener">deny</a></p>
</li>
<li>
<p><strong>HTTP Basic authentication</strong> as defined in <a href="https://tools.ietf.org/html/rfc7617" target="_blank" rel="noopener">RFC7617</a>. In the sample configuration file, uncomment the <code>auth_basic</code> and <code>auth_basic_user_file</code> directives and add user entries to the <strong>/etc/nginx/users</strong> file (for example, by using an <strong>htpasswd</strong> generator). If you have an Apache installation, another option is to reuse an existing <strong>htpasswd</strong> file.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3b2d318&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3b2d318">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">auth_basic</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auth_basic_user_file</span> <span class="s">/etc/nginx/users</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">auth_basic</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">auth_basic_user_file</span> <span class="s">/etc/nginx/users</span><span class="p">;</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html#auth_basic" target="_blank" rel="noopener">auth_basic</a>, <a href="https://nginx.org/en/docs/http/ngx_http_auth_basic_module.html#auth_basic_user_file" target="_blank" rel="noopener">auth_basic_user_file</a></p>
</li>
<li>
<p><strong>Client certificates</strong>, which are part of a complete configuration of SSL/TLS. For more information, see the <a href="/nginx/admin-guide/security-controls/terminating-ssl-http/">NGINXPlus AdminGuide</a> and the reference documentation for the HTTP <a href="https://nginx.org/en/docs/http/ngx_http_ssl_module.html" target="_blank" rel="noopener">SSL/TLS</a> module.</p>
</li>
<li>
<p><strong>Firewall</strong>. Configure your firewall to disallow outside access to the port for the dashboard (8080 in the sample configuration file).</p>
</li>
</ul>
</li>
</ol>
<p>When you reload the NGINXPlus configuration file, for example by running the <span style="white-space: nowrap;"><code>nginx -s reload</code></span> command, the NGINXPlus dashboard is available immediately at <span style="white-space: nowrap;"><strong>http://<em>nginx-plus-server-address</em>:8080</strong></span>.</p>
<p>For more information about live activity monitoring, see the <span style="white-space: nowrap;"><a href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/">NGINX Plus Admin Guide</a></span>.</p>
<p><span id="full-configuration-enhanced"></span></p>
<h3 
id="full-configuration-for-enhanced-load-balancing">Full Configuration for Enhanced Load Balancing  <a class="headerlink float-right" href="#full-configuration-for-enhanced-load-balancing" title="Full Configuration for Enhanced Load Balancing"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3cb8750&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3cb8750">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;http&#39; block into it, including the initial and final lines (&#39;http { ... }&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"># which open and close the &#39;http&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If creating a separate conf.d/exchange-http.conf file, either exclude the
</span></span></span><span class="line"><span class="cl"><span class="c1"># initial and final lines from the copied region, or copy them but comment
</span></span></span><span class="line"><span class="cl"><span class="c1"># them out in the exchange-http.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="nv">$upstream_addr&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If this file serves as the main nginx.conf file (contains your entire
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># site configuration), this &#39;include&#39; directive reads in the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># configuration file for live activity monitoring. If creating a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># separate conf.d/exchange-http.conf file, put this directive in the main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># nginx.conf file instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">include</span> <span class="s">conf.d/status.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-activesync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-activesync</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-ecp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-mapi</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-owa</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-rpc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-rpc</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                     <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">match</span> <span class="s">exchange-auth</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status</span> <span class="mi">401</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">header</span> <span class="s">WWW-Authenticate</span> <span class="p">~</span> <span class="sr">Basic;</span>
</span></span><span class="line"><span class="cl">    <span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">match</span> <span class="s">exchange-health</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">body</span> <span class="p">~</span> <span class="sr">&#34;200</span> <span class="s">OK&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">http2</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">&#34;/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Grant access to admin users only, by uncommenting the &#39;allow&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># and &#39;deny&#39; directives and substituting the IP address and
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># prefix of your admin network. Or configure more sophisticated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># access control.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/ecp/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/mapi/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/Microsoft-Server-ActiveSync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-active-sync</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/owa/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/rpc/rpcproxy.dll</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;stream&#39; block into it, including the initial and final lines
</span></span></span><span class="line"><span class="cl"><span class="c1"># (&#39;stream { ... }&#34;) which open and close the &#39;stream&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If using a separate conf.d/exchange-stream.conf file, either exclude
</span></span></span><span class="line"><span class="cl"><span class="c1"># the initial and final lines from the copied region, or copy them but
</span></span></span><span class="line"><span class="cl"><span class="c1"># comment them out in the exchange-stream.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">info</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span> <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;http&#39; block into it, including the initial and final lines (&#39;http { ... }&#39;)
</span></span></span><span class="line"><span class="cl"><span class="c1"># which open and close the &#39;http&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If creating a separate conf.d/exchange-http.conf file, either exclude the
</span></span></span><span class="line"><span class="cl"><span class="c1"># initial and final lines from the copied region, or copy them but comment
</span></span></span><span class="line"><span class="cl"><span class="c1"># them out in the exchange-http.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">main</span> <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="nv">$upstream_addr&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_read_timeout</span> <span class="s">3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nodelay</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># If this file serves as the main nginx.conf file (contains your entire
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># site configuration), this &#39;include&#39; directive reads in the
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># configuration file for live activity monitoring. If creating a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># separate conf.d/exchange-http.conf file, put this directive in the main
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># nginx.conf file instead.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">include</span> <span class="s">conf.d/status.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-general</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-activesync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-activesync</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-ecp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-mapi</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-owa</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-rpc</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-rpc</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ntlm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">443</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">sticky</span> <span class="s">learn</span> <span class="s">create=</span><span class="nv">$remote_addr</span> <span class="s">lookup=</span><span class="nv">$remote_addr</span>
</span></span><span class="line"><span class="cl">                     <span class="s">zone=client_sessions:10m</span> <span class="s">timeout=3h</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">match</span> <span class="s">exchange-auth</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status</span> <span class="mi">401</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">header</span> <span class="s">WWW-Authenticate</span> <span class="p">~</span> <span class="sr">Basic;</span>
</span></span><span class="line"><span class="cl">    <span class="err">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="s">match</span> <span class="s">exchange-health</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status</span> <span class="mi">200</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">body</span> <span class="p">~</span> <span class="sr">&#34;200</span> <span class="s">OK&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">http2</span>  <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="s">2G</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate</span> <span class="s">/etc/nginx/ssl/company.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span> <span class="s">/etc/nginx/ssl/company.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-combined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">return</span> <span class="mi">301</span> <span class="s">&#34;/owa/&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="p">=</span> <span class="s">/favicon.ico</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">empty_gif</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">access_log</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/ecp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># Grant access to admin users only, by uncommenting the &#39;allow&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># and &#39;deny&#39; directives and substituting the IP address and
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># prefix of your admin network. Or configure more sophisticated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1"># access control.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="c1">#allow 172.16.0.0/16; # Replace with your admin network
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">#deny all;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-ecp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/ecp/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/mapi</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-mapi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/mapi/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/Microsoft-Server-ActiveSync</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-active-sync</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/owa</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-owa</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/owa/healthcheck.htm</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-health</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/rpc/rpcproxy.dll</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">https://exchange-rpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_request_buffering</span> <span class="no">off</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_set_header</span> <span class="s">Connection</span> <span class="s">&#34;Keep-Alive&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">health_check</span> <span class="s">uri=/rpc/rpcproxy.dll</span> <span class="s">interval=3s</span>
</span></span><span class="line"><span class="cl">                         <span class="s">match=exchange-auth</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># If placing all directives in the main nginx.conf file, copy the following
</span></span></span><span class="line"><span class="cl"><span class="c1"># &#39;stream&#39; block into it, including the initial and final lines
</span></span></span><span class="line"><span class="cl"><span class="c1"># (&#39;stream { ... }&#34;) which open and close the &#39;stream&#39; context.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1"># If using a separate conf.d/exchange-stream.conf file, either exclude
</span></span></span><span class="line"><span class="cl"><span class="c1"># the initial and final lines from the copied region, or copy them but
</span></span></span><span class="line"><span class="cl"><span class="c1"># comment them out in the exchange-stream.conf file.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kn">stream</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-imaps</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-imaps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">993</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">upstream</span> <span class="s">exchange-smtp</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">zone</span> <span class="s">exchange-smtp</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">server</span> <span class="n">10.0.0.237</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">server</span> <span class="n">10.0.0.238</span><span class="p">:</span><span class="mi">25</span><span class="p">;</span> <span class="c1"># Replace with IP address of a CAS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">993</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">status_zone</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-imaps</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">25</span><span class="p">;</span> <span class="c1"># SMTP port can be changed here (to 587, for example)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">status_zone</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">exchange-smtp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p><span id="revision"></span></p>
<h3 
id="revision-history">Revision History  <a class="headerlink float-right" href="#revision-history" title="Revision History"><i class="fas fa-link fa-xs"></i></a>
</h3><ul>
<li>Version 6 (May 2024)  Update about HTTP/2 support (the <a href="https://nginx.org/en/docs/http/ngx_http_v2_module.html#http2" target="_blank" rel="noopener">http2</a> directive)</li>
<li>Version 5 (April 2018)  Update for NGINX Plus API (<span style="white-space: nowrap;">NGINX Plus R14</span>)</li>
<li>Version 4 (May 2017) Update about HTTP/2 support (<span style="white-space: nowrap;">NGINX Plus Release 11</span> and later)</li>
<li>Version 3 (February 2016) Conversion to HTML formatting (<span style="white-space: nowrap;">NGINX Plus Release 8</span>)</li>
<li>Version 2 (November 2015) Updates for <span style="white-space: nowrap;">NGINX Plus Release 7</span></li>
<li>Version 1 (May 2015) Initial version (<span style="white-space: nowrap;">NGINX Plus Release 6</span>)</li>
</ul>

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nginx/deployment-guides/load-balance-third-party/microsoft-exchange.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=Load%20Balancing%20Microsoft%20Exchange%20Servers%20with%20NGINX%20Plus&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		
		
		<li style="flex:1; text-align: left; white-space: nowrap;"><a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/apache-tomcat/" class="" title="Previous -- Load Balancing Apache Tomcat Servers with NGINX Open Source and NGINX Plus "><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.378 46.5L1.94 25.06C1.80067 24.9209 1.69014 24.7556 1.61472 24.5738C1.53931 24.3919 1.50049 24.1969 1.50049 24C1.50049 23.8031 1.53931 23.6081 1.61472 23.4262C1.69014 23.2444 1.80067 23.0791 1.94 22.94L23.378 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M45.878 46.5L24.44 25.06C24.3007 24.9209 24.1901 24.7556 24.1147 24.5738C24.0393 24.3919 24.0005 24.1969 24.0005 24C24.0005 23.8031 24.0393 23.6081 24.1147 23.4262C24.1901 23.2444 24.3007 23.0791 24.44 22.94L45.878 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		

		
			<li style="flex:1; text-align: right; white-space: nowrap;"><a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/node-js/" class="" title="Next -- Load Balancing Node.js Application Servers with NGINX Open Source and NGINX Plus"><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24.622 1.5L46.06 22.94C46.1993 23.0791 46.3099 23.2444 46.3853 23.4262C46.4607 23.6081 46.4995 23.8031 46.4995 24C46.4995 24.1969 46.4607 24.3919 46.3853 24.5738C46.3099 24.7556 46.1993 24.9209 46.06 25.06L24.622 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.122 1.5L23.56 22.94C23.6993 23.0791 23.8099 23.2444 23.8853 23.4262C23.9607 23.6081 23.9995 23.8031 23.9995 24C23.9995 24.1969 23.9607 24.3919 23.8853 24.5738C23.8099 24.7556 23.6993 24.9209 23.56 25.06L2.122 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#about-nginx-plus">About NGINX Plus</a></li>
    <li><a href="#using-this-guide">Using This Guide</a>
      <ul>
        <li><a href="#about-sample-values-and-copying-of-text">About Sample Values and Copying of Text</a></li>
      </ul>
    </li>
    <li><a href="#prerequisites-and-system-requirements">Prerequisites and System Requirements</a></li>
    <li><a href="#configuring-dns-exchange-and-firewalls">Configuring DNS, Exchange, and Firewalls</a>
      <ul>
        <li><a href="#configuring-dns">Configuring DNS</a></li>
        <li><a href="#configuring-exchange">Configuring Exchange</a></li>
        <li><a href="#configuring-firewalls">Configuring Firewalls</a></li>
      </ul>
    </li>
    <li><a href="#configuring-an-ssltls-certificate-for-client-traffic">Configuring an SSL/TLS Certificate for Client Traffic</a>
      <ul>
        <li><a href="#generating-a-certificate-request-with-the-openssl-command">Generating a Certificate Request with the openssl Command</a></li>
        <li><a href="#exporting-and-converting-an-ssltls-certificate-from-an-iis-server">Exporting and Converting an SSL/TLS Certificate from an IIS Server</a></li>
      </ul>
    </li>
    <li><a href="#configuring-nginx-plus">Configuring NGINX Plus</a>
      <ul>
        <li><a href="#installing-nginx-plus">Installing NGINX Plus</a></li>
        <li><a href="#creating-and-modifying-configuration-files">Creating and Modifying Configuration Files</a></li>
        <li><a href="#configuring-global-settings">Configuring Global Settings</a></li>
        <li><a href="#configuring-tcp-load-balancing">Configuring TCP Load Balancing</a></li>
        <li><a href="#configuring-global-http-and-https-settings">Configuring Global HTTP and HTTPS Settings</a></li>
        <li><a href="#configuring-virtual-servers-for-http-and-https-traffic">Configuring Virtual Servers for HTTP and HTTPS Traffic</a></li>
        <li><a href="#configuring-http2-support">Configuring HTTP/2 Support</a></li>
      </ul>
    </li>
    <li><a href="#completing-the-configuration-of-load-balancing">Completing the Configuration of Load Balancing</a>
      <ul>
        <li><a href="#completing-the-configuration-of-basic-load-balancing">Completing the Configuration of Basic Load Balancing</a></li>
        <li><a href="#full-configuration-for-basic-load-balancing">Full Configuration for Basic Load Balancing</a></li>
        <li><a href="#completing-the-configuration-of-enhanced-load-balancing">Completing the Configuration of Enhanced Load Balancing</a></li>
        <li><a href="#full-configuration-for-enhanced-load-balancing">Full Configuration for Enhanced Load Balancing</a></li>
        <li><a href="#revision-history">Revision History</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


