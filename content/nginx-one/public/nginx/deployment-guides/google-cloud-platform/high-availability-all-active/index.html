<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>All-Active HA for NGINX Plus on the Google Cloud Platform | DEV -- docs-nginx-com</title>


<meta name="description" content="Configure highly available F5 NGINX Plus load balancing of application instances, in an all-active deployment on the Google Cloud Platform.">





<link rel="canonical" href="http://localhost:1313/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/">







<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Configure highly available F5 NGINX Plus load balancing of application instances, in an all-active deployment on the Google Cloud Platform." />
<meta name="twitter:title" content="All-Active HA for NGINX Plus on the Google Cloud Platform" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="27/05/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/">F5 NGINX Plus</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/">Deployment Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/google-cloud-platform/">Google Cloud Platform</a><i class="fas fa-chevron-right"></i></li>
                
            
                All-Active HA for NGINX Plus on the Google Cloud Platform
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx/" alt="F5 NGINX Plus"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-Plus-product-icon-RGB.svg"
                        alt="F5 NGINX Plus">
                    F5 NGINX Plus</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx/admin-guide/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginx--admin-guide" aria-controls="nginx--admin-guide">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Admin Guide</a>
                            </li>
                        </div>
                        <div id="nginx--admin-guide" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/installing-nginx/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--installing-nginx-and-nginx-plus">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Installing NGINX and NGINX Plus</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--installing-nginx-and-nginx-plus" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/">Installing NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-open-source/">Installing NGINX Open Source</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/">Installing NGINX Plus AMIs on Amazon EC2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/">Install NGINX Plus on the Google Cloud Platform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/">Installing NGINX Plus on Microsoft Azure</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/installing-nginx/installing-nginx-docker/" href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-docker/">Deploying NGINX and NGINX Plus with Docker</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/basic-functionality/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--basic-functionality">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Basic Functionality</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--basic-functionality" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/basic-functionality/runtime-control/" href="http://localhost:1313/nginx/admin-guide/basic-functionality/runtime-control/">Control NGINX Processes at Runtime</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/basic-functionality/managing-configuration-files/" href="http://localhost:1313/nginx/admin-guide/basic-functionality/managing-configuration-files/">Create NGINX Plus and NGINX Configuration Files</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/load-balancer/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--load-balancer">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Load Balancer</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--load-balancer" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/http-load-balancer/" href="http://localhost:1313/nginx/admin-guide/load-balancer/http-load-balancer/">HTTP Load Balancing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/">TCP and UDP Load Balancing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/http-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/http-health-check/">HTTP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/tcp-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-health-check/">TCP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/udp-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/udp-health-check/">UDP Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/grpc-health-check/" href="http://localhost:1313/nginx/admin-guide/load-balancer/grpc-health-check/">gRPC Health Checks</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/dynamic-configuration-api/" href="http://localhost:1313/nginx/admin-guide/load-balancer/dynamic-configuration-api/">Dynamic Configuration of Upstreams with the NGINX Plus API</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/load-balancer/using-proxy-protocol/" href="http://localhost:1313/nginx/admin-guide/load-balancer/using-proxy-protocol/">Accepting the PROXY Protocol</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/content-cache/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--content-cache">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Content Cache</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--content-cache" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/content-cache/content-caching/" href="http://localhost:1313/nginx/admin-guide/content-cache/content-caching/">NGINX Content Caching</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/web-server/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--web-server">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Web Server</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--web-server" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/web-server/" href="http://localhost:1313/nginx/admin-guide/web-server/web-server/">Configuring NGINX and NGINX Plus as a Web Server</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/serving-static-content/" href="http://localhost:1313/nginx/admin-guide/web-server/serving-static-content/">Serve Static Content</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/reverse-proxy/" href="http://localhost:1313/nginx/admin-guide/web-server/reverse-proxy/">NGINX Reverse Proxy</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/compression/" href="http://localhost:1313/nginx/admin-guide/web-server/compression/">Compression and Decompression</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/web-server/app-gateway-uwsgi-django/" href="http://localhost:1313/nginx/admin-guide/web-server/app-gateway-uwsgi-django/">Using NGINX and NGINX Plus as an Application Gateway with uWSGI and Django</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/security-controls/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--security-controls">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Security Controls</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--security-controls" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/terminating-ssl-http/" href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-http/">NGINX SSL Termination</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/terminating-ssl-tcp/" href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-tcp/">SSL Termination for TCP Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-http-basic-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-http-basic-authentication/">Restricting Access with HTTP Basic Authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-subrequest-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-subrequest-authentication/">Authentication Based on Subrequest Result</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-jwt-authentication/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-jwt-authentication/">Setting up JWT Authentication</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/configuring-oidc/" href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-oidc/">Single Sign-On with OpenID Connect and Identity Providers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-proxied-http/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-http/">Limiting Access to Proxied HTTP Resources</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/">Restricting Access to Proxied TCP Resources</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/controlling-access-by-geoip/" href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-by-geoip/">Restricting Access by Geographical Location</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/securing-http-traffic-upstream/" href="http://localhost:1313/nginx/admin-guide/security-controls/securing-http-traffic-upstream/">Securing HTTP Traffic to Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/" href="http://localhost:1313/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/">Securing TCP Traffic to Upstream Servers</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/security-controls/denylisting-ip-addresses/" href="http://localhost:1313/nginx/admin-guide/security-controls/denylisting-ip-addresses/">Dynamic Denylisting of IP Addresses</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/monitoring/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--monitoring">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Monitoring</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--monitoring" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/live-activity-monitoring/" href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/">Live Activity Monitoring</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/logging/" href="http://localhost:1313/nginx/admin-guide/monitoring/logging/">Configuring Logging</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/debugging/" href="http://localhost:1313/nginx/admin-guide/monitoring/debugging/">Debugging NGINX</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/diagnostic-package/" href="http://localhost:1313/nginx/admin-guide/monitoring/diagnostic-package/">NGINX Diagnostic Package</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/monitoring/new-relic-plugin/" href="http://localhost:1313/nginx/admin-guide/monitoring/new-relic-plugin/">Monitoring NGINX and NGINX Plus with the New Relic Plug-In</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/high-availability/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--high-availability">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>High Availability</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--high-availability" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/ha-keepalived/" href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived/">High Availability Support for NGINX Plus in On-Premises Deployments</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/ha-keepalived-nodes/" href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived-nodes/">Configuring Active-Active High Availability and Additional Passive Nodes with keepalived</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/configuration-sharing/" href="http://localhost:1313/nginx/admin-guide/high-availability/configuration-sharing/">Synchronizing NGINX Configuration in a Cluster</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/zone_sync/" href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync/">Runtime State Sharing in a Cluster</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/high-availability/zone_sync_details/" href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync_details/">How NGINX Plus Performs Zone Synchronization</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/dynamic-modules/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--dynamic-modules">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Dynamic Modules</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--dynamic-modules" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/dynamic-modules/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/dynamic-modules/">Dynamic Modules</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/brotli/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/brotli/">Brotli</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/cookie-flag/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/cookie-flag/">Cookie-Flag</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/encrypted-session/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/encrypted-session/">Encrypted-Session</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/fips/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/fips/">FIPS Status Check</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/geoip/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip/">GeoIP</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/geoip2/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip2/">GeoIP2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/headers-more/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/headers-more/">Headers-More</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/http-substitutions-filter/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/http-substitutions-filter/">HTTP Substitutions Filter</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/image-filter/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/image-filter/">Image-Filter</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/lua/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/lua/">Lua</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/ndk/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/ndk/">NGINX Developer Kit</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/nginx-waf/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginx-waf/">NGINX ModSecurity WAF</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/nginscript/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginscript/">njs Scripting Language</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/opentelemetry/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentelemetry/">OpenTelemetry</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/opentracing/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentracing/">OpenTracing</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/perl/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/perl/">Perl</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/passenger-open-source/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/passenger-open-source/">Phusion Passenger Open Source</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/prometheus-njs/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/prometheus-njs/">Prometheus-njs</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/rtmp/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/rtmp/">RTMP</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/set-misc/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/set-misc/">Set-Misc</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/spnego/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/spnego/">SPNEGO</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/uninstall/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/uninstall/">Uninstalling a dynamic module</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/dynamic-modules/xslt/" href="http://localhost:1313/nginx/admin-guide/dynamic-modules/xslt/">XSLT</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/admin-guide/mail-proxy/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--admin-guide--mail-proxy">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Mail Proxy</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--admin-guide--mail-proxy" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/admin-guide/mail-proxy/mail-proxy/" href="http://localhost:1313/nginx/admin-guide/mail-proxy/mail-proxy/">Configure NGINX as a Mail Proxy Server</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx/deployment-guides/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nginx--deployment-guides" aria-controls="nginx--deployment-guides">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Deployment Guides</a>
                            </li>
                        </div>
                        <div id="nginx--deployment-guides" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/amazon-web-services/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--amazon-web-services">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Amazon Web Services</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--amazon-web-services" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/">Active-Active HA for NGINX Plus on AWS Using AWS Network Load Balancer</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/">Active-Passive HA for NGINX Plus on AWS Using Elastic IP Addresses</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/">Using NGINX or NGINX Plus as the Ingress Controller for Amazon Elastic Kubernetes Services</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/" href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/">Create Amazon EC2 Instances for NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/global-server-load-balancing/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--global-server-load-balancing">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Global Server Load Balancing</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--global-server-load-balancing" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/" href="http://localhost:1313/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/">Global Server Load Balancing with NS1 and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/google-cloud-platform/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--google-cloud-platform">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Google Cloud Platform</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--google-cloud-platform" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/" href="http://localhost:1313/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/">All-Active HA for NGINX Plus on the Google Cloud Platform</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--load-balancing-third-party-servers">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Load Balancing Third-Party Servers</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--load-balancing-third-party-servers" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/apache-tomcat/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/apache-tomcat/">Load Balancing Apache Tomcat Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/">Load Balancing Microsoft Exchange Servers with NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/node-js/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/node-js/">Load Balancing Node.js Application Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/">Load Balancing Oracle E-Business Suite with NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/">Load Balancing Oracle WebLogic Server with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/load-balance-third-party/wildfly/" href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/wildfly/">Load Balancing Wildfly and JBoss Application Servers with NGINX Open Source and NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/microsoft-azure/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--microsoft-azure">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Microsoft Azure</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--microsoft-azure" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/" href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/">Active-Active HA for NGINX Plus on Microsoft Azure Using the Azure Standard Load Balancer</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/" href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/">Creating Microsoft Azure Virtual Machines for NGINX Open Source and F5 NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--migrate-hardware-adcs">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Migrate Hardware ADCs</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--migrate-hardware-adcs" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/" href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/">Migrating Load Balancer Configuration from Citrix ADC to NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/" href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/">Migrating Load Balancer Configuration from F5 BIG-IP LTM to F5 NGINX Plus</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/single-sign-on/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nginx--deployment-guides--set-up-single-sign-on-for-proxied-applications">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Set Up Single Sign-On for Proxied Applications</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nginx--deployment-guides--set-up-single-sign-on-for-proxied-applications" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/auth0/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/auth0/">Single Sign-On With Auth0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/cognito/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/cognito/">Single Sign-On with Amazon Cognito</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/active-directory-federation-services/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/active-directory-federation-services/">Single Sign-On with Microsoft Active Directory FS</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/entra-id/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/entra-id/">Single Sign-On with Microsoft Entra ID</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/keycloak/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/keycloak/">Single Sign-On with Keycloak</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/onelogin/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/onelogin/">Single Sign-On with OneLogin</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/okta/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/okta/">Single Sign-On with Okta</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx/deployment-guides/single-sign-on/ping-identity/" href="http://localhost:1313/nginx/deployment-guides/single-sign-on/ping-identity/">Single Sign-On with Ping Identity</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <div class="accordion" id="Accordion3">
                                                            <div class="sidebar-l2-padding">
                                                                <div class="accordion-group sidebar-il-border">
                                                                    <div class="accordion-heading">
                                                                        <ul>
                                                                            <li class="nginx-toc-link l2">
                                                                                <a data-menu-id="/nginx/deployment-guides/single-signon/oidc-njs/" class="accordion-toggle"
                                                                                    aria-expanded="false" data-toggle="collapse"
                                                                                    href="#nginx--single-sign-on--legacy-njs-based-single-sign-on-solutions">
                                                                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Legacy njs-based Single Sign-On Solutions</a>
                                                                            </li>
                                                                        <ul>
                                                                    </div>
                                                                    <div id="nginx--single-sign-on--legacy-njs-based-single-sign-on-solutions" class="accordion-body collapse leaf">
                                                                        <div class="accordion-inner">
                                                                        
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/">Single Sign-On with Amazon Cognito and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/">Single Sign-On With Auth0 and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/">Single Sign-On with Keycloak and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/">Single Sign-On with Microsoft AD FS and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/okta/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/okta/">Single Sign-On with Okta and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/">Single Sign-On with OneLogin and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        
                                                                        
                                                                            <ul class="sidebar-l2-padding">
                                                                                <li class="nginx-toc-link l3 sidebar-il-border ">
                                                                                    <a data-menu-id="/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/"
                                                                                        href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/">Single Sign-On with Ping Identity and njs</a>
                                                                                </li>
                                                                            </ul>
                                                                        
                                                                        
                                                                            
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx/deployment-guides/setting-up-nginx-demo-environment/"
                                                                href="http://localhost:1313/nginx/deployment-guides/setting-up-nginx-demo-environment/">Setting up an NGINX demo environment</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/releases/" href="http://localhost:1313/nginx/releases/">Releases</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/technical-specs/" href="http://localhost:1313/nginx/technical-specs/">Technical Specs</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/open-source-components/" href="http://localhost:1313/nginx/open-source-components/">Open Source Components</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/fips-compliance-nginx-plus/" href="http://localhost:1313/nginx/fips-compliance-nginx-plus/">NGINX Plus FIPS Compliance</a>
                </li>
                
                

            
                
                
                <li class="nginx-toc-link l1">
                    <a data-menu-id="/nginx/directives/" href="http://localhost:1313/nginx/directives/">NGINX Directives Index</a>
                </li>
                
                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name">NGINX Plus</div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-d8b0ed076d8ee224a3aef5fe811e3a69" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-d8b0ed076d8ee224a3aef5fe811e3a69" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Admin Guide 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-34ba13d39918e960bfd91478931ee142" class="toggle-checkbox" style="display: none;">
            <label for="toggle-34ba13d39918e960bfd91478931ee142" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Installing NGINX and NGINX Plus 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/" style="">Installing NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-open-source/" style="">Installing NGINX Open Source </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-amazon-web-services/" style="">Installing NGINX Plus AMIs on Amazon EC2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-google-cloud-platform/" style="">Install NGINX Plus on the Google Cloud Platform </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus-microsoft-azure/" style="">Installing NGINX Plus on Microsoft Azure </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-docker/" style="">Deploying NGINX and NGINX Plus with Docker </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-4fed1bc24136a50ced01c75c6f2619a2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-4fed1bc24136a50ced01c75c6f2619a2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Basic Functionality 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/basic-functionality/runtime-control/" style="">Control NGINX Processes at Runtime </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/basic-functionality/managing-configuration-files/" style="">Create NGINX Plus and NGINX Configuration Files </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-a0b990a08877f2414420dd3fab30a616" class="toggle-checkbox" style="display: none;">
            <label for="toggle-a0b990a08877f2414420dd3fab30a616" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Load Balancer 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/http-load-balancer/" style="">HTTP Load Balancing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-udp-load-balancer/" style="">TCP and UDP Load Balancing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/http-health-check/" style="">HTTP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/tcp-health-check/" style="">TCP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/udp-health-check/" style="">UDP Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/grpc-health-check/" style="">gRPC Health Checks </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/dynamic-configuration-api/" style="">Dynamic Configuration of Upstreams with the NGINX Plus API </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/load-balancer/using-proxy-protocol/" style="">Accepting the PROXY Protocol </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-3827dd0c2b43b01d6adb9d92730551a2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-3827dd0c2b43b01d6adb9d92730551a2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Content Cache 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/content-cache/content-caching/" style="">NGINX Content Caching </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-bc8955a748a8c048c742c5efe92af86f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-bc8955a748a8c048c742c5efe92af86f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Web Server 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/web-server/" style="">Configuring NGINX and NGINX Plus as a Web Server </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/serving-static-content/" style="">Serve Static Content </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/reverse-proxy/" style="">NGINX Reverse Proxy </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/compression/" style="">Compression and Decompression </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/web-server/app-gateway-uwsgi-django/" style="">Using NGINX and NGINX Plus as an Application Gateway with uWSGI and Django </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-bdec90cc0d849dbcf048e137054cd075" class="toggle-checkbox" style="display: none;">
            <label for="toggle-bdec90cc0d849dbcf048e137054cd075" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Security Controls 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-http/" style="">NGINX SSL Termination </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/terminating-ssl-tcp/" style="">SSL Termination for TCP Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-http-basic-authentication/" style="">Restricting Access with HTTP Basic Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-subrequest-authentication/" style="">Authentication Based on Subrequest Result </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-jwt-authentication/" style="">Setting up JWT Authentication </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/configuring-oidc/" style="">Single Sign-On with OpenID Connect and Identity Providers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-http/" style="">Limiting Access to Proxied HTTP Resources </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-proxied-tcp/" style="">Restricting Access to Proxied TCP Resources </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/controlling-access-by-geoip/" style="">Restricting Access by Geographical Location </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/securing-http-traffic-upstream/" style="">Securing HTTP Traffic to Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/securing-tcp-traffic-upstream/" style="">Securing TCP Traffic to Upstream Servers </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/security-controls/denylisting-ip-addresses/" style="">Dynamic Denylisting of IP Addresses </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-4115092e5ba91d2d8fd1b7bf0bf88aa9" class="toggle-checkbox" style="display: none;">
            <label for="toggle-4115092e5ba91d2d8fd1b7bf0bf88aa9" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Monitoring 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/live-activity-monitoring/" style="">Live Activity Monitoring </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/logging/" style="">Configuring Logging </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/debugging/" style="">Debugging NGINX </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/diagnostic-package/" style="">NGINX Diagnostic Package </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/monitoring/new-relic-plugin/" style="">Monitoring NGINX and NGINX Plus with the New Relic Plug-In </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-58f36bce08139196af7dbd68b048562d" class="toggle-checkbox" style="display: none;">
            <label for="toggle-58f36bce08139196af7dbd68b048562d" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                High Availability 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived/" style="">High Availability Support for NGINX Plus in On-Premises Deployments </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/ha-keepalived-nodes/" style="">Configuring Active-Active High Availability and Additional Passive Nodes with keepalived </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/configuration-sharing/" style="">Synchronizing NGINX Configuration in a Cluster </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync/" style="">Runtime State Sharing in a Cluster </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/high-availability/zone_sync_details/" style="">How NGINX Plus Performs Zone Synchronization </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-d9475b942e664d5a02f3c7e0832be30f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-d9475b942e664d5a02f3c7e0832be30f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Dynamic Modules 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/dynamic-modules/" style="">Dynamic Modules </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/brotli/" style="">Brotli </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/cookie-flag/" style="">Cookie-Flag </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/encrypted-session/" style="">Encrypted-Session </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/fips/" style="">FIPS Status Check </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip/" style="">GeoIP </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/geoip2/" style="">GeoIP2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/headers-more/" style="">Headers-More </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/http-substitutions-filter/" style="">HTTP Substitutions Filter </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/image-filter/" style="">Image-Filter </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/lua/" style="">Lua </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/ndk/" style="">NGINX Developer Kit </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginx-waf/" style="">NGINX ModSecurity WAF </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/nginscript/" style="">njs Scripting Language </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentelemetry/" style="">OpenTelemetry </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/opentracing/" style="">OpenTracing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/perl/" style="">Perl </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/passenger-open-source/" style="">Phusion Passenger Open Source </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/prometheus-njs/" style="">Prometheus-njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/rtmp/" style="">RTMP </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/set-misc/" style="">Set-Misc </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/spnego/" style="">SPNEGO </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/uninstall/" style="">Uninstalling a dynamic module </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/dynamic-modules/xslt/" style="">XSLT </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-0e96b7a1b81ada95980c6f8945f7298a" class="toggle-checkbox" style="display: none;">
            <label for="toggle-0e96b7a1b81ada95980c6f8945f7298a" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Mail Proxy 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/admin-guide/mail-proxy/mail-proxy/" style="">Configure NGINX as a Mail Proxy Server </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-ad2e544081d8a2dc550608bf96863673" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-ad2e544081d8a2dc550608bf96863673" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Deployment Guides 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-5e13f0d338ace88d49a9d6caa7010fc4" class="toggle-checkbox" style="display: none;">
            <label for="toggle-5e13f0d338ace88d49a9d6caa7010fc4" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Amazon Web Services 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-network-load-balancer/" style="">Active-Active HA for NGINX Plus on AWS Using AWS Network Load Balancer </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/high-availability-keepalived/" style="">Active-Passive HA for NGINX Plus on AWS Using Elastic IP Addresses </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ingress-controller-elastic-kubernetes-services/" style="">Using NGINX or NGINX Plus as the Ingress Controller for Amazon Elastic Kubernetes Services </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/amazon-web-services/ec2-instances-for-nginx/" style="">Create Amazon EC2 Instances for NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-22d3c4602e6471d3cb1277bf845bc7a5" class="toggle-checkbox" style="display: none;">
            <label for="toggle-22d3c4602e6471d3cb1277bf845bc7a5" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Global Server Load Balancing 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/global-server-load-balancing/ns1-global-server-load-balancing/" style="">Global Server Load Balancing with NS1 and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-539116910b30b117ba27575318b0e1d8" class="toggle-checkbox" style="display: none;">
            <label for="toggle-539116910b30b117ba27575318b0e1d8" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Google Cloud Platform 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx/deployment-guides/google-cloud-platform/high-availability-all-active/" style="font-weight: bold;">All-Active HA for NGINX Plus on the Google Cloud Platform </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#design-and-topology">Design and Topology</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#task-1-creating-a-project-and-firewall-rules">Task 1: Creating a Project and Firewall Rules</a>
      <ul>
        <li><a href="#creating-firewall-rules">Creating Firewall Rules</a></li>
      </ul>
    </li>
    <li><a href="#task-2-creating-source-instances">Task 2: Creating Source Instances</a>
      <ul>
        <li><a href="#creating-source-instances-from-vm-images">Creating Source Instances from VM Images</a></li>
        <li><a href="#creating-source-instances-from-prebuilt-nginxplus-images">Creating Source Instances from Prebuilt NGINXPlus Images</a></li>
      </ul>
    </li>
    <li><a href="#task-3-creating-gold-images">Task 3: Creating &ldquo;Gold&rdquo; Images</a></li>
    <li><a href="#task-4-creating-instance-templates">Task 4: Creating Instance Templates</a>
      <ul>
        <li><a href="#creating-the-first-application-instance-template">Creating the First Application Instance Template</a></li>
        <li><a href="#creating-the-second-application-instance-template">Creating the Second Application Instance Template</a></li>
        <li><a href="#creating-the-load-balancing-instance-template">Creating the Load-Balancing Instance Template</a></li>
      </ul>
    </li>
    <li><a href="#task-5-creating-image-health-checks">Task 5: Creating Image Health Checks</a></li>
    <li><a href="#task-6-creating-instance-groups">Task 6: Creating Instance Groups</a>
      <ul>
        <li><a href="#creating-the-first-application-instance-group">Creating the First Application Instance Group</a></li>
        <li><a href="#creating-the-second-application-instance-group">Creating the Second Application Instance Group</a></li>
        <li><a href="#creating-the-load-balancing-instance-group">Creating the Load-Balancing Instance Group</a></li>
        <li><a href="#updating-and-testing-the-nginxplus-configuration">Updating and Testing the NGINXPlus Configuration</a></li>
      </ul>
    </li>
    <li><a href="#task-7-configuring-gce-network-load-balancer">Task 7: Configuring GCE Network Load Balancer</a></li>
    <li><a href="#task-8-testing-the-all-active-load-balancing-deployment">Task 8: Testing the All-Active Load Balancing Deployment</a>
      <ul>
        <li><a href="#revision-history">Revision History</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-eea80951fd0bc0c7385d3863c701b40f" class="toggle-checkbox" style="display: none;">
            <label for="toggle-eea80951fd0bc0c7385d3863c701b40f" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Load Balancing Third-Party Servers 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/apache-tomcat/" style="">Load Balancing Apache Tomcat Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/microsoft-exchange/" style="">Load Balancing Microsoft Exchange Servers with NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/node-js/" style="">Load Balancing Node.js Application Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-e-business-suite/" style="">Load Balancing Oracle E-Business Suite with NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/oracle-weblogic-server/" style="">Load Balancing Oracle WebLogic Server with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/load-balance-third-party/wildfly/" style="">Load Balancing Wildfly and JBoss Application Servers with NGINX Open Source and NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-deab0f7f4195e0ebfdd9a46bf3c45873" class="toggle-checkbox" style="display: none;">
            <label for="toggle-deab0f7f4195e0ebfdd9a46bf3c45873" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Microsoft Azure 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/high-availability-standard-load-balancer/" style="">Active-Active HA for NGINX Plus on Microsoft Azure Using the Azure Standard Load Balancer </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/microsoft-azure/virtual-machines-for-nginx/" style="">Creating Microsoft Azure Virtual Machines for NGINX Open Source and F5 NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-9d116931baf1693c0ecb4484238d72ce" class="toggle-checkbox" style="display: none;">
            <label for="toggle-9d116931baf1693c0ecb4484238d72ce" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Migrate Hardware ADCs 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/citrix-adc-configuration/" style="">Migrating Load Balancer Configuration from Citrix ADC to NGINX Plus </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/migrate-hardware-adc/f5-big-ip-configuration/" style="">Migrating Load Balancer Configuration from F5 BIG-IP LTM to F5 NGINX Plus </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-1b645490e7b8fc3e2dbc02de30e692bb" class="toggle-checkbox" style="display: none;">
            <label for="toggle-1b645490e7b8fc3e2dbc02de30e692bb" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Set Up Single Sign-On for Proxied Applications 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/auth0/" style="">Single Sign-On With Auth0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/cognito/" style="">Single Sign-On with Amazon Cognito </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/active-directory-federation-services/" style="">Single Sign-On with Microsoft Active Directory FS </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/entra-id/" style="">Single Sign-On with Microsoft Entra ID </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/keycloak/" style="">Single Sign-On with Keycloak </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/onelogin/" style="">Single Sign-On with OneLogin </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/okta/" style="">Single Sign-On with Okta </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/ping-identity/" style="">Single Sign-On with Ping Identity </a>
            
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-078a70b7a7961256b5a3c59fcd9c4eb2" class="toggle-checkbox" style="display: none;">
            <label for="toggle-078a70b7a7961256b5a3c59fcd9c4eb2" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Legacy njs-based Single Sign-On Solutions 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/cognito/" style="">Single Sign-On with Amazon Cognito and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/auth0/" style="">Single Sign-On With Auth0 and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/keycloak/" style="">Single Sign-On with Keycloak and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/active-directory-federation-services/" style="">Single Sign-On with Microsoft AD FS and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/okta/" style="">Single Sign-On with Okta and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/onelogin/" style="">Single Sign-On with OneLogin and njs </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/single-sign-on/oidc-njs/ping-identity/" style="">Single Sign-On with Ping Identity and njs </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx/deployment-guides/setting-up-nginx-demo-environment/" style="">Setting up an NGINX demo environment </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/releases/" style="">Releases </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/technical-specs/" style="">Technical Specs </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/open-source-components/" style="">Open Source Components </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/fips-compliance-nginx-plus/" style="">NGINX Plus FIPS Compliance </a> 
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                                         
                        <span class="parent-box-link"></span>              
                    
                    <a href="http://localhost:1313/nginx/directives/" style="">NGINX Directives Index </a> 
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/">F5 NGINX Plus</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/">Deployment Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx/deployment-guides/google-cloud-platform/">Google Cloud Platform</a><i class="fas fa-chevron-right"></i></li>
                
            
                All-Active HA for NGINX Plus on the Google Cloud Platform
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>All-Active HA for NGINX Plus on the Google Cloud Platform</h1>
        <p>This guide explains how to deploy F5 NGINX Plus in a high-availability configuration on Google Compute Engine (GCE). GCE is the Google Cloud Platform (GCP) service for running workloads on virtual machines. In this setup, multiple NGINX Plus instances work together, in active pairs. They load balance incoming connections across your app environments.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>The GCE environment changes constantly. This could include names and arrangements of GUI elements. This guide was accurate when published. But, some GCE GUI elements might have changed over time. Use this guide as a reference and adapt to the current GCE working environment.</li>
<li>The configuration described in this guide allows anyone from a public IP address to access the NGINXPlus instances. While this works in common scenarios in a test environment, we do not recommend it in production. Block external HTTP/HTTPS access to <strong>app1</strong> and <strong>app2</strong> instances to external IP address before production deployment. Alternatively, remove the external IP addresses for all application instances, so they&rsquo;re accessible only on the internal GCE network.</li>
</ul>
<p><span id="design"></span></p>
<h2 
id="design-and-topology">Design and Topology  <a class="headerlink float-right" href="#design-and-topology" title="Design and Topology"><i class="fas fa-link fa-xs"></i></a>
</h2><p>The deployment combines the following technologies:</p>
<ul>
<li><a href="https://www.f5.com/products/nginx/nginx-plus" target="_blank" rel="noopener">NGINXPlus</a> Load balances HTTP connections across multiple instances of two applications. We provide instructions for manual installation on a GCE VM image and setting up the prebuilt NGINX Plus VM image. Both are available in the Google Marketplace.</li>
<li>PHP-FPM Supports the two sample applications.</li>
<li><a href="https://cloud.google.com/compute/docs/load-balancing/network" target="_blank" rel="noopener">GCE network load balancer</a> Enables TCP connectivity between clients and NGINX Plus load-balancing (LB) instances in a GCP region. It also maintains session persistence for each NGINXPlus instance.</li>
<li><a href="https://cloud.google.com/compute/docs/instance-groups" target="_blank" rel="noopener">GCE instance groups</a> Provide a mechanism for managing a group of VM instances as a unit.</li>
<li><a href="https://cloud.google.com/compute/docs/load-balancing/health-checks" target="_blank" rel="noopener">GCE health checks</a> Maintain high availability of the NGINXPlus LB instances by controlling when GCE creates a new LB instance in the instance group.</li>
</ul>
<img src="/nginx/images/gce-all-active-load-balancing-topology.png" alt="Topology of the allactive deployment of NGINX Plus as the Google Cloud Platform load balancer." width="1024" height="1000" class="aligncenter size-full wp-image-47509" style="border:2px solid #666666; padding:2px; margin:2px;" />
<p><a href="https://www.nginx.com/products/nginx/load-balancing/#session-persistence" target="_blank" rel="noopener">Session persistence</a> is managed at the network layer by the GCE network load balancer (based on client IP address). The NGINX Plus LB instance also manages it at the application layer (with a session cookie).</p>
<p>The GCE network LB assigns each new client to a specific NGINX Plus LB. This association persists as long as the LB instance is up and functional.</p>
<p>NGINX Plus LB uses the round-robin algorithm to forward requests to specific app instances. It also adds a session cookie. It keeps future requests from the same client on the same app instance as long as it&rsquo;s running.</p>
<p>This deployment guide uses two groups of app instances: <strong>app1</strong> and <strong>app2</strong>. It demonstrates <a href="https://www.nginx.com/products/nginx/load-balancing/" target="_blank" rel="noopener">load balancing</a> between different app types. But both groups have the same app configurations.</p>
<p>You can adapt the deployment to distribute unique connections to different groups of app instances. This can be done by creating discrete upstream blocks and routing content based on the URI.</p>
<p>Please see the reference docs for details on configuring multiple <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html" target="_blank" rel="noopener">upstream server groups</a>.</p>
<p><span id="prereqs"></span></p>
<h2 
id="prerequisites">Prerequisites  <a class="headerlink float-right" href="#prerequisites" title="Prerequisites"><i class="fas fa-link fa-xs"></i></a>
</h2><p>This guide assumes that you:</p>
<ul>
<li>Have a <a href="https://accounts.google.com/SignUp" target="_blank" rel="noopener">Google account</a> (a separate GCP or GCE account is unnecessary).</li>
<li>Have enrolled in a <a href="https://cloud.google.com/free-trial" target="_blank" rel="noopener">free trial</a> available credit or have a GCP payment account.</li>
<li>Have a basic working knowledge of GCE and its GUI control panel:
<ul>
<li>Navigation</li>
<li>Creating instances</li>
<li>Managing IAM policies</li>
</ul>
</li>
<li>Understand basic networking.</li>
<li>Have an NGINXPlus subscription. You can start a <a href="https://www.nginx.com/free-trial-request/" target="_blank" rel="noopener">free 30day trial</a> if you don&rsquo;t already have a paid subscription.</li>
<li>Know how to install NGINX Plus. Have a basic understanding of performance in load balancing and application delivery modes. Be familiar with its configuration syntax.</li>
<li>Are familiar with GitHub and know how to <a href="https://help.github.com/en/articles/cloning-a-repository/" target="_blank" rel="noopener">clone a repository</a>.</li>
</ul>
<p>All component names, like projects and instances, are examples only. You can change them to suit your needs.</p>
<p><span id="project-firewall"></span></p>
<h2 
id="task-1-creating-a-project-and-firewall-rules">Task 1: Creating a Project and Firewall Rules  <a class="headerlink float-right" href="#task-1-creating-a-project-and-firewall-rules" title="Task 1: Creating a Project and Firewall Rules"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Create a new GCE project to host the allactive NGINXPlus deployment.</p>
<ol>
<li>
<p>Log into the <a href="http://console.cloud.google.com" target="_blank" rel="noopener">GCP Console</a> at <strong>console.cloud.google.com</strong>.</p>
</li>
<li>
<p>The GCP <strong>Home&gt;Dashboard</strong> tab opens. Its contents depend on whether you have any existing projects.</p>
<ul>
<li>
<p>If there are no existing projects, click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create a project</span> button.</p>
<img src="/nginx/images/gce-dashboard-no-project.png" alt="Screenshot of the Google Cloud Platform dashboard that appears when there are no existing projects (creating a project is the first step in configuring NGINX Plus as the Google Cloud load balancer)" width="1024" height="422" class="aligncenter size-full wp-image-47475" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>If there are existing projects, the name of one of them appears in the upper left of the blue header bar (in the screenshot, it&rsquo;s <span style="background-color:#3366cc; color:white; white-space: nowrap;">My Test Project</span>). Click the project name and select <strong>Createproject</strong> from the menu that opens.</p>
<img src="/nginx/images/gce-dashboard-existing-project.png" alt="Screenshot of the Google Cloud Platform page that appears when other projects already exist (creating a project is the first step in configuring NGINX Plus as the Google Cloud load balancer)" width="1024" height="533" class="aligncenter size-full wp-image-47474" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ul>
</li>
<li>
<p>Type your project name in the <strong>NewProject</strong> window that pops up, then click <span style="color:#3366cc;">CREATE</span>. We&rsquo;re naming the project <strong>NGINXPlusAllActiveLB</strong>.</p>
 <img src="/nginx/images/gce-new-project-popup.png" alt="Screenshot of the New Project pop-up window for naming a new project on the Google Cloud Platform, which is the first step in configuring NGINX Plus as the Google load balancer" width="512" height="249" class="aligncenter size-full wp-image-47514" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ol>
<h3 
id="creating-firewall-rules">Creating Firewall Rules  <a class="headerlink float-right" href="#creating-firewall-rules" title="Creating Firewall Rules"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Create firewall rules that allow access to the HTTP and HTTPS ports on your GCE instances. You&rsquo;ll attach the rules to all the instances you create for the deployment.</p>
<ol>
<li>
<p>Navigate to the <strong>Networking&gt;Firewallrules</strong> tab and click <span style="background-color:#3366cc; color:white;">+</span> <span style="color:#3366cc;">CREATE FIREWALL RULE</span>. (The screenshot shows the default rules provided by GCE.)</p>
<img src="/nginx/images/gce-firewall-rules-tab.png" alt="Screenshot of the Google Cloud Platform page for defining new firewall rules; when configuring NGINX Plus as the Google Cloud load balancer, we open ports 80, 443, and 8080 for it." width="1024" height="413" class="aligncenter size-full wp-image-47476" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Fill in the fields on the <strong>Createafirewallrule</strong> screen that opens:<!-- Tony notes Feb 2018: I have purposely broken the "rule" that if any bullet in a list ends in a period (here, bullet 3), they all must. I think the appropriate values in bullets 1, 2, and 4 are clearer without a final period --></p>
<ul>
<li>
<p><strong>Name</strong> <strong>nginxplushttpfwrule</strong></p>
</li>
<li>
<p><strong>Description</strong> <strong>Allow access to ports 80, 8080, and 443 on all NGINXPlus instances</strong></p>
</li>
<li>
<p><strong>Sourcefilter</strong> On the drop-down menu, select either <strong>Allow from any source (0.0.0.0/0)</strong>, or <strong>IPrange</strong> if you want to restrict access to users on your private network. In the second case, fill in the <strong>SourceIPranges</strong> field that opens. In the screenshot, we are allowing unrestricted access.</p>
</li>
<li>
<p><strong>Allowedprotocolsandports</strong> <strong>tcp:80;tcp:8080;tcp:443</strong></p>
<p><strong>Note:</strong> As noted in the introduction, allowing access from any public IP address is appropriate only in a test environment. Before deploying the architecture in production, create a firewall rule. Use this rule to block access to the external IP address for your application instances. Alternatively, you can disable external IP addresses for the instances. This limits access only to the internal GCE network.</p>
</li>
<li>
<p><strong>Targettags</strong> <strong>nginxplushttpfwrule</strong></p>
</li>
</ul>
<img src="/nginx/images/gce-create-firewall-rule.png" alt="Screenshot of the interface for creating a Google Compute Engine (GCE) firewall rule, used during deployment of NGINX Plus as the Google load balancer." width="1024" height="619" class="aligncenter size-full wp-image-47470" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button. The new rule is added to the table on the <strong>Firewallrules</strong> tab.</p>
</li>
</ol>
<p><span id="source"></span></p>
<h2 
id="task-2-creating-source-instances">Task 2: Creating Source Instances  <a class="headerlink float-right" href="#task-2-creating-source-instances" title="Task 2: Creating Source Instances"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Create three GCE source instances. Use them as templates for later instance groups. One for the NGINX Plus load balancer and two for NGINX Plus PHP app servers.</p>
<p>You can create source instances in either of two ways:</p>
<ul>
<li><a href="#source-vm">Based on a standard GCE VM image</a>, you install NGINXPlus manually. This guide uses the latest Ubuntu LTS image at publication (<span style="white-space: nowrap;">Ubuntu 24.04 LTS</span>). You can use any Unix or Linux OS that <a href="http://localhost:1313/nginx/technical-specs/">NGINXPlus supports</a>.</li>
<li><a href="#source-prebuilt">Based on the prebuilt NGINXPlus image</a> in the Google Marketplace, which at the time of publication runs on <span style="white-space: nowrap;">Ubuntu 14.04 LTS</span>.</li>
</ul>
<p>The methods to create a source instance are different. Once you&rsquo;ve created the source instances, all later instructions are the same.</p>
<p><span id="source-vm"></span></p>
<h3 
id="creating-source-instances-from-vm-images">Creating Source Instances from VM Images  <a class="headerlink float-right" href="#creating-source-instances-from-vm-images" title="Creating Source Instances from VM Images"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Create three source VM instances based on a GCE VM image. We&rsquo;re basing our instances on the <span style="white-space: nowrap;">Ubuntu 16.04 LTS</span> image.</p>
<ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create instance</span> button. The <strong>Createaninstance</strong> page opens.</p>
</li>
</ol>
<p><span id="source-vm-app-1"></span></p>
<h4 
id="creating-the-first-application-instance-from-a-vm-image">Creating the First Application Instance from a VM Image  <a class="headerlink float-right" href="#creating-the-first-application-instance-from-a-vm-image" title="Creating the First Application Instance from a VM Image"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>On the <strong>Createaninstance</strong> page, modify or verify the fields and checkboxes as indicated (a screenshot of the completed page appears in the next step):</p>
<ul>
<li>
<p><strong>Name</strong> <strong>nginxplusapp1</strong></p>
</li>
<li>
<p><strong>Zone</strong> The GCP zone that makes sense for your location. We&rsquo;re using <strong>uswest1a</strong>.</p>
</li>
<li>
<p><strong>Machinetype</strong> The appropriate size for the level of traffic you anticipate. We&rsquo;re selecting <strong>micro</strong>, which is ideal for testing purposes.</p>
</li>
<li>
<p><strong>Bootdisk</strong> Click <strong>Change</strong>. The <strong>Bootdisk</strong> page opens to the <span style="color:#3366cc; white-space: nowrap;">OS images</span> subtab. Perform the following steps:</p>
<ul>
<li>Click the radio button for the Unix or Linux image of your choice (here, <strong>Ubuntu16.04LTS</strong>).</li>
<li>Accept the default values in the <strong>Bootdisktype</strong> and <strong>Size(GB)</strong> fields (<strong>Standardpersistentdisk</strong> and <strong>10</strong> respectively).</li>
<li>Click the <span style="background-color:#3366cc; color:white;">Select</span> button.</li>
</ul>
 <img src="/nginx/images/gce-ubuntu-instance-boot-disk.png" alt="Screenshot of the 'Boot disk' page in Google Cloud Platform for selecting the OS on which a VM runs. In the deployment of NGINX Plus as the Google load balancer, we select Ubuntu 16.04 LTS." width="512" height="577" class="aligncenter size-full wp-image-47484" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p><strong>IdentityandAPIaccess</strong> Keep the defaults for the <strong>Serviceaccount</strong> field and <strong>Accessscopes</strong> radio button. Unless you need more granular control.</p>
</li>
<li>
<p><strong>Firewall</strong> Verify that neither check box is checked (the default). The firewall rule invoked in the <strong>Tags</strong> field on the <strong>Management</strong> subtab (see Step3 below) controls this type of access.</p>
</li>
</ul>
</li>
<li>
<p>Click <span style="color:#3366cc; white-space: nowrap;">Management, disk, networking, SSH keys</span> to open that set of subtabs. (The screenshot shows the values entered in the previous step.)</p>
<img src="/nginx/images/gce-ubuntu-instance-create.png" alt="Screen shot of the 'Create an instance' page for an application server in the deployment of NGINX Plus as the Google Cloud Platform load balancer." width="487" height="839" class="aligncenter size-full wp-image-47516" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Management</strong> subtab, modify or verify the fields as indicated:</p>
<ul>
<li><strong>Description</strong> <strong>NGINXPlusapp1Image</strong></li>
<li><strong>Tags</strong> <strong>nginxplushttpfwrule</strong></li>
<li><strong>Preemptibility</strong> <strong>Off(recommended)</strong> (the default)</li>
<li><strong>Automaticrestart</strong> <strong>On(recommended)</strong> (the default)</li>
<li><strong>Onhostmaintenance</strong> <strong>MigrateVMinstance(recommended)</strong> (the default)</li>
</ul>
<img src="/nginx/images/gce-ubuntu-instance-management.png" alt="Screenshot of the Management subtab used during creation of a new VM instance, part of deploying NGINX Plus as the Google load balancer." width="487" height="551" class="aligncenter size-full wp-image-47486" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Disks</strong> subtab, uncheck the checkbox labeled <strong>Delete boot disk when instance is deleted</strong>.</p>
<img src="/nginx/images/gce-ubuntu-instance-disks.png" alt="Screenshot of the Disks subtab used during creation of a new VM instance, part of deploying NGINX Plus as the Google Cloud load balancer." width="487" height="224" class="aligncenter size-full wp-image-47485" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Networking</strong> subtab, verify the default settings, in particular <strong>Ephemeral</strong> for <strong>ExternalIP</strong> and <strong>Off</strong> for <strong>IPForwarding</strong>.</p>
<img src="/nginx/images/gce-ubuntu-instance-networking.png" alt="Screenshot of the Networking subtab used during creation of a new VM instance, part of deploying NGINX Plus as the Google Cloud load balancer." width="488" height="279" class="aligncenter size-full wp-image-47487" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>If you&rsquo;re using your own SSH public key instead of your default GCE keys, paste the hexadecimal key string on the <strong>SSHKeys</strong> subtab. Right into the box that reads <strong>Enterentirekeydata</strong>.</p>
<img src="/nginx/images/gce-ubuntu-instance-ssh-keys.png" alt="Screenshot of the SSH Keys subtab used during creation of a new VM instance, part of deploying NGINX Plus as the Google Cloud Platform load balancer." width="488" height="205" class="aligncenter size-full wp-image-47488" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create</span> button at the bottom of the <strong>Createaninstance</strong> page.</p>
<p>The <strong>VMinstances</strong> summary page opens. It can take several minutes for the instance to be created. Wait to continue until the green check mark appears.</p>
 <img src="/nginx/images/gce-ubuntu-instance-summary.png" alt="Screenshot of the summary page that verifies the creation of a new VM instance, part of deploying NGINX Plus as the load balancer for Google Cloud." width="1024" height="192" class="aligncenter size-full wp-image-47490" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ol>
<p><span id="source-vm-app-2"></span></p>
<h4 
id="creating-the-second-application-instance-from-a-vm-image">Creating the Second Application Instance from a VM Image  <a class="headerlink float-right" href="#creating-the-second-application-instance-from-a-vm-image" title="Creating the Second Application Instance from a VM Image"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>On the <strong>VMinstances</strong> summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE</span>.</p>
</li>
<li>
<p>Repeat the steps in <a href="#source-vm-app-1">Creating the First Application Instance</a> to create the second application instance. Specify the same values as for the first application instance, except:</p>
<ul>
<li>In Step1, <strong>Name</strong> <strong>nginxplusapp2</strong></li>
<li>In Step3, <strong>Description</strong> <strong>NGINXPlusapp2Image</strong></li>
</ul>
</li>
</ol>
<p><span id="source-vm-lb"></span></p>
<h4 
id="creating-the-load-balancing-instance-from-a-vm-image">Creating the Load-Balancing Instance from a VM Image  <a class="headerlink float-right" href="#creating-the-load-balancing-instance-from-a-vm-image" title="Creating the Load-Balancing Instance from a VM Image"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>On the <strong>VMinstances</strong> summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE</span>.</p>
</li>
<li>
<p>Repeat the steps in <a href="#source-vm-app-1">Creating the First Application Instance</a> to create the loadbalancing instance. Specify the same values as for the first application instance, except:</p>
<ul>
<li>In Step1, <strong>Name</strong> <strong>nginxpluslb</strong></li>
<li>In Step3, <strong>Description</strong> <strong>NGINXPlus Load Balancing Image</strong></li>
</ul>
</li>
</ol>
<p><span id="source-vm-php"></span></p>
<h4 
id="configuring-php-and-fastcgi-on-the-vm-based-instances">Configuring PHP and FastCGI on the VM-Based Instances  <a class="headerlink float-right" href="#configuring-php-and-fastcgi-on-the-vm-based-instances" title="Configuring PHP and FastCGI on the VM-Based Instances"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Install and configure PHP and FastCGI on the instances.</p>
<p><span style="text-decoration: underline; white-space: nowrap;">Repeat these instructions</span> for all three source instances (<strong>nginxplusapp1</strong>, <strong>nginxplusapp2</strong>, and <strong>nginxpluslb</strong>).</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<ol>
<li>
<p>Connect to the instance over SSH using the method of your choice. GCE provides a built-in mechanism:</p>
<ul>
<li>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab.</li>
<li>In the instance&rsquo;s row in the table, click the triangle icon in the <strong>Connect</strong> column at the far right and select a method (for example, <strong>Openinbrowserwindow</strong>).</li>
</ul>
<img src="/nginx/images/gce-ubuntu-instance-ssh.png" alt="Screenshot showing how to connect via SSH to a VM instance, part of deploying NGINX Plus as the Google load balancer." width="1024" height="284" class="aligncenter size-full wp-image-47489" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Working in the SSH terminal, install PHP7 (the default PHP version for <span style="white-space: nowrap;">Ubuntu 16.04 LTS</span>) and FastCGI.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2bcb348&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2bcb348">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">apt-get install php7.0-fpm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">apt-get install php7.0-fpm</span></span></code></pre></div>
</div></li>
<li>
<p>Edit the PHP7 configuration to bind to a local network port instead of a Unix socket. Using your preferred text editor, remove the following line from <strong>/etc/php/7.0/fpm/pool.d</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2bf08f0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2bf08f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">listen = /run/php/php7.0-fpm.sock</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">listen = /run/php/php7.0-fpm.sock</span></span></code></pre></div>
</div><p>and replace it with these two lines:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c04940&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2c04940">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">listen = 127.0.0.1:9000
</span></span><span class="line"><span class="cl">listen.allowed_clients = 127.0.0.1</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">listen = 127.0.0.1:9000
</span></span><span class="line"><span class="cl">listen.allowed_clients = 127.0.0.1</span></span></code></pre></div>
</div></li>
<li>
<p>Restart PHP:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c1d7b0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2c1d7b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service php7.0-fpm restart</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service php7.0-fpm restart</span></span></code></pre></div>
</div></li>
<li>
<p>Leave the SSH connection open for reuse in the next section.</p>
</li>
</ol>
<p><span id="source-vm-nginx-plus"></span></p>
<h4 
id="installing-and-configuring-nginx-plus-on-the-vm-based-instances">Installing and Configuring NGINX Plus on the VM-Based Instances  <a class="headerlink float-right" href="#installing-and-configuring-nginx-plus-on-the-vm-based-instances" title="Installing and Configuring NGINX Plus on the VM-Based Instances"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Now install NGINXPlus and download files that are specific to the allactive deployment:</p>
<ul>
<li>An NGINXPlus configuration file customized for the function performed by the instance</li>
<li>A set of content files (HTML, images, and so on) served by the application servers in the deployment</li>
</ul>
<p>Both the configuration and content files are available at the <a href="https://github.com/nginxinc/NGINX-Demos/tree/master/gce-nginx-plus-deployment-guide-files" target="_blank" rel="noopener">NGINX GitHub repository</a>.</p>
<p><span style="text-decoration: underline; white-space: nowrap;">Repeat these instructions</span> for all three source instances (<strong>nginxplusapp1</strong>, <strong>nginxplusapp2</strong>, and <strong>nginxpluslb</strong>).</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<ol>
<li>
<p>Install NGINXPlus. For instructions, see the <a href="http://localhost:1313/nginx/admin-guide/installing-nginx/installing-nginx-plus/">NGINXPlus Admin Guide</a>.</p>
</li>
<li>
<p>Clone the GitHub repository for the <a href="https://github.com/nginxinc/NGINX-Demos/tree/master/gce-nginx-plus-deployment-guide-files" target="_blank" rel="noopener">allactive load balancing deployment</a>. (Instructions for downloading the files directly from the GitHub repository are provided below, in case you prefer not to clone it.)</p>
</li>
<li>
<p>Copy the contents of the <strong>usr_share_nginx</strong> subdirectory from the cloned repository to the local <strong>/usr/share/nginx</strong> directory. Create the local directory if needed. (If you choose not to clone the repository, you need to download each file from the GitHub repository individually.)</p>
</li>
<li>
<p>Copy the right configuration file from the <strong>etc_nginx_conf.d</strong> subdirectory of the cloned repository to <strong>/etc/nginx/conf.d</strong>:</p>
<ul>
<li>
<p>On <span style="text-decoration: underline;">both</span> <strong>nginxplusapp1</strong> and <strong>nginxplusapp2</strong>, copy <strong>gceallactiveapp.conf</strong>.</p>
<p>You can also run the following commands to download the configuration file directly from the GitHub repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c40a30&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2c40a30">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-app.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-app.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c5a070&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2c5a070">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
</div></li>
<li>
<p>On <strong>nginxpluslb</strong>, copy <strong>gceallactivelb.conf</strong>.</p>
<p>You can also run the following commands to download the configuration file directly from the GitHub repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c71f40&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2c71f40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">$ curl -o gce-all-active-lb.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$ cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">$ curl -o gce-all-active-lb.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2c88e70&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2c88e70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
</div></li>
</ul>
</li>
<li>
<p>On the LB instance (<strong>nginxpluslb</strong>), use a text editor to open <strong>gceallactivelb.conf</strong>. Change the <code>server</code> directives in the <code>upstream</code> block to reference the internal IP addresses of the <strong>nginxplusapp1</strong> and <strong>nginxplusapp2</strong> instances (substitute the address for the expression in angle brackets). You do not need to modify the two application instances.</p>
<p>You can look up internal IP addresses in the <strong>InternalIP</strong> column of the table on the <strong>ComputeEngine&gt;VMinstances</strong> summary page.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2cabd08&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2cabd08">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-1&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-2&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-1&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-2&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" target="_blank" rel="noopener"><code>sticky cookie</code></a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>Rename <strong>default.conf</strong> to <strong>default.conf.bak</strong> so that NGINXPlus does not load it. The configuration files provided for the allactive deployment include equivalent instructions plus additional functionspecific directives.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2ccdc00&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2ccdc00">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mv default.conf default.conf.bak</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mv default.conf default.conf.bak</span></span></code></pre></div>
</div></li>
<li>
<p>Enable the NGINXPlus <a href="https://www.nginx.com/products/nginx/live-activity-monitoring/" target="_blank" rel="noopener">live activity monitoring</a> dashboard for the instance. Copy <strong>status.html</strong> from the <strong>etc_nginx_conf.d</strong> subdirectory of the cloned repository to <strong>/etc/nginx/conf.d</strong>.</p>
<p>You can also run the following commands to download the configuration file directly from the GitHub repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2cec060&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2cec060">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o status.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o status.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d00c68&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2d00c68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
</div></li>
<li>
<p>Validate the NGINXPlus configuration and restart NGINXPlus:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d16810&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2d16810">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
</div></li>
<li>
<p>Verify the instance is working by accessing it at its external IP address. (As previously noted, we recommend blocking access to the external IP addresses of the application instances in a production environment.) The external IP address for the instance appears on the <strong>ComputeEngine&gt;VMinstances</strong> summary page, in the <strong>ExternalIP</strong> column of the table.</p>
<ul>
<li>
<p>Access the <strong>index.html</strong> page either in a browser or by running this <code>curl</code> command.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d2e2f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2d2e2f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://&lt;external-IP-address&gt;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://&lt;external-IP-address&gt;</span></span></code></pre></div>
</div></li>
<li>
<p>Access its NGINXPlus live activity monitoring dashboard in a browser, at:</p>
<p><strong>https://<em>externalIPaddress</em>:8080/status.html</strong></p>
</li>
</ul>
</li>
<li>
<p>Proceed to <a href="#gold">Task 3: Creating &ldquo;Gold&rdquo; Images</a>.</p>
</li>
</ol>
<p><span id="source-prebuilt"></span></p>
<h3 
id="creating-source-instances-from-prebuilt-nginxplus-images">Creating Source Instances from Prebuilt NGINXPlus Images  <a class="headerlink float-right" href="#creating-source-instances-from-prebuilt-nginxplus-images" title="Creating Source Instances from Prebuilt NGINXPlus Images"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Create three source instances based on a prebuilt NGINXPlus image running on <span style="white-space: nowrap;">Ubuntu 14.04 LTS</span>, available in the Google Marketplace. Google requires that you provision the first instance in the GCP Marketplace. Then you can clone the additional two instances from the first one.</p>
<p><span id="source-prebuilt-app-1"></span></p>
<h4 
id="creating-the-first-application-instance-from-a-prebuilt-image">Creating the First Application Instance from a Prebuilt Image  <a class="headerlink float-right" href="#creating-the-first-application-instance-from-a-prebuilt-image" title="Creating the First Application Instance from a Prebuilt Image"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the GCP Marketplace and search for <strong>nginxplus</strong>.</p>
</li>
<li>
<p>Click the <strong>NGINXPlus</strong> box in the results area.</p>
<img src="/nginx/images/nginx-plus-in-gcp-marketplace.png" alt="Screenshot of NGINX Plus in the Google Cloud Platform Marketplace; from here, you can create a prebuilt NGINX Plus VM instance when deploying NGINX Plus as the load balancer for Google Cloud." width="1024" height="604" class="aligncenter size-full wp-image-47469" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>NGINXPlus</strong> page that opens, click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Launch on Compute Engine</span> button.</p>
</li>
<li>
<p>Fill in the fields on the <strong>NewNGINXPlusdeployment</strong> page as indicated.</p>
<ul>
<li><strong>Deploymentname</strong> <strong>nginxplusapp1</strong></li>
<li><strong>Zone</strong> The GCP zone that makes sense for your location. We&rsquo;re using <strong>uswest1a</strong>.</li>
<li><strong>Machinetype</strong> The appropriate size for the level of traffic you anticipate. We&rsquo;re selecting <strong>micro</strong>, which is ideal for testing purposes.</li>
<li><strong>Disktype</strong> <strong>StandardPersistentDisk</strong> (the default)</li>
<li><strong>DisksizeinGB</strong> <strong>10</strong> (the default and minimum allowed)</li>
<li><strong>Networkname</strong> <strong>default</strong></li>
<li><strong>Subnetworkname</strong> <strong>default</strong></li>
<li><strong>Firewall</strong> Verify that the <strong>AllowHTTPtraffic</strong> checkbox is checked.</li>
</ul>
<p><a href="/nginx/images/gce-marketplace-new-deployment.png"><img src="/nginx/images/gce-marketplace-new-deployment.png" alt="Screenshot of the page for creating a prebuilt NGINX Plus VM instance when deploying NGINX Plus as the Google Cloud Platform load balancer." width="1054" height="973" class="aligncenter size-full wp-image-47468" style="border:2px solid #666666; padding:2px; margin:2px;" /></a></p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Deploy</span> button.</p>
<p>It can take several minutes for the instance to deploy. Wait until the green check mark and confirmation message appear before continuing.</p>
<img src="/nginx/images/gce-marketplace-instance-deployed.png" alt="Screenshot of the page that confirms the creation of a prebuilt NGINX Plus VM instance when deploying NGINX Plus as the Google load balancer." width="1024" height="399" class="aligncenter size-full wp-image-47467" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab and click <strong>nginxplusapp1vm</strong> in the <span style="color:#3366cc;">Name</span> column in the table. (The <strong>vm</strong> suffix is added automatically to the name of the newly created instance.)</p>
<img src="/nginx/images/gce-app-1-vm-select.png" alt="Screenshot showing how to access the page where configuration details for a VM instance can be modified during deployment of NGINX Plus as the Google Cloud load balancer." width="1023" height="194" class="aligncenter size-full wp-image-47465" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>VMinstances</strong> page that opens, click <span style="color:#3366cc;">EDIT</span> at the top of the page. In fields that can be edited, the value changes from static text to text boxes, dropdown menus, and checkboxes.</p>
</li>
<li>
<p>Modify or verify the indicated editable fields (noneditable fields are not listed):</p>
<ul>
<li><strong>Tags</strong> If a default tag appears (for example, <strong>nginxplusapp1tcp80</strong>), click the <strong>X</strong> after its name to remove it. Then, type in <strong>nginxplushttpfwrule</strong>.</li>
<li><strong>ExternalIP</strong> <strong>Ephemeral</strong> (the default)</li>
<li><strong>Bootdiskandlocaldisks</strong> Uncheck the checkbox labeled <strong>Delete boot disk when instance is deleted</strong>.</li>
<li><strong>Additionaldisks</strong> No changes</li>
<li><strong>Network</strong> If you must change the defaults, for example, when configuring a production environment, select <span style="color:#3366cc;">default</span> Then, select <span style="color:#3366cc;">EDIT</span> on the opened <strong>Networkdetails</strong> page. After making your changes select the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Save</span> button.</li>
<li><strong>Firewall</strong> Verify that neither check box is checked (the default). The firewall rule named in the <strong>Tags</strong> field that&rsquo;s above on the current page (see the first bullet in this list) controls this type of access.</li>
<li><strong>Automaticrestart</strong> <strong>On(recommended)</strong> (the default)</li>
<li><strong>Onhostmaintenance</strong> <strong>MigrateVMinstance(recommended)</strong> (the default)</li>
<li><strong>Custommetadata</strong> No changes</li>
<li><strong>SSHKeys</strong> If you&rsquo;re using your own SSH public key instead of your default GCE keys, paste the hexadecimal key string into the box labeled <strong>Enterentirekeydata</strong>.</li>
<li><strong>Serialport</strong> Verify that the check box labeled <strong>Enableconnectingtoserialports</strong> is not checked (the default).</li>
</ul>
<p>The screenshot shows the results of your changes. It omits some fields that can&rsquo;t be edited or for which we recommend keeping the defaults.</p>
<img src="/nginx/images/gce-app-1-vm-edited.png" alt="Screenshot showing the configuration modifications for a VM instance being deployed as part of setting up NGINX Plus as the Google load balancer." width="1027" height="1368" class="aligncenter size-full wp-image-47464" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Save</span> button.</p>
</li>
</ol>
<p><span id="source-prebuilt-app-2"></span></p>
<h4 
id="creating-the-second-application-instance-from-a-prebuilt-image">Creating the Second Application Instance from a Prebuilt Image  <a class="headerlink float-right" href="#creating-the-second-application-instance-from-a-prebuilt-image" title="Creating the Second Application Instance from a Prebuilt Image"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Create the second application instance by cloning the first one.</p>
<ol>
<li>
<p>Navigate back to the summary page on the <strong>ComputeEngine&gt;VMinstances</strong> tab (click the arrow that is circled in the following figure).</p>
<img src="/nginx/images/gce-vm-instances-back-arrow.png" alt="Screenshot showing how to return to the VM instance summary page during deployment of NGINX Plus as the Google Cloud Platform load balancer." width="1024" height="110" class="aligncenter size-full wp-image-47492" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click <strong>nginxplusapp1vm</strong> in the <span style="color:#3366cc;">Name</span> column of the table (shown in the screenshot in Step7 of <a href="#source-prebuilt-app-1">Creating the First Application Instance</a>).</p>
</li>
<li>
<p>On the <strong>VMinstances</strong> page that opens, click <span style="color:#3366cc;">CLONE</span> at the top of the page.</p>
</li>
<li>
<p>On the <strong>Createaninstance</strong> page that opens, modify or verify the fields and checkboxes as indicated:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusapp2vm</strong>. Here we&rsquo;re adding the <strong>vm</strong> suffix to make the name consistent with the first instance; GCE does not add it automatically when you clone an instance.</li>
<li><strong>Zone</strong> The GCP zone that makes sense for your location. We&rsquo;re using <strong>uswest1a</strong>.</li>
<li><strong>Machinetype</strong> The appropriate size for the level of traffic you anticipate. We&rsquo;re selecting <strong>f1micro</strong>, which is ideal for testing purposes.</li>
<li><strong>Bootdisktype</strong> <strong>New10GBstandardpersistentdisk</strong> (the value inherited from <strong>nginxplusapp1vm</strong>)</li>
<li><strong>IdentityandAPIaccess</strong> Set the <strong>Accessscopes</strong> radio button to <strong>Allowdefaultaccess</strong> and accept the default values in all other fields. If you want more granular control over access than is provided by these settings, modify the fields in this section as appropriate.</li>
<li><strong>Firewall</strong> Verify that neither check box is checked (the default).</li>
</ul>
</li>
<li>
<p>Click <span style="color:#3366cc; white-space: nowrap;">Management, disk, networking, SSH keys</span> to open that set of subtabs.</p>
</li>
<li>
<p>Verify the following settings on the subtabs, modifying them as necessary:</p>
<ul>
<li><strong>Management</strong> In the <strong>Tags</strong> field: <strong>nginxplushttpfwrule</strong></li>
<li><strong>Disks</strong> The <strong>Deletionrule</strong> checkbox (labeled <strong>Delete boot disk when instance is deleted</strong>) is <span style="text-decoration: underline;">not</span> checked</li>
</ul>
</li>
<li>
<p>Select the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
</li>
</ol>
<p><span id="source-prebuilt-lb"></span></p>
<h4 
id="creating-the-load-balancing-instance-from-a-prebuilt-image">Creating the Load-Balancing Instance from a Prebuilt Image  <a class="headerlink float-right" href="#creating-the-load-balancing-instance-from-a-prebuilt-image" title="Creating the Load-Balancing Instance from a Prebuilt Image"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Create the source loadbalancing instance by cloning the first instance again.</p>
<p>Repeat Steps2 through7 of <a href="#source-prebuilt-app-2">Creating the Second Application Instance</a>. In Step4, specify <strong>nginxpluslbvm</strong> as the name.</p>
<p><span id="source-prebuilt-php"></span></p>
<h4 
id="configuring-php-and-fastcgi-on-the-prebuilt-based-instances">Configuring PHP and FastCGI on the Prebuilt-Based Instances  <a class="headerlink float-right" href="#configuring-php-and-fastcgi-on-the-prebuilt-based-instances" title="Configuring PHP and FastCGI on the Prebuilt-Based Instances"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Install and configure PHP and FastCGI on the instances.</p>
<p><span style="text-decoration: underline; white-space: nowrap;">Repeat these instructions</span> for all three source instances (<strong>nginxplusapp1vm</strong>, <strong>nginxplusapp2vm</strong>, and <strong>nginxpluslbvm</strong>).</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<ol>
<li>
<p>Connect to the instance over SSH using the method of your choice. GCE provides a builtin mechanism:</p>
<ul>
<li>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab.</li>
<li>In the table, find the row for the instance. Select the triangle icon in the <strong>Connect</strong> column at the far right. Then, select a method (for example, <strong>Openinbrowserwindow</strong>).</li>
</ul>
<p>The screenshot shows instances based on the prebuilt NGINXPlus images.</p>
<img src="/nginx/images/gce-prebuilt-instance-ssh.png" alt="Screenshot showing how to connect via SSH to a VM instance, part of deploying NGINX Plus as the Google load balancer." width="1024" height="284" class="aligncenter size-full wp-image-47495" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Working in the SSH terminal, install PHP5 (the default PHP version for Ubuntu14.04 LTS) and FastCGI.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d5a9e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2d5a9e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">apt-get install php5-fpm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">apt-get install php5-fpm</span></span></code></pre></div>
</div></li>
<li>
<p>Edit the PHP5 configuration to bind to a local network port instead of a Unix socket. Using your preferred text editor, remove the following line from <strong>/etc/php5/fpm/pool.d</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d6b388&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2d6b388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Listen = /run/php/php5-fpm.sock</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Listen = /run/php/php5-fpm.sock</span></span></code></pre></div>
</div><p>and replace it with these two lines:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2d80760&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2d80760">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Listen = 127.0.0.1:9000
</span></span><span class="line"><span class="cl">Listen.allowed_clients = 127.0.0.1</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Listen = 127.0.0.1:9000
</span></span><span class="line"><span class="cl">Listen.allowed_clients = 127.0.0.1</span></span></code></pre></div>
</div></li>
<li>
<p>Restart PHP:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2da7090&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2da7090">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service php5-fpm restart</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">service php5-fpm restart</span></span></code></pre></div>
</div></li>
<li>
<p>Leave the SSH connection open for reuse in the next section.</p>
</li>
</ol>
<p><span id="source-prebuilt-nginx-plus"></span></p>
<h4 
id="configuring-nginx-plus-on-the-prebuilt-based-instances">Configuring NGINX Plus on the Prebuilt-Based Instances  <a class="headerlink float-right" href="#configuring-nginx-plus-on-the-prebuilt-based-instances" title="Configuring NGINX Plus on the Prebuilt-Based Instances"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Now download files that are specific to the allactive deployment:</p>
<ul>
<li>An NGINXPlus configuration file customized for the function the instance performs (application server or load balancer)</li>
<li>A set of content files (HTML, images, and so on) served by the application servers in the deployment</li>
</ul>
<p>Both the configuration and content files are available at the <a href="https://github.com/nginxinc/NGINX-Demos/tree/master/gce-nginx-plus-deployment-guide-files" target="_blank" rel="noopener">NGINX GitHub repository</a>.</p>
<p><span style="text-decoration: underline; white-space: nowrap;">Repeat these instructions</span> for all three source instances (<strong>nginxplusapp1vm</strong>, <strong>nginxplusapp2vm</strong>, and <strong>nginxpluslbvm</strong>).</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<ol>
<li>
<p>Clone the GitHub repository for the <a href="https://github.com/nginxinc/NGINX-Demos/tree/master/gce-nginx-plus-deployment-guide-files" target="_blank" rel="noopener">allactive load balancing deployment</a>. (See the instructions below for downloading the files from GitHub if you choose not to clone it.)</p>
</li>
<li>
<p>Copy the contents of the <strong>usr_share_nginx</strong> subdirectory from the cloned repo to the local <strong>/usr/share/nginx</strong> directory. Create the local directory if necessary. (If you choose not to clone the repository, you need to download each file from the GitHub repository one at a time.)</p>
</li>
<li>
<p>Copy the right configuration file from the <strong>etc_nginx_conf.d</strong> subdirectory of the cloned repository to <strong>/etc/nginx/conf.d</strong>:</p>
<ul>
<li>
<p>On <span style="text-decoration: underline;">both</span> <strong>nginxplusapp1vm</strong> and <strong>nginxplusapp2vm</strong>, copy <strong>gceallactiveapp.conf</strong>.</p>
<p>You can also run these commands to download the configuration file from GitHub:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2deed00&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2deed00">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-app.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-app.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e06400&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2e06400">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-app.conf</span></span></code></pre></div>
</div></li>
<li>
<p>On <strong>nginxpluslbvm</strong>, copy <strong>gceallactivelb.conf</strong>.</p>
<p>You can also run the following commands to download the configuration file directly from the GitHub repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e21598&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2e21598">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-lb.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o gce-all-active-lb.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e3cb18&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2e3cb18">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">cd /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/gce-all-active-lb.conf</span></span></code></pre></div>
</div></li>
</ul>
</li>
<li>
<p>On the LB instance (<strong>nginxpluslbvm</strong>), use a text editor to open <strong>gceallactivelb.conf</strong>. Change the <code>server</code> directives in the <code>upstream</code> block to reference the internal IP addresses of the <strong>nginxplusapp1vm</strong> and <strong>nginxplusapp2vm</strong> instances. (No action is required on the two application instances themselves.)</p>
<p>You can look up internal IP addresses in the <strong>InternalIP</strong> column of the table on the <strong>ComputeEngine&gt;VMinstances</strong> summary page.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e6e7f8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2e6e7f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-1-vm&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-2-vm&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-1-vm&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="s">&lt;internal</span> <span class="s">IP</span> <span class="s">address</span> <span class="s">of</span> <span class="s">nginx-plus-app-2-vm&gt;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" target="_blank" rel="noopener"><code>sticky cookie</code></a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>Rename <strong>default.conf</strong> to <strong>default.conf.bak</strong> so that NGINXPlus does not load it. The configuration files for the all-active deployment include equivalent instructions. They also have extra, function-specific directives.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2e8a160&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2e8a160">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mv default.conf default.conf.bak</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mv default.conf default.conf.bak</span></span></code></pre></div>
</div></li>
<li>
<p>Enable the NGINXPlus <a href="https://www.nginx.com/products/nginx/live-activity-monitoring/" target="_blank" rel="noopener">live activity monitoring</a> dashboard for the instance. To do this, copy <strong>status.html</strong> from the <strong>etc_nginx_conf.d</strong> subdirectory of the cloned repository to <strong>/etc/nginx/conf.d</strong>.</p>
<p>You can also run the following commands to download the configuration file directly from the GitHub repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2eb3d58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2eb3d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o status.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">curl -o status.conf https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
</div><p>or</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f01f58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2f01f58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/nginx/conf.d/
</span></span><span class="line"><span class="cl">wget https://github.com/nginxinc/NGINX-Demos/blob/master/gce-nginx-plus-deployment-guide-files/etc_nginx_conf.d/status.conf</span></span></code></pre></div>
</div></li>
<li>
<p>Validate the NGINXPlus configuration and restart NGINXPlus:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f34bd8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2f34bd8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
</div></li>
<li>
<p>Verify the instance is working by accessing it at its external IP address. (As noted, we recommend blocking access, in production, to the external IPs of the app.) The external IP address for the instance appears on the <strong>ComputeEngine&gt;VMinstances</strong> summary page, in the <strong>ExternalIP</strong> column of the table.</p>
<ul>
<li>
<p>Access the <strong>index.html</strong> page either in a browser or by running this <code>curl</code> command.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2f5f388&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb2f5f388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://&lt;external-IP-address-of-NGINX-Plus-server&gt;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl http://&lt;external-IP-address-of-NGINX-Plus-server&gt;</span></span></code></pre></div>
</div></li>
<li>
<p>Access the NGINXPlus live activity monitoring dashboard in a browser, at:</p>
<p><strong>https://<em>externalIPaddressofNGINXPlusserver</em>:8080/dashboard.html</strong></p>
</li>
</ul>
</li>
<li>
<p>Proceed to <a href="#gold">Task 3: Creating &ldquo;Gold&rdquo; Images</a>.</p>
</li>
</ol>
<p><span id="gold"></span></p>
<h2 
id="task-3-creating-gold-images">Task 3: Creating &ldquo;Gold&rdquo; Images  <a class="headerlink float-right" href="#task-3-creating-gold-images" title="Task 3: Creating &ldquo;Gold&rdquo; Images"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Create <em>gold images</em>, which are base images that GCE clones automatically when it needs to scale up the number of instances. They are derived from the instances you created in <a href="#source">Creating Source Instances</a>. Before creating the images, delete the source instances. This breaks the attachment between them and the disk. (you can&rsquo;t create an image from a disk attached to a VM instance).</p>
<ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab.</p>
</li>
<li>
<p>In the table, select all three instances:</p>
<ul>
<li>If you created source instances from <a href="#source-vm">VM (Ubuntu) images</a>: <strong>nginxplusapp1</strong>, <strong>nginxplusapp2</strong>, and <strong>nginxpluslb</strong></li>
<li>If you created source instances from <a href="#source-prebuilt">prebuilt NGINXPlus images</a>: <strong>nginxplusapp1vm</strong>, <strong>nginxplusapp2vm</strong>, and <strong>nginxpluslbvm</strong></li>
</ul>
</li>
<li>
<p>Click <span style="color:#3366cc;">STOP</span> in the top toolbar to stop the instances.</p>
<img src="/nginx/images/gce-vm-instances-toolbar.png" alt="Screenshot of the toolbar on the Google Compute Engine page that lists VM instances, used when deploying NGINX Plus as the Google Cloud load balancer." width="1024" height="63" class="aligncenter size-full wp-image-47493" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click <span style="color:#3366cc;">DELETE</span> in the top toolbar to delete the instances.</p>
<p><strong>Note:</strong> If the pop-up warns that it will delete the boot disk for any instance, cancel the deletion. Then, perform the steps below <span style="text-decoration: underline;">for each affected instance</span>:</p>
<ul>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab and click the instance in the <span style="color:#3366cc;">Name</span> column in the table. (The screenshot shows <strong>nginxplusapp1vm</strong>.)</p>
<img src="/nginx/images/gce-app-1-vm-select.png" alt="Screenshot showing how to access the page where configuration details for a VM instance can be modified during deployment of NGINX Plus as the Google Cloud load balancer." width="1023" height="194" class="aligncenter size-full wp-image-47465" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>VMinstances</strong> page that opens, click <span style="color:#3366cc;">EDIT</span> at the top of the page. In fields that can be edited, the value changes from static text to text boxes, dropdown menus, and checkboxes.</p>
</li>
<li>
<p>In the <strong>Bootdiskandlocaldisks</strong> field, uncheck the checkbox labeled <strong>Delete boot disk when instance is deleted</strong>.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Save</span> button.</p>
</li>
<li>
<p>On the <strong>VMinstances</strong> summary page, select the instance in the table and click <span style="color:#3366cc;">DELETE</span> in the top toolbar to delete it.</p>
</li>
</ul>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;Images</strong> tab.</p>
</li>
<li>
<p>Click <span style="color:#3366cc; white-space: nowrap;">[+] CREATE IMAGE</span>.</p>
</li>
<li>
<p>On the <strong>Createanimage</strong> page that opens, modify or verify the fields as indicated:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusapp1image</strong></li>
<li><strong>Family</strong> Leave the field empty</li>
<li><strong>Description</strong> <strong>NGINXPlus Application 1 Gold Image</strong></li>
<li><strong>Encryption</strong> <strong>Automatic(recommended)</strong> (the default)</li>
<li><strong>Source</strong> <strong>Disk</strong> (the default)</li>
<li><strong>Sourcedisk</strong> <strong>nginxplusapp1</strong> or <strong>nginxplusapp1vm</strong>, depending on the method you used to create source instances (select the source instance from the dropdown menu)</li>
</ul>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
</li>
<li>
<p>Repeat Steps7 through9 to create a second image with the following values (retain the default values in all other fields):</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusapp2image</strong></li>
<li><strong>Description</strong> <strong>NGINXPlusApplication2GoldImage</strong></li>
<li><strong>Sourcedisk</strong> <strong>nginxplusapp2</strong> or <strong>nginxplusapp2vm</strong>, depending on the method you used to create source instances (select the source instance from the dropdown menu)</li>
</ul>
</li>
<li>
<p>Repeat Steps7 through9 to create a third image with the following values (retain the default values in all other fields):</p>
<ul>
<li><strong>Name</strong> <strong>nginxpluslbimage</strong></li>
<li><strong>Description</strong> <strong>NGINXPlus LB Gold Image</strong></li>
<li><strong>Sourcedisk</strong> <strong>nginxpluslb</strong> or <strong>nginxpluslbvm</strong>, depending on the method you used to create source instances (select the source instance from the dropdown menu)</li>
</ul>
</li>
<li>
<p>Verify that the three images appear at the top of the table on the <strong>ComputeEngine&gt;Images</strong> tab.</p>
</li>
</ol>
<p><span id="templates"></span></p>
<h2 
id="task-4-creating-instance-templates">Task 4: Creating Instance Templates  <a class="headerlink float-right" href="#task-4-creating-instance-templates" title="Task 4: Creating Instance Templates"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Create <em>instance templates</em>. They are the compute workloads in instance groups. These are created manually or automatically when GCE detects a failure.</p>
<p><span id="templates-app-1"></span></p>
<h3 
id="creating-the-first-application-instance-template">Creating the First Application Instance Template  <a class="headerlink float-right" href="#creating-the-first-application-instance-template" title="Creating the First Application Instance Template"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;Instancetemplates</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create instance template</span> button.</p>
</li>
<li>
<p>On the <strong>Createaninstancetemplate</strong> page that opens, modify or verify the fields as indicated:</p>
<ul>
<li>
<p><strong>Name</strong> <strong>nginxplusapp1instancetemplate</strong></p>
</li>
<li>
<p><strong>Machinetype</strong> The appropriate size for the level of traffic you anticipate. We&rsquo;re selecting <strong>micro</strong>, which is ideal for testing purposes.</p>
</li>
<li>
<p><strong>Bootdisk</strong> Click <strong>Change</strong>. The <strong>Bootdisk</strong> page opens. Perform the following steps:</p>
<ul>
<li>
<p>Open the <strong>CustomImages</strong> subtab.</p>
  <img src="/nginx/images/gce-instance-template-boot-disk.png" alt="Screenshot of the 'Boot disk' page in Google Cloud Platform for selecting the source instance of a new instance template, part of deploying NGINX Plus as the Google load balancer." width="491" height="517" class="aligncenter size-full wp-image-47478" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Select <strong>NGINXPlusAllActiveLB</strong> from the drop-down menu labeled <strong>Showimagesfrom</strong>.</p>
</li>
<li>
<p>Click the <strong>nginxplusapp1image</strong> radio button.</p>
</li>
<li>
<p>Accept the default values in the <strong>Bootdisktype</strong> and <strong>Size(GB)</strong> fields (<strong>Standardpersistentdisk</strong> and <strong>10</strong> respectively).</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Select</span> button.</p>
</li>
</ul>
</li>
<li>
<p><strong>IdentityandAPIaccess</strong> Unless you want more granular control over access, keep the defaults in the <strong>Serviceaccount</strong> field (<strong>Compute Engine default service account</strong>) and <strong>Accessscopes</strong> field (<strong>Allowdefaultaccess</strong>).</p>
</li>
<li>
<p><strong>Firewall</strong> Verify that neither check box is checked (the default). The firewall rule invoked in the <strong>Tags</strong> field on the <strong>Management</strong> subtab (see Step6 below) controls this type of access.</p>
</li>
</ul>
</li>
<li>
<p>Select <span style="color:#3366cc; white-space: nowrap;">Management, disk, networking, SSH keys</span> (indicated with a red arrow in the following screenshot) to open that set of subtabs.</p>
<img src="/nginx/images/gce-create-instance-template.png" alt="Screenshot of the interface for creating a Google Compute Engine (GCE) instance template, used during deployment of NGINX Plus as the Google load balancer." width="498" height="798" class="aligncenter size-full wp-image-47473" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Management</strong> subtab, modify or verify the fields as indicated:</p>
<ul>
<li><strong>Description</strong> <strong>NGINXPlusapp1InstanceTemplate</strong></li>
<li><strong>Tags</strong> <strong>nginxplushttpfwrule</strong></li>
<li><strong>Preemptibility</strong> <strong>Off(recommended)</strong> (the default)</li>
<li><strong>Automaticrestart</strong> <strong>On(recommended)</strong> (the default)</li>
<li><strong>Onhostmaintenance</strong> <strong>MigrateVMinstance(recommended)</strong> (the default)</li>
</ul>
<img src="/nginx/images/gce-instance-template-management.png" alt="Screenshot of the Management subtab used during creation of a new VM instance template, part of deploying NGINX Plus as the Google load balancer." width="487" height="551" class="aligncenter size-full wp-image-47480" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Disks</strong> subtab, verify that the checkbox labeled <strong>Delete boot disk when instance is deleted</strong> is checked.</p>
<p>Instances from this template are ephemeral instantiations of the gold image. So, we want GCE to reclaim the disk when the instance is terminated. New instances are always based on the gold image. So, there is no reason to keep the instantiations on disk when the instance is deleted.</p>
<img src="/nginx/images/gce-instance-template-disks.png" alt="Screenshot of the Disks subtab used during creation of a new VM instance template, part of deploying NGINX Plus as the Google Cloud load balancer." width="488" height="184" class="aligncenter size-full wp-image-47479" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>On the <strong>Networking</strong> subtab, verify the default settings of <strong>Ephemeral</strong> for <strong>ExternalIP</strong> and <strong>Off</strong> for <strong>IPForwarding</strong>.</p>
<img src="/nginx/images/gce-instance-template-networking.png" alt="Screenshot of the Networking subtab used during creation of a new VM instance template, part of deploying NGINX Plus as the Google load balancer." width="488" height="174" class="aligncenter size-full wp-image-47481" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>If you&rsquo;re using your own SSH public key instead of your default keys, paste the hexadecimal key string on the <strong>SSHKeys</strong> subtab. Right into the box that reads <strong>Enterentirekeydata</strong>.</p>
 <img src="/nginx/images/gce-ubuntu-instance-ssh-keys.png" alt="Screenshot of the SSH Keys subtab used during creation of a new VM instance, part of deploying NGINX Plus as the Google Cloud Platform load balancer." width="488" height="205" class="aligncenter size-full wp-image-47488" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
</li>
</ol>
<p><span id="templates-app-2"></span></p>
<h3 
id="creating-the-second-application-instance-template">Creating the Second Application Instance Template  <a class="headerlink float-right" href="#creating-the-second-application-instance-template" title="Creating the Second Application Instance Template"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>On the <strong>Instancetemplates</strong> summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE TEMPLATE</span>.</p>
</li>
<li>
<p>Repeat Steps4 through10 of <a href="#templates-app-1">Creating the First Application Instance Template</a> to create a second application instance template. Use the same values as for the first instance template, except as noted:</p>
<ul>
<li>In Step4:
<ul>
<li><strong>Name</strong> <strong>nginxplusapp2instancetemplate</strong></li>
<li><strong>Bootdisk</strong> Click the <strong>nginxplusapp2image</strong> radio button</li>
</ul>
</li>
<li>In Step6, <strong>Description</strong> <strong>NGINXPlusapp2InstanceTemplate</strong></li>
</ul>
</li>
</ol>
<p><span id="templates-lb"></span></p>
<h3 
id="creating-the-load-balancing-instance-template">Creating the Load-Balancing Instance Template  <a class="headerlink float-right" href="#creating-the-load-balancing-instance-template" title="Creating the Load-Balancing Instance Template"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>On the <strong>Instancetemplates</strong> summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE TEMPLATE</span>.</p>
</li>
<li>
<p>Repeat Steps4 through10 of <a href="#templates-app-1">Creating the First Application Instance Template</a> to create the loadbalancing instance template. Use the same values as for the first instance template, except as noted:</p>
<ul>
<li>
<p>In Step4:</p>
<ul>
<li><strong>Name</strong> <strong>nginxpluslbinstancetemplate</strong>.</li>
<li><strong>Bootdisk</strong> Click the <strong>nginxpluslbimage</strong> radio button</li>
</ul>
</li>
<li>
<p>In Step6, <strong>Description</strong> <strong>NGINXPlus LoadBalancing Instance Template</strong></p>
</li>
</ul>
</li>
</ol>
<p><span id="health-checks"></span></p>
<h2 
id="task-5-creating-image-health-checks">Task 5: Creating Image Health Checks  <a class="headerlink float-right" href="#task-5-creating-image-health-checks" title="Task 5: Creating Image Health Checks"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Define the simple HTTP health check that GCE uses. This verifies that each NGINX Plus LB image is running (and to re-create any LB instance that isn&rsquo;t running).</p>
<ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;Healthchecks</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create a health check</span> button.</p>
</li>
<li>
<p>On the <strong>Createahealthcheck</strong> page that opens, modify or verify the fields as indicated:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplushttphealthcheck</strong></li>
<li><strong>Description</strong> <strong>Basic HTTP health check to monitor NGINXPlus instances</strong></li>
<li><strong>Protocol</strong> <strong>HTTP</strong> (the default)</li>
<li><strong>Port</strong> <strong>80</strong> (the default)</li>
<li><strong>Requestpath</strong> <strong>/statusold.html</strong></li>
</ul>
</li>
<li>
<p>If the <strong>Healthcriteria</strong> section is not already open, click <span style="color:#3366cc;">More</span>.</p>
</li>
<li>
<p>Modify or verify the fields as indicated:</p>
<ul>
<li><strong>Checkinterval</strong> <strong>10seconds</strong></li>
<li><strong>Timeout</strong> <strong>10seconds</strong></li>
<li><strong>Healthythreshold</strong> <strong>2consecutivesuccesses</strong> (the default)</li>
<li><strong>Unhealthythreshold</strong> <strong>10consecutivefailures</strong></li>
</ul>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
<img src="/nginx/images/gce-create-health-check.png" alt="Screenshot of the interface for creating a health check in Google Compute Engine (GCE), which Google network load balancer uses to monitor NGINX Plus as the Google cloud load balancer." width="487" height="706" class="aligncenter size-full wp-image-47471" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ol>
<p><span id="groups"></span></p>
<h2 
id="task-6-creating-instance-groups">Task 6: Creating Instance Groups  <a class="headerlink float-right" href="#task-6-creating-instance-groups" title="Task 6: Creating Instance Groups"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Create three independent instance groups, one for each type of function-specific instance.</p>
<ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>ComputeEngine&gt;Instancegroups</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create instance group</span> button.</p>
</li>
</ol>
<p><span id="groups-app-1"></span></p>
<h3 
id="creating-the-first-application-instance-group">Creating the First Application Instance Group  <a class="headerlink float-right" href="#creating-the-first-application-instance-group" title="Creating the First Application Instance Group"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>On the <strong>Createanewinstancegroup</strong> page that opens, modify or verify the fields as indicated. Ignore fields that are not mentioned:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusapp1instancegroup</strong></li>
<li><strong>Description</strong> <strong>Instance group to host NGINXPlus app-1 instances</strong></li>
<li><strong>Location</strong>
<ul>
<li>Click the <strong>Singlezone</strong> radio button (the default).</li>
<li><strong>Zone</strong> The GCP zone you specified when you created source instances (Step1 of <a href="#source-vm-app-1">Creating the First Application Instance from a VM Image</a> or Step5 of <a href="#source-prebuilt">Creating the First Application Instance from a Prebuilt Image</a>). We&rsquo;re using <strong>uswest1a</strong>.</li>
</ul>
</li>
<li><strong>Creationmethod</strong> <strong>Useinstancetemplate</strong> radio button (the default)</li>
<li><strong>Instancetemplate</strong> <strong>nginxplusapp1instancetemplate</strong> (select from the drop-down menu)</li>
<li><strong>Autoscaling</strong> <strong>Off</strong> (the default)</li>
<li><strong>Numberofinstances</strong> <strong>2</strong></li>
<li><strong>Healthcheck</strong> <strong>nginxplushttphealthcheck</strong> (select from the drop-down menu)</li>
<li><strong>Initialdelay</strong> <strong>300seconds</strong> (the default)</li>
</ul>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
<img src="/nginx/images/gce-create-instance-group.png" alt="Screenshot of the interface for creating a Google Compute Engine (GCE) instance group, used during deployment of NGINX Plus as the load balancer for Google Cloud." width="488" height="1045" class="aligncenter size-full wp-image-47472" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ol>
<p><span id="groups-app-2"></span></p>
<h3 
id="creating-the-second-application-instance-group">Creating the Second Application Instance Group  <a class="headerlink float-right" href="#creating-the-second-application-instance-group" title="Creating the Second Application Instance Group"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>On the Instance groups summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE GROUP</span>.</p>
</li>
<li>
<p>Repeat the steps in <a href="#groups-app-1">Creating the First Application Instance Group</a> to create a second application instance group. Specify the same values as for the first instance template, except for these fields:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusapp2instancegroup</strong></li>
<li><strong>Description</strong> <strong>Instance group to host NGINXPlus app-2 instances</strong></li>
<li><strong>Instancetemplate</strong> <strong>nginxplusapp2instancetemplate</strong> (select from the drop-down menu)</li>
</ul>
</li>
</ol>
<p><span id="groups-lb"></span></p>
<h3 
id="creating-the-load-balancing-instance-group">Creating the Load-Balancing Instance Group  <a class="headerlink float-right" href="#creating-the-load-balancing-instance-group" title="Creating the Load-Balancing Instance Group"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>On the <strong>Instancegroups</strong> summary page, click <span style="color:#3366cc; white-space: nowrap;">CREATE INSTANCE GROUP</span>.</p>
</li>
<li>
<p>Repeat the steps in <a href="#groups-app-1">Creating the First Application Instance Group</a> to create the loadbalancing instance group. Specify the same values as for the first instance template, except for these fields:</p>
<ul>
<li><strong>Name</strong> <strong>nginxpluslbinstancegroup</strong></li>
<li><strong>Description</strong> <strong>Instance group to host NGINXPlus load balancing instances</strong></li>
<li><strong>Instancetemplate</strong> <strong>nginxpluslbinstancetemplate</strong> (select from the drop-down menu)</li>
</ul>
</li>
</ol>
<p><span id="update-test"></span></p>
<h3 
id="updating-and-testing-the-nginxplus-configuration">Updating and Testing the NGINXPlus Configuration  <a class="headerlink float-right" href="#updating-and-testing-the-nginxplus-configuration" title="Updating and Testing the NGINXPlus Configuration"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Update the NGINXPlus configuration on the two LB instances (<strong>nginxpluslbinstancegroup[a&hellip;z]</strong>). It should list the internal IP addresses of the four application servers (two instances each of <strong>nginxplusapp1instancegroup[a&hellip;z]</strong> and <strong>nginxplusapp2instancegroup[a&hellip;z]</strong>).</p>
<p><span style="text-decoration: underline; white-space: nowrap;">Repeat these instructions</span> for both LB instances.</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<ol>
<li>
<p>Connect to the LB instance over SSH using the method of your choice. GCE provides a built-in mechanism:</p>
<ul>
<li>Navigate to the <strong>ComputeEngine&gt;VMinstances</strong> tab.</li>
<li>In the table, find the row for the instance. Click the triangle icon in the <strong>Connect</strong> column at the far right. Then, select a method (for example, <strong>Openinbrowserwindow</strong>).</li>
</ul>
</li>
<li>
<p>In the SSH terminal, use your preferred text editor to edit <strong>gceallactivelb.conf</strong>. Change the <code>server</code> directives in the <code>upstream</code> block to  reference the internal IPs of the two <strong>nginxplusapp1instancegroup[a&hellip;z]</strong> instances and the two <strong>nginxplusapp2instancegroup[a&hellip;z]</strong> instances. You can check the addresses in the <strong>InternalIP</strong> column of the table on the <strong>ComputeEngine&gt;VMinstances</strong> summary page. For example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb2ff9078&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb2ff9078">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">upstream</span> <span class="s">upstream_app_pool</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">zone</span> <span class="s">upstream-apps</span> <span class="mi">64k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="mi">10</span><span class="s">.10.10.4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sticky</span> <span class="s">cookie</span> <span class="s">GCPPersist</span> <span class="s">expires=300</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p>Directive documentation: <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#server" target="_blank" rel="noopener">server</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#sticky" target="_blank" rel="noopener"><code>sticky cookie</code></a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#upstream" target="_blank" rel="noopener">upstream</a>, <a href="https://nginx.org/en/docs/http/ngx_http_upstream_module.html#zone" target="_blank" rel="noopener">zone</a></p>
</li>
<li>
<p>Validate the NGINXPlus configuration and restart NGINXPlus:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3028648&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1fb3028648">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -t
</span></span><span class="line"><span class="cl">nginx -s reload</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the four application instances are receiving traffic and responding. To do this, access the NGINX Plus live activity monitoring dashboard on the load-balancing instance (<strong>nginxpluslbinstancegroup[a&hellip;z]</strong>). You can see the instance&rsquo;s external IP address on the <strong>ComputeEngine&gt;VMinstances</strong> summary page in the <strong>ExternalIP</strong> column of the table.</p>
<p><strong>https://<em>LBexternalIPaddress</em>:8080/status.html</strong></p>
</li>
<li>
<p>Verify that NGINXPlus is load balancing traffic among the four application instance groups. Do this by running this command on a separate client machine:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb306fae8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb306fae8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> curl -s &lt;LB-external-IP-address&gt; <span class="p">|</span> grep Server: <span class="p">;</span><span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> curl -s &lt;LB-external-IP-address&gt; <span class="p">|</span> grep Server: <span class="p">;</span><span class="k">done</span></span></span></code></pre></div>
</div><p>If load balancing is working properly, the unique <strong>Server</strong> field from the index page for each application instance appears in turn.</p>
</li>
</ol>
<p><span id="static-ip"></span></p>
<h2 
id="task-7-configuring-gce-network-load-balancer">Task 7: Configuring GCE Network Load Balancer  <a class="headerlink float-right" href="#task-7-configuring-gce-network-load-balancer" title="Task 7: Configuring GCE Network Load Balancer"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Set up a GCE network load balancer. It will distribute incoming client traffic to the NGINX Plus LB instances. First, reserve the static IP address the GCE network load balancer advertises to clients.</p>
<ol>
<li>
<p>Verify that the <strong>NGINXPlusAllActiveLB</strong> project is still selected in the Google Cloud Platform header bar.</p>
</li>
<li>
<p>Navigate to the <strong>Networking&gt;ExternalIPaddresses</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Reserve static address</span> button.</p>
</li>
<li>
<p>On the <strong>Reserveastaticaddress</strong> page that opens, modify or verify the fields as indicated:</p>
<ul>
<li><strong>Name</strong> <strong>nginxplusnetworklbstaticip</strong></li>
<li><strong>Description</strong> <strong>Static IP address for Network LB frontend to NGINXPlus LB instances</strong></li>
<li><strong>Type</strong> Click the <strong>Regional</strong> radio button (the default)</li>
<li><strong>Region</strong> The GCP zone you specified when you created source instances (Step1 of <a href="#source-vm-app-1">Creating the First Application Instance from a VM Image</a> or Step5 of <a href="#source-prebuilt">Creating the First Application Instance from a Prebuilt Image</a>). We&rsquo;re using <strong>uswest1</strong>.</li>
<li><strong>Attachedto</strong> <strong>None</strong> (the default)</li>
</ul>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Reserve</span> button.</p>
<img src="/nginx/images/gce-reserve-static-address.png" alt="Screenshot of the interface for reserving a static IP address for Google Compute Engine network load balancer." width="488" height="496" class="aligncenter size-full wp-image-47483" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Navigate to the <strong>Networking&gt;Loadbalancing</strong> tab.</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white; white-space: nowrap;">Create load balancer</span> button.</p>
</li>
<li>
<p>On the <strong>Loadbalancing</strong> page that opens, click <strong>Startconfiguration</strong> in the <strong>TCPLoadBalancing</strong> box.</p>
</li>
<li>
<p>On the page that opens, click the <strong>FromInternettomyVMs</strong> and <strong>No(TCP)</strong> radio buttons (the defaults).</p>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Continue</span> button. The <strong>NewTCPloadbalancer</strong> page opens.</p>
</li>
<li>
<p>In the <strong>Name</strong> field, type <strong>nginxplusnetworklbfrontend</strong>.</p>
</li>
<li>
<p>Click <strong>Backendconfiguration</strong> in the left column to open the <strong>Backendconfiguration</strong> interface in the right column. Fill in the fields as indicated:</p>
<ul>
<li><strong>Region</strong> The GCP region you specified in Step4. We&rsquo;re using <strong>uswest1</strong>.</li>
<li><strong>Backends</strong> With <strong>Selectexistinginstancegroups</strong> selected, select <strong>nginxpluslbinstancegroup</strong> from the drop-down menu</li>
<li><strong>Backuppool</strong> <strong>None</strong> (the default)</li>
<li><strong>Failoverratio</strong> <strong>10</strong> (the default)</li>
<li><strong>Healthcheck</strong> <strong>nginxplushttphealthcheck</strong></li>
<li><strong>Sessionaffinity</strong> <strong>ClientIP</strong></li>
</ul>
<img src="/nginx/images/gce-backend-configuration.png" alt="Screenshot of the interface for backend configuration of GCE network load balancer, used during deployment of NGINX Plus as the Google Cloud Platform load balancer." width="862" height="584" class="aligncenter size-full wp-image-47466" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
<li>
<p>Select <strong>Frontendconfiguration</strong> in the left column. This opens up the <strong>Frontendconfiguration</strong> interface on the right column.</p>
</li>
<li>
<p>Create three <strong>ProtocolIPPort</strong> tuples, each with:</p>
<ul>
<li><strong>Protocol</strong> <strong>TCP</strong></li>
<li><strong>IP</strong> The address you reserved in Step5, selected from the drop-down menu (if there is more than one address, select the one labeled in parentheses with the name you specified in Step5)</li>
<li><strong>Port</strong> <strong>80</strong>, <strong>8080</strong>, and <strong>443</strong> in the three tuples respectively</li>
</ul>
</li>
<li>
<p>Click the <span style="background-color:#3366cc; color:white;">Create</span> button.</p>
<img src="/nginx/images/gce-frontend-configuration.png" alt="Screenshot of the interface for frontend configuration of GCE network load balancer, used during deployment of NGINX Plus as the Google Cloud load balancer." width="1067" height="437" class="aligncenter size-full wp-image-47477" style="border:2px solid #666666; padding:2px; margin:2px;" />
</li>
</ol>
<p><span id="testing"></span></p>
<h2 
id="task-8-testing-the-all-active-load-balancing-deployment">Task 8: Testing the All-Active Load Balancing Deployment  <a class="headerlink float-right" href="#task-8-testing-the-all-active-load-balancing-deployment" title="Task 8: Testing the All-Active Load Balancing Deployment"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Verify that GCE network load balancer is properly routing traffic to both NGINXPlus LB instances.</p>
<p><strong>Note:</strong> Some commands require <code>root</code> privilege. If appropriate for your environment, prefix commands with the <code>sudo</code> command.</p>
<p>Working on a separate client machine, run this command, using the static IP address you set in the previous section for GCE network load balancer:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb30c6d70&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb30c6d70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> curl -s &lt;GCE-Network-LB-external-static-IP-address&gt; <span class="p">|</span> grep Server: <span class="p">;</span><span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span> curl -s &lt;GCE-Network-LB-external-static-IP-address&gt; <span class="p">|</span> grep Server: <span class="p">;</span><span class="k">done</span></span></span></code></pre></div>
</div><p>Alternatively, you can use a web browser to access this URL:</p>
<p><strong>http://</strong><em>GCE-Network-LB-external-static-IP-address</em></p>
<p>If load balancing is working properly, the unique <strong>Server</strong> field from the index page for each application instance appears in turn.</p>
<p>To verify that high availability is working:</p>
<ol>
<li>
<p>Connect to one of the instances in the <strong>nginxpluslbinstancegroup</strong> over SSH and run this command to force it offline:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3100b38&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb3100b38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">iptables -A INPUT -p tcp --destination-port <span class="m">80</span> -j DROP</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">iptables -A INPUT -p tcp --destination-port <span class="m">80</span> -j DROP</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that with one LB instance offline, the other LB instance still forwards traffic to the application instances (there might be a delay before GCE network load balancer detects that the first instance is offline). Continue monitoring and verify that GCE network load balancer then re-creates the first LB instance and brings it online.</p>
</li>
<li>
<p>When the LB instance is back online, run this command to return it to its working state:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1fb3123db8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1fb3123db8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">iptables -F</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">iptables -F</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="revision-history">Revision History  <a class="headerlink float-right" href="#revision-history" title="Revision History"><i class="fas fa-link fa-xs"></i></a>
</h3><ul>
<li>Version 3 (July 2018) Updates for Google Cloud Platform Marketplace</li>
<li>Version 2 (April 2018) Standardized information about root privilege and links to directive documentation</li>
<li>Version 1 (November 2016) Initial version (<span style="white-space: nowrap;">NGINX Plus R11</span>)</li>
</ul>

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nginx/deployment-guides/google-cloud-platform/high-availability-all-active.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=All-Active%20HA%20for%20NGINX%20Plus%20on%20the%20Google%20Cloud%20Platform&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        
        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#design-and-topology">Design and Topology</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#task-1-creating-a-project-and-firewall-rules">Task 1: Creating a Project and Firewall Rules</a>
      <ul>
        <li><a href="#creating-firewall-rules">Creating Firewall Rules</a></li>
      </ul>
    </li>
    <li><a href="#task-2-creating-source-instances">Task 2: Creating Source Instances</a>
      <ul>
        <li><a href="#creating-source-instances-from-vm-images">Creating Source Instances from VM Images</a></li>
        <li><a href="#creating-source-instances-from-prebuilt-nginxplus-images">Creating Source Instances from Prebuilt NGINXPlus Images</a></li>
      </ul>
    </li>
    <li><a href="#task-3-creating-gold-images">Task 3: Creating &ldquo;Gold&rdquo; Images</a></li>
    <li><a href="#task-4-creating-instance-templates">Task 4: Creating Instance Templates</a>
      <ul>
        <li><a href="#creating-the-first-application-instance-template">Creating the First Application Instance Template</a></li>
        <li><a href="#creating-the-second-application-instance-template">Creating the Second Application Instance Template</a></li>
        <li><a href="#creating-the-load-balancing-instance-template">Creating the Load-Balancing Instance Template</a></li>
      </ul>
    </li>
    <li><a href="#task-5-creating-image-health-checks">Task 5: Creating Image Health Checks</a></li>
    <li><a href="#task-6-creating-instance-groups">Task 6: Creating Instance Groups</a>
      <ul>
        <li><a href="#creating-the-first-application-instance-group">Creating the First Application Instance Group</a></li>
        <li><a href="#creating-the-second-application-instance-group">Creating the Second Application Instance Group</a></li>
        <li><a href="#creating-the-load-balancing-instance-group">Creating the Load-Balancing Instance Group</a></li>
        <li><a href="#updating-and-testing-the-nginxplus-configuration">Updating and Testing the NGINXPlus Configuration</a></li>
      </ul>
    </li>
    <li><a href="#task-7-configuring-gce-network-load-balancer">Task 7: Configuring GCE Network Load Balancer</a></li>
    <li><a href="#task-8-testing-the-all-active-load-balancing-deployment">Task 8: Testing the All-Active Load Balancing Deployment</a>
      <ul>
        <li><a href="#revision-history">Revision History</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


