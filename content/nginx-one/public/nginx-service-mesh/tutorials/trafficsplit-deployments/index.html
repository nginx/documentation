<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Deployments using Traffic Splitting | DEV -- docs-nginx-com</title>


<meta name="description" content="This topic provides a guide for using traffic splits with different deployment strategies.">





<link rel="canonical" href="http://localhost:1313/nginx-service-mesh/tutorials/trafficsplit-deployments/">






<meta name="robots" content="noindex,nofollow" />


<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="This topic provides a guide for using traffic splits with different deployment strategies." />
<meta name="twitter:title" content="Deployments using Traffic Splitting" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="19/03/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-service-mesh/">F5 NGINX Service Mesh</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-service-mesh/tutorials/">Tutorials</a><i class="fas fa-chevron-right"></i></li>
                
            
                Deployments using Traffic Splitting
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx-service-mesh/tutorials/trafficsplit-deployments/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx-service-mesh/" alt="F5 NGINX Service Mesh">
                    F5 NGINX Service Mesh</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/about/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--about-nginx-service-mesh" aria-controls="mesh--about-nginx-service-mesh">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>About NGINX Service Mesh</a>
                            </li>
                        </div>
                        <div id="mesh--about-nginx-service-mesh" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/about/what-is-nsm/"
                                                                href="http://localhost:1313/nginx-service-mesh/about/what-is-nsm/">What is NGINX Service Mesh?</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/about/mesh-tech-specs/"
                                                                href="http://localhost:1313/nginx-service-mesh/about/mesh-tech-specs/">Technical Specifications</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/about/architecture/"
                                                                href="http://localhost:1313/nginx-service-mesh/about/architecture/">Architecture</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/get-started/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--getting-started" aria-controls="mesh--getting-started">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Getting Started</a>
                            </li>
                        </div>
                        <div id="mesh--getting-started" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#mesh--get-started--prepare-your-cluster">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Prepare Your Cluster</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="mesh--get-started--prepare-your-cluster" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/supported-platforms/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/supported-platforms/">Supported Platforms</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/persistent-storage/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/persistent-storage/">Persistent Storage</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/gke/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/gke/">Google Kubernetes Engine</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/kubeadm/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/kubeadm/">Kubeadm</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/kubespray/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/kubespray/">Kubespray</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/openshift/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/openshift/">OpenShift</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/platform-setup/rke/" href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/rke/">Rancher Kubernetes Engine</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/get-started/install/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#mesh--get-started--install-nginx-service-mesh">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Install NGINX Service Mesh</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="mesh--get-started--install-nginx-service-mesh" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/install/configuration/" href="http://localhost:1313/nginx-service-mesh/get-started/install/configuration/">Configuration Options</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/install/install/" href="http://localhost:1313/nginx-service-mesh/get-started/install/install/">Install with nginx-meshctl</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/install/install-with-helm/" href="http://localhost:1313/nginx-service-mesh/get-started/install/install-with-helm/">Install with Helm</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/get-started/upgrade/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#mesh--get-started--upgrade-nginx-service-mesh">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Upgrade NGINX Service Mesh</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="mesh--get-started--upgrade-nginx-service-mesh" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/upgrade/upgrade/" href="http://localhost:1313/nginx-service-mesh/get-started/upgrade/upgrade/">Upgrade with nginx-meshctl</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/upgrade/upgrade-with-helm/" href="http://localhost:1313/nginx-service-mesh/get-started/upgrade/upgrade-with-helm/">Upgrade with Helm</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/get-started/uninstall/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#mesh--get-started--uninstall-nginx-service-mesh">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Uninstall NGINX Service Mesh</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="mesh--get-started--uninstall-nginx-service-mesh" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/uninstall/uninstall/" href="http://localhost:1313/nginx-service-mesh/get-started/uninstall/uninstall/">Uninstall with nginx-meshctl</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/get-started/uninstall/uninstall-with-helm/" href="http://localhost:1313/nginx-service-mesh/get-started/uninstall/uninstall-with-helm/">Uninstall with Helm</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/guides/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--guides" aria-controls="mesh--guides">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Guides</a>
                            </li>
                        </div>
                        <div id="mesh--guides" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/inject-sidecar-proxy/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/inject-sidecar-proxy/">Sidecar Proxy Injection</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/monitoring-and-tracing/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/monitoring-and-tracing/">Monitoring and Tracing</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/secure-traffic-mtls/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/secure-traffic-mtls/">Secure Mesh Traffic using mTLS</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/prometheus-metrics/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/prometheus-metrics/">Prometheus Metrics</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/smi-traffic-metrics/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/smi-traffic-metrics/">SMI Traffic Metrics</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/smi-traffic-policies/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/smi-traffic-policies/">SMI Traffic Policies</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/private-registry/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/private-registry/">Private Registry</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/production-tuning/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/production-tuning/">Production Tuning</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/guides/v1alpha1-ratelimit/"
                                                                href="http://localhost:1313/nginx-service-mesh/guides/v1alpha1-ratelimit/">v1alpha1 RateLimit Documentation</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/tutorials/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--tutorials" aria-controls="mesh--tutorials">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Tutorials</a>
                            </li>
                        </div>
                        <div id="mesh--tutorials" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/kic/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#mesh--tutorials--nginx-ingress-controller">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>NGINX Ingress Controller</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="mesh--tutorials--nginx-ingress-controller" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/tutorials/kic/deploy-with-kic/" href="http://localhost:1313/nginx-service-mesh/tutorials/kic/deploy-with-kic/">Deploy with NGINX Ingress Controller</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/tutorials/kic/egress-walkthrough/" href="http://localhost:1313/nginx-service-mesh/tutorials/kic/egress-walkthrough/">Configure a Secure Egress Route with NGINX Ingress Controller</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/tutorials/kic/ingress-walkthrough/" href="http://localhost:1313/nginx-service-mesh/tutorials/kic/ingress-walkthrough/">Expose an Application with NGINX Ingress Controller</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-service-mesh/tutorials/kic/ingress-udp-walkthrough/" href="http://localhost:1313/nginx-service-mesh/tutorials/kic/ingress-udp-walkthrough/">Expose a UDP Application with NGINX Ingress Controller</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/observability/"
                                                                href="http://localhost:1313/nginx-service-mesh/tutorials/observability/">Install NGINX Service Mesh with Basic Observability</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/deploy-example-app/"
                                                                href="http://localhost:1313/nginx-service-mesh/tutorials/deploy-example-app/">Deploy an Example App with NGINX Service Mesh</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/trafficsplit-deployments/"
                                                                href="http://localhost:1313/nginx-service-mesh/tutorials/trafficsplit-deployments/">Deployments using Traffic Splitting</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/accesscontrol-walkthrough/"
                                                                href="http://localhost:1313/nginx-service-mesh/tutorials/accesscontrol-walkthrough/">Services using Access Control</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/tutorials/ratelimit-walkthrough/"
                                                                href="http://localhost:1313/nginx-service-mesh/tutorials/ratelimit-walkthrough/">Configure Rate Limiting</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/reference/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--reference" aria-controls="mesh--reference">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Reference</a>
                            </li>
                        </div>
                        <div id="mesh--reference" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/reference/permissions/"
                                                                href="http://localhost:1313/nginx-service-mesh/reference/permissions/">NGINX Service Mesh Permissions</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/reference/api-usage/"
                                                                href="http://localhost:1313/nginx-service-mesh/reference/api-usage/">NGINX Service Mesh API</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/reference/nginx-meshctl/"
                                                                href="http://localhost:1313/nginx-service-mesh/reference/nginx-meshctl/">CLI Reference</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/support/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--support" aria-controls="mesh--support">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Support</a>
                            </li>
                        </div>
                        <div id="mesh--support" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/support/contact-support/"
                                                                href="http://localhost:1313/nginx-service-mesh/support/contact-support/">Where to Go for Support</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-service-mesh/releases/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#mesh--releases" aria-controls="mesh--releases">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Releases</a>
                            </li>
                        </div>
                        <div id="mesh--releases" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-2.0.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-2.0.0/">Release Notes 2.0.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.7.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.7.0/">Release Notes 1.7.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.6.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.6.0/">Release Notes 1.6.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.5.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.5.0/">Release Notes 1.5.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.4.1/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.4.1/">Release Notes 1.4.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.4.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.4.0/">Release Notes 1.4.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.3.1/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.3.1/">Release Notes 1.3.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.3.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.3.0/">Release Notes 1.3.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.2.1/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.2.1/">Release Notes 1.2.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.2.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.2.0/">Release Notes 1.2.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.1.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.1.0/">Release Notes 1.1.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.0.1/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.0.1/">Release Notes 1.0.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-1.0.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.0.0/">Release Notes 1.0.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.9.1/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.9.1/">Release Notes 0.9.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.9.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.9.0/">Release Notes 0.9.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.8.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.8.0/">Release Notes 0.8.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.7.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.7.0/">Release Notes 0.7.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.6.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.6.0/">Release Notes 0.6.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/release-notes-0.5.0/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.5.0/">Release Notes 0.5.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-service-mesh/releases/oss-dependencies/"
                                                                href="http://localhost:1313/nginx-service-mesh/releases/oss-dependencies/">Open Source Licenses Addendum</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name"></div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-bf41ae5def3c15f356cd6af4e2a8b323" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-bf41ae5def3c15f356cd6af4e2a8b323" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        About NGINX Service Mesh 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/about/what-is-nsm/" style="">What is NGINX Service Mesh? </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/about/mesh-tech-specs/" style="">Technical Specifications </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/about/architecture/" style="">Architecture </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-449b73c88c4de3bea33ac3029e6b5583" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-449b73c88c4de3bea33ac3029e6b5583" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Getting Started 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-deb82227940a2d5e07e44c8439038b55" class="toggle-checkbox" style="display: none;">
            <label for="toggle-deb82227940a2d5e07e44c8439038b55" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Prepare Your Cluster 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/supported-platforms/" style="">Supported Platforms </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/persistent-storage/" style="">Persistent Storage </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/gke/" style="">Google Kubernetes Engine </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/kubeadm/" style="">Kubeadm </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/kubespray/" style="">Kubespray </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/openshift/" style="">OpenShift </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/platform-setup/rke/" style="">Rancher Kubernetes Engine </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-aba00bf13287d0813d38081f7ee261d3" class="toggle-checkbox" style="display: none;">
            <label for="toggle-aba00bf13287d0813d38081f7ee261d3" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Install NGINX Service Mesh 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/install/configuration/" style="">Configuration Options </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/install/install/" style="">Install with nginx-meshctl </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/install/install-with-helm/" style="">Install with Helm </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-d65d072a88d70fd28ec8f36342526df5" class="toggle-checkbox" style="display: none;">
            <label for="toggle-d65d072a88d70fd28ec8f36342526df5" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Upgrade NGINX Service Mesh 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/upgrade/upgrade/" style="">Upgrade with nginx-meshctl </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/upgrade/upgrade-with-helm/" style="">Upgrade with Helm </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-6ec43d96b6ef5498baecab381ece941c" class="toggle-checkbox" style="display: none;">
            <label for="toggle-6ec43d96b6ef5498baecab381ece941c" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Uninstall NGINX Service Mesh 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/uninstall/uninstall/" style="">Uninstall with nginx-meshctl </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/get-started/uninstall/uninstall-with-helm/" style="">Uninstall with Helm </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-bbb6da7727e4fb623f0175cabaeefe2d" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-bbb6da7727e4fb623f0175cabaeefe2d" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Guides 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/inject-sidecar-proxy/" style="">Sidecar Proxy Injection </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/monitoring-and-tracing/" style="">Monitoring and Tracing </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/secure-traffic-mtls/" style="">Secure Mesh Traffic using mTLS </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/prometheus-metrics/" style="">Prometheus Metrics </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/smi-traffic-metrics/" style="">SMI Traffic Metrics </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/smi-traffic-policies/" style="">SMI Traffic Policies </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/private-registry/" style="">Private Registry </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/production-tuning/" style="">Production Tuning </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/guides/v1alpha1-ratelimit/" style="">v1alpha1 RateLimit Documentation </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-a40e89f82d592b9864b87549dd72cf74" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-a40e89f82d592b9864b87549dd72cf74" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Tutorials 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-b0d171c6ef19de294cb136496519d1e3" class="toggle-checkbox" style="display: none;">
            <label for="toggle-b0d171c6ef19de294cb136496519d1e3" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                NGINX Ingress Controller 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/kic/deploy-with-kic/" style="">Deploy with NGINX Ingress Controller </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/kic/egress-walkthrough/" style="">Configure a Secure Egress Route with NGINX Ingress Controller </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/kic/ingress-walkthrough/" style="">Expose an Application with NGINX Ingress Controller </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/kic/ingress-udp-walkthrough/" style="">Expose a UDP Application with NGINX Ingress Controller </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/observability/" style="">Install NGINX Service Mesh with Basic Observability </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/deploy-example-app/" style="">Deploy an Example App with NGINX Service Mesh </a>
            
        
    </li>
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/trafficsplit-deployments/" style="font-weight: bold;">Deployments using Traffic Splitting </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#before-you-begin">Before You Begin</a></li>
    <li><a href="#objectives">Objectives</a>
      <ul>
        <li><a href="#deploy-the-production-version-of-the-target-app">Deploy the Production Version of the Target App</a></li>
        <li><a href="#deploy-a-new-version-of-the-target-app-using-a-canary-deployment">Deploy a New Version of the Target App using a Canary Deployment</a></li>
        <li><a href="#deploy-a-new-version-of-the-target-app-using-a-blue-green-deployment">Deploy a New Version of the Target App using a Blue-Green Deployment</a></li>
        <li><a href="#ab-testing-with-traffic-splits">A/B Testing with Traffic Splits</a></li>
        <li><a href="#traffic-splitting-based-on-path-and-http-methods">Traffic Splitting based on path and HTTP methods</a></li>
      </ul>
    </li>
    <li><a href="#cleanup">Cleanup</a></li>
    <li><a href="#use-case">Use Case</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/accesscontrol-walkthrough/" style="">Services using Access Control </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/tutorials/ratelimit-walkthrough/" style="">Configure Rate Limiting </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-802e371d8a0a73b77a378a9d9a8e870b" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-802e371d8a0a73b77a378a9d9a8e870b" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Reference 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/reference/permissions/" style="">NGINX Service Mesh Permissions </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/reference/api-usage/" style="">NGINX Service Mesh API </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/reference/nginx-meshctl/" style="">CLI Reference </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-e6039fce1c694f861615e8c943cda621" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-e6039fce1c694f861615e8c943cda621" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Support 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/support/contact-support/" style="">Where to Go for Support </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-19d2271b8bef4f1a5be0b066d0de7e2f" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-19d2271b8bef4f1a5be0b066d0de7e2f" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Releases 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-2.0.0/" style="">Release Notes 2.0.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.7.0/" style="">Release Notes 1.7.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.6.0/" style="">Release Notes 1.6.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.5.0/" style="">Release Notes 1.5.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.4.1/" style="">Release Notes 1.4.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.4.0/" style="">Release Notes 1.4.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.3.1/" style="">Release Notes 1.3.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.3.0/" style="">Release Notes 1.3.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.2.1/" style="">Release Notes 1.2.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.2.0/" style="">Release Notes 1.2.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.1.0/" style="">Release Notes 1.1.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.0.1/" style="">Release Notes 1.0.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-1.0.0/" style="">Release Notes 1.0.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.9.1/" style="">Release Notes 0.9.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.9.0/" style="">Release Notes 0.9.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.8.0/" style="">Release Notes 0.8.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.7.0/" style="">Release Notes 0.7.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.6.0/" style="">Release Notes 0.6.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/release-notes-0.5.0/" style="">Release Notes 0.5.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-service-mesh/releases/oss-dependencies/" style="">Open Source Licenses Addendum </a>
            
        
    </li>
    
</ul>
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-service-mesh/">F5 NGINX Service Mesh</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-service-mesh/tutorials/">Tutorials</a><i class="fas fa-chevron-right"></i></li>
                
            
                Deployments using Traffic Splitting
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>Deployments using Traffic Splitting</h1>
        <h2 
id="overview">Overview  <a class="headerlink float-right" href="#overview" title="Overview"><i class="fas fa-link fa-xs"></i></a>
</h2><p>You can use traffic splitting for most deployment scenarios, including canary, blue-green, A/B testing, and so on. The ability to control traffic flow to different versions of an application makes it easy to roll out a new application version with minimal effort and interruption to production traffic.</p>
<h2 
id="before-you-begin">Before You Begin  <a class="headerlink float-right" href="#before-you-begin" title="Before You Begin"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>Install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" target="_blank" rel="noopener">kubectl</a>.</p>
</li>
<li>
<p>(Optional) If you want to view metrics, ensure that you have deployed Prometheus and Grafana.
Refer to the <a href="http://localhost:1313/nginx-service-mesh/guides/monitoring-and-tracing/">Monitoring and Tracing</a> guide for instructions.</p>
</li>
<li>
<p>Set up a Kubernetes cluster with <a href="http://localhost:1313/nginx-service-mesh/get-started/install/install/">F5 NGINX Service Mesh</a> deployed with the following configuration:</p>
<ul>
<li><code>--mtls-mode</code> is set to <code>permissive</code> or <code>off</code> states.</li>
<li>(Optional) <code>--prometheus-address</code> is pointed to the Prometheus instance you created above.</li>
</ul>
</li>
<li>
<p>Enable <a href="http://localhost:1313/nginx-service-mesh/guides/inject-sidecar-proxy/#automatic-proxy-injection">automatic sidecar injection</a> for the <code>default</code> namespace.</p>
</li>
<li>
<p>Download all the example files:</p>
<ul>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/gateway.yaml">gateway.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/target-svc.yaml">target-svc.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/target-v1.0.yaml">target-v1.0.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/target-v2.0-failing.yaml">target-v2.0-failing.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/target-v2.1-successful.yaml">target-v2.1-successful.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/target-v3.0.yaml">target-v3.0.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/trafficsplit.yaml">trafficsplit.yaml</a>
</li>
<li><i class="fas fa-download "></i> 
 
 
      
     <a href="/examples/traffic-split/trafficsplit-matches.yaml">trafficsplit-matches.yaml</a>
</li>
</ul>
</li>
</ol>
<blockquote class="note">
  <div><strong>Note:</strong><br/> The NGINX Plus Ingress Controller&rsquo;s custom resource <a href="https://docs.nginx.com/nginx-ingress-controller/configuration/transportserver-resource/" target="_blank" rel="noopener">TransportServer</a> has the same Kubernetes short name(<code>ts</code>) as the custom resource TrafficSplit.
If you have the NGINX Plus Ingress Controller installed, use the full name <code>trafficsplit(s)</code> instead of <code>ts</code> in the following instructions.</div>
</blockquote>

<blockquote class="note">
  <div><strong>Note:</strong><br/> Avoid configuring traffic policies such as TrafficSplits, RateLimits, and CircuitBreakers for headless services.
These policies will not work as expected because NGINX Service Mesh has no way to tie each pod IP address to its headless service.</div>
</blockquote>

<h2 
id="objectives">Objectives  <a class="headerlink float-right" href="#objectives" title="Objectives"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Follow the steps in this guide to learn how to use traffic splitting for various deployment strategies.</p>
<h3 
id="deploy-the-production-version-of-the-target-app">Deploy the Production Version of the Target App  <a class="headerlink float-right" href="#deploy-the-production-version-of-the-target-app" title="Deploy the Production Version of the Target App"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>First, let&rsquo;s begin by deploying the &ldquo;production&rdquo; v1.0 target app, the load balancer Service, and the ingress gateway.
<blockquote class="tip">
  <div><strong>Tip:</strong><br/> For simplicity, this guide uses a simple NGINX reverse proxy for the ingress gateway. For production usage and for more advanced ingress control, we recommend using the <a href="https://www.nginx.com/products/nginx-ingress-controller/" target="_blank" rel="noopener">NGINX Ingress Controller for Kubernetes</a>. Refer to <a href="http://localhost:1313/nginx-service-mesh/tutorials/kic/ingress-walkthrough/" target="_blank" rel="noopener">Deploy NGINX Ingress Controller with NGINX Service Mesh</a> to learn more.</div>
</blockquote>
</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49ab1a20&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49ab1a20">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-svc.yaml -f target-v1.0.yaml -f gateway.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-svc.yaml -f target-v1.0.yaml -f gateway.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> All Pods and Services deploy successfully.</p>
<p>Use <code>kubectl</code> to make sure the Pods and Services deploy successfully.</p>
<p>Example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49b11948&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49b11948">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pods
</span></span><span class="line"><span class="cl">NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">gateway-58c6c76dd-4mmht        2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v1-0-6f69fc48f6-mzcf2   2/2     Running   <span class="m">0</span>          2m</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pods
</span></span><span class="line"><span class="cl">NAME                           READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">gateway-58c6c76dd-4mmht        2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v1-0-6f69fc48f6-mzcf2   2/2     Running   <span class="m">0</span>          2m</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49ba7f88&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49ba7f88">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get svc
</span></span><span class="line"><span class="cl">NAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">gateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m
</span></span><span class="line"><span class="cl">target-svc    ClusterIP      10.0.0.3        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v1-0   ClusterIP      10.0.0.4        &lt;none&gt;          80/TCP         2m</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get svc
</span></span><span class="line"><span class="cl">NAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">gateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m
</span></span><span class="line"><span class="cl">target-svc    ClusterIP      10.0.0.3        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v1-0   ClusterIP      10.0.0.4        &lt;none&gt;          80/TCP         2m</span></span></code></pre></div>
</div><p>To better understand what is going on here, let&rsquo;s take a quick look at what we deployed here:</p>
<ul>
<li><strong>gateway</strong>: simple NGINX reverse proxy that forwards traffic to the target app. Besides providing a single point of ingress to the cluster, using the gateway lets us use the <code>nginx-meshctl top</code> command to check traffic metrics between it and the backend Services it is sending traffic to.</li>
<li><strong>target-svc</strong>: the root Service that connects to all the different versions of the target app.</li>
<li><strong>target</strong>: for our example we will be deploying 3 different versions of the target app. The target app is a basic NGINX server that returns the target version. Each one has its own Service tagged with its version number. These are the Services that the root target-svc sends requests to.</li>
</ul>
</li>
<li>
<p>Once the Pods and Services are ready, generate traffic to <code>target-svc</code>. Use a different bash window for this step so you can watch the traffic change as you are doing the deployments.</p>
<p><strong>Commands:</strong></p>
<ul>
<li>
<p>Get the external IP for gateway-svc:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49bff9e0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49bff9e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get svc gateway-svc</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get svc gateway-svc</span></span></code></pre></div>
</div></li>
<li>
<p>Save the IP address as an environment variable:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49c66280&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49c66280">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">GATEWAY_IP</span><span class="o">=</span>&lt;gateway external IP&gt;</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">export</span> <span class="nv">GATEWAY_IP</span><span class="o">=</span>&lt;gateway external IP&gt;</span></span></code></pre></div>
</div></li>
<li>
<p>Start a loop that sends a request to that IP once per second for 5 minutes. Rerun as needed:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49cb5fd8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49cb5fd8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 300<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 300<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
</div></li>
</ul>
<p><strong>Expectation:</strong> Requests will start to come in to <code>target-svc</code>. At this point you should only see <code>target v1.0</code> responses.</p>
</li>
<li>
<p>Back in your original bash window, use the mesh CLI to check traffic metrics.</p>
<p><strong>Command:</strong> <code>nginx-meshctl top</code> <br>
<strong>Expectation:</strong> The <code>target-v1-0</code> deployment will show 100% incoming success rate and the <code>gateway</code> deployment will show 100% outgoing success rate. The <code>top</code> command only shows traffic from the last 30s. <code>top</code> provides a quick look at your Services for immediate debugging and to see if there’s any anomalies that need further investigation. For more detailed and accurate traffic monitoring, we recommend using Grafana. Refer to <a href="http://localhost:1313/nginx-service-mesh/guides/smi-traffic-metrics/">traffic metrics</a> for details.</p>
<p>Example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49d39950&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49d39950">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        100.00%           <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v1-0  100.00%                             <span class="m">10</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        100.00%           <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v1-0  100.00%                             <span class="m">10</span></span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="deploy-a-new-version-of-the-target-app-using-a-canary-deployment">Deploy a New Version of the Target App using a Canary Deployment  <a class="headerlink float-right" href="#deploy-a-new-version-of-the-target-app-using-a-canary-deployment" title="Deploy a New Version of the Target App using a Canary Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Using traffic splits we can use a variety of deployment strategies. Whether using a blue-green deployment, canary deployment, or a hybrid of different deployment strategies, traffic splits make the process extremely easy.</p>
<p>For this version of the target app, let&rsquo;s try using a canary deployment strategy.</p>
<ol>
<li>
<p>Apply the traffic split so that once a new version is deployed, it will not receive any traffic until we are ready. Ideally we would apply this at the same time as the first <code>target</code> version, <code>target-svc</code>, and <code>gateway</code>. To make it easier to see what is happening though, we are applying it in this separate step.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49d76210&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49d76210">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> The traffic split is applied successfully. Use <code>kubectl get ts</code> to see the current traffic splits.</p>
<p>Use <code>kubectl describe ts target-ts</code> to see details about the traffic split we just applied. Currently the traffic split is configured to send 100% of traffic to target v1.0.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49dcd880&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49dcd880">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span></span></span></code></pre></div>
</div></li>
<li>
<p>Now let&rsquo;s deploy target v2.0. To show a scenario where an upgrade is failing, this version of target is configured to return a <code>500</code> error status code instead of a successful <code>200</code>.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49e01c70&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49e01c70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v2.0-failing.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v2.0-failing.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> Target v2.0 will deploy to the cluster successfully. You should see the new <code>target-v2-0</code> Pod and Service in the <code>kubectl get pods</code>/<code>kubectl get svc</code> output. Since we deployed the traffic split, if you look at your other bash window where the traffic is being generated you should still only see responses from target v1.0. If you check <code>nginx-meshctl top</code> you should see the same deployments as before. This is because no traffic has been sent to or received from target v2.0.</p>
</li>
<li>
<p>For this deployment we&rsquo;ll send 10% of traffic to target v2.0 while 90% is still going to target v1.0. Open <code>trafficsplit.yaml</code> in the editor of your choice and add a new backend for <code>target-v2-0</code> with a weight of <code>10</code>. Change the weight of <code>target-v1-0</code> to <code>90</code>.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49e89080&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49e89080">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">10</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">90</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">10</span></span></span></code></pre></div>
</div></li>
<li>
<p>After updating <code>trafficsplit.yaml</code>, save and apply it.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49ec2290&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49ec2290">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> After applying the updated traffic split, you should start seeing responses from target v2.0 in the other bash where traffic is being generated. Because of the weight we set in the previous step, about 1 out of 10 requests will be sent to v2.0. Something to keep in mind is that these are weighted, so it will not be exactly 1 in 10, but it will be close.</p>
</li>
<li>
<p>Check the traffic metrics now that v2.0 is available.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49ef08c0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49ef08c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nginx-meshctl top</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nginx-meshctl top</span></span></code></pre></div>
</div><p><strong>Expectation:</strong></p>
<ul>
<li><code>target-v1-0</code> deployment will still show 100% incoming success rate</li>
<li><code>target-v2-0</code> deployment will show 0% incoming success rate</li>
<li><code>gateway</code> deployment will show the appropriate percentage of successful outgoing requests</li>
</ul>
<p>Example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49f54668&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49f54668">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        90.00%            <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v1-0  100.00%                             <span class="m">9</span>
</span></span><span class="line"><span class="cl">target-v2-0  0.00%                               <span class="m">1</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        90.00%            <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v1-0  100.00%                             <span class="m">9</span>
</span></span><span class="line"><span class="cl">target-v2-0  0.00%                               <span class="m">1</span></span></span></code></pre></div>
</div></li>
<li>
<p>It looks like v2.0 doesn&rsquo;t work! We can see that because the incoming success rate to target-v2 is 0%. Thankfully, using traffic splitting, it is easy to redirect all traffic back to v1.0 without doing a complicated rollback. To update the traffic split, simply update <code>trafficsplit.yaml</code> to send 100% of traffic to v1.0 and 0% of traffic to v2.0 and re-apply it.</p>
<p>You can either explicitly set the weight of <code>target-v2-0</code> to <code>0</code> or remove the <code>target-v2-0</code> backend completely. The result will be the same.</p>
<p>At this point you can delete v2.0 from the cluster.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49f9c6c0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49f9c6c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f target-v2.0-failing.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f target-v2.0-failing.yaml</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="deploy-a-new-version-of-the-target-app-using-a-blue-green-deployment">Deploy a New Version of the Target App using a Blue-Green Deployment  <a class="headerlink float-right" href="#deploy-a-new-version-of-the-target-app-using-a-blue-green-deployment" title="Deploy a New Version of the Target App using a Blue-Green Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><p>For this version of the target app, let&rsquo;s use a blue-green deployment.</p>
<ol>
<li>
<p>Deploy v2.1 of target, which fixes the issue causing the failing requests that we saw in v2.0.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49fbe9a0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f49fbe9a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v2.1-successful.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v2.1-successful.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> Target v2.1 will deploy successfully. You should see the new <code>target-v2-1</code> Pod and Service in the <code>kubectl get pods</code>/<code>kubectl get svc</code> output. Just as with <code>target-v2-0</code> though, we have the traffic split configured to send all traffic to <code>target-v1-0</code> until we are ready to do the actual deployment and make <code>target-v2-1</code> available for traffic.</p>
</li>
<li>
<p>Since we are doing a blue-green deployment, we will configure the traffic split to send all traffic to target v2.1. Open <code>trafficsplit.yaml</code> in the editor of your choice and add a new backend for <code>target-v2-1</code> with a weight of <code>100</code>. Change the weight of <code>target-v1-0</code> to <code>0</code>. You could also delete the <code>target-v1-0</code> backend completely, but with this type of deployment it&rsquo;s easier to set the weight to <code>0</code> in case you need to roll back quickly.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f49fe8598&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f49fe8598">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v1-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span></span></span></code></pre></div>
</div></li>
<li>
<p>After updating <code>trafficsplit.yaml</code>, save and apply it.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a003730&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a003730">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> After applying the updated traffic split, you should start seeing responses from target v2.1 in the other bash where traffic is being generated. Because of the weight we set in the previous step, all traffic should be going to v2.1.</p>
</li>
<li>
<p>Check the traffic metrics now that v2.1 is available.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a015070&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a015070">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nginx-meshctl top</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nginx-meshctl top</span></span></code></pre></div>
</div><p><strong>Expectation:</strong></p>
<ul>
<li><code>target-v1-0</code> deployment will not show up, although keep in mind that it will take a bit for the previous requests to move out of the 30s metric window. If you see <code>target-v1-0</code>, try again in 30s or so.</li>
<li><code>target-v2-1</code> deployment will show 100% incoming success rate</li>
<li><code>gateway</code> deployment will show 100% outgoing success rate</li>
</ul>
<p>Example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a05a1e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a05a1e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        100.00%           <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v2-1  100.00%                             <span class="m">10</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ nginx-meshctl top
</span></span><span class="line"><span class="cl">Deployment   Incoming Success  Outgoing Success  NumRequests
</span></span><span class="line"><span class="cl">gateway                        100.00%           <span class="m">10</span>
</span></span><span class="line"><span class="cl">target-v2-1  100.00%                             <span class="m">10</span></span></span></code></pre></div>
</div></li>
<li>
<p>Since target v2.1 is working as expected, we can delete v1.0 from the cluster. If v2.1 had started failing, we could have quickly rolled back to v1.0 just as we did earlier.</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a07ebd8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a07ebd8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f target-v1.0.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f target-v1.0.yaml</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="ab-testing-with-traffic-splits">A/B Testing with Traffic Splits  <a class="headerlink float-right" href="#ab-testing-with-traffic-splits" title="A/B Testing with Traffic Splits"><i class="fas fa-link fa-xs"></i></a>
</h3><p>If you want to implement A/B testing, you can create an HTTPRouteGroup resource and associate the HTTPRouteGroup with the traffic split.</p>
<p>Consider the following configuration:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a0a5508&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a0a5508">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">specs.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox-users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">headers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user-agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;.*Firefox.*&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">specs.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox-users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">headers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user-agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;.*Firefox.*&#34;</span></span></span></code></pre></div>
</div><p>The <a href="https://github.com/servicemeshinterface/smi-spec/blob/main/apis/traffic-specs/v1alpha3/traffic-specs.md#httproutegroup" target="_blank" rel="noopener">HTTPRouteGroup</a> is used to describe HTTP traffic. The <code>spec.matches</code> field defines a list of routes that an application can serve. Routes are made up of the following match conditions: pathRegex, headers, and HTTP methods.
In the <code>target-hrg</code> example above, we have defined one route, <code>firefox-users</code>, using the header filter <code>user-agent: &quot;.*Firefox.*&quot;</code>. Incoming HTTP traffic that has the <code>user-agent</code> header set to a value that matches the regex <code>&quot;.*Firefox.*&quot;</code> satisfies the <code>firefox-users</code> match condition.</p>
<blockquote class="tip">
  <div><strong>Tip:</strong><br/> A route with multiple match conditions (pathRegex, headers, and/or HTTP methods) within a single match represent an <code>AND</code> condition. This means that all match conditions must be satisfied for the traffic to match the route.</div>
</blockquote>

<p>To associate the <code>target-hrg</code> HTTPRouteGroup with the traffic split we need to add the <code>matches</code> field to our traffic split spec:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a0d5e60&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a0d5e60">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v3-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">split.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">TrafficSplit</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-ts</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">backends</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v2-1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">service</span><span class="p">:</span><span class="w"> </span><span class="l">target-v3-0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="m">100</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span></span></span></code></pre></div>
</div><p>Traffic split <code>matches</code> allow you to associate one or more <code>HTTPRouteGroups</code> with a traffic split.
The <code>matches</code> field in the traffic split spec maps the HTTPRouteGroup&rsquo;s <code>matches</code> directives to the traffic split. This means that the traffic split only applies if the request&rsquo;s attributes satisfy the match conditions outlined in the match directives.</p>
<p>If there are multiple HTTPRouteGroups listed in the traffic split <code>matches</code> field and/or multiple matches defined in the HTTPRouteGroup, the traffic split will be applied if the request satisfies any of the specified matches.</p>
<p>In this example, all traffic sent to the root Service <code>target-svc</code> that contains the string <code>Firefox</code> in the <code>user-agent</code> header will be routed to the <code>target-v2-1</code> backend. All other traffic will be sent to the root Service <code>target-svc</code>.</p>
<ol>
<li>
<p>To demonstrate how to A/B test with traffic splits, let&rsquo;s create a new version of the target application:</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a0f17c8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a0f17c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v3.0.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f target-v3.0.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> The target-v3-0 Pod and Service deploy successfully. At this point there should be three Pods and four Services running.</p>
<p>Example:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a126b58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a126b58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pods
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">gateway-58c6c76dd-4mmht         2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v2-1-6f69fc48f6-mzcf2    2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v3-0-5f6fc9cf99-tps6k    2/2     Running   <span class="m">0</span>          2m</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get pods
</span></span><span class="line"><span class="cl">NAME                            READY   STATUS    RESTARTS   AGE
</span></span><span class="line"><span class="cl">gateway-58c6c76dd-4mmht         2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v2-1-6f69fc48f6-mzcf2    2/2     Running   <span class="m">0</span>          2m
</span></span><span class="line"><span class="cl">target-v3-0-5f6fc9cf99-tps6k    2/2     Running   <span class="m">0</span>          2m</span></span></code></pre></div>
</div>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">bash</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a174d58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a174d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get svc
</span></span><span class="line"><span class="cl">NAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">gateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m
</span></span><span class="line"><span class="cl">target-svc    ClusterIP      10.0.0.3        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v2-1   ClusterIP      10.0.0.4        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v3-0   ClusterIP      10.0.0.5        &lt;none&gt;          80/TCP         2m</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">$ kubectl get svc
</span></span><span class="line"><span class="cl">NAME          TYPE           CLUSTER-IP      EXTERNAL-IP     PORT<span class="o">(</span>S<span class="o">)</span>        AGE
</span></span><span class="line"><span class="cl">gateway-svc   LoadBalancer   10.0.0.2        1.2.3.4         80:30975/TCP   2m
</span></span><span class="line"><span class="cl">target-svc    ClusterIP      10.0.0.3        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v2-1   ClusterIP      10.0.0.4        &lt;none&gt;          80/TCP         2m
</span></span><span class="line"><span class="cl">target-v3-0   ClusterIP      10.0.0.5        &lt;none&gt;          80/TCP         2m</span></span></code></pre></div>
</div><p>In the terminal window where you are generating traffic to the gateway Service you should still see all responses coming from the <code>target-v2-1</code> backend. You may need to restart the loop that generates traffic:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a1ebbb0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a1ebbb0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 300<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 300<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
</div></li>
<li>
<p>Create the <code>target-hrg</code> HTTPRouteGroup and update the traffic split:</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a203a80&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a203a80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit-matches.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl apply -f trafficsplit-matches.yaml</span></span></code></pre></div>
</div><p><strong>Expectation:</strong> The <code>target-hrg</code> HTTPRouteGroup is created and the <code>target-ts</code> traffic split is updated.</p>
<blockquote class="tip">
  <div><strong>Tip:</strong><br/> Use <code>kubectl get</code> and <code>kubectl describe</code> for <code>httproutegroups</code> and <code>trafficsplits</code> to make sure the resources were created or updated.</div>
</blockquote>

<p>In the terminal window where you are generating traffic to the gateway Service you should now see responses from both the <code>target-v2-1</code> and <code>target-v3</code> backends. To test the A/B traffic shaping, open another terminal window and generate traffic to the gateway Service with the header <code>user-agent: Firefox</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a22bb20&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a22bb20">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 100<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span> -H <span class="s2">&#34;user-agent:Firefox&#34;</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 100<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span> -H <span class="s2">&#34;user-agent:Firefox&#34;</span><span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
</div><p>Since the <code>user-agent</code> header is set to &ldquo;Firefox&rdquo;, you should see responses from the <code>target-v3-0</code> backend only.</p>
</li>
</ol>
<h3 
id="traffic-splitting-based-on-path-and-http-methods">Traffic Splitting based on path and HTTP methods  <a class="headerlink float-right" href="#traffic-splitting-based-on-path-and-http-methods" title="Traffic Splitting based on path and HTTP methods"><i class="fas fa-link fa-xs"></i></a>
</h3><p>In addition to supporting traffic splitting based on header filters, NGINX Service Mesh also supports traffic splitting based on path and HTTP methods. To demonstrate this let&rsquo;s update the <code>target-hrg</code> and add a new match.</p>
<ol>
<li>
<p>Edit the HTTPRouteGroup <code>target-hrg</code>:</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a2441c0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a2441c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit httproutegroup target-hrg</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl edit httproutegroup target-hrg</span></span></code></pre></div>
</div><p>Add the <code>get-api-requests</code> route to the list of matches:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a292b90&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f4a292b90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">specs.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox-users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">headers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user-agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;.*Firefox.*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">get-api-requests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pathRegex</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/api&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">methods</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">GET</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">specs.smi-spec.io/v1alpha3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">HTTPRouteGroup</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">target-hrg</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">matches</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">firefox-users</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">headers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">user-agent</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;.*Firefox.*&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">get-api-requests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">pathRegex</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/api&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">methods</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">GET</span></span></span></code></pre></div>
</div><p>Save and close the editor.</p>
<p>The <code>get-api-requests</code> route will match all GET requests to the <code>/api</code> endpoint. By adding this route to the <code>target-hrg</code> matches, the <code>target-ts</code> traffic split will now have both the <code>firefox-users</code> and <code>get-api-requests</code> matches applied to it. Since multiple matches are applied with an <code>OR</code> operator, if an incoming HTTP request to <code>target-svc</code> matches either <code>firefox-users</code> or <code>get-api-requests</code>, the traffic split will be applied, and the request will be routed to the <code>target-v3-0</code> backend Service.
All other incoming HTTP requests will be routed to the root <code>target-svc</code>, which will forward the request to one of the target services based on the load-balancing algorithm of the mesh.</p>
<p><strong>Expectations:</strong></p>
<ul>
<li>
<p>In the terminal window where requests to the gateway Service have the <code>user-agent:Firefox</code> header set, you should still see responses from the <code>target-v3-0</code> backend only.</p>
</li>
<li>
<p>To test the <code>get-api-requests</code> route, start a new for loop that sends GET requests to the <code>/api</code> endpoint:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a2bd728&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a2bd728">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 100<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span>/api<span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="k">for</span> i in <span class="k">$(</span>seq <span class="m">1</span> 100<span class="k">)</span><span class="p">;</span> <span class="k">do</span> curl <span class="nv">$GATEWAY_IP</span>/api<span class="p">;</span> sleep 1<span class="p">;</span> <span class="k">done</span></span></span></code></pre></div>
</div><p>You should only see responses from the <code>target-v3-0</code> backend. If you remove the <code>/api</code> path from the request you should see responses from both the <code>target-v2-1</code> and <code>target-v3-0</code> backends.</p>
</li>
</ul>
</li>
</ol>
<h2 
id="cleanup">Cleanup  <a class="headerlink float-right" href="#cleanup" title="Cleanup"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Delete all the resources from your cluster:</p>
<p><strong>Command:</strong></p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f4a2f0790&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f4a2f0790">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f gateway.yaml -f target-svc.yaml -f target-v2.1-successful.yaml -f target-v3.0.yaml -f trafficsplit-matches.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl delete -f gateway.yaml -f target-svc.yaml -f target-v2.1-successful.yaml -f target-v3.0.yaml -f trafficsplit-matches.yaml</span></span></code></pre></div>
</div><h2 
id="use-case">Use Case  <a class="headerlink float-right" href="#use-case" title="Use Case"><i class="fas fa-link fa-xs"></i></a>
</h2><p>An example use case for traffic splitting can be seen in <a href="https://www.nginx.com/blog/how-do-i-choose-api-gateway-vs-ingress-controller-vs-service-mesh/#East-West-API-Gateway-Use-Cases:-Use-a-Service-Mesh" target="_blank" rel="noopener">this blog</a>. The blog uses a self-referential TrafficSplit configuration in which the root service is also listed as a backend service. Even though the Service Mesh Interface specification mentions that self-referential configurations are invalid, NGINX Service Mesh supports this type of configuration due to its value in use cases like the example defined in the blog.</p>
<h2 
id="summary">Summary  <a class="headerlink float-right" href="#summary" title="Summary"><i class="fas fa-link fa-xs"></i></a>
</h2><p>These are just a couple examples of how you can use traffic splits for a deployment. Whether you want to do a gradual roll out of 5% increments or send 5% to two staging backends while 90% goes to production or any other combination of splits, traffic splits offer a convenient way to handle almost any deployment strategy you need.</p>
<h2 
id="resources">Resources  <a class="headerlink float-right" href="#resources" title="Resources"><i class="fas fa-link fa-xs"></i></a>
</h2><!-- vale off -->
<ul>
<li><a href="https://github.com/servicemeshinterface/smi-spec/blob/master/apis/traffic-split/v1alpha3/traffic-split.md#example-implementation" target="_blank" rel="noopener">SMI Traffic Split Example on GitHub</a></li>
</ul>
<!-- vale on -->

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/mesh/tutorials/trafficsplit-deployments.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/mesh/tutorials/trafficsplit-deployments.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=Deployments%20using%20Traffic%20Splitting&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		
		
		<li style="flex:1; text-align: left; white-space: nowrap;"><a href="http://localhost:1313/nginx-service-mesh/tutorials/deploy-example-app/" class="" title="Previous -- Deploy an Example App with NGINX Service Mesh "><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.378 46.5L1.94 25.06C1.80067 24.9209 1.69014 24.7556 1.61472 24.5738C1.53931 24.3919 1.50049 24.1969 1.50049 24C1.50049 23.8031 1.53931 23.6081 1.61472 23.4262C1.69014 23.2444 1.80067 23.0791 1.94 22.94L23.378 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M45.878 46.5L24.44 25.06C24.3007 24.9209 24.1901 24.7556 24.1147 24.5738C24.0393 24.3919 24.0005 24.1969 24.0005 24C24.0005 23.8031 24.0393 23.6081 24.1147 23.4262C24.1901 23.2444 24.3007 23.0791 24.44 22.94L45.878 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		

		
			<li style="flex:1; text-align: right; white-space: nowrap;"><a href="http://localhost:1313/nginx-service-mesh/tutorials/accesscontrol-walkthrough/" class="" title="Next -- Services using Access Control"><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24.622 1.5L46.06 22.94C46.1993 23.0791 46.3099 23.2444 46.3853 23.4262C46.4607 23.6081 46.4995 23.8031 46.4995 24C46.4995 24.1969 46.4607 24.3919 46.3853 24.5738C46.3099 24.7556 46.1993 24.9209 46.06 25.06L24.622 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.122 1.5L23.56 22.94C23.6993 23.0791 23.8099 23.2444 23.8853 23.4262C23.9607 23.6081 23.9995 23.8031 23.9995 24C23.9995 24.1969 23.9607 24.3919 23.8853 24.5738C23.8099 24.7556 23.6993 24.9209 23.56 25.06L2.122 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#before-you-begin">Before You Begin</a></li>
    <li><a href="#objectives">Objectives</a>
      <ul>
        <li><a href="#deploy-the-production-version-of-the-target-app">Deploy the Production Version of the Target App</a></li>
        <li><a href="#deploy-a-new-version-of-the-target-app-using-a-canary-deployment">Deploy a New Version of the Target App using a Canary Deployment</a></li>
        <li><a href="#deploy-a-new-version-of-the-target-app-using-a-blue-green-deployment">Deploy a New Version of the Target App using a Blue-Green Deployment</a></li>
        <li><a href="#ab-testing-with-traffic-splits">A/B Testing with Traffic Splits</a></li>
        <li><a href="#traffic-splitting-based-on-path-and-http-methods">Traffic Splitting based on path and HTTP methods</a></li>
      </ul>
    </li>
    <li><a href="#cleanup">Cleanup</a></li>
    <li><a href="#use-case">Use Case</a></li>
    <li><a href="#summary">Summary</a></li>
    <li><a href="#resources">Resources</a></li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          ©2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>©2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


