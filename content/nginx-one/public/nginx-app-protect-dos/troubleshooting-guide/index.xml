<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Troubleshooting Guide on DEV -- docs-nginx-com</title>
    <link>http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/</link>
    <description>Recent content in Troubleshooting Guide on DEV -- docs-nginx-com</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <atom:link href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>NGINX App Protect DoS Troubleshooting Guide</title>
      <link>http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/</guid>
      <description>&lt;h2 &#xA;id=&#34;overview&#34;&gt;Overview  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#overview&#34; title=&#34;Overview&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;This Troubleshooting Guide is intended to provide guidance to customers in the detection and correction of programming issues in F5 NGINX App Protect DoS. It may also be useful to IT.&lt;/p&gt;&#xA;&lt;h2 &#xA;id=&#34;resolving-known-problems&#34;&gt;Resolving Known Problems  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#resolving-known-problems&#34; title=&#34;Resolving Known Problems&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 &#xA;id=&#34;configuration&#34;&gt;Configuration  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#configuration&#34; title=&#34;Configuration&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;table class=&#34;table table-bordered table-striped table-responsive table-sm table-v1&#34;&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Problem&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Solution&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX is not running (ps -aux) &lt;br&gt;&lt;br&gt; Reloading NGINX fails&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Check the error log at &lt;code&gt;/var/log/nginx/error.log&lt;/code&gt;. &lt;br&gt; Fix the problem and re-run NGINX.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;No original source IP in logs&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;1. XFF is not configured (or not configured correctly) &lt;br&gt;2. External Load Balancer doesn&amp;rsquo;t forward XFF&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect DoS functionality is not as expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect DoS has several logs which can be used for troubleshooting. &lt;br&gt; Usually, it is best to look for any warning or error messages within the logs. &lt;br&gt; Refer to &lt;a href=&#34;http://localhost:1313/nginx-app-protect-dos/monitoring/types-of-logs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Logs Overview&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;Too many open files&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase number of file descriptors. &lt;br&gt; For example: &lt;code&gt;worker_rlimit_nofile 65535;&lt;/code&gt; in the main context of &lt;code&gt;nginx.conf&lt;/code&gt; file. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;worker_rlimit_nofile directive&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;setrlimit ... failed (Permission denied)&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase the limit using the following command as the root user:&lt;br&gt; &lt;code&gt;setsebool -P httpd_setrlimit 1;&lt;/code&gt; &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue 4: Too many files are open Error&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;More protected objects than expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;The &lt;code&gt;app_protect_dos_enable&lt;/code&gt; directive is inherited by all server and location blocks beneath it, each block will be a protected object. &lt;br&gt; Consider moving this directive from outer to inner block. &lt;br&gt; Refer to: &lt;a href=&#34;http://localhost:1313/nginx-app-protect-dos/directives-and-policy/learn-about-directives-and-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX App Protect DoS - Directives and Policy&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;No DOS protection for ngx_worker at idx X&lt;/code&gt; warning message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;There are more nginx processes than allowed. &lt;br&gt; Either decrease the number of nginx processes (ngx_processes directive in &lt;code&gt;nginx.conf&lt;/code&gt; file) or increase the number of supported workers for NGINX App Protect DoS using the flag &lt;code&gt;--max-workers NUM&lt;/code&gt; for &lt;code&gt;/usr/bin/adminstall&lt;/code&gt;.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;unknown directive &#39;app_protect_dos_xxx&#39;&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;App Protect DOS module is not loaded. Add this line to the main (global) context of nginx.conf: &lt;br&gt;  &lt;code&gt;load_module &amp;quot;/etc/nginx/modules/ngx_http_app_protect_dos_module.so&amp;quot;;&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX struggles handling a high rate of incoming connections&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Linux machine should be tuned for optimal performance. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/tuning-nginx/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tuning NGINX for Performance&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error in &lt;code&gt;adminstall&lt;/code&gt; process, such as &lt;code&gt;Failed to allocate&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Insufficient memory to allocate all the required resources. &lt;br&gt; Increase the &lt;code&gt;--memory&lt;/code&gt; size or decrease the number of nginx workers (&lt;code&gt;--max_workers&lt;/code&gt;) if not all of them are going to be in use. &lt;br&gt; Use the &lt;code&gt;--help&lt;/code&gt; flag for more info.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;&#xA;&#xA;&lt;div data-mf=&#34;true&#34; style=&#34;display: none;&#34; class=&#34;table-v2 table table-bordered table-striped table-responsive table-sm narrow&#34;&gt;&#xA;    &lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Problem&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Solution&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX is not running (ps -aux) &lt;br&gt;&lt;br&gt; Reloading NGINX fails&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Check the error log at &lt;code&gt;/var/log/nginx/error.log&lt;/code&gt;. &lt;br&gt; Fix the problem and re-run NGINX.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;No original source IP in logs&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;1. XFF is not configured (or not configured correctly) &lt;br&gt;2. External Load Balancer doesn&amp;rsquo;t forward XFF&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect DoS functionality is not as expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect DoS has several logs which can be used for troubleshooting. &lt;br&gt; Usually, it is best to look for any warning or error messages within the logs. &lt;br&gt; Refer to &lt;a href=&#34;http://localhost:1313/nginx-app-protect-dos/monitoring/types-of-logs/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Logs Overview&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;Too many open files&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase number of file descriptors. &lt;br&gt; For example: &lt;code&gt;worker_rlimit_nofile 65535;&lt;/code&gt; in the main context of &lt;code&gt;nginx.conf&lt;/code&gt; file. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;worker_rlimit_nofile directive&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;setrlimit ... failed (Permission denied)&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase the limit using the following command as the root user:&lt;br&gt; &lt;code&gt;setsebool -P httpd_setrlimit 1;&lt;/code&gt; &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue 4: Too many files are open Error&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;More protected objects than expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;The &lt;code&gt;app_protect_dos_enable&lt;/code&gt; directive is inherited by all server and location blocks beneath it, each block will be a protected object. &lt;br&gt; Consider moving this directive from outer to inner block. &lt;br&gt; Refer to: &lt;a href=&#34;http://localhost:1313/nginx-app-protect-dos/directives-and-policy/learn-about-directives-and-policy/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX App Protect DoS - Directives and Policy&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;No DOS protection for ngx_worker at idx X&lt;/code&gt; warning message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;There are more nginx processes than allowed. &lt;br&gt; Either decrease the number of nginx processes (ngx_processes directive in &lt;code&gt;nginx.conf&lt;/code&gt; file) or increase the number of supported workers for NGINX App Protect DoS using the flag &lt;code&gt;--max-workers NUM&lt;/code&gt; for &lt;code&gt;/usr/bin/adminstall&lt;/code&gt;.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;unknown directive &#39;app_protect_dos_xxx&#39;&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;App Protect DOS module is not loaded. Add this line to the main (global) context of nginx.conf: &lt;br&gt;  &lt;code&gt;load_module &amp;quot;/etc/nginx/modules/ngx_http_app_protect_dos_module.so&amp;quot;;&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX struggles handling a high rate of incoming connections&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Linux machine should be tuned for optimal performance. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/tuning-nginx/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tuning NGINX for Performance&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error in &lt;code&gt;adminstall&lt;/code&gt; process, such as &lt;code&gt;Failed to allocate&lt;/code&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Insufficient memory to allocate all the required resources. &lt;br&gt; Increase the &lt;code&gt;--memory&lt;/code&gt; size or decrease the number of nginx workers (&lt;code&gt;--max_workers&lt;/code&gt;) if not all of them are going to be in use. &lt;br&gt; Use the &lt;code&gt;--help&lt;/code&gt; flag for more info.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&lt;/div&gt;&#xA;&lt;h3 &#xA;id=&#34;elk-issues&#34;&gt;ELK issues  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#elk-issues&#34; title=&#34;ELK issues&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&lt;p&gt;ELK issues are addressed directly in GitHub by posting the issue to Kibana dashboards for &lt;a href=&#34;https://github.com/f5devcentral/nap-dos-elk-dashboards&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;NGINX App Protect DoS GitHub repo&lt;/a&gt;.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
