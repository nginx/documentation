<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>NGINX App Protect DoS Deployment | DEV -- docs-nginx-com</title>


<meta name="description" content="Learn about F5 NGINX App Protect DoS Deployment.">





<link rel="canonical" href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/learn-about-deployment/">







<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="Learn about F5 NGINX App Protect DoS Deployment." />
<meta name="twitter:title" content="NGINX App Protect DoS Deployment" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="25/04/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-dos/">F5 NGINX App Protect DoS</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-dos/deployment-guide/">Deployment Guide</a><i class="fas fa-chevron-right"></i></li>
                
            
                NGINX App Protect DoS Deployment
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx-app-protect-dos/deployment-guide/learn-about-deployment/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx-app-protect-dos/" alt="F5 NGINX App Protect DoS"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-App-Protect-DoS-product-icon.svg"
                        alt="F5 NGINX App Protect DoS">
                    F5 NGINX App Protect DoS</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-dos/deployment-guide/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-dos--deployment-guide" aria-controls="nap-dos--deployment-guide">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Deployment Guide</a>
                            </li>
                        </div>
                        <div id="nap-dos--deployment-guide" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/deployment-guide/learn-about-deployment/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/learn-about-deployment/">NGINX App Protect DoS Deployment</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services/">NGINX App Protect WAF &#43; DoS AMIs on Amazon EC2</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-dos/directives-and-policy/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-dos--directives-and-policy" aria-controls="nap-dos--directives-and-policy">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Directives and Policy</a>
                            </li>
                        </div>
                        <div id="nap-dos--directives-and-policy" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/directives-and-policy/learn-about-directives-and-policy/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/directives-and-policy/learn-about-directives-and-policy/">NGINX App Protect DoS Directives and Policy</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-dos/monitoring/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-dos--monitoring" aria-controls="nap-dos--monitoring">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Monitoring</a>
                            </li>
                        </div>
                        <div id="nap-dos--monitoring" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/monitoring/types-of-logs/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/monitoring/types-of-logs/">NGINX App Protect DoS Logs Overview</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/monitoring/live-activity-monitoring/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/monitoring/live-activity-monitoring/">NGINX App Protect DoS Live Activity Monitoring</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/monitoring/security-log/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/monitoring/security-log/">NGINX App Protect DoS Security Log</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/monitoring/access-log/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/monitoring/access-log/">NGINX App Protect DoS Access Log Request Mechanism</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/monitoring/operation-log/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/monitoring/operation-log/">NGINX App Protect DoS Operation Log</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-dos/troubleshooting-guide/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-dos--troubleshooting-guide" aria-controls="nap-dos--troubleshooting-guide">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Troubleshooting Guide</a>
                            </li>
                        </div>
                        <div id="nap-dos--troubleshooting-guide" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/">NGINX App Protect DoS Troubleshooting Guide</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-dos/releases/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-dos--releases" aria-controls="nap-dos--releases">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Releases</a>
                            </li>
                        </div>
                        <div id="nap-dos--releases" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.6/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.6/">NGINX App Protect DoS 4.6</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-1.2.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.2.0/">NGINX App Protect DoS Arbitrator 1.2.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.5/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.5/">NGINX App Protect DoS 4.5</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.4/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.4/">NGINX App Protect DoS 4.4</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.3/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.3/">NGINX App Protect DoS 4.3</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.2/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.2/">NGINX App Protect DoS 4.2</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.1/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.1/">NGINX App Protect DoS 4.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-1.1.1/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.1.1/">NGINX App Protect DoS Arbitrator 1.1.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-4.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.0/">NGINX App Protect DoS 4.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-3.1/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-3.1/">NGINX App Protect DoS 3.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-3.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-3.0/">NGINX App Protect DoS 3.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-2.4/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.4/">NGINX App Protect DoS 2.4</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-2.3/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.3/">NGINX App Protect DoS 2.3</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-2.2/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.2/">NGINX App Protect DoS 2.2</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-2.1/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.1/">NGINX App Protect DoS 2.1</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-2.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.0/">NGINX App Protect DoS 2.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-1.1.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.1.0/">NGINX App Protect DoS Arbitrator 1.1.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                                
                                    
                                    <ul class="sidebar-reg-padding">
                                        <div class="accordion" id="accordion2">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-dos/releases/about-1.0/"
                                                                href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.0/">NGINX App Protect 1.0</a>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </ul>
                                    
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name">NGINX App Protect DoS</div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-bb05dd6e4ddf4f22e1dacc04329b3f0e" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-bb05dd6e4ddf4f22e1dacc04329b3f0e" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Deployment Guide 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/learn-about-deployment/" style="font-weight: bold;">NGINX App Protect DoS Deployment </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#platform-security-considerations">Platform Security Considerations</a></li>
    <li><a href="#centos-74-installation">CentOS 7.4+ Installation</a></li>
    <li><a href="#rhel-74-installation">RHEL 7.4+ Installation</a></li>
    <li><a href="#rhel-8--rocky-linux-8-installation">RHEL 8+ / Rocky Linux 8 Installation</a></li>
    <li><a href="#rhel-9-installation">RHEL 9+ Installation</a></li>
    <li><a href="#debian--ubuntu-installation">Debian / Ubuntu Installation</a></li>
    <li><a href="#alpine-315x--317x--319x-installation">Alpine 3.15.x / 3.17.x / 3.19.x Installation</a></li>
    <li><a href="#amazon-linux-2023-installation">Amazon Linux 2023 Installation</a></li>
    <li><a href="#docker-deployment">Docker Deployment</a>
      <ul>
        <li><a href="#docker-deployment-instructions">Docker Deployment Instructions</a></li>
        <li><a href="#centos-74-docker-deployment-example">CentOS 7.4 Docker Deployment Example</a></li>
        <li><a href="#ubi7-docker-deployment-example">UBI7 Docker Deployment Example</a></li>
        <li><a href="#rhel-8--rocky-linux-8-docker-deployment-example">RHEL 8 / Rocky Linux 8 Docker Deployment Example</a></li>
        <li><a href="#rhel-9-docker-deployment-example">RHEL 9 Docker Deployment Example</a></li>
        <li><a href="#debian-10-buster--debian-11-bullseye--debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye) / Debian 12 (Bookworm) Docker Deployment Example</a></li>
        <li><a href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble-docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble) Docker Deployment Example</a></li>
        <li><a href="#alpine-docker-deployment-example">Alpine Docker Deployment Example</a></li>
        <li><a href="#amazonlinux-2023-docker-deployment-example">AmazonLinux 2023 Docker Deployment Example</a></li>
      </ul>
    </li>
    <li><a href="#docker-deployment-with-nginx-app-protect">Docker Deployment with NGINX App Protect</a>
      <ul>
        <li><a href="#docker-deployment-instructions-1">Docker Deployment Instructions</a></li>
        <li><a href="#centos-74-docker-deployment-example-1">Centos 7.4 Docker Deployment Example</a></li>
        <li><a href="#rhel-74-docker-deployment-example">RHEL 7.4 Docker Deployment Example</a></li>
        <li><a href="#debian-10-buster--debian-11-bullseye---debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye)  / Debian 12 (Bookworm) Docker Deployment Example</a></li>
        <li><a href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble--docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble)  Docker Deployment Example</a></li>
      </ul>
    </li>
    <li><a href="#nginx-app-protect-dos-arbitrator">NGINX App Protect DoS Arbitrator</a>
      <ul>
        <li><a href="#overview-1">Overview</a></li>
        <li><a href="#why-nginx-app-protect-dos-arbitrator-is-necessary">Why NGINX App Protect DoS Arbitrator is Necessary</a></li>
        <li><a href="#nginx-app-protect-dos-arbitrator-deployment">NGINX App Protect DoS Arbitrator Deployment</a></li>
        <li><a href="#multi-vm-deployment">Multi-VM Deployment</a></li>
      </ul>
    </li>
    <li><a href="#post-installation-checks">Post-Installation Checks</a>
      <ul>
        <li><a href="#compatibility-with-nginx-plus-releases">Compatibility with NGINX Plus Releases</a></li>
      </ul>
    </li>
    <li><a href="#upgrading-app-protect-dos">Upgrading App Protect DoS</a></li>
    <li><a href="#selinux">SELinux</a>
      <ul>
        <li><a href="#modifying-file-labels">Modifying File Labels</a></li>
        <li><a href="#syslog-to-custom-port">Syslog to Custom Port</a></li>
        <li><a href="#kubernetes-deployment-examples">Kubernetes Deployment Examples</a></li>
      </ul>
    </li>
    <li><a href="#app-protect-dos-ebpf-manager">App Protect DoS eBPF manager</a>
      <ul>
        <li><a href="#overview-2">Overview</a></li>
        <li><a href="#cli-options-for-flexible-configuration">CLI Options for Flexible Configuration</a></li>
      </ul>
    </li>
  </ul>
</nav>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services/" style="">NGINX App Protect WAF &#43; DoS AMIs on Amazon EC2 </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-d105093aff487b4ad26b216f671385cc" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-d105093aff487b4ad26b216f671385cc" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Directives and Policy 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/directives-and-policy/learn-about-directives-and-policy/" style="">NGINX App Protect DoS Directives and Policy </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-8109714a0ef8a6b3add865e2b8808038" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-8109714a0ef8a6b3add865e2b8808038" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Monitoring 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/monitoring/types-of-logs/" style="">NGINX App Protect DoS Logs Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/monitoring/live-activity-monitoring/" style="">NGINX App Protect DoS Live Activity Monitoring </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/monitoring/security-log/" style="">NGINX App Protect DoS Security Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/monitoring/access-log/" style="">NGINX App Protect DoS Access Log Request Mechanism </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/monitoring/operation-log/" style="">NGINX App Protect DoS Operation Log </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-98c0dacb8900b200ffba95b2dcadc2ab" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-98c0dacb8900b200ffba95b2dcadc2ab" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Troubleshooting Guide 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/" style="">NGINX App Protect DoS Troubleshooting Guide </a>
            
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-92a77a520c2734c2579833949be71871" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-92a77a520c2734c2579833949be71871" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Releases 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.6/" style="">NGINX App Protect DoS 4.6 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.2.0/" style="">NGINX App Protect DoS Arbitrator 1.2.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.5/" style="">NGINX App Protect DoS 4.5 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.4/" style="">NGINX App Protect DoS 4.4 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.3/" style="">NGINX App Protect DoS 4.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.2/" style="">NGINX App Protect DoS 4.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.1/" style="">NGINX App Protect DoS 4.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.1.1/" style="">NGINX App Protect DoS Arbitrator 1.1.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-4.0/" style="">NGINX App Protect DoS 4.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-3.1/" style="">NGINX App Protect DoS 3.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-3.0/" style="">NGINX App Protect DoS 3.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.4/" style="">NGINX App Protect DoS 2.4 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.3/" style="">NGINX App Protect DoS 2.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.2/" style="">NGINX App Protect DoS 2.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.1/" style="">NGINX App Protect DoS 2.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-2.0/" style="">NGINX App Protect DoS 2.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.1.0/" style="">NGINX App Protect DoS Arbitrator 1.1.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-dos/releases/about-1.0/" style="">NGINX App Protect 1.0 </a>
            
        
    </li>
    
</ul>
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-dos/">F5 NGINX App Protect DoS</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-dos/deployment-guide/">Deployment Guide</a><i class="fas fa-chevron-right"></i></li>
                
            
                NGINX App Protect DoS Deployment
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>NGINX App Protect DoS Deployment</h1>
        <h2 
id="overview">Overview  <a class="headerlink float-right" href="#overview" title="Overview"><i class="fas fa-link fa-xs"></i></a>
</h2><p>F5 NGINX App Protect DoS provides behavioral protection against DoS for your web applications. <br><br>
This guide explains how to deploy NGINX App Protect DoS as well as upgrade App Protect DoS.</p>
<h2 
id="prerequisites">Prerequisites  <a class="headerlink float-right" href="#prerequisites" title="Prerequisites"><i class="fas fa-link fa-xs"></i></a>
</h2><p>NGINX App Protect DoS is available to the customers as a downloadable dynamic module at an additional cost. To purchase or add NGINX App Protect DoS to an existing NGINX Plus subscription, contact the NGINX sales team.</p>
<p>NGINX Plus Release 24 and later supports NGINX App Protect DoS.</p>
<p>NGINX App Protect DoS supports the following operating systems:</p>
<ul>
<li><a href="#centos-74-installation">CentOS 7.4.x and above</a> (Deprecated starting from NGINX Plus R33)</li>
<li><a href="#rhel-74-installation">RHEL 7.4.x and above</a> (Deprecated starting from NGINX Plus R33)</li>
<li><a href="#rhel-8--rocky-linux-8-installation">RHEL 8.1.x / Rocky Linux 8 and above</a></li>
<li><a href="#rhel-9-installation">RHEL 9 and above</a></li>
<li><a href="#debian--ubuntu-installation">Debian 10 (Buster)</a> - (Deprecated starting from NGINX Plus R28)</li>
<li><a href="#debian--ubuntu-installation">Debian 11 (Bullseye)</a></li>
<li><a href="#debian--ubuntu-installation">Debian 12 (Bookworm)</a></li>
<li><a href="#debian--ubuntu-installation">Ubuntu 18.04 (Bionic)</a> - (Deprecated starting from NGINX Plus R30)</li>
<li><a href="#debian--ubuntu-installation">Ubuntu 20.04 (Focal)</a></li>
<li><a href="#debian--ubuntu-installation">Ubuntu 22.04 (Jammy)</a></li>
<li><a href="#debian--ubuntu-installation">Ubuntu 24.04 (Noble)</a></li>
<li><a href="#alpine-315x--317x--319x-installation">Alpine 3.15</a> - (Deprecated starting from NGINX Plus R30)</li>
<li><a href="#alpine-315x--317x--319x-installation">Alpine 3.17</a> - (Deprecated starting from NGINX Plus R34)</li>
<li><a href="#alpine-315x--317x--319x-installation">Alpine 3.19</a></li>
<li><a href="#amazonlinux-linux-2023-installation">AmazonLinux 2023</a></li>
</ul>
<p>The NGINX App Protect DoS package has the following dependencies:</p>
<ol>
<li><strong>nginx-plus-module-appprotectdos</strong> - NGINX Plus dynamic module for App Protect DoS</li>
<li><strong>libcurl</strong> - Software library for HTTP access</li>
<li><strong>zeromq4</strong> - Software library for fast, message-based applications</li>
<li><strong>boost</strong> - The free peer-reviewed portable C++ source libraries</li>
<li><strong>openssl</strong> - Toolkit for the Transport Layer Security (TLS) and Secure Sockets Layer (SSL) protocol</li>
<li><strong>libelf</strong> - Software library for ELF access</li>
</ol>
<p>See the NGINX Plus full list of prerequisites for more details. NGINX App Protect DoS can be installed as a module to an existing NGINX Plus installation or as a complete NGINX Plus with App Protect DoS installation in a clean environment or to a system with NGINX App Protect WAF.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> <ul>
<li>gRPC, HTTP/2 and WebSocket protection require active monitoring of the protected service. The directive <code>app_protect_dos_monitor</code> is mandatory for the attack to be detected.</li>
<li>TLS fingerprint feature is not used in CentOS 7.4 and RHEL 7 / UBI 7 due to the old OpenSSL version. The required OpenSSL version is 1.1.1 or higher.</li>
<li>Monitor directive <code>app_protect_dos_monitor</code> with proxy_protocol parameter can not be configured on Ubuntu 18.04. As a result, gRPC and HTTP/2 DoS protection for proxy_protocol configuration is not supported.</li>
<li>Regularly update the Operating System (OS) to avoid known OS vulnerabilities which may impact the service.</li>
</ul>
</div>
</blockquote>

<h2 
id="platform-security-considerations">Platform Security Considerations  <a class="headerlink float-right" href="#platform-security-considerations" title="Platform Security Considerations"><i class="fas fa-link fa-xs"></i></a>
</h2><p>When deploying App Protect DoS on NGINX Plus take the following precautions to secure the platform. This avoids the risk of causing a Denial of Service condition or compromising the platform security.</p>
<ul>
<li>Restrict permissions to the files on the NGINX App Protect DoS platform to user <strong>nginx</strong> and group <strong>nginx</strong>, especially for the sensitive areas containing the configuration.</li>
<li>Remove unnecessary remote access services on the platform.</li>
<li>Configure a Syslog destination on the same machine as App Protect DoS and proxy to an external destination. This avoids eavesdropping and <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener">man-in-the-middle</a> attacks on the Syslog channel.</li>
</ul>
<h2 
id="centos-74-installation">CentOS 7.4+ Installation  <a class="headerlink float-right" href="#centos-74-installation" title="CentOS 7.4&#43; Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><blockquote class="note">
  <div><strong>Note:</strong><br/> CentOS 7.4 and RHEL 7.4 are deprecated as of NGINX Plus Release 32 (R32) and are not supported in Release 33 (R33) or later. For the list of supported distributions, refer to the <a href="/nginx/technical-specs/">NGINX Plus Tech Specs</a>.</div>
</blockquote>

<ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5066c008&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5066c008">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <code>/etc/ssl/nginx/</code> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f506be088&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f506be088">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div></li>
<li>
<p>Log in to the NGINX <a href="https://my.f5.com" target="_blank" rel="noopener">Customer Portal</a> and download the following two files:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f506fe7c8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f506fe7c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
</div></li>
<li>
<p>Copy the above two files to the CentOS server’s <code>/etc/ssl/nginx/</code> directory. Use an SCP client or another secure file transfer tool to perform this task.</p>
</li>
<li>
<p>Install prerequisite packages:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f50749ae8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f50749ae8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install ca-certificates epel-release wget</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install ca-certificates epel-release wget</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus and NGINX App Protect DoS repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f507ab950&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f507ab950">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo</span></span></code></pre></div>
</div></li>
<li>
<p>In case of fresh installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5081d5a0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5081d5a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos</span></span></code></pre></div>
</div><p>Alternatively, you can use the following command to list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5087b588&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5087b588">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum --showduplicates list app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum --showduplicates list app-protect-dos</span></span></code></pre></div>
</div><p>Then, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f508c4198&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f508c4198">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos-27+2.4.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos-27+2.4.0</span></span></code></pre></div>
</div></li>
<li>
<p>In case of upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f509401f8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f509401f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove nginx-plus
</span></span><span class="line"><span class="cl">sudo yum install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove nginx-plus
</span></span><span class="line"><span class="cl">sudo yum install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> Make sure to restore configuration from <code>/etc/nginx-plus-backup</code> back to <code>/etc/nginx-plus</code>.</div>
</blockquote>

</li>
<li>
<p>Check the NGINX binary version to ensure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f50964418&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f50964418">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the NGINX App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f50999b90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f50999b90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f509e3b28&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f509e3b28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS on an <code>http/server/location</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f50deaf28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f50deaf28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the SELinux to allow NGINX App Protect DoS:</p>
<p>a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51029e60&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51029e60">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file created above:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f512a90f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f512a90f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f513147b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f513147b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te
</span></span><span class="line"><span class="cl">sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod
</span></span><span class="line"><span class="cl">sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te
</span></span><span class="line"><span class="cl">sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod
</span></span><span class="line"><span class="cl">sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>If you encounter any issues, refer to the <a href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/">Troubleshooting Guide</a>.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Additional SELinux configuration may be required to allow NGINX Plus to listen on specific network ports, connect to upstreams, and send syslog entries to remote systems. Refer to the practices outlined in the <a href="https://www.nginx.com/blog/using-nginx-plus-with-selinux/" target="_blank" rel="noopener">Using NGINX and NGINX Plus with SELinux</a> article for details.</div>
</blockquote>

</li>
<li>
<p>To enable the NGINX/App-Protect-DoS service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5134be68&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5134be68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51362d98&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51362d98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="rhel-74-installation">RHEL 7.4+ Installation  <a class="headerlink float-right" href="#rhel-74-installation" title="RHEL 7.4&#43; Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><blockquote class="note">
  <div><strong>Note:</strong><br/> CentOS 7.4 and RHEL 7.4 are deprecated as of NGINX Plus Release 32 (R32) and are not supported in Release 33 (R33) or later. For the list of supported distributions, refer to the <a href="/nginx/technical-specs/">NGINX Plus Tech Specs</a>.</div>
</blockquote>

<ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51382580&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51382580">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <code>/etc/ssl/nginx/</code> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5139a450&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5139a450">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div></li>
<li>
<p>Log in to the NGINX <a href="https://my.f5.com" target="_blank" rel="noopener">Customer Portal</a> and download the following two files:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f513d4218&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f513d4218">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
</div></li>
<li>
<p>Copy the above two files to the CentOS server’s <code>/etc/ssl/nginx/</code> directory. Use an SCP client or another secure file transfer tool to perform this task.</p>
</li>
<li>
<p>Install prerequisite packages:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f513f7498&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f513f7498">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install ca-certificates wget</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install ca-certificates wget</span></span></code></pre></div>
</div></li>
<li>
<p>Enable Yum repositories to pull App Protect DoS dependencies:</p>
<p>If you have a RHEL subscription:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f514200f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f514200f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> sudo subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                 --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                 --enable rhel-ha-for-rhel-*-server-rpms
</span></span><span class="line"><span class="cl"> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> sudo subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                 --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                                 --enable rhel-ha-for-rhel-*-server-rpms
</span></span><span class="line"><span class="cl"> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</span></span></code></pre></div>
</div><p>If you don’t have a RHEL subscription, you can pull the dependencies from the CentOS repository: Create a new repository centos.repo in <code>/etc/yum.repos.d/</code> with the content:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5148abf8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5148abf8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>centos<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>CentOS-7
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://ftp.heanet.ie/pub/centos/7/os/x86_64/
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>http://ftp.heanet.ie/pub/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7
</span></span><span class="line"><span class="cl"><span class="o">[</span>epel<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>epel packages <span class="k">for</span> CentOS/RHEL <span class="m">7</span>
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>https://dl.fedoraproject.org/pub/epel/7/x86_64
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
</span></span><span class="line"><span class="cl"><span class="o">[</span>extras<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>extras packages <span class="k">for</span> CentOS/RHEL <span class="m">7</span>
</span></span><span class="line"><span class="cl"><span class="nv">mirrorlist</span><span class="o">=</span>http://mirrorlist.centos.org/?release<span class="o">=</span>7<span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span>x86_64<span class="p">&amp;</span><span class="nv">repo</span><span class="o">=</span>extras
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="o">[</span>centos<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>CentOS-7
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>http://ftp.heanet.ie/pub/centos/7/os/x86_64/
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>http://ftp.heanet.ie/pub/centos/7/os/x86_64/RPM-GPG-KEY-CentOS-7
</span></span><span class="line"><span class="cl"><span class="o">[</span>epel<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>epel packages <span class="k">for</span> CentOS/RHEL <span class="m">7</span>
</span></span><span class="line"><span class="cl"><span class="nv">baseurl</span><span class="o">=</span>https://dl.fedoraproject.org/pub/epel/7/x86_64
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>https://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7
</span></span><span class="line"><span class="cl"><span class="o">[</span>extras<span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nv">name</span><span class="o">=</span>extras packages <span class="k">for</span> CentOS/RHEL <span class="m">7</span>
</span></span><span class="line"><span class="cl"><span class="nv">mirrorlist</span><span class="o">=</span>http://mirrorlist.centos.org/?release<span class="o">=</span>7<span class="p">&amp;</span><span class="nv">arch</span><span class="o">=</span>x86_64<span class="p">&amp;</span><span class="nv">repo</span><span class="o">=</span>extras
</span></span><span class="line"><span class="cl"><span class="nv">enabled</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgcheck</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="nv">gpgkey</span><span class="o">=</span>http://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus and NGINX App Protect DoS repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f514abb50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f514abb50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo</span></span></code></pre></div>
</div></li>
<li>
<p>In case of fresh installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f514c1ae0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f514c1ae0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos</span></span></code></pre></div>
</div><p>Alternatively, you can use the following command to list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f514d99b0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f514d99b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum --showduplicates list app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum --showduplicates list app-protect-dos</span></span></code></pre></div>
</div><p>Then, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f514f08e0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f514f08e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos-27+2.4.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum install app-protect-dos-27+2.4.0</span></span></code></pre></div>
</div></li>
<li>
<p>In case of upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5151b090&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5151b090">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove nginx-plus
</span></span><span class="line"><span class="cl">sudo yum install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo yum remove nginx-plus
</span></span><span class="line"><span class="cl">sudo yum install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> Make sure to restore configuration from <code>/etc/nginx-plus-backup</code> back to <code>/etc/nginx-plus</code>.</div>
</blockquote>

</li>
<li>
<p>Check the NGINX binary version to ensure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51531fc0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51531fc0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f515440d0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f515440d0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51555628&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51555628">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS on an <code>http/server/location</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51570f90&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51570f90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the SELinux to allow NGINX App Protect DoS:</p>
<p>a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51582cb8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51582cb8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file created above:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51612598&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51612598">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5163fc28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5163fc28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>If you encounter any issues, refer to the <a href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/">Troubleshooting Guide</a>.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Additional SELinux configuration may be required to allow NGINX Plus to listen on specific network ports, connect to upstreams, and send syslog entries to remote systems. Refer to the practices outlined in the <a href="https://www.nginx.com/blog/using-nginx-plus-with-selinux/" target="_blank" rel="noopener">Using NGINX and NGINX Plus with SELinux</a> article for details.</div>
</blockquote>

</li>
<li>
<p>To enable the NGINX/App-Protect-DoS service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51656388&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51656388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5166aba8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5166aba8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="rhel-8--rocky-linux-8-installation">RHEL 8+ / Rocky Linux 8 Installation  <a class="headerlink float-right" href="#rhel-8--rocky-linux-8-installation" title="RHEL 8&#43; / Rocky Linux 8 Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5168d658&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5168d658">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <strong>/etc/ssl/nginx</strong> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53359778&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53359778">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div>
</li>
<li>
<p>Create the <strong>/etc/nginx/</strong> directory for the JWT license file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53380878&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53380878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
</div>
</li>
<li>
<p>Download the SSL certificate, private key, and the JWT license file associated with your NGINX Plus subscription from the MyF5 Customer Portal:</p>
<ul>
<li>Log in to <a href="https://my.f5.com/manage/s/" target="_blank" rel="noopener">MyF5</a>.</li>
<li>Go to <strong>My Products &amp; Plans &gt; Subscriptions</strong> to see your active subscriptions.</li>
<li>Find your NGINX products or services subscription, and select the <strong>Subscription ID</strong> for details.</li>
<li>Download the <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong> from the subscription page.</li>
<li>Download the <strong>JSON Web Token</strong> (JWT) from the subscription page.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Starting from <a href="http://localhost:1313/nginx/releases/#r33" target="_blank" rel="noopener">NGINX Plus Release 33</a>, a JWT file is required for each NGINX Plus instance. For more information, see <a href="http://localhost:1313/solutions/about-subscription-licenses/" target="_blank" rel="noopener">About Subscription Licenses</a>.</div>
</blockquote>


</li>
<li>
<p>Copy the downloaded <strong>.crt</strong> and <strong>.key</strong> files to the <strong>/etc/ssl/nginx/</strong> directory and make sure they are named <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f534143c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f534143c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
</div>
</li>
<li>
<p>Copy the downloaded JWT file to the <strong>/etc/nginx/</strong> directory and make sure it is named <strong>license.jwt</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5343f340&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5343f340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
</div>
</li>
<li>
<p>Install prerequisite packages:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f516a4d58&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f516a4d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
</div></li>
<li>
<p>Enable Yum repositories to pull NGINX App Protect DoS dependencies:</p>
<p>If you have a RHEL subscription:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f516ca6e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f516ca6e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-baseos-rpms
</span></span><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-appstream-rpms
</span></span><span class="line"><span class="cl">sudo dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-baseos-rpms
</span></span><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-appstream-rpms
</span></span><span class="line"><span class="cl">sudo dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus and NGINX App Protect DoS repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f516e73d8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f516e73d8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-8.repo</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-8.repo</span></span></code></pre></div>
</div></li>
<li>
<p>In case of fresh installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f516fbfe0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f516fbfe0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature (RHEL 8.6+):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51710be8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51710be8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature (RHEL 8.6+):</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> run with root privileges.</li>
</ul></div>
</blockquote>

<p>Alternatively, you can use the following command to list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51725408&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51725408">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
</div><p>Then, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f517388a0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f517388a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-27+2.4.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-27+2.4.0</span></span></code></pre></div>
</div></li>
<li>
<p>In case of upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51759be0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51759be0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> Make sure to restore configuration from <code>/etc/nginx-plus-backup</code> back to <code>/etc/nginx-plus</code>.</div>
</blockquote>

</li>
<li>
<p>Check the <code>nginx</code> version to verify that NGINX Plus is installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53481da8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53481da8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx -v</span></span></code></pre></div>
</div>
</li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5176bcf0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5176bcf0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5177bec0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5177bec0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS in an <code>http/server/location</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51798f98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51798f98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable the L4 accelerated mitigation feature (RHEL 8.6+) in an <code>http</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f517ab0a8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f517ab0a8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the SELinux to allow App Protect DoS:</p>
<p>a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f517bcdd0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f517bcdd0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file that you have created:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5185d050&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5185d050">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51887fd0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51887fd0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature:</p>
<p>a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51898d58&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51898d58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos-ebpf-manager.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos-ebpf-manager.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file you have created:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f518e7b10&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f518e7b10">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos-ebpf-manager 1.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">    require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> root_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class unix_stream_socket connectto<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t root_t:sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:unix_stream_socket connectto<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos-ebpf-manager 1.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">    require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> root_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class unix_stream_socket connectto<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t root_t:sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:unix_stream_socket connectto<span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51911320&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51911320">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos-ebpf-manager.mod app-protect-dos-ebpf-manager.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos-ebpf-manager.pp -m app-protect-dos-ebpf-manager.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos-ebpf-manager.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos-ebpf-manager.mod app-protect-dos-ebpf-manager.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos-ebpf-manager.pp -m app-protect-dos-ebpf-manager.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos-ebpf-manager.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>If you encounter any issues, refer to the <a href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/">Troubleshooting Guide</a>.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Additional SELinux configuration may be required to allow NGINX Plus to listen on specific network ports, connect to upstreams, and send syslog entries to remote systems. Refer to the practices outlined in the <a href="https://www.nginx.com/blog/using-nginx-plus-with-selinux/" target="_blank" rel="noopener">Using NGINX and NGINX Plus with SELinux</a> article for details.</div>
</blockquote>

</li>
<li>
<p>To enable the NGINX/App-Protect-DoS service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51927e68&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51927e68">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51940120&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51940120">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
<li>
<p>L4 mitigation</p>
<p>To enable the <code>app-protect-dos-ebpf-manager</code> service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51953d88&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51953d88">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div><p>Start the <code>app-protect-dos-ebpf-manager</code> service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5196b0a0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5196b0a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="rhel-9-installation">RHEL 9+ Installation  <a class="headerlink float-right" href="#rhel-9-installation" title="RHEL 9&#43; Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>If you already have NGINX packages on your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5198b828&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5198b828">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <strong>/etc/ssl/nginx</strong> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53359778&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53359778">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div>
</li>
<li>
<p>Create the <strong>/etc/nginx/</strong> directory for the JWT license file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53380878&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53380878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
</div>
</li>
<li>
<p>Download the SSL certificate, private key, and the JWT license file associated with your NGINX Plus subscription from the MyF5 Customer Portal:</p>
<ul>
<li>Log in to <a href="https://my.f5.com/manage/s/" target="_blank" rel="noopener">MyF5</a>.</li>
<li>Go to <strong>My Products &amp; Plans &gt; Subscriptions</strong> to see your active subscriptions.</li>
<li>Find your NGINX products or services subscription, and select the <strong>Subscription ID</strong> for details.</li>
<li>Download the <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong> from the subscription page.</li>
<li>Download the <strong>JSON Web Token</strong> (JWT) from the subscription page.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Starting from <a href="http://localhost:1313/nginx/releases/#r33" target="_blank" rel="noopener">NGINX Plus Release 33</a>, a JWT file is required for each NGINX Plus instance. For more information, see <a href="http://localhost:1313/solutions/about-subscription-licenses/" target="_blank" rel="noopener">About Subscription Licenses</a>.</div>
</blockquote>


</li>
<li>
<p>Copy the downloaded <strong>.crt</strong> and <strong>.key</strong> files to the <strong>/etc/ssl/nginx/</strong> directory and make sure they are named <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f534143c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f534143c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
</div>
</li>
<li>
<p>Copy the downloaded JWT file to the <strong>/etc/nginx/</strong> directory and make sure it is named <strong>license.jwt</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5343f340&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5343f340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
</div>
</li>
<li>
<p>Install prerequisite packages:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f519a1ba0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f519a1ba0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
</div></li>
<li>
<p>Enable the yum repositories to pull NGINX App Protect DoS dependencies:</p>
<p>If you have a RHEL subscription:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f519cafc8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f519cafc8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-baseos-rpms
</span></span><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-appstream-rpms
</span></span><span class="line"><span class="cl">sudo dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-baseos-rpms
</span></span><span class="line"><span class="cl">sudo subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-appstream-rpms
</span></span><span class="line"><span class="cl">sudo dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm</span></span></code></pre></div>
</div></li>
<li>
<p>Add the NGINX Plus and NGINX App Protect DoS repositories:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f519f24b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f519f24b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-9.repo</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-9.repo</span></span></code></pre></div>
</div></li>
<li>
<p>If you are performing a fresh installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a07888&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a07888">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature (RHEL 9):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a1c0a8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a1c0a8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature (RHEL 9):</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> run with root privileges.</li>
</ul></div>
</blockquote>

<p>Alternatively, you can use the following command to list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a31868&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a31868">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
</div><p>Then, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a46c40&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a46c40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-32+4.4.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-32+4.4.0</span></span></code></pre></div>
</div></li>
<li>
<p>In you are upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a6be00&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51a6be00">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> Make sure to restore configuration from <code>/etc/nginx-plus-backup</code> back to <code>/etc/nginx-plus</code>.</div>
</blockquote>

</li>
<li>
<p>Check the NGINX binary version to ensure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a7f298&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a7f298">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51a92f00&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51a92f00">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51aa34b8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51aa34b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS on an <code>http/server/location</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ac0590&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51ac0590">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable the L4 accelerated mitigation feature (RHEL 8.6+) in the <code>http</code> context of the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ad0b48&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51ad0b48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the SELinux to allow App Protect DoS:</p>
<p>a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ae1100&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51ae1100">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file created above:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51b77358&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51b77358">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos 2.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> tmpfs_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> initrc_state_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    class file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_state_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t self:capability sys_resource<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t tmpfs_t:file <span class="o">{</span> <span class="nb">read</span> write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_t:shm <span class="o">{</span> associate <span class="nb">read</span> write unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t initrc_t:shm <span class="o">{</span> associate <span class="nb">read</span> unix_read unix_write write <span class="o">}</span><span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ba8c50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51ba8c50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos.mod app-protect-dos.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos.pp -m app-protect-dos.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature:<br>
a. Using the vi editor, create a file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51bbb148&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51bbb148">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos-ebpf-manager.te</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">vi app-protect-dos-ebpf-manager.te</span></span></code></pre></div>
</div><p>b. Insert the following contents into the file created above:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c0a6d0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51c0a6d0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos-ebpf-manager 1.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">    require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> root_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class unix_stream_socket connectto<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t root_t:sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:unix_stream_socket connectto<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">module app-protect-dos-ebpf-manager 1.0<span class="p">;</span>
</span></span><span class="line"><span class="cl">    require <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> root_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> httpd_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">type</span> unconfined_service_t<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class unix_stream_socket connectto<span class="p">;</span>
</span></span><span class="line"><span class="cl">    class shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">allow httpd_t root_t:sock_file write<span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:shm <span class="o">{</span> unix_read unix_write <span class="o">}</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">allow httpd_t unconfined_service_t:unix_stream_socket connectto<span class="p">;</span></span></span></code></pre></div>
</div><p>c. Run the following chain of commands:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c36208&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51c36208">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos-ebpf-manager.mod app-protect-dos-ebpf-manager.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos-ebpf-manager.pp -m app-protect-dos-ebpf-manager.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos-ebpf-manager.pp<span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo checkmodule -M -m -o app-protect-dos-ebpf-manager.mod app-protect-dos-ebpf-manager.te <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule_package -o app-protect-dos-ebpf-manager.pp -m app-protect-dos-ebpf-manager.mod <span class="o">&amp;&amp;</span>  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>sudo semodule -i app-protect-dos-ebpf-manager.pp<span class="p">;</span></span></span></code></pre></div>
</div><p>If you encounter any issues, refer to the <a href="http://localhost:1313/nginx-app-protect-dos/troubleshooting-guide/how-to-troubleshoot/">Troubleshooting Guide</a>.</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Additional SELinux configuration may be required to allow NGINX Plus to listen on specific network ports, connect to upstreams, and send syslog entries to remote systems. Refer to the practices outlined in the <a href="https://www.nginx.com/blog/using-nginx-plus-with-selinux/" target="_blank" rel="noopener">Using NGINX and NGINX Plus with SELinux</a> article for details.</div>
</blockquote>

</li>
<li>
<p>To enable the NGINX/App-Protect-DoS service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c4ec90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51c4ec90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c628f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51c628f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
<li>
<p>L4 mitigation</p>
<p>To enable the <code>app-protect-dos-ebpf-manager</code> service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c75d90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51c75d90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div><p>Start the <code>app-protect-dos-ebpf-manager</code> service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51c88e40&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51c88e40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="debian--ubuntu-installation">Debian / Ubuntu Installation  <a class="headerlink float-right" href="#debian--ubuntu-installation" title="Debian / Ubuntu Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ca72a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51ca72a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <strong>/etc/ssl/nginx</strong> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53359778&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53359778">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div>
</li>
<li>
<p>Create the <strong>/etc/nginx/</strong> directory for the JWT license file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53380878&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53380878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
</div>
</li>
<li>
<p>Download the SSL certificate, private key, and the JWT license file associated with your NGINX Plus subscription from the MyF5 Customer Portal:</p>
<ul>
<li>Log in to <a href="https://my.f5.com/manage/s/" target="_blank" rel="noopener">MyF5</a>.</li>
<li>Go to <strong>My Products &amp; Plans &gt; Subscriptions</strong> to see your active subscriptions.</li>
<li>Find your NGINX products or services subscription, and select the <strong>Subscription ID</strong> for details.</li>
<li>Download the <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong> from the subscription page.</li>
<li>Download the <strong>JSON Web Token</strong> (JWT) from the subscription page.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Starting from <a href="http://localhost:1313/nginx/releases/#r33" target="_blank" rel="noopener">NGINX Plus Release 33</a>, a JWT file is required for each NGINX Plus instance. For more information, see <a href="http://localhost:1313/solutions/about-subscription-licenses/" target="_blank" rel="noopener">About Subscription Licenses</a>.</div>
</blockquote>


</li>
<li>
<p>Copy the downloaded <strong>.crt</strong> and <strong>.key</strong> files to the <strong>/etc/ssl/nginx/</strong> directory and make sure they are named <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f534143c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f534143c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
</div>
</li>
<li>
<p>Copy the downloaded JWT file to the <strong>/etc/nginx/</strong> directory and make sure it is named <strong>license.jwt</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5343f340&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5343f340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
</div>
</li>
<li>
<p>Install appropriate packages with <code>apt</code>:</p>
<p>For Debian:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51cc3ba8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51cc3ba8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring</span></span></code></pre></div>
</div><p>For Ubuntu:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51cdf8f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51cdf8f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> In case the apt installation or database update fails due to release info change, run the below command before you install.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51cf2d90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51cf2d90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update --allow-releaseinfo-change</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update --allow-releaseinfo-change</span></span></code></pre></div>
</div></li>
<li>
<p>Download and add the NGINX signing key:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51d15840&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51d15840">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> sudo gpg --dearmor <span class="p">|</span> sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> sudo gpg --dearmor <span class="p">|</span> sudo tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus and NGINX App Protect DoS repository:</p>
<p>For Debian:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51d39e48&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51d39e48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-plus.list
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-plus.list
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list</span></span></code></pre></div>
</div><p>For Ubuntu:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51d5d4b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51d5d4b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-plus.list
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-plus.list
</span></span><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> sudo tee /etc/apt/sources.list.d/nginx-app-protect-dos.list</span></span></code></pre></div>
</div></li>
<li>
<p>Download the apt configuration to <code>/etc/apt/apt.conf.d</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51d74bb0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51d74bb0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx</span></span></code></pre></div>
</div></li>
<li>
<p>In case of fresh Installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51d8e1f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51d8e1f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get install app-protect-dos</span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature (Debian 11 /  Debian 12 / Ubuntu 20.04 / Ubuntu 22.04 / Ubuntu 24.04):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51da35c8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51da35c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature (Debian 11 /  Debian 12 /  Ubuntu 20.04 / Ubuntu 22.04 / Ubuntu 24.04):</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> run with root privileges.</li>
</ul></div>
</blockquote>

<p>Alternatively, to install a specific version, use the following commands to update and list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51dbb880&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51dbb880">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-cache policy app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-cache policy app-protect-dos</span></span></code></pre></div>
</div><p>Finally, install a specific version from the output of command above.</p>
<p>For example for Debian 10:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51dd4ec0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51dd4ec0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>27+2.4.0-1~buster nginx-plus-module-appprotectdos<span class="o">=</span>27+2.4.0-1~buster</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>27+2.4.0-1~buster nginx-plus-module-appprotectdos<span class="o">=</span>27+2.4.0-1~buster</span></span></code></pre></div>
</div><p>For example for Debian 11:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ded948&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51ded948">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~bullseye nginx-plus-module-appprotectdos<span class="o">=</span>33+4.5.0--1~bullseye</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~bullseye nginx-plus-module-appprotectdos<span class="o">=</span>33+4.5.0--1~bullseye</span></span></code></pre></div>
</div><p>For example, for Debian 12:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e067b8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51e067b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~bookworm nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~bookworm</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~bookworm nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~bookworm</span></span></code></pre></div>
</div><p>For example for Ubuntu 18.04:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e1f240&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51e1f240">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>27+2.4.0-1~bionic nginx-plus-module-appprotectdos<span class="o">=</span>27+2.4.0-1~bionic</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>27+2.4.0-1~bionic nginx-plus-module-appprotectdos<span class="o">=</span>27+2.4.0-1~bionic</span></span></code></pre></div>
</div><p>For example for Ubuntu 20.04:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e374f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51e374f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~focal nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~focal</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~focal nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~focal</span></span></code></pre></div>
</div><p>For example for Ubuntu 22.04:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e55570&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51e55570">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~jammy nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~jammy</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~jammy nginx-plus-module-appprotectdos<span class="o">=</span>32+4.5.0-1~jammy</span></span></code></pre></div>
</div><p>For example for Ubuntu 24.04:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e6e3e0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51e6e3e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~noble nginx-plus-module-appprotectdos<span class="o">=</span>33+4.5.1-1~noble</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get install app-protect-dos<span class="o">=</span>33+4.5.0-1~noble nginx-plus-module-appprotectdos<span class="o">=</span>33+4.5.1-1~noble</span></span></code></pre></div>
</div></li>
<li>
<p>In the case of upgrading from a previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51e97420&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51e97420">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get remove nginx-plus
</span></span><span class="line"><span class="cl">sudo apt-get install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apt-get update
</span></span><span class="line"><span class="cl">sudo apt-get remove nginx-plus
</span></span><span class="line"><span class="cl">sudo apt-get install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
<li>
<p>Check the NGINX binary version to ensure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51eab470&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51eab470">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ebe138&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51ebe138">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51ecf690&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51ecf690">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS on an <code>http/server/location</code> context in the <code>nginx.conf</code> via:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51eeb7c8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51eeb7c8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable the L4 accelerated mitigation feature (Debian 11 / Debian 12 / Ubuntu 20.04 / Ubuntu 22.04) on the <code>http</code> context of the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51efc168&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51efc168">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f1b180&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51f1b180">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
<li>
<p>Start the L4 service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f320b0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51f320b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"> sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="alpine-315x--317x--319x-installation">Alpine 3.15.x / 3.17.x / 3.19.x Installation  <a class="headerlink float-right" href="#alpine-315x--317x--319x-installation" title="Alpine 3.15.x / 3.17.x / 3.19.x Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f50ce0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51f50ce0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <strong>/etc/ssl/nginx</strong> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53359778&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53359778">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div>
</li>
<li>
<p>Create the <strong>/etc/nginx/</strong> directory for the JWT license file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53380878&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53380878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
</div>
</li>
<li>
<p>Download the SSL certificate, private key, and the JWT license file associated with your NGINX Plus subscription from the MyF5 Customer Portal:</p>
<ul>
<li>Log in to <a href="https://my.f5.com/manage/s/" target="_blank" rel="noopener">MyF5</a>.</li>
<li>Go to <strong>My Products &amp; Plans &gt; Subscriptions</strong> to see your active subscriptions.</li>
<li>Find your NGINX products or services subscription, and select the <strong>Subscription ID</strong> for details.</li>
<li>Download the <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong> from the subscription page.</li>
<li>Download the <strong>JSON Web Token</strong> (JWT) from the subscription page.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Starting from <a href="http://localhost:1313/nginx/releases/#r33" target="_blank" rel="noopener">NGINX Plus Release 33</a>, a JWT file is required for each NGINX Plus instance. For more information, see <a href="http://localhost:1313/solutions/about-subscription-licenses/" target="_blank" rel="noopener">About Subscription Licenses</a>.</div>
</blockquote>


</li>
<li>
<p>Copy the downloaded <strong>.crt</strong> and <strong>.key</strong> files to the <strong>/etc/ssl/nginx/</strong> directory and make sure they are named <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f534143c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f534143c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
</div>
</li>
<li>
<p>Copy the downloaded JWT file to the <strong>/etc/nginx/</strong> directory and make sure it is named <strong>license.jwt</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5343f340&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5343f340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
</div>
</li>
<li>
<p>Add the NGINX public signing key to the directory <code>/etc/apk/keys</code>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f683e0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51f683e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -O /etc/apk/keys/nginx_signing.rsa.pub  https://cs.nginx.com/static/keys/nginx_signing.rsa.pub</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -O /etc/apk/keys/nginx_signing.rsa.pub  https://cs.nginx.com/static/keys/nginx_signing.rsa.pub</span></span></code></pre></div>
</div></li>
<li>
<p>Remove any previously configured NGINX Plus repository:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f7a108&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51f7a108">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sed <span class="s2">&#34;/plus-pkgs.nginx.com/d&#34;</span> /etc/apk/repositories</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sed <span class="s2">&#34;/plus-pkgs.nginx.com/d&#34;</span> /etc/apk/repositories</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus repository to <code>/etc/apk/repositories</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51f923c0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51f923c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> sudo tee -a /etc/apk/repositories</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> sudo tee -a /etc/apk/repositories</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX App Protect DoS repository to <code>/etc/apk/repositories</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51fae4f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f51fae4f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-dos/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> sudo tee -a /etc/apk/repositories</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-dos/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> sudo tee -a /etc/apk/repositories</span></span></code></pre></div>
</div></li>
<li>
<p>It is recommended to remove all community-supported NGINX packages. Note that all NGINX modules will be removed as well.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51fcc570&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51fcc570">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk del -r app-protect-dos
</span></span><span class="line"><span class="cl">sudo apk del -r nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk del -r app-protect-dos
</span></span><span class="line"><span class="cl">sudo apk del -r nginx</span></span></code></pre></div>
</div></li>
<li>
<p>Update the repository and install the most recent version of the NGINX Plus and NGINX App Protect DoS:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f51feb970&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f51feb970">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos</span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52001900&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52001900">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo sudo apk add app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo sudo apk add app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature:</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> run with root privileges.</li>
</ul></div>
</blockquote>

<p>Alternatively, to install a specific version, use the following commands to update and list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5201baf8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5201baf8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk info app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk info app-protect-dos</span></span></code></pre></div>
</div><p>Finally, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52032e10&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52032e10">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos<span class="o">=</span>33+4.5.0-r1</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos<span class="o">=</span>33+4.5.0-r1</span></span></code></pre></div>
</div></li>
<li>
<p>In case of upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5205f500&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5205f500">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk del -r app-protect-dos
</span></span><span class="line"><span class="cl">sudo apk del -r nginx-plus
</span></span><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos
</span></span><span class="line"><span class="cl">rc-service nginx-app-protect-dos start</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo apk update
</span></span><span class="line"><span class="cl">sudo apk del -r app-protect-dos
</span></span><span class="line"><span class="cl">sudo apk del -r nginx-plus
</span></span><span class="line"><span class="cl">sudo apk add nginx-plus app-protect-dos
</span></span><span class="line"><span class="cl">rc-service nginx-app-protect-dos start</span></span></code></pre></div>
</div></li>
<li>
<p>Check the NGINX binary version to ensure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520719f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f520719f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52082780&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52082780">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52092180&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52092180">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS on an <code>http/server/location</code> context in the <code>nginx.conf</code> via:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520ac760&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f520ac760">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable the L4 accelerated mitigation feature on the <code>http</code> context of the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520bc160&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f520bc160">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520ce270&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f520ce270">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rc-service nginx-app-protect-dos start</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rc-service nginx-app-protect-dos start</span></span></code></pre></div>
</div></li>
<li>
<p>Start the L4 service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520dff98&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f520dff98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rc-service app-protect-dos-ebpf-manager start</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">rc-service app-protect-dos-ebpf-manager start</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="amazon-linux-2023-installation">Amazon Linux 2023 Installation  <a class="headerlink float-right" href="#amazon-linux-2023-installation" title="Amazon Linux 2023 Installation"><i class="fas fa-link fa-xs"></i></a>
</h2><ol>
<li>
<p>If you already have NGINX packages in your system, back up your configs and logs:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f520fcc88&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f520fcc88">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp -a /etc/nginx /etc/nginx-plus-backup
</span></span><span class="line"><span class="cl">sudo cp -a /var/log/nginx /var/log/nginx-plus-backup</span></span></code></pre></div>
</div></li>
<li>
<p>Create the <strong>/etc/ssl/nginx</strong> directory:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53359778&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53359778">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/ssl/nginx</span></span></code></pre></div>
</div>
</li>
<li>
<p>Create the <strong>/etc/nginx/</strong> directory for the JWT license file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53380878&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f53380878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo mkdir -p /etc/nginx/</span></span></code></pre></div>
</div>
</li>
<li>
<p>Download the SSL certificate, private key, and the JWT license file associated with your NGINX Plus subscription from the MyF5 Customer Portal:</p>
<ul>
<li>Log in to <a href="https://my.f5.com/manage/s/" target="_blank" rel="noopener">MyF5</a>.</li>
<li>Go to <strong>My Products &amp; Plans &gt; Subscriptions</strong> to see your active subscriptions.</li>
<li>Find your NGINX products or services subscription, and select the <strong>Subscription ID</strong> for details.</li>
<li>Download the <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong> from the subscription page.</li>
<li>Download the <strong>JSON Web Token</strong> (JWT) from the subscription page.</li>
</ul>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Starting from <a href="http://localhost:1313/nginx/releases/#r33" target="_blank" rel="noopener">NGINX Plus Release 33</a>, a JWT file is required for each NGINX Plus instance. For more information, see <a href="http://localhost:1313/solutions/about-subscription-licenses/" target="_blank" rel="noopener">About Subscription Licenses</a>.</div>
</blockquote>


</li>
<li>
<p>Copy the downloaded <strong>.crt</strong> and <strong>.key</strong> files to the <strong>/etc/ssl/nginx/</strong> directory and make sure they are named <strong>nginx-repo.crt</strong> and <strong>nginx-repo.key</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f534143c0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f534143c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.crt /etc/ssl/nginx/nginx-repo.crt
</span></span><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.key /etc/ssl/nginx/nginx-repo.key</span></span></code></pre></div>
</div>
</li>
<li>
<p>Copy the downloaded JWT file to the <strong>/etc/nginx/</strong> directory and make sure it is named <strong>license.jwt</strong>:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5343f340&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5343f340">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo cp &lt;downloaded-file-name&gt;.jwt /etc/nginx/license.jwt</span></span></code></pre></div>
</div>
</li>
<li>
<p>Install prerequisite packages:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52114388&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52114388">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install ca-certificates wget</span></span></code></pre></div>
</div></li>
<li>
<p>Add NGINX Plus and NGINX App Protect DoS repository:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52133788&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52133788">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-amazonlinux2023.repo</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo
</span></span><span class="line"><span class="cl">sudo wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-amazonlinux2023.repo</span></span></code></pre></div>
</div></li>
<li>
<p>In case of fresh installation, update the repository and install the most recent version of the NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5214aaa0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5214aaa0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos</span></span></code></pre></div>
</div><p>For L4 accelerated mitigation feature:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5215eaf0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5215eaf0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature:</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> run with root privileges.</li>
</ul></div>
</blockquote>

<p>Alternatively, you can use the following command to list available versions:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52173ae0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52173ae0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf --showduplicates list app-protect-dos</span></span></code></pre></div>
</div><p>Then, install a specific version from the output of command above. For example:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f521886e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f521886e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-34+4.6.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf install app-protect-dos-34+4.6.0</span></span></code></pre></div>
</div></li>
<li>
<p>In case of upgrading from previously installed NGINX Plus App Protect DoS package (which includes NGINX Plus):</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f521b4220&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f521b4220">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo dnf remove nginx-plus
</span></span><span class="line"><span class="cl">sudo dnf install app-protect-dos
</span></span><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div><blockquote class="note">
  <div><strong>Note:</strong><br/> Make sure to restore configuration from <code>/etc/nginx-plus-backup</code> back to <code>/etc/nginx-plus</code>.</div>
</blockquote>

</li>
<li>
<p>Confirm the NGINX binary version to make sure that you have NGINX Plus installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f521c7aa0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f521c7aa0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo nginx -v</span></span></code></pre></div>
</div></li>
<li>
<p>Check the App Protect DoS binary version to ensure that you have the right version installed correctly:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f521d8ff8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f521d8ff8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo admd -v</span></span></code></pre></div>
</div></li>
<li>
<p>Load the NGINX App Protect DoS module on the main context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f521e8de0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f521e8de0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect DoS in an <code>http/server/location</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52204748&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52204748">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">app_protect_dos_monitor</span> <span class="s">uri=serv:80/</span><span class="p">;</span> <span class="err">#</span> <span class="k">Assuming</span> <span class="s">server_name</span> <span class="s">&#34;serv&#34;</span> <span class="no">on</span> <span class="s">port</span> <span class="mi">80</span><span class="s">,</span> <span class="s">with</span> <span class="s">the</span> <span class="s">root</span> <span class="s">path</span> <span class="s">&#34;/&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable the L4 accelerated mitigation feature in an <code>http</code> context in the <code>nginx.conf</code> file:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52214148&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52214148">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_dos_accelerated_mitigation</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>To enable the NGINX/App-Protect-DoS service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52227db0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52227db0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div></li>
<li>
<p>Start the NGINX service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5223dd40&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5223dd40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl start nginx</span></span></code></pre></div>
</div></li>
<li>
<p>L4 mitigation</p>
<p>To enable the <code>app-protect-dos-ebpf-manager</code> service to start at boot, run the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f522515c0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f522515c0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo systemctl <span class="nb">enable</span> nginx.service</span></span></code></pre></div>
</div><p>Start the <code>app-protect-dos-ebpf-manager</code> service:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52263ab8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52263ab8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">sudo systemctl start app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="docker-deployment">Docker Deployment  <a class="headerlink float-right" href="#docker-deployment" title="Docker Deployment"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="docker-deployment-instructions">Docker Deployment Instructions  <a class="headerlink float-right" href="#docker-deployment-instructions" title="Docker Deployment Instructions"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You need root permissions to execute the following steps.</p>
<ol>
<li>
<p>Create a Dockerfile (see examples below) which copies the following files into the docker image:</p>
<ul>
<li><code>nginx-repo.crt</code>: Certificate for NGINX repository access</li>
<li><code>nginx-repo.key</code>: Private key for NGINX repository access</li>
<li><code>license.jwt</code>: JWT license file for NGINX Plus license management</li>
<li><code>nginx.conf</code>: User defined <code>nginx.conf</code> with <code>app-protect-dos</code> enabled</li>
<li><code>entrypoint.sh</code>: Docker startup script which spins up all App Protect DoS processes, must have executable permissions</li>
</ul>
</li>
<li>
<p>Log in to NGINX Plus Customer Portal and download your <code>nginx-repo.crt</code>, <code>nginx-repo.key</code>, and <code>license.jwt</code> files.</p>
</li>
<li>
<p>Copy the files to the directory where the Dockerfile is located.</p>
</li>
<li>
<p>Add NGINX App Protect DoS to your <code>nginx.conf</code>. The configuration below is an example for an <code>http</code> and <code>grpc+tls</code> servers which has NGINX App Protect DoS enabled. Note that every NGINX App Protect DoS related directive starts with <code>app_protect_dos_</code>.</p>
<p><code>nginx.conf</code></p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f522e6878&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f522e6878">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span> <span class="c1"># NGINX App Protect DoS module
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># Enable NGINX App Protect DoS&#39;s security logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span> <span class="c1"># Security logger outputs to a file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261; # Security logger outputs to a syslog destination
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># HTTP/1 server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span> <span class="c1"># Access log with rate limiting and additional information
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1"># access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span> <span class="c1"># Policy configuration for NGINX App Protect DoS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># Enable NGINX App Protect DoS in this block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App80&#34;</span><span class="p">;</span> <span class="c1"># PO name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv80/</span><span class="p">;</span> <span class="c1"># Health monitoring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># gRPC server with ssl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">http2</span> <span class="s">ssl</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv_grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># TLS config
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">ssl_certificate</span>      <span class="s">/etc/ssl/certs/grpc.example.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span>  <span class="s">/etc/ssl/private/grpc.example.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:10m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_ciphers</span>          <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span>        <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;AppGRPC&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=https://serv_grpc:443/service/method</span> <span class="s">protocol=grpc</span><span class="p">;</span> <span class="c1"># mandatory for gRPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">grpc_pass</span> <span class="s">grpc://1.2.3.4:1001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span> <span class="c1"># NGINX App Protect DoS module
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># Enable NGINX App Protect DoS&#39;s security logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span> <span class="c1"># Security logger outputs to a file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1"># app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261; # Security logger outputs to a syslog destination
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># HTTP/1 server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span> <span class="c1"># Access log with rate limiting and additional information
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1"># access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span> <span class="c1"># Policy configuration for NGINX App Protect DoS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span> <span class="c1"># Enable NGINX App Protect DoS in this block
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App80&#34;</span><span class="p">;</span> <span class="c1"># PO name
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv80/</span><span class="p">;</span> <span class="c1"># Health monitoring
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># gRPC server with ssl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">http2</span> <span class="s">ssl</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv_grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># TLS config
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">ssl_certificate</span>      <span class="s">/etc/ssl/certs/grpc.example.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span>  <span class="s">/etc/ssl/private/grpc.example.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:10m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_ciphers</span>          <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span>        <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;AppGRPC&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=https://serv_grpc:443/service/method</span> <span class="s">protocol=grpc</span><span class="p">;</span> <span class="c1"># mandatory for gRPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">grpc_pass</span> <span class="s">grpc://1.2.3.4:1001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> Make sure to replace upstream and proxy pass directives in this example with relevant application backend settings.</div>
</blockquote>

</li>
<li>
<p>In the same directory create an <code>entrypoint.sh</code> file with executable permissions, with the following content:</p>
<p>For CentOS 7 / UBI 7:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52339898&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52339898">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/opt/rpm/lib64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> LD_LIBRARY_PATH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/opt/rpm/lib64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> LD_LIBRARY_PATH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
</div><p>For Alpine / Debian / Ubuntu / UBI 8/ UBI 9:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52384bb8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52384bb8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Create a Docker image:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523a0908&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f523a0908">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --no-cache --platform linux/amd64 -t app-protect-dos .</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --no-cache --platform linux/amd64 -t app-protect-dos .</span></span></code></pre></div>
</div><p>The <code>--no-cache</code> option tells Docker to build the image from scratch and ensures the installation of the latest version of NGINX Plus and NGINX App Protect DoS. If the Dockerfile was previously used to build an image without the <code>--no-cache</code> option, the new image uses versions from the previously built image from the Docker cache.</p>
</li>
<li>
<p>Verify that the <code>app-protect-dos</code> image was created successfully with the docker images command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523b31e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f523b31e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker images app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker images app-protect-dos</span></span></code></pre></div>
</div></li>
<li>
<p>Create a container based on this image, for example, <code>my-app-protect-dos</code> container:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523cb888&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f523cb888">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the <code>my-app-protect-dos</code> container is up and running with the <code>docker ps</code> command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523dbe40&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f523dbe40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps</span></span></code></pre></div>
</div></li>
<li>
<p>L4 Accelerated Mitigation Deployment Options:<br>
There are three different ways to deploy the L4 accelerated mitigation feature:<br></p>
<ol>
<li>
<p>Deploy in a Dedicated Container. <br>
Create a shared folder on the host:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523ec3f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f523ec3f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir /shared</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mkdir /shared</span></span></code></pre></div>
</div><p>This folder will be used to share data between containers.
Modify the <code>entrypoint.sh</code> to run the L4 mitigation:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f523fc9b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f523fc9b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/usr/bin/ebpf_manager_dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/usr/bin/ebpf_manager_dos</span></span></code></pre></div>
</div><p>Create and run the L4 container:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5241f848&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5241f848">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --privileged --network host --mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/sys/fs/bpf,target<span class="o">=</span>/sys/fs/bpf -v /shared:/shared --name my-app-protect-dos-ebpf-manager -d app-protect-dos-ebpf-manager</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --privileged --network host --mount <span class="nv">type</span><span class="o">=</span>bind,source<span class="o">=</span>/sys/fs/bpf,target<span class="o">=</span>/sys/fs/bpf -v /shared:/shared --name my-app-protect-dos-ebpf-manager -d app-protect-dos-ebpf-manager</span></span></code></pre></div>
</div><p>Create and run the main <code>app-protect-dos</code> container:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5243a210&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f5243a210">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -v /shared:/shared -p 80:80 -d app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -v /shared:/shared -p 80:80 -d app-protect-dos</span></span></code></pre></div>
</div></li>
<li>
<p>Deploy Directly on the Host.<br>
To run L4 mitigation directly on the host:<br></p>
<ol>
<li>Install the L4 mitigation on the host, as described in the OS-specific instructions.</li>
<li>Run the app-protect-dos container:



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52458288&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52458288">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -v /shared:/shared -p 80:80 -d app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -v /shared:/shared -p 80:80 -d app-protect-dos</span></span></code></pre></div>
</div></li>
</ol>
</li>
<li>
<p>Run L4 Mitigation Inside the Same Container as <code>app-protect-dos</code>.<br>
To run both L4 mitigation and the main application within the same container:<br></p>
<ol>
<li>Modify the <code>entrypoint.sh</code>:



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5246e9e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5246e9e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/usr/bin/ebpf_manager_dos <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">...</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">...
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/usr/bin/ebpf_manager_dos <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">...</span></span></code></pre></div>
</div></li>
<li>run the container:



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52488410&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52488410">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
</div></li>
</ol>
</li>
</ol>
</li>
</ol>
<blockquote class="note">
  <div><strong>Note:</strong><br/> <p>L4 accelerated mitigation feature:</p>
<ul>
<li><code>app-protect-dos-ebpf-manager</code> need to run with root privileges.</li>
</ul></div>
</blockquote>

<h3 
id="centos-74-docker-deployment-example">CentOS 7.4 Docker Deployment Example  <a class="headerlink float-right" href="#centos-74-docker-deployment-example" title="CentOS 7.4 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f525136a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f525136a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># For CentOS 7:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7.4.1708</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates epel-release<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and  NGINX App Protect DoS repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># For CentOS 7:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7.4.1708</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates epel-release<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and  NGINX App Protect DoS repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="ubi7-docker-deployment-example">UBI7 Docker Deployment Example  <a class="headerlink float-right" href="#ubi7-docker-deployment-example" title="UBI7 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f525a3b38&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f525a3b38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi7:ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-ha-for-rhel-*-server-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi7:ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-ha-for-rhel-*-server-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="rhel-8--rocky-linux-8-docker-deployment-example">RHEL 8 / Rocky Linux 8 Docker Deployment Example  <a class="headerlink float-right" href="#rhel-8--rocky-linux-8-docker-deployment-example" title="RHEL 8 / Rocky Linux 8 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5263fb50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5263fb50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For UBI 8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi8:ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup repos and Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-baseos-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-appstream-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repo to Yum: https://cs.nginx.com/static/files/nginx-plus-8.4.repo</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-8.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For UBI 8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi8:ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup repos and Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-baseos-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-8-for-x86_64-appstream-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repo to Yum: https://cs.nginx.com/static/files/nginx-plus-8.4.repo</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-8.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="rhel-9-docker-deployment-example">RHEL 9 Docker Deployment Example  <a class="headerlink float-right" href="#rhel-9-docker-deployment-example" title="RHEL 9 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f526f0b58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f526f0b58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For RHEL ubi9:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi9/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup repos and Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-baseos-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-appstream-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App-protect &amp; dependencies repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-9.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="c1"># You can use either of the dependencies or epel repo</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="c1"># &amp;&amp; rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm \</span>
</span></span><span class="line"><span class="cl">    <span class="o">&amp;&amp;</span> dnf clean all<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For RHEL ubi9:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi9/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Redhat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup repos and Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-baseos-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable<span class="o">=</span>rhel-9-for-x86_64-appstream-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-9.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App-protect &amp; dependencies repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-9.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="c1"># You can use either of the dependencies or epel repo</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span>    <span class="c1"># &amp;&amp; rpm -ivh https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm \</span>
</span></span><span class="line"><span class="cl">    <span class="o">&amp;&amp;</span> dnf clean all<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="debian-10-buster--debian-11-bullseye--debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye) / Debian 12 (Bookworm) Docker Deployment Example  <a class="headerlink float-right" href="#debian-10-buster--debian-11-bullseye--debian-12-bookworm-docker-deployment-example" title="Debian 10 (Buster) / Debian 11 (Bullseye) / Debian 12 (Bookworm) Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f527a03f0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f527a03f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: buster/bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="o">&amp;&amp;</span> apt-key add nginx_signing.key<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: buster/bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="o">&amp;&amp;</span> apt-key add nginx_signing.key<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble-docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble) Docker Deployment Example  <a class="headerlink float-right" href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble-docker-deployment-example" title="Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble) Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52840670&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52840670">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: bionic/focal/jammy/noble</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: bionic/focal/jammy/noble</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="alpine-docker-deployment-example">Alpine Docker Deployment Example  <a class="headerlink float-right" href="#alpine-docker-deployment-example" title="Alpine Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f528cb518&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f528cb518">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For Alpine 3.15 / 3.17 / 3.19:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: 3.15 / 3.17 / 3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> tee -a /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-dos/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> tee -a /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add prerequisite packages</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk update <span class="o">&amp;&amp;</span> apk add bash<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk update <span class="o">&amp;&amp;</span> apk add nginx-plus app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;/root/entrypoint.sh&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For Alpine 3.15 / 3.17 / 3.19:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: 3.15 / 3.17 / 3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> tee -a /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-dos/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> tee -a /etc/apk/repositories<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add prerequisite packages</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apk update <span class="o">&amp;&amp;</span> apk add bash<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk update <span class="o">&amp;&amp;</span> apk add nginx-plus app-protect-dos<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;sh&#34;</span><span class="p">,</span> <span class="s2">&#34;/root/entrypoint.sh&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div><h3 
id="amazonlinux-2023-docker-deployment-example">AmazonLinux 2023 Docker Deployment Example  <a class="headerlink float-right" href="#amazonlinux-2023-docker-deployment-example" title="AmazonLinux 2023 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5293aa58&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5293aa58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For AmazonLinux 2023:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi9/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App-protect &amp; dependencies repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-amazonlinux2023.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For AmazonLinux 2023:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi9/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/plus-amazonlinux2023.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX App-protect &amp; dependencies repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-amazonlinux2023.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> dnf -y install app-protect-dos <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h2 
id="docker-deployment-with-nginx-app-protect">Docker Deployment with NGINX App Protect  <a class="headerlink float-right" href="#docker-deployment-with-nginx-app-protect" title="Docker Deployment with NGINX App Protect"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="docker-deployment-instructions-1">Docker Deployment Instructions  <a class="headerlink float-right" href="#docker-deployment-instructions-1" title="Docker Deployment Instructions"><i class="fas fa-link fa-xs"></i></a>
</h3><p>You need root permissions to execute the following steps.</p>
<ol>
<li>
<p>Create a Dockerfile (see examples below) which copies the following files into the docker image:</p>
<ul>
<li><code>nginx-repo.crt</code>: Certificate for NGINX repository access</li>
<li><code>nginx-repo.key</code>: Private key for NGINX repository access</li>
<li><code>license.jwt</code>: JWT license file for NGINX Plus license management</li>
<li><code>nginx.conf</code>: User defined <code>nginx.conf</code> with <code>app-protect-dos</code> enabled</li>
<li><code>entrypoint.sh</code>: Docker startup script which spins up all App Protect DoS processes, must have executable permissions</li>
</ul>
</li>
<li>
<p>Log in to NGINX Plus Customer Portal and download your <code>nginx-repo.crt</code>, <code>nginx-repo.key</code> and <code>license.jwt</code> files.</p>
</li>
<li>
<p>Copy the files to the directory where the Dockerfile is located.</p>
</li>
<li>
<p>In the same directory create the <code>nginx.conf</code> file with the following contents:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f529c12b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f529c12b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># HTTP/1 server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>        <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>              <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>         <span class="s">serv80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_http_version</span>  <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_policy_file</span> <span class="s">&#34;/etc/app_protect/conf/NginxDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App80&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv80/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># gRPC server with ssl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">http2</span> <span class="s">ssl</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv_grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># TLS config
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">ssl_certificate</span>      <span class="s">/etc/ssl/certs/grpc.example.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span>  <span class="s">/etc/ssl/private/grpc.example.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:10m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_ciphers</span>          <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span>        <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;AppGRPC&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=https://serv_grpc:443/service/method</span> <span class="s">protocol=grpc</span><span class="p">;</span> <span class="c1"># mandatory for gRPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">grpc_pass</span> <span class="s">grpc://1.2.3.4:1001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">error</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># HTTP/1 server
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>        <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>              <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>         <span class="s">serv80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_http_version</span>  <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_policy_file</span> <span class="s">&#34;/etc/app_protect/conf/NginxDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App80&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv80/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># gRPC server with ssl
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span>    <span class="s">application/grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span>          <span class="mi">443</span> <span class="s">http2</span> <span class="s">ssl</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span>     <span class="s">serv_grpc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># TLS config
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">ssl_certificate</span>      <span class="s">/etc/ssl/certs/grpc.example.com.crt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_certificate_key</span>  <span class="s">/etc/ssl/private/grpc.example.com.key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_cache</span>    <span class="s">shared:SSL:10m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_session_timeout</span>  <span class="mi">5m</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_ciphers</span>          <span class="s">HIGH:!aNULL:!MD5</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">ssl_protocols</span>        <span class="s">TLSv1.2</span> <span class="s">TLSv1.3</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;AppGRPC&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=https://serv_grpc:443/service/method</span> <span class="s">protocol=grpc</span><span class="p">;</span> <span class="c1"># mandatory for gRPC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kn">grpc_pass</span> <span class="s">grpc://1.2.3.4:1001</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div></li>
</ol>
<blockquote class="important call-out">
  <div><strong class="call-out-type">Important</strong><br/> Make sure to replace upstream and proxy pass directives in this example with relevant application backend settings.</div>
</blockquote>

<ol start="5">
<li>
<p>For the L4 accelerated mitigation feature: <br />
The following line in the <code>nginx.conf</code> file needs to be modified:<br />
Change:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f529d4360&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f529d4360">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span></span></span></code></pre></div>
</div><p>To:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f529e58b8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f529e58b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">root</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">root</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>In the same directory create an <code>entrypoint.sh</code> file with executable permissions, with the following content:</p>
<p>For CentOS 7 / UBI 7:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52a4c158&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52a4c158">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/opt/rpm/lib64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> LD_LIBRARY_PATH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/bin/su -s /bin/bash -c <span class="s1">&#39;/opt/app_protect/bin/bd_agent &amp;&#39;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/share/ts/bin/bd-socket-plugin tmm_count 4 proc_cpuinfo_cpu_mhz 2000000 total_xml_memory 307200000 total_umu_max_size 3129344 sys_max_account_id 1024 no_static_config 2&gt;&amp;1 &gt; /var/log/app_protect/bd-socket-plugin.log &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/opt/rpm/lib64
</span></span><span class="line"><span class="cl"><span class="nb">export</span> LD_LIBRARY_PATH
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/bin/su -s /bin/bash -c <span class="s1">&#39;/opt/app_protect/bin/bd_agent &amp;&#39;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/share/ts/bin/bd-socket-plugin tmm_count 4 proc_cpuinfo_cpu_mhz 2000000 total_xml_memory 307200000 total_umu_max_size 3129344 sys_max_account_id 1024 no_static_config 2&gt;&amp;1 &gt; /var/log/app_protect/bd-socket-plugin.log &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
</div><p>For Alpine / Debian / Ubuntu / UBI 8/ UBI 9:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52aa2058&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52aa2058">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/bin/su -s /bin/bash -c <span class="s1">&#39;/opt/app_protect/bin/bd_agent &amp;&#39;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/share/ts/bin/bd-socket-plugin tmm_count 4 proc_cpuinfo_cpu_mhz 2000000 total_xml_memory 307200000 total_umu_max_size 3129344 sys_max_account_id 1024 no_static_config 2&gt;&amp;1 &gt; /var/log/app_protect/bd-socket-plugin.log &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>/bin/su -s /bin/bash -c <span class="s1">&#39;/opt/app_protect/bin/bd_agent &amp;&#39;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/share/ts/bin/bd-socket-plugin tmm_count 4 proc_cpuinfo_cpu_mhz 2000000 total_xml_memory 307200000 total_umu_max_size 3129344 sys_max_account_id 1024 no_static_config 2&gt;&amp;1 &gt; /var/log/app_protect/bd-socket-plugin.log &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
</div></li>
<li>
<p>Create a Docker image:</p>
<p>For CentOS:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52abba80&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52abba80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --no-cache --platform linux/amd64 -t app-protect-dos .</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --no-cache --platform linux/amd64 -t app-protect-dos .</span></span></code></pre></div>
</div><p>For RHEL:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52adb650&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52adb650">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --platform linux/amd64 --build-arg <span class="nv">RHEL_ORGANIZATION</span><span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORGANIZATION</span><span class="si">}</span> --build-arg <span class="nv">RHEL_ACTIVATION_KEY</span><span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span> --no-cache -t app-protect-dos .</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker build --platform linux/amd64 --build-arg <span class="nv">RHEL_ORGANIZATION</span><span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORGANIZATION</span><span class="si">}</span> --build-arg <span class="nv">RHEL_ACTIVATION_KEY</span><span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span> --no-cache -t app-protect-dos .</span></span></code></pre></div>
</div><p>The <code>--no-cache</code> option tells Docker to build the image from scratch and ensures the installation of the latest version of NGINX Plus and NGINX App Protect DoS. If the Dockerfile was previously used to build an image without the <code>--no-cache</code> option, the new image uses versions from the previously built image from the Docker cache.</p>
</li>
<li>
<p>Verify that the <code>app-protect-dos</code> image was created successfully with the docker images command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52aedb48&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52aedb48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker images app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker images app-protect-dos</span></span></code></pre></div>
</div></li>
<li>
<p>Create a container based on this image, for example, <code>my-app-protect-dos</code> container:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52b061e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52b061e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name my-app-protect-dos -p 80:80 -d app-protect-dos</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the <code>my-app-protect-dos</code> container is up and running with the <code>docker ps</code> command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52b15fd0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52b15fd0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="centos-74-docker-deployment-example-1">Centos 7.4 Docker Deployment Example  <a class="headerlink float-right" href="#centos-74-docker-deployment-example-1" title="Centos 7.4 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52b81690&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52b81690">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For CentOS 7:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7.4.1708</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates epel-release<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect DoS and NGINX App Protect repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS and NGINX App Protect:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos app-protect<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For CentOS 7:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7.4.1708</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates epel-release<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect DoS and NGINX App Protect repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS and NGINX App Protect:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos app-protect<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="rhel-74-docker-deployment-example">RHEL 7.4 Docker Deployment Example  <a class="headerlink float-right" href="#rhel-74-docker-deployment-example" title="RHEL 7.4 Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52c1ee18&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52c1ee18">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For Red Hat 7.4+:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/rhel7:7.4</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Red Hat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-ha-for-rhel-*-server-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect DoS and NGINX App Protect repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS and NGINX App Protect:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos app-protect<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="c"># For Red Hat 7.4+:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/rhel7:7.4</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate and key from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Setup the Red Hat subscription</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager register --force --org<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ORG</span><span class="si">}</span> --activationkey<span class="o">=</span><span class="si">${</span><span class="nv">RHEL_ACTIVATION_KEY</span><span class="si">}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager refresh<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager attach --auto<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install wget ca-certificates<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install dependencies</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> subscription-manager repos --enable rhel-*-optional-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-*-extras-rpms <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>                               --enable rhel-ha-for-rhel-*-server-rpms<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect DoS and NGINX App Protect repo to Yum:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-dos-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/app-protect-7.repo<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect DoS and NGINX App Protect:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> yum -y install app-protect-dos app-protect<span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="debian-10-buster--debian-11-bullseye---debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye)  / Debian 12 (Bookworm) Docker Deployment Example  <a class="headerlink float-right" href="#debian-10-buster--debian-11-bullseye---debian-12-bookworm-docker-deployment-example" title="Debian 10 (Buster) / Debian 11 (Bullseye)  / Debian 12 (Bookworm) Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52cc7180&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52cc7180">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: buster/bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS and NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos app-protect<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: buster/bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 debian-archive-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS and NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos app-protect<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh  /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h3 
id="ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble--docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble)  Docker Deployment Example  <a class="headerlink float-right" href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble--docker-deployment-example" title="Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble)  Docker Deployment Example"><i class="fas fa-link fa-xs"></i></a>
</h3>


<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">Dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52d7b450&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52d7b450">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: bionic/focal/jammy/noble</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS and NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos app-protect<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Dockerfile" data-lang="Dockerfile"><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> OS_CODENAME<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Where OS_CODENAME can be: bionic/focal/jammy/noble</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span>noninteractive
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Download certificate, key, and JWT license from the customer portal (https://my.f5.com)</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># and copy to the build context:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> mkdir -p /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt nginx-repo.key /etc/ssl/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx-repo.crt license.jwt /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install prerequisite packages:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y apt-transport-https lsb-release ca-certificates wget gnupg2 ubuntu-keyring<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download and add the NGINX signing key:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Add NGINX Plus, NGINX App Protect and NGINX App Protect DoS repository:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-plus.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect-dos/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect-dos.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] https://pkgs.nginx.com/app-protect/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> tee /etc/apt/sources.list.d/nginx-app-protect.list<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Download the apt configuration to `/etc/apt/apt.conf.d`:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Update the repository and install the most recent version of the NGINX App Protect DoS and NGINX App Protect package (which includes NGINX Plus):</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> apt-get update <span class="o">&amp;&amp;</span> apt-get install -y app-protect-dos app-protect<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Remove nginx repository key/cert from docker</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> rm -rf /etc/ssl/nginx<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Copy configuration files:</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> nginx.conf custom_log_format.json /etc/nginx/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">COPY</span> entrypoint.sh /root/<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> /root/entrypoint.sh <span class="o">&amp;&amp;</span> tail -f /dev/null</span></span></code></pre></div>
</div><h2 
id="nginx-app-protect-dos-arbitrator">NGINX App Protect DoS Arbitrator  <a class="headerlink float-right" href="#nginx-app-protect-dos-arbitrator" title="NGINX App Protect DoS Arbitrator"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="overview-1">Overview  <a class="headerlink float-right" href="#overview-1" title="Overview"><i class="fas fa-link fa-xs"></i></a>
</h3><p>NGINX App Protect DoS arbitrator orchestrates all the running NGINX App Protect DoS instances to synchronize local/global attack start/stop.</p>
<p>NGINX App Protect DoS arbitrator serves as a central coordinating component for managing multiple instances of  App Protect DoS in a network. It is needed when there are more than one NGINX App Protect DoS instances. Its primary function is to ensure that all instances are aware of and share the same state for each protected object. Here&rsquo;s a clearer breakdown of how it works and why it&rsquo;s necessary:</p>
<p>How NGINX App Protect DoS Arbitrator Works:</p>
<ul>
<li><strong>Collecting State Periodically</strong>: The arbitrator regularly collects the state information from all running instances of App Protect DoS. This collection occurs at set intervals, typically every 10 seconds.</li>
<li><strong>State Initialization for New Instances</strong>: When a new App Protect DoS instance is created, it doesn&rsquo;t start with a blank or uninitialized state for a protected object. Instead, it retrieves the initial state for the protected object from the arbitrator.</li>
<li><strong>Updating State in Case of an Attack</strong>: If an attack is detected by one of the App Protect DoS instances, that instance sends an attack notification to the arbitrator. The arbitrator then updates the state of the affected protected object to indicate that it is under attack. Importantly, this updated state is propagated to all other instances.</li>
</ul>
<h3 
id="why-nginx-app-protect-dos-arbitrator-is-necessary">Why NGINX App Protect DoS Arbitrator is Necessary  <a class="headerlink float-right" href="#why-nginx-app-protect-dos-arbitrator-is-necessary" title="Why NGINX App Protect DoS Arbitrator is Necessary"><i class="fas fa-link fa-xs"></i></a>
</h3><p>NGINX App Protect DoS Arbitrator is essential for several reasons:</p>
<ul>
<li><strong>Global State Management</strong>: Without the arbitrator, each individual instance of App Protect DoS would manage its own isolated state for each protected object. This isolation could lead to inconsistencies. For example, if instance A declared an attack on a protected object named &ldquo;PO-Example,&rdquo; instance B would remain unaware of this attack, potentially leaving the object vulnerable.</li>
<li><strong>Uniform Attack Detection</strong>: With the arbitrator in place, when instance A detects an attack on &ldquo;PO-Example&rdquo; and reports it to the arbitrator, the state of &ldquo;PO-Example&rdquo; is immediately updated to indicate an attack. This means that all instances, including instance B, are aware of the attack and can take appropriate measures to mitigate it.</li>
</ul>
<p>In summary, NGINX App Protect DoS Arbitrator acts as a central coordinator to maintain a consistent and up-to-date global state for protected objects across multiple instances of App Protect DoS. This coordination helps ensure that attacks are properly detected and mitigated, and that knowledge gained by one instance is efficiently shared with others, enhancing the overall security of the network.</p>
<h3 
id="nginx-app-protect-dos-arbitrator-deployment">NGINX App Protect DoS Arbitrator Deployment  <a class="headerlink float-right" href="#nginx-app-protect-dos-arbitrator-deployment" title="NGINX App Protect DoS Arbitrator Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Pull the official NGINX App Protect DoS Arbitrator image with the command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52d9b020&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52d9b020">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull docker-registry.nginx.com/nap-dos/app_protect_dos_arb:latest</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull docker-registry.nginx.com/nap-dos/app_protect_dos_arb:latest</span></span></code></pre></div>
</div></li>
<li>
<p>Create a container based on this image, for example, <code>app-protect-dos-arb</code> container:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52db5600&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52db5600">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name app_protect_dos_arb -p 3000:3000 -d docker-registry.nginx.com/nap-dos/app_protect_dos_arb</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --name app_protect_dos_arb -p 3000:3000 -d docker-registry.nginx.com/nap-dos/app_protect_dos_arb</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the <code>app-protect-dos-arb</code> container is up and running with the <code>docker ps</code> command.</p>
</li>
<li>
<p>DNS records are required for NGINX App Protect DoS Arbitrator to work properly and be accessible by NGINX App Protect DoS servers. Ensure that the <code>svc-appprotect-dos-arb</code> or configured Arbitrator FQDN (with <code>app_protect_dos_arb_fqdn</code> directive) has a valid DNS resolution.
This step is necessary only for VM/Docker deployments with arbitrator. When the arbitrator is in the same Kubernetes namespace as NGINX App Protect DoS, this step is not needed.</p>
</li>
</ol>
<h3 
id="multi-vm-deployment">Multi-VM Deployment  <a class="headerlink float-right" href="#multi-vm-deployment" title="Multi-VM Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><p>The Arbitrator service is standalone. Once it is down, it can be seamlessly re-started. It will immediately recover all the needed information from NGINX App Protect DoS instances that communicate to it every 10 sec. It’s downtime is around 10-20 seconds which  will not affect the NGINX App Protect DoS working.</p>
<p>NGINX App Protect DoS Arbitrator service connects to port 3000 and can be seen under App Protect DoS instances. All modules try to connect to this service automatically. If it’s not accessible, each instance works in standalone mode.</p>
<p>There is no such option for authentications between NGINX App Protect DoS servers and Arbitrator service like MTLS or password . Currently Arbitrator service is not exposed outside of the namespace. It is customers responsibility to isolate it from outside. It is applicable to any deployment of Arbitrator, not only to multi-VM.</p>
<h2 
id="post-installation-checks">Post-Installation Checks  <a class="headerlink float-right" href="#post-installation-checks" title="Post-Installation Checks"><i class="fas fa-link fa-xs"></i></a>
</h2><p>You can run the following commands to ensure that NGINX App Protect DoS enforcement is operational.</p>
<ol>
<li>
<p>Check that the three processes needed for NGINX App Protect DoS are running using <code>ps aux</code>:</p>
<ul>
<li>admd</li>
<li>nginx: master process</li>
<li>nginx: worker process</li>
</ul>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52e233d0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52e233d0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">USER       PID   %CPU   %MEM    VSZ    RSS TTY      STAT  START     TIME  COMMAND
</span></span><span class="line"><span class="cl">nginx      <span class="m">7759</span>   0.0    0.0   <span class="m">113120</span>  <span class="m">1200</span> ?       Ss    Sep06     0:00  /bin/sh -c /usr/bin/admd -d --log info &gt; /var/log/adm/admd.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">root       <span class="m">7765</span>   0.0    0.0   <span class="m">87964</span>   <span class="m">1464</span> ?       Ss    Sep06     0:00  nginx: master process /usr/sbin/nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl">nginx      <span class="m">7767</span>   0.0    0.1   <span class="m">615868</span>  <span class="m">8188</span> ?       Sl    Sep06     0:04  nginx: worker process</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">USER       PID   %CPU   %MEM    VSZ    RSS TTY      STAT  START     TIME  COMMAND
</span></span><span class="line"><span class="cl">nginx      <span class="m">7759</span>   0.0    0.0   <span class="m">113120</span>  <span class="m">1200</span> ?       Ss    Sep06     0:00  /bin/sh -c /usr/bin/admd -d --log info &gt; /var/log/adm/admd.log 2&gt;<span class="p">&amp;</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">root       <span class="m">7765</span>   0.0    0.0   <span class="m">87964</span>   <span class="m">1464</span> ?       Ss    Sep06     0:00  nginx: master process /usr/sbin/nginx -g daemon off<span class="p">;</span>
</span></span><span class="line"><span class="cl">nginx      <span class="m">7767</span>   0.0    0.1   <span class="m">615868</span>  <span class="m">8188</span> ?       Sl    Sep06     0:04  nginx: worker process</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that there are no NGINX errors in the <code>/var/log/nginx/error.log</code> and that the policy compiled successfully:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52ea2ae0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52ea2ae0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: using the <span class="s2">&#34;epoll&#34;</span> event method
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: nginx/1.19.0 <span class="o">(</span>nginx-plus-r22<span class="o">)</span>
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: built by gcc 4.8.5 <span class="m">20150623</span> <span class="o">(</span>Red Hat 4.8.5-39<span class="o">)</span> <span class="o">(</span>GCC<span class="o">)</span>
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: OS: Linux 3.10.0-327.28.3.el7.x86_64
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: getrlimit<span class="o">(</span>RLIMIT_NOFILE<span class="o">)</span>: 1024:4096
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9310#9310: start worker processes
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9310#9310: start worker process <span class="m">9311</span>
</span></span><span class="line"><span class="cl">PID &lt;9311&gt;, WORKER &lt;0&gt;, Function adm_ngx_init_process, line 684, version: 22+1.19.4-1.el7.ngx</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: using the <span class="s2">&#34;epoll&#34;</span> event method
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: nginx/1.19.0 <span class="o">(</span>nginx-plus-r22<span class="o">)</span>
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: built by gcc 4.8.5 <span class="m">20150623</span> <span class="o">(</span>Red Hat 4.8.5-39<span class="o">)</span> <span class="o">(</span>GCC<span class="o">)</span>
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: OS: Linux 3.10.0-327.28.3.el7.x86_64
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9307#9307: getrlimit<span class="o">(</span>RLIMIT_NOFILE<span class="o">)</span>: 1024:4096
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9310#9310: start worker processes
</span></span><span class="line"><span class="cl">2020/09/07 15:33:44 <span class="o">[</span>notice<span class="o">]</span> 9310#9310: start worker process <span class="m">9311</span>
</span></span><span class="line"><span class="cl">PID &lt;9311&gt;, WORKER &lt;0&gt;, Function adm_ngx_init_process, line 684, version: 22+1.19.4-1.el7.ngx</span></span></code></pre></div>
</div></li>
<li>
<p>Check that by applying an attack, the attacker IP addresses are blocked while the good traffic pass through:</p>
<p>a. Simulate good traffic:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52ed0d28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52ed0d28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Start Good Traffic 2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good1 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good2 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good3 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good4
</span></span><span class="line"><span class="cl">  sleep 0.1
</span></span><span class="line"><span class="cl">  <span class="k">done</span> <span class="p">&amp;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;Start Good Traffic 2&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">while</span> true<span class="p">;</span> <span class="k">do</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good1 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good2 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good3 <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">  curl <span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/good4
</span></span><span class="line"><span class="cl">  sleep 0.1
</span></span><span class="line"><span class="cl">  <span class="k">done</span> <span class="p">&amp;</span></span></span></code></pre></div>
</div><p>b. After 7 minutes start the attack:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52f6d510&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52f6d510">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> <span class="o">[</span> <span class="nb">true</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP1</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/ <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP2</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/ <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP3</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -s <span class="m">10</span> -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> killall ab
</span></span><span class="line"><span class="cl"> <span class="k">done</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="k">while</span> <span class="o">[</span> <span class="nb">true</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">do</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP1</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/ <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP2</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/ <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">ab -B <span class="si">${</span><span class="nv">BAD_IP3</span><span class="si">}</span> -l -r -n <span class="m">1000000</span> -c <span class="m">150</span> -d -s <span class="m">10</span> -H <span class="s2">&#34;Host: evil.net&#34;</span> -H <span class="s2">&#34;Pragma: no-cache&#34;</span> -H <span class="s2">&#34;Cache-Control: no-cache&#34;</span> -H <span class="s2">&#34;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&#34;</span> -H <span class="s2">&#34;Upgrade-Insecure-Requests: 1&#34;</span> -H <span class="s2">&#34;User-Agent: WireXBot&#34;</span> -H <span class="s2">&#34;x-requested-with:&#34;</span> -H <span class="s2">&#34;Referer: http://10.0.2.1/none.html&#34;</span> -H <span class="s2">&#34;Accept-Encoding: gzip, deflate&#34;</span> -H <span class="s2">&#34;Accept-Language: en-US&#34;</span> http://<span class="si">${</span><span class="nv">VS</span><span class="si">}</span>/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"> killall ab
</span></span><span class="line"><span class="cl"> <span class="k">done</span></span></span></code></pre></div>
</div><p>c. See that the good traffic continue as usual while the attackers receive denial of service.</p>
</li>
</ol>
<p>To check NGINX App Protect WAF along side NGINX App Protect DoS, just perform the normal tests as specified at <a href="https://docs.nginx.com/nginx-app-protect/admin-guide/" target="_blank" rel="noopener">Admin Guide</a></p>
<h3 
id="compatibility-with-nginx-plus-releases">Compatibility with NGINX Plus Releases  <a class="headerlink float-right" href="#compatibility-with-nginx-plus-releases" title="Compatibility with NGINX Plus Releases"><i class="fas fa-link fa-xs"></i></a>
</h3><p>A threat campaign package is compatible with the NGINX Plus release supported during the time the threat campaign package was released and with all future releases from that point in time on. In other words, it is not compatible with earlier App Protect DoS releases. Those older releases are not supported at this point in time so you will have to upgrade App Protect DoS to benefit from the support which includes Threat campaigns updates.</p>
<h2 
id="upgrading-app-protect-dos">Upgrading App Protect DoS  <a class="headerlink float-right" href="#upgrading-app-protect-dos" title="Upgrading App Protect DoS"><i class="fas fa-link fa-xs"></i></a>
</h2><p>You can upgrade to the latest NGINX Plus and App Protect DoS versions by downloading and installing the latest NGINX App Protect DoS package. When upgrading from this package, App Protect DoS will be uninstalled and reinstalled. The old default security policy is deleted and the new default security policy is installed. If you have created a custom security policy, the policy persists and you will need to update <code>nginx.conf</code> and point to the custom security policy by referencing the json file (using the full path).</p>
<p>If you upgrade your NGINX version outside of the App Protect DoS module, App Protect DoS will be uninstalled and you will need to reinstall it. You need to restart NGINX after an upgrade.</p>
<h2 
id="selinux">SELinux  <a class="headerlink float-right" href="#selinux" title="SELinux"><i class="fas fa-link fa-xs"></i></a>
</h2><p>The default settings for Security-Enhanced Linux (SELinux) on modern Red Hat Enterprise Linux (RHEL) and related Linux distributions can be very strict, erring on the side of security rather than convenience.</p>
<p>Although the App Protect DoS applies its SELinux policy module during installation, your specific configuration might be blocked unless you adjust the policy or modify file labels.</p>
<h3 
id="modifying-file-labels">Modifying File Labels  <a class="headerlink float-right" href="#modifying-file-labels" title="Modifying File Labels"><i class="fas fa-link fa-xs"></i></a>
</h3><p>For example, if you plan to store your log configuration files in <code>/etc/logs</code> - you should change the default SELinux file context for this directory:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52f96550&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f52f96550">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage fcontext -a -t httpd_config_t /etc/logs
</span></span><span class="line"><span class="cl">restorecon -Rv /etc/logs</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage fcontext -a -t httpd_config_t /etc/logs
</span></span><span class="line"><span class="cl">restorecon -Rv /etc/logs</span></span></code></pre></div>
</div><h3 
id="syslog-to-custom-port">Syslog to Custom Port  <a class="headerlink float-right" href="#syslog-to-custom-port" title="Syslog to Custom Port"><i class="fas fa-link fa-xs"></i></a>
</h3><p>If you want to send logs to some unreserved port, you can use semanage to add the desired port (here, 35514) to the syslogd_port_t type:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52fb1eb8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52fb1eb8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage port -a -t syslogd_port_t -p tcp <span class="m">35514</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage port -a -t syslogd_port_t -p tcp <span class="m">35514</span></span></span></code></pre></div>
</div><p>Review the syslog ports by entering the following command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f52fc7290&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f52fc7290">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage port -l <span class="p">|</span> grep syslog</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">semanage port -l <span class="p">|</span> grep syslog</span></span></code></pre></div>
</div><h3 
id="kubernetes-deployment-examples">Kubernetes Deployment Examples  <a class="headerlink float-right" href="#kubernetes-deployment-examples" title="Kubernetes Deployment Examples"><i class="fas fa-link fa-xs"></i></a>
</h3><h4 
id="app-protect-dos">App Protect DoS  <a class="headerlink float-right" href="#app-protect-dos" title="App Protect DoS"><i class="fas fa-link fa-xs"></i></a>
</h4><p><code>appprotect-dos.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5308d670&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5308d670">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">centos-bados</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">example.com/centos_app_protect_dos_r24:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;200m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;900m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;800Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">probe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8091</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">probe500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/app_protect_dos_liveness</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/app_protect_dos_readiness</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/shared/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">root-script</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/root/entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect_dos/log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">pvc-appprotect-dos-shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">root-script</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-entry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">defaultMode</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">defaultMode</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">revisionHistoryLimit</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">strategy</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">RollingUpdate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">rollingUpdate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxSurge</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxUnavailable</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">centos-bados</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">example.com/centos_app_protect_dos_r24:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Always</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;200m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;900m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;800Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">web</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">probe</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">8091</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">probe500</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">livenessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/app_protect_dos_liveness</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">readinessProbe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">httpGet</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">/app_protect_dos_readiness</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">8090</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="m">0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">periodSeconds</span><span class="p">:</span><span class="w"> </span><span class="m">10</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/shared/</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">root-script</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/root/entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect_dos/log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">pvc-appprotect-dos-shared</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">root-script</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-entry</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">defaultMode</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">entrypoint.sh</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">cm-appprotect-dos-log-default</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">defaultMode</span><span class="p">:</span><span class="w"> </span><span class="m">0755</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">log-default.json</span></span></span></code></pre></div>
</div><p><code>svc-appprotect-dos.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f530bbca0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f530bbca0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">svc-appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">svc-appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">nodePort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
</div><p><code>log-default.json</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">json</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f530d7220&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f530d7220">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;filter&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;traffic-mitigation-stats&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;bad-actors&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;attack-signatures&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;filter&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;traffic-mitigation-stats&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;bad-actors&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;attack-signatures&#34;</span><span class="p">:</span> <span class="s2">&#34;all&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><p><code>entrypoint.sh</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53122158&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f53122158">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/usr/bin/env bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">USER</span><span class="o">=</span>nginx
</span></span><span class="line"><span class="cl"><span class="nv">LOGDIR</span><span class="o">=</span>/var/log/adm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># prepare environment</span>
</span></span><span class="line"><span class="cl">mkdir -p /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chmod <span class="m">755</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">chown <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>:<span class="si">${</span><span class="nv">USER</span><span class="si">}</span> /var/run/adm /tmp/cores <span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># run processes</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/adminstall &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/adminstall.log 2&gt;&amp;1&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></span><span class="line"><span class="cl">/usr/sbin/nginx -g <span class="s1">&#39;daemon off;&#39;</span> <span class="p">&amp;</span>
</span></span><span class="line"><span class="cl">/bin/su -s /bin/bash -c <span class="s2">&#34;/usr/bin/admd -d --log info &gt; </span><span class="si">${</span><span class="nv">LOGDIR</span><span class="si">}</span><span class="s2">/admd.log 2&gt;&amp;1 &amp;&#34;</span> <span class="si">${</span><span class="nv">USER</span><span class="si">}</span></span></span></code></pre></div>
</div><p><code>install.sh</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f531716e0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f531716e0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-nginx --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/nginx.conf
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-entry --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/entrypoint.sh
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-log-default --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/log-default.json
</span></span><span class="line"><span class="cl">kubectl create -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos.yaml
</span></span><span class="line"><span class="cl"><span class="c1">#kubectl create -f ${DIR}/svc-appprotect-dos.yaml</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-nginx --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/nginx.conf
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-entry --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/entrypoint.sh
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff create cm cm-appprotect-dos-log-default --from-file <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/log-default.json
</span></span><span class="line"><span class="cl">kubectl create -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos.yaml
</span></span><span class="line"><span class="cl"><span class="c1">#kubectl create -f ${DIR}/svc-appprotect-dos.yaml</span></span></span></code></pre></div>
</div><p><code>nginx.conf</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f531d5488&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f531d5488">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>    <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span> <span class="s">serv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv:80/</span> <span class="s">protocol=http1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">8090</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span> <span class="s">probe</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_liveness</span> <span class="no">on</span><span class="p">;</span>    <span class="c1"># uri:/app_protect_dos_liveness port:8090
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_dos_readiness</span> <span class="no">on</span><span class="p">;</span>   <span class="c1"># uri:/app_protect_dos_readiness port:8090
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://localhost:8091</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">8091</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">return</span> <span class="mi">503</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span> <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">error_log</span> <span class="s">/var/log/nginx/error.log</span> <span class="s">debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_rlimit_nofile</span> <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">working_directory</span> <span class="s">/tmp/cores</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_dos_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">65535</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>         <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>    <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span> <span class="s">log_napd</span> <span class="s">&#39;,</span> <span class="s">vs_name_al=</span><span class="nv">$app_protect_dos_vs_name,</span> <span class="s">ip=</span><span class="nv">$remote_addr,</span> <span class="s">tls_fp=</span><span class="nv">$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;outcome=</span><span class="nv">$app_protect_dos_outcome,</span> <span class="s">reason=</span><span class="nv">$app_protect_dos_outcome_reason,</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                        <span class="s">&#39;ip_tls=</span><span class="nv">$remote_addr:$app_protect_dos_tls_fp,</span> <span class="s">&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">app_protect_dos_security_log</span> <span class="s">&#34;/etc/app_protect_dos/log-default.json&#34;</span> <span class="s">/var/log/adm/logger.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># app_protect_dos_security_log &#34;/etc/app_protect_dos/log-default.json&#34; syslog:server=1.2.3.4:5261;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">80</span> <span class="s">reuseport</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span> <span class="s">serv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">set</span> <span class="nv">$loggable</span> <span class="s">&#39;0&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">access_log</span> <span class="s">/var/log/nginx/access.log</span> <span class="s">log_napd</span> <span class="s">if=</span><span class="nv">$loggable</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># access_log syslog:server=1.1.1.1:5561 log_napd if=$loggable;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_policy_file</span> <span class="s">&#34;/etc/app_protect_dos/BADOSDefaultPolicy.json&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_name</span> <span class="s">&#34;App1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">app_protect_dos_monitor</span> <span class="s">uri=http://serv:80/</span> <span class="s">protocol=http1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://1.2.3.4:80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">8090</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">server_name</span> <span class="s">probe</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">app_protect_dos_liveness</span> <span class="no">on</span><span class="p">;</span>    <span class="c1"># uri:/app_protect_dos_liveness port:8090
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_dos_readiness</span> <span class="no">on</span><span class="p">;</span>   <span class="c1"># uri:/app_protect_dos_readiness port:8090
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kn">proxy_pass</span> <span class="s">http://localhost:8091</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">listen</span> <span class="mi">8091</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">return</span> <span class="mi">503</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>            <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">tcp_nopush</span>          <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>   <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div><h4 
id="app-protect-dos-arb">App Protect DoS arb  <a class="headerlink float-right" href="#app-protect-dos-arb" title="App Protect DoS arb"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Arbitrator (arb) is an internal service that is essential for the scaling scenarios. The arbitrator service should be deployed in the same namespace as NGINX App Protect DoS.</p>
<p><code>appprotect-dos-arb.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5321a218&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5321a218">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">arb-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">example.com/app_protect_dos_arb:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;200m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;900m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;800Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">arb-svc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">example.com/app_protect_dos_arb:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;200m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;500Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">limits</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">cpu</span><span class="p">:</span><span class="w">  </span><span class="s2">&#34;900m&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;800Mi&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span></span></span></code></pre></div>
</div><p><code>svc-appprotect-dos-arb.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f53249400&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f53249400">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">svc-appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l">None</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">svc-appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-wp-diff</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">appprotect-dos-arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">arb</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">3000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">clusterIP</span><span class="p">:</span><span class="w"> </span><span class="l">None</span></span></span></code></pre></div>
</div><p><code>install_appprotect-arb.sh</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f5327d408&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f5327d408">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff apply -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos-arb.yaml
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff apply -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/svc-appprotect-dos-arb.yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff apply -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos-arb.yaml
</span></span><span class="line"><span class="cl">kubectl -n appprotect-dos-wp-diff apply -f <span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/svc-appprotect-dos-arb.yaml</span></span></code></pre></div>
</div><p><code>install NGINX App Protect DoS with ARB service</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f532aa6b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f532aa6b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl create ns appprotect-dos-wp-diff
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos/install.sh
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos-arb/install_appprotect-dos-arb.sh</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="nb">set</span> -ex
</span></span><span class="line"><span class="cl"><span class="nv">DIR</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span> <span class="nb">cd</span> <span class="s2">&#34;</span><span class="k">$(</span> dirname <span class="s2">&#34;</span><span class="si">${</span><span class="nv">BASH_SOURCE</span><span class="p">[0]</span><span class="si">}</span><span class="s2">&#34;</span> <span class="k">)</span><span class="s2">&#34;</span> &gt;/dev/null 2&gt;<span class="p">&amp;</span><span class="m">1</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span> <span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">kubectl create ns appprotect-dos-wp-diff
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos/install.sh
</span></span><span class="line"><span class="cl"><span class="si">${</span><span class="nv">DIR</span><span class="si">}</span>/appprotect-dos-arb/install_appprotect-dos-arb.sh</span></span></code></pre></div>
</div><hr>
<h2 
id="app-protect-dos-ebpf-manager">App Protect DoS eBPF manager  <a class="headerlink float-right" href="#app-protect-dos-ebpf-manager" title="App Protect DoS eBPF manager"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="overview-2">Overview  <a class="headerlink float-right" href="#overview-2" title="Overview"><i class="fas fa-link fa-xs"></i></a>
</h3><p>The eBPF Manager is a powerful and efficient tool designed to simplify and secure the deployment of eBPF (Extended Berkeley Packet Filter) programs for advanced networking use cases.
Its primary responsibilities include program installation and managing client interactions to enable real-time packet processing and mitigation solutions.</p>
<h3 
id="cli-options-for-flexible-configuration">CLI Options for Flexible Configuration  <a class="headerlink float-right" href="#cli-options-for-flexible-configuration" title="CLI Options for Flexible Configuration"><i class="fas fa-link fa-xs"></i></a>
</h3><p>The eBPF Manager comes with configurable command-line flags for ease of use and deployment customization. Key options include:</p>
<ul>
<li>Interface Selection:
<ul>
<li>-i, &ndash;interface [interfaces&hellip;]: Specify one or more network interfaces for eBPF XDP program deployment. If omitted, it defaults to all non-virtual, active network devices.</li>
</ul>
</li>
<li>gRPC UDS Ownership:
<ul>
<li>-u, &ndash;user &lt;user_name&gt;: Set the user ownership for the gRPC Unix Domain Socket (UDS). Defaults to nginx.</li>
<li>-g, &ndash;group &lt;group_name&gt;: Set the group ownership for the gRPC Unix Domain Socket (UDS). Defaults to nginx.</li>
</ul>
</li>
</ul>

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nap-dos/deployment-guide/learn-about-deployment.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nap-dos/deployment-guide/learn-about-deployment.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=NGINX%20App%20Protect%20DoS%20Deployment&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		

		
			<li style="flex:1; text-align: right; white-space: nowrap;"><a href="http://localhost:1313/nginx-app-protect-dos/deployment-guide/installing-nginx-plus-with-dos-and-waf-on-amazon-web-services/" class="" title="Next -- NGINX App Protect WAF &#43; DoS AMIs on Amazon EC2"><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24.622 1.5L46.06 22.94C46.1993 23.0791 46.3099 23.2444 46.3853 23.4262C46.4607 23.6081 46.4995 23.8031 46.4995 24C46.4995 24.1969 46.4607 24.3919 46.3853 24.5738C46.3099 24.7556 46.1993 24.9209 46.06 25.06L24.622 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.122 1.5L23.56 22.94C23.6993 23.0791 23.8099 23.2444 23.8853 23.4262C23.9607 23.6081 23.9995 23.8031 23.9995 24C23.9995 24.1969 23.9607 24.3919 23.8853 24.5738C23.8099 24.7556 23.6993 24.9209 23.56 25.06L2.122 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#overview">Overview</a></li>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#platform-security-considerations">Platform Security Considerations</a></li>
    <li><a href="#centos-74-installation">CentOS 7.4+ Installation</a></li>
    <li><a href="#rhel-74-installation">RHEL 7.4+ Installation</a></li>
    <li><a href="#rhel-8--rocky-linux-8-installation">RHEL 8+ / Rocky Linux 8 Installation</a></li>
    <li><a href="#rhel-9-installation">RHEL 9+ Installation</a></li>
    <li><a href="#debian--ubuntu-installation">Debian / Ubuntu Installation</a></li>
    <li><a href="#alpine-315x--317x--319x-installation">Alpine 3.15.x / 3.17.x / 3.19.x Installation</a></li>
    <li><a href="#amazon-linux-2023-installation">Amazon Linux 2023 Installation</a></li>
    <li><a href="#docker-deployment">Docker Deployment</a>
      <ul>
        <li><a href="#docker-deployment-instructions">Docker Deployment Instructions</a></li>
        <li><a href="#centos-74-docker-deployment-example">CentOS 7.4 Docker Deployment Example</a></li>
        <li><a href="#ubi7-docker-deployment-example">UBI7 Docker Deployment Example</a></li>
        <li><a href="#rhel-8--rocky-linux-8-docker-deployment-example">RHEL 8 / Rocky Linux 8 Docker Deployment Example</a></li>
        <li><a href="#rhel-9-docker-deployment-example">RHEL 9 Docker Deployment Example</a></li>
        <li><a href="#debian-10-buster--debian-11-bullseye--debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye) / Debian 12 (Bookworm) Docker Deployment Example</a></li>
        <li><a href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble-docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble) Docker Deployment Example</a></li>
        <li><a href="#alpine-docker-deployment-example">Alpine Docker Deployment Example</a></li>
        <li><a href="#amazonlinux-2023-docker-deployment-example">AmazonLinux 2023 Docker Deployment Example</a></li>
      </ul>
    </li>
    <li><a href="#docker-deployment-with-nginx-app-protect">Docker Deployment with NGINX App Protect</a>
      <ul>
        <li><a href="#docker-deployment-instructions-1">Docker Deployment Instructions</a></li>
        <li><a href="#centos-74-docker-deployment-example-1">Centos 7.4 Docker Deployment Example</a></li>
        <li><a href="#rhel-74-docker-deployment-example">RHEL 7.4 Docker Deployment Example</a></li>
        <li><a href="#debian-10-buster--debian-11-bullseye---debian-12-bookworm-docker-deployment-example">Debian 10 (Buster) / Debian 11 (Bullseye)  / Debian 12 (Bookworm) Docker Deployment Example</a></li>
        <li><a href="#ubuntu-1804-bionic--2004-focal--2204-jammy--2404-noble--docker-deployment-example">Ubuntu 18.04 (Bionic) / 20.04 (Focal) / 22.04 (Jammy) / 24.04 (Noble)  Docker Deployment Example</a></li>
      </ul>
    </li>
    <li><a href="#nginx-app-protect-dos-arbitrator">NGINX App Protect DoS Arbitrator</a>
      <ul>
        <li><a href="#overview-1">Overview</a></li>
        <li><a href="#why-nginx-app-protect-dos-arbitrator-is-necessary">Why NGINX App Protect DoS Arbitrator is Necessary</a></li>
        <li><a href="#nginx-app-protect-dos-arbitrator-deployment">NGINX App Protect DoS Arbitrator Deployment</a></li>
        <li><a href="#multi-vm-deployment">Multi-VM Deployment</a></li>
      </ul>
    </li>
    <li><a href="#post-installation-checks">Post-Installation Checks</a>
      <ul>
        <li><a href="#compatibility-with-nginx-plus-releases">Compatibility with NGINX Plus Releases</a></li>
      </ul>
    </li>
    <li><a href="#upgrading-app-protect-dos">Upgrading App Protect DoS</a></li>
    <li><a href="#selinux">SELinux</a>
      <ul>
        <li><a href="#modifying-file-labels">Modifying File Labels</a></li>
        <li><a href="#syslog-to-custom-port">Syslog to Custom Port</a></li>
        <li><a href="#kubernetes-deployment-examples">Kubernetes Deployment Examples</a></li>
      </ul>
    </li>
    <li><a href="#app-protect-dos-ebpf-manager">App Protect DoS eBPF manager</a>
      <ul>
        <li><a href="#overview-2">Overview</a></li>
        <li><a href="#cli-options-for-flexible-configuration">CLI Options for Flexible Configuration</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          ©2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>©2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


