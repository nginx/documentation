<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Troubleshooting on DEV -- docs-nginx-com</title>
    <link>http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/</link>
    <description>Recent content in Troubleshooting on DEV -- docs-nginx-com</description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <atom:link href="http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>NGINX App Protect WAF Troubleshooting Guide</title>
      <link>http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/</guid>
      <description>&lt;h2 &#xA;id=&#34;overview&#34;&gt;Overview  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#overview&#34; title=&#34;Overview&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;This Troubleshooting Guide is intended to provide guidance to customers in the detection and correction of programming issues in F5 NGINX App Protect WAF. It may also be useful to IT in resolving any installation or configuration problems. &lt;br&gt;&lt;/p&gt;&#xA;&lt;p&gt;Refer to the below table for any NGINX App Protect WAF installation or configuration known problems.&lt;/p&gt;&#xA;&lt;h2 &#xA;id=&#34;resolving-known-problems&#34;&gt;Resolving Known Problems  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#resolving-known-problems&#34; title=&#34;Resolving Known Problems&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;h3 &#xA;id=&#34;configuration&#34;&gt;Configuration  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#configuration&#34; title=&#34;Configuration&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h3&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&lt;table class=&#34;table table-striped table-bordered table-sm table-responsive table-v1&#34;&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Problem&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Solution&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX is not running (ps -aux)&lt;br&gt;&lt;br&gt; Reloading NGINX fails&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Check the error log at &lt;code&gt;/var/log/nginx/error.log&lt;/code&gt;&lt;br&gt;Fix the problem and re-run NGINX.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect WAF functionality is not as expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect WAF has several logs which can be used for troubleshooting. &lt;br&gt; Usually, it is best to look for any warning or error messages within the logs. &lt;br&gt; Refer to &lt;a href=&#34;http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/logs-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Logs Overview&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;Too many open files&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase number of file descriptors. &lt;br&gt; For example: &lt;code&gt;worker_rlimit_nofile 65535;&lt;/code&gt; in the main context of &lt;code&gt;nginx.conf&lt;/code&gt; file. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;worker_rlimit_nofile directive&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;setrlimit ... failed (Permission denied)&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase the limit using the following command as the root user:&lt;br&gt; &lt;code&gt;setsebool -P httpd_setrlimit 1;&lt;/code&gt; &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue 4: Too many files are open Error&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;unknown directive &lt;code&gt;app_protect_xxx&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;App Protect module is not loaded. Add this line to the main (global) context of nginx.conf:&lt;br&gt;&lt;code&gt;load_module &amp;quot;/etc/nginx/modules/ngx_http_app_protect_module.so&amp;quot;;&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Compiler error message:&lt;br&gt;&lt;em&gt;Expected declarative policy&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Make sure your policy conforms to proper WAF policy standards. The proper structure is:&lt;pre&gt;&lt;code&gt;&lt;code&gt;{&lt;/code&gt;&lt;br&gt;    &lt;code&gt;&amp;quot;policy&amp;quot;: {&lt;/code&gt;&lt;br&gt;    &lt;code&gt;...&lt;/code&gt;&lt;br&gt;    &lt;code&gt;}&lt;/code&gt;&lt;br&gt;&lt;code&gt;}&lt;/code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Policy Bundles version is older than the local version&lt;/em&gt;&lt;br&gt;and&lt;br&gt;&lt;em&gt;Policy Bundles version is newer than the local version&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Recompile all of your bundles from scratch. Bundles must always be recompiled whenever you install security updates.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Found mixed content of compiled and raw configuration&lt;/em&gt;&lt;br&gt;and&lt;br&gt; &lt;em&gt;Compiler is required, but not installed: Missing /opt/app_protect/bin/config_set_compiler&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Only pre-compiled bundles can be used in the nginx.conf &amp;ndash; don&amp;rsquo;t use JSON policies. Make sure the JSON policies are compiled to bundles first.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Policy Bundles have differing global states&lt;/em&gt;&lt;br&gt;and&lt;br&gt;&lt;em&gt;Policy Bundles have differing cookie seeds&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Recompile all of your bundles from scratch with your custom compiler. Bundles must always be compiled using the same compiler image/version. Default and custom policy bundles can&amp;rsquo;t be mixed.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Duplicate policy name found&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Don&amp;rsquo;t compile multiple policies with the same name, and don&amp;rsquo;t compile one policy to multiple bundles. Each policy can only be compiled once but the bundle can be reused many times.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Duplicate logging profile name found&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Don&amp;rsquo;t compile the same logging profile to multiple bundles. Each logging profile can only be compiled once but the bundle can be reused many times.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Timeout waiting for enforcer&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Likely an internal issue. Please contact support and provide the policies used in the bundles.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;  &#xA;&#xA;&#xA;&lt;div data-mf=&#34;true&#34; style=&#34;display: none;&#34; class=&#34;table-v2 table table-striped table-bordered table-sm table-responsive narrow&#34;&gt;&#xA;    &lt;table&gt;&#xA;  &lt;thead&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Problem&lt;/th&gt;&#xA;          &lt;th style=&#34;text-align: left&#34;&gt;Solution&lt;/th&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/thead&gt;&#xA;  &lt;tbody&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX is not running (ps -aux)&lt;br&gt;&lt;br&gt; Reloading NGINX fails&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Check the error log at &lt;code&gt;/var/log/nginx/error.log&lt;/code&gt;&lt;br&gt;Fix the problem and re-run NGINX.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect WAF functionality is not as expected&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;NGINX App Protect WAF has several logs which can be used for troubleshooting. &lt;br&gt; Usually, it is best to look for any warning or error messages within the logs. &lt;br&gt; Refer to &lt;a href=&#34;http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/logs-overview/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Logs Overview&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;Too many open files&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase number of file descriptors. &lt;br&gt; For example: &lt;code&gt;worker_rlimit_nofile 65535;&lt;/code&gt; in the main context of &lt;code&gt;nginx.conf&lt;/code&gt; file. &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;worker_rlimit_nofile directive&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;&lt;code&gt;setrlimit ... failed (Permission denied)&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Increase the limit using the following command as the root user:&lt;br&gt; &lt;code&gt;setsebool -P httpd_setrlimit 1;&lt;/code&gt; &lt;br&gt; Refer to &lt;a href=&#34;https://www.nginx.com/blog/using-nginx-plus-with-selinux/#Issue-4:-%3Ccode%3EToo-many-files-are-open%3C/code%3E-Error&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Issue 4: Too many files are open Error&lt;/a&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;unknown directive &lt;code&gt;app_protect_xxx&lt;/code&gt; error message&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;App Protect module is not loaded. Add this line to the main (global) context of nginx.conf:&lt;br&gt;&lt;code&gt;load_module &amp;quot;/etc/nginx/modules/ngx_http_app_protect_module.so&amp;quot;;&lt;/code&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Compiler error message:&lt;br&gt;&lt;em&gt;Expected declarative policy&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Make sure your policy conforms to proper WAF policy standards. The proper structure is:&lt;pre&gt;&lt;code&gt;&lt;code&gt;{&lt;/code&gt;&lt;br&gt;    &lt;code&gt;&amp;quot;policy&amp;quot;: {&lt;/code&gt;&lt;br&gt;    &lt;code&gt;...&lt;/code&gt;&lt;br&gt;    &lt;code&gt;}&lt;/code&gt;&lt;br&gt;&lt;code&gt;}&lt;/code&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Policy Bundles version is older than the local version&lt;/em&gt;&lt;br&gt;and&lt;br&gt;&lt;em&gt;Policy Bundles version is newer than the local version&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Recompile all of your bundles from scratch. Bundles must always be recompiled whenever you install security updates.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Found mixed content of compiled and raw configuration&lt;/em&gt;&lt;br&gt;and&lt;br&gt; &lt;em&gt;Compiler is required, but not installed: Missing /opt/app_protect/bin/config_set_compiler&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Only pre-compiled bundles can be used in the nginx.conf &amp;ndash; don&amp;rsquo;t use JSON policies. Make sure the JSON policies are compiled to bundles first.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error messages:&lt;br&gt;&lt;em&gt;Policy Bundles have differing global states&lt;/em&gt;&lt;br&gt;and&lt;br&gt;&lt;em&gt;Policy Bundles have differing cookie seeds&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Recompile all of your bundles from scratch with your custom compiler. Bundles must always be compiled using the same compiler image/version. Default and custom policy bundles can&amp;rsquo;t be mixed.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Duplicate policy name found&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Don&amp;rsquo;t compile multiple policies with the same name, and don&amp;rsquo;t compile one policy to multiple bundles. Each policy can only be compiled once but the bundle can be reused many times.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Duplicate logging profile name found&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Don&amp;rsquo;t compile the same logging profile to multiple bundles. Each logging profile can only be compiled once but the bundle can be reused many times.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;      &lt;tr&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Error message:&lt;br&gt;&lt;em&gt;Timeout waiting for enforcer&lt;/em&gt;&lt;/td&gt;&#xA;          &lt;td style=&#34;text-align: left&#34;&gt;Likely an internal issue. Please contact support and provide the policies used in the bundles.&lt;/td&gt;&#xA;      &lt;/tr&gt;&#xA;  &lt;/tbody&gt;&#xA;&lt;/table&gt;&#xA;&#xA;&lt;/div&gt;&#xA;&lt;h2 &#xA;id=&#34;selinux&#34;&gt;SELinux  &lt;a class=&#34;headerlink float-right&#34; href=&#34;#selinux&#34; title=&#34;SELinux&#34;&gt;&lt;i class=&#34;fas fa-link fa-xs&#34;&gt;&lt;/i&gt;&lt;/a&gt;&#xA;&lt;/h2&gt;&lt;p&gt;In some operating systems, security mechanisms like &lt;strong&gt;SELinux&lt;/strong&gt; or &lt;strong&gt;AppArmor&lt;/strong&gt; are enabled by default, potentially blocking necessary file access for the &lt;code&gt;nginx&lt;/code&gt; process and &lt;code&gt;waf-config-mgr&lt;/code&gt; and &lt;code&gt;waf-enforcer&lt;/code&gt; containers. To ensure NGINX App Protect WAF operates smoothly without compromising security, consider setting up a custom SELinux policy or AppArmor profile. For short-term troubleshooting, you may use &lt;code&gt;permissive&lt;/code&gt; (SELinux) or &lt;code&gt;complain&lt;/code&gt; (AppArmor) mode to avoid these restrictions, but keep in mind that this lowers security and isn&amp;rsquo;t advised for prolonged use.&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
