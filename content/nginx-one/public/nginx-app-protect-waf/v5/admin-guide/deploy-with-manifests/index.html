<!DOCTYPE html>
<html lang="en-us">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>  
  <style>
    body {
       
      visibility: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
  </style>
  
  <noscript>
    <style>
       
      body {
        visibility: visible;
      }
    </style>
  </noscript>
  


  <script>

    const setTheme = (isNewTheme) => {
      localStorage.setItem("useNewTheme", `${isNewTheme}`);
      
      const v1cssIds = [
        "cssFA1",
        "cssFA2",
        "cssFA3",
        "cssBootstrap",
        "css1",
        "css2",
        "css3",
        "css4",
        "css5",
        "css6",
      ];

      v1cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = isNewTheme;
        }
      });

      const v2cssIds = ["css7", "css9"];
      v2cssIds.forEach((cssId) => {
        const element = document.getElementById(cssId);
        if (element !== null) {
          element.disabled = !isNewTheme;
        }
      });

      
      const v1ElementIds = ["sidebar", "footer", "toc", "api", "search-v1", "breadcrumb-v1", "list-v1"]

      v1ElementIds.forEach((elementId) => {
        const element = document.getElementById(elementId);
        if (element !== null) {
          element.style.display = isNewTheme ? "none" : "";
        }

        const trustarc = document.getElementById("teconsent-v1");
        if (trustarc) {
          trustarc.id = isNewTheme ? "teconsent-v1" : "teconsent";
        }
      });

      document.querySelectorAll(".table-v1").forEach((table) => {
        table.style.display = isNewTheme ? "none" : "";
      });

      const notMfElements = ['[data-mf="false"]'];
      notMfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "none" : "";
        });
      })

      const mfElements = ['[data-mf="true"]'];
      mfElements.forEach((elementId) => {
        document.querySelectorAll(elementId).forEach((element) => {
          element.style.display = isNewTheme ? "" : "none";

          const trustarc = document.getElementById("teconsent-v2");
          if (trustarc) {
            trustarc.id = isNewTheme ? "teconsent" : "teconsent-v2";
          }
        });
      });

      document.getElementById("body").style.visibility = "visible";
    };

    const toggleTheme = () => {
      setTheme(!(localStorage.getItem("useNewTheme") === "true"));
    };

    
    const mf = toggleTheme;
    const useNewTheme = toggleTheme;

    document.addEventListener("DOMContentLoaded", () => {
      setTheme(localStorage.getItem("useNewTheme") === "true");
    });

    function gameCode(callback) {
      let kkeys = [];
      
      const code = "38,38,40,40,37,39,37,39,66,65";
      return (event) => {
        kkeys.push(event.keyCode);
        if (kkeys.toString().indexOf(code) >= 0) {
          callback(event);
          kkeys = [];
        }
      };
    }
    const handler = gameCode(() => {
      mf();
    });
    window.addEventListener("keydown", handler);

  </script>

  

  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Deploy NGINX App Protect WAF with Manifests | DEV -- docs-nginx-com</title>






<link rel="canonical" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-manifests/">







<meta property="article:publisher" content="https://www.facebook.com/nginxinc" />
<meta property="og:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta property="og:image:width" content="500" />
<meta property="og:image:height" content="300" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:description" content="" />
<meta name="twitter:title" content="Deploy NGINX App Protect WAF with Manifests" />
<meta name="twitter:site" content="@nginx" />
<meta name="twitter:image" content="http://localhost:1313/images/icons/NGINX-Docs-new-docs-dark-1200x630.png" />
<meta name="twitter:creator" content="@nginx" />

<meta http-equiv="last-modified" content="01/04/2025" />




<meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline'
    https://consent.trustarc.com/ https://mktg.tags.f5.com/basic/prod/utag.sync.js https://static.cloud.coveo.com/ https://*.f5.com/
    https://*.netlify.app https://gist.github.com
    https://tag.demandbase.com/pscSDsz4.min.js
    https://munchkin.brightfunnel.com/js/build/bf-munchkin.min.js
    https://www.googletagmanager.com/gtm.js
    https://www.google-analytics.com/
    https://www.google-analytics.com/analytics.js
    https://www.google-analytics.com/plugins/ua/linkid.js
    https://cdn.bizible.com/scripts/bizible.js
    https://cdn.bizible.com/xdc.js
    https://f5networksglobalprod.122.2o7.net/
    https://f5networksnginxdocs.122.2o7.net/
    https://*.siteintercept.qualtrics.com/SIE/?Q_ZID=*
    https://siteintercept.qualtrics.com/
    ;
    worker-src 'self' blob:">



<meta property="environment" type="development" />
<meta property="buildtype" type="webdocs" />
<meta property="isServer" type="true" />


<meta name="product" content="DEV -- docs-nginx-com">
<meta name="version" content="">
<meta name="doc_type" content="Manual">
  
  <link rel="shortcut icon" type="image/x-icon" href="http://localhost:1313/images/favicon-48x48.ico">

  
  










<link href="/css/v2/style.css" integrity="" rel="stylesheet" type="text/css" id="css7"
  disabled>


<link href="/css/inter/inter.987d1be34797653eabce3627efb116c263d4045fd5badfe003ff283c5a5da435d83a3fad6bfe524e3ce3cf8a41168a30e7aa42507961257eeb275024def0f9b9.css" integrity="sha512-mH0b40eXZT6rzjYn77EWwmPUBF/Vut/gA/8oPFpdpDXYOj&#43;ta/5STjzjz4pBFoow56pCUHlhJX7rJ1Ak3vD5uQ==" rel="stylesheet" type="text/css"
  id="cssInter">


<link href="/css/v2/highlight.min.9ef7c7ad221175216abc8a5827f967bcd7c0e035bfa91180acd26a2c36d54242ae5f485986c260d70b1bbdf225ad76cdbba3179afa7e4335282cc3080a17e337.css" rel="stylesheet" type="text/css" id="css9">





<link href="/fontawesome/css/all.min.4a71f958af9b67180f1ece38b96217f8b2c9009f7fd8f90f299e508808fa4daf3ac3e7ec6f64e47267d1c955f7a419cc15c57ba103c9925f507af4825abdd6e8.css" integrity="sha512-SnH5WK&#43;bZxgPHs44uWIX&#43;LLJAJ9/2PkPKZ5QiAj6Ta86w&#43;fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" rel="stylesheet" type="text/css"
  id="cssFA1">


<link href="/fontawesome/css/v4-font-face.min.5870089ba06cf03e9721f87919eaf15c961a65e071845949ed2da58c5bfbd18a714c5dab2c155f0455ebcd2f45bfd598a5e47ae19976e7aa3a51e22914eac1b6.css" integrity="sha512-WHAIm6Bs8D6XIfh5GerxXJYaZeBxhFlJ7S2ljFv70YpxTF2rLBVfBFXrzS9Fv9WYpeR64Zl256o6UeIpFOrBtg==" rel="stylesheet" type="text/css"
  id="cssFA2">


<link href="/fontawesome/css/v5-font-face.min.81bdf1c9f8ff16b1eda613d52d868a059f16c8c6045c3d7e0a0b771622a11666cdd94b8ea62b5edb0d4b826c3a3737ec3663065fe05b56b6b871e57de73f556b.css" integrity="sha512-gb3xyfj/FrHtphPVLYaKBZ8WyMYEXD1&#43;Cgt3FiKhFmbN2UuOpite2w1Lgmw6NzfsNmMGX&#43;BbVra4ceV95z9Vaw==" rel="stylesheet" type="text/css"
  id="cssFA3">



<link href="/css/bootstrap.min.3f9320327d6304dd356ac060534cfad10938431897a3cebec2515a84aaec41fdfb73d72ba39d7b5b35523cf575b432b3864bb6889d855602faef01b4dd21a734.css" integrity="sha512-P5MgMn1jBN01asBgU0z60Qk4QxiXo86&#43;wlFahKrsQf37c9cro517WzVSPPV1tDKzhku2iJ2FVgL67wG03SGnNA==" rel="stylesheet"
  type="text/css" id="cssBootstrap">



<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.10104/0/css/CoveoFullSearch.min.css"
  integrity="sha512-9/A9yVCU4GS6/iIwTRJKnan4Hf8gDKj3anwItN9QCsU8SixaT5xkjjWsZ/iq0TWaizhtqOLacadXJfxHlwYCcA=="
  crossorigin="anonymous" />


<link
  rel="stylesheet"
  href="https://static.cloud.coveo.com/atomic/v3.19.0/themes/coveo.css"
  integrity="sha512-m2BufPi8Tc6H2jcQfDj/PIl5H57C9jeqhbDFgFXKTtOhoC4S7ULXmx74FseZ8WXpfdT9uyccMHDBJDrIZlrUUQ=="
  crossorigin="anonymous"/>


<link href="/css/docs-nginx-com/nginx-site-header.min.80b10ed49ecfad93607ee771acca88d13dc958e6eecc642af3aa2b170c86b8dcce442e7b86c3e5298c95b0ab2b053a71074c2f15c28266c3a2c502275415b3a7.css" rel="stylesheet" type="text/css" id="css1">


<link href="/css/docs-nginx-com/style.min.2cd4748c438c49d012a5fdc6b98770223c4875fe0f89517b17423b6a5328af4d93d9d772207bfc51d9449781281e1eb8707dcc2f7467e6e24330c9b8c7c5f734.css" rel="stylesheet" type="text/css" id="css2">


<link href="/css/bootstrap-docs.min.8a70c94c72e3783cecd631bc1705c7843b2fdef99f1549f0bf7f774a4083173ee25974413a8206c2340c0fee9bb7a07acd41d41c78ae2280c96a2ce0faca2847.css" rel="stylesheet" type="text/css" id="css3">



<link href="/css/coveo.min.fce7d4df31de99e4f86510a90915820f236b8dcd02be030b27529af7ff10189f807c78cedacb91afa9d07f310a172c6046b1921832f199b9158898a7f74fa117.css" rel="stylesheet" type="text/css" id="css6">



<link href="/css/f5-hugo.min.42feae8b135e9380a66db9c3cb2803221888524a29f41cbc55790b5cb5a309ac7e6dd80e70ed0260370fd93c04b7aa8a5c3d6aca0964804341fad51cfcec963f.css" rel="stylesheet" type="text/css" id="css4">


<link href="/css/inline-overrides.min.495e6889d9955581580c654bad961bb33af6344b283af7e9a34648c5e8d5f1fe90efb8aac33359c4178efd36cd7cb92c7c6458d4175caff9c284b14bd9d2b97a.css" rel="stylesheet" type="text/css" id="css8">





<link href="/css/highlight.min.fe5647c4b67f4b3fcf0ea60b483479d567ba1b05ee6e816439207edfa3d310dbee79536278c67d89c1db5da275bde962a10163da375f05bd19743e2a80e1ad02.css" rel="stylesheet" type="text/css" id="css5">
  
  
  
  
  
  
        
  <script async="async" src="https://consent.trustarc.com/notice?domain=f5.com&c=teconsent&js=nj&noticeType=bb&text=true&gtm=1" crossorigin=""></script>
  
  

<script src="https://mktg.tags.f5.com/basic/prod/utag.sync.js"></script> 


  
  
  
  
  
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K5HG9JT');</script>
  
  </head>
  
  <body id="body">
    
   
<script type="text/javascript"> 
    (function(a,b,c,d) { 
        a='//mktg.tags.f5.com/basic/prod/utag.js'; 
        b=document;c='script';d=b.createElement(c);d.src=a; 
        d.type='text/java'+c;d.async=true; 
        a=b.getElementsByTagName(c)[0];a.parentNode.insertBefore(d,a)})(); 
</script> 
    
  
    <header>
      
<div class="navbar navbar-expand navbar-dark flex-column flex-md-row bd-navbar navbar-fixed-top">
  <div class="container-fluid flex-md-row flex-column header-container">
    <a class="navbar-brand mr-0 mr-md-2" href="/" aria-label="NGINX Docs">
      <img class="navbar-img" src="http://localhost:1313/images/icons/NGINX-Docs-horiz-white-type.svg" alt="NGINX Docs">
    </a>
    
      <div class="navbar navbar-nav">
        
        <div id="searchbox">
          
          <div class="CoveoSearchbox" data-placeholder='Search NGINX Docs...'></div>
        </div>
        <atomic-search-interface id="search-standalone-header" data-mf="true" style="display:none;">
          <atomic-search-box redirection-url="/search.html">
          </atomic-search-box>
        </atomic-search-interface>
      </div>
    
    
    
    
    <ul class="navbar navbar-nav">
        <li class="nav-item-explore active">
          <button id="navbar-sites-button" class="button navbar-button">
              F5 Sites
              <i id="navbar-sites-button-icon" class="link-chevron-icon fa-solid fa-chevron-down"></i>
          </button>
          <div class="dropdown-content" id="dropdown-content">
            <ul>
              
                <li>
                  <a href="https://community.f5.com/" target="_blank" >DevCentral</a>
                  <p>Connect &amp; learn in our hosted community</p>
                </li>
              
                <li>
                  <a href="https://my.f5.com/" target="_blank" >MyF5</a>
                  <p>Your key to everything F5, including support, registration keys, and subscriptions</p>
                </li>
              
                <li>
                  <a href="https://nginx.org/" target="_blank" >NGINX</a>
                  <p>Learn more about NGINX Open Source and read the community blog</p>
                </li>
              
            </ul>
          </div>
        </li>
    </ul>
  </div>
</div>


    </header>
  
    <section class="base-layout" data-testid="base-layout">
      <section id="breadcrumb-v1">
        
          
          <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/">F5 NGINX App Protect WAF</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/v5/">Version 5</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/v5/admin-guide/">Administration Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                Deploy NGINX App Protect WAF with Manifests
        </ol>
    </div>
</nav>
  
          
        
      </section>
  
      <div class="main container-fluid min-page-height" data-menu-id="/nginx-app-protect-waf/v5/admin-guide/deploy-with-manifests/">
        
<div class="docs-container row override-sidebar-collapse">
<div class="docs-container row override-sidebar-collapse">
  <nav id="sidebar" class="sidenav overflow-auto col-md-3 d-none d-xl-block d-print-none align-top">
    

<div id="sidebar-wrapper">
     <div id="sidebar" class="sidebar" aria-label="Sidebar navigation">
        <button id="sidebar-toggle-button" title="Toggle sidebar navigation" role="button" aria-controls="sidebar-content">
           <i class="fa fa-chevron-right sidebar-visible-collapsed"></i>
           <i class="fa fa-chevron-left sidebar-visible-expanded"></i>
        </button>
        <div id="sidebar-content">
            <h3>
                <a class="sidebar-title" href="http://localhost:1313/nginx-app-protect-waf/" alt="F5 NGINX App Protect WAF"><img
                        class="card-img-top" src="http://localhost:1313//images/icons/NGINX-App-Protect-WAF-product-icon.svg"
                        alt="F5 NGINX App Protect WAF">
                    F5 NGINX App Protect WAF</a>
            </h3>
            <ul>
            
            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-waf/v4/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-waf--version-4-and-earlier" aria-controls="nap-waf--version-4-and-earlier">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Version 4 and Earlier</a>
                            </li>
                        </div>
                        <div id="nap-waf--version-4-and-earlier" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v4/admin-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--administration-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Administration Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--administration-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/admin-guide/install/" href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/install/">NGINX App Protect WAF Administration Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/admin-guide/install-nms/" href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/install-nms/">Using NGINX App Protect WAF with NGINX Management Suite</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/admin-guide/upgrade-nap-waf/" href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/upgrade-nap-waf/">Upgrade NGINX App Protect WAF on Managed Instances</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v4/configuration-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--configuration-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Configuration Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--configuration-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/configuration-guide/configuration/" href="http://localhost:1313/nginx-app-protect-waf/v4/configuration-guide/configuration/">NGINX App Protect WAF Configuration Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v4/declarative-policy/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--declarative-policy">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Declarative Policy</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--declarative-policy" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/declarative-policy/policy/" href="http://localhost:1313/nginx-app-protect-waf/v4/declarative-policy/policy/">NGINX App Protect WAF Declarative Policy</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--logging-overview">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Logging Overview</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--logging-overview" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/logs-overview/" href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/logs-overview/">NGINX App Protect WAF Logs Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/security-log/" href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/security-log/">NGINX App Protect WAF Security Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/operation-logs/" href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/operation-logs/">NGINX App Protect WAF Operation Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/debug-logs/" href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/debug-logs/">NGINX App Protect WAF Debug Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/logging-overview/access-log/" href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/access-log/">NGINX App Protect WAF Access Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/troubleshooting-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--troubleshooting-guide">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Troubleshooting Guide</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--troubleshooting-guide" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/troubleshooting-guide/troubleshooting/" href="http://localhost:1313/nginx-app-protect-waf/v4/troubleshooting-guide/troubleshooting/">NGINX App Protect WAF Troubleshooting Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v4/releases/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v4--releases">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Releases</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v4--releases" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.14/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.14/">NGINX App Protect WAF 4.14</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.13/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.13/">NGINX App Protect WAF 4.13</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.12/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.12/">NGINX App Protect WAF 4.12</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.11/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.11/">NGINX App Protect WAF 4.11</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.10/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.10/">NGINX App Protect WAF 4.10</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.9/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.9/">NGINX App Protect WAF 4.9</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.8.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.8.1/">NGINX App Protect WAF 4.8.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.8/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.8/">NGINX App Protect WAF 4.8</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.7/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.7/">NGINX App Protect WAF 4.7</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.6/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.6/">NGINX App Protect WAF 4.6</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.5/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.5/">NGINX App Protect WAF 4.5</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.4/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.4/">NGINX App Protect WAF 4.4</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.3/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.3/">NGINX App Protect WAF 4.3</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.2/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.2/">NGINX App Protect WAF 4.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.1/">NGINX App Protect WAF 4.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-4.0/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.0/">NGINX App Protect WAF 4.0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.12.2/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.12.2/">NGINX App Protect WAF 3.12.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.12/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.12/">NGINX App Protect WAF 3.12</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.11/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.11/">NGINX App Protect WAF 3.11</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.10/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.10/">NGINX App Protect WAF 3.10</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.9.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.9.1/">NGINX App Protect WAF 3.9.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.9/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.9/">NGINX App Protect WAF 3.9</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.8/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.8/">NGINX App Protect WAF 3.8</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.7/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.7/">NGINX App Protect WAF 3.7</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.6/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.6/">NGINX App Protect WAF 3.6</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.5/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.5/">NGINX App Protect WAF 3.5</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.4/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.4/">NGINX App Protect WAF 3.4</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.3/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.3/">NGINX App Protect WAF 3.3</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.2/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.2/">NGINX App Protect WAF 3.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.1/">NGINX App Protect WAF 3.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-3.0/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.0/">NGINX App Protect WAF 3.0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-2.3/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.3/">NGINX App Protect WAF 2.3</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-2.2/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.2/">NGINX App Protect WAF 2.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-2.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.1/">NGINX App Protect WAF 2.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-2.0/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.0/">NGINX App Protect WAF 2.0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-1.3/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.3/">NGINX App Protect WAF 1.3</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-1.2/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.2/">NGINX App Protect WAF 1.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-1.1/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.1/">NGINX App Protect WAF 1.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v4/releases/about-1.0/" href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.0/">NGINX App Protect WAF 1.0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            
                
                
                <div class="accordion" id="accordion1">
                    <div class="accordion-group">
                        <div class="accordion-heading">
                            <li class="nginx-toc-link l1">
                                    <a data-menu-id="/nginx-app-protect-waf/v5/" class="accordion-toggle" aria-expanded="false"
                                    data-toggle="collapse" href="#" data-target="#nap-waf--version-5" aria-controls="nap-waf--version-5">
                                    <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                        class="fa fa-2xs fa-fw fa-chevron-down"></i>Version 5</a>
                            </li>
                        </div>
                        <div id="nap-waf--version-5" class="accordion-body collapse">
                            <div class="accordion-inner">
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--administration-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Administration Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--administration-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/overview/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/overview/">NGINX App Protect WAF Administration Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/install/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/install/">Installing NGINX App Protect WAF</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/deploy-with-helm/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-helm/">Deploy NGINX App Protect WAF with Helm</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/deploy-with-manifests/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-manifests/">Deploy NGINX App Protect WAF with Manifests</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/deploy-on-docker/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-on-docker/">Deploy NGINX App Protect WAF with Docker</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/compiler/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/compiler/">NGINX App Protect WAF Compiler</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/admin-guide/upgrade-nap-waf/" href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/upgrade-nap-waf/">Upgrade NGINX App Protect WAF on Managed Instances</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/configuration-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--configuration-guides">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Configuration Guides</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--configuration-guides" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/configuration-guide/configuration/" href="http://localhost:1313/nginx-app-protect-waf/v5/configuration-guide/configuration/">NGINX App Protect WAF Configuration Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/declarative-policy/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--declarative-policy">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Declarative Policy</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--declarative-policy" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/declarative-policy/policy/" href="http://localhost:1313/nginx-app-protect-waf/v5/declarative-policy/policy/">NGINX App Protect WAF Declarative Policy</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/logging-overview/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--logging-overview">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Logging Overview</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--logging-overview" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/logging-overview/security-log/" href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/security-log/">NGINX App Protect WAF Security Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/logging-overview/access-log/" href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/access-log/">NGINX App Protect WAF Access Log</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/logging-overview/logs-overview/" href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/logs-overview/">NGINX App Protect WAF Logs Overview</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/troubleshooting-guide/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--troubleshooting">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Troubleshooting</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--troubleshooting" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/" href="http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/">NGINX App Protect WAF Troubleshooting Guide</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                                
                                    
                                    <div class="accordion" id="Accordion2">
                                        <div class="sidebar-l1-padding">
                                            <div class="accordion-group sidebar-il-border">
                                                <div class="accordion-heading">
                                                    <ul>
                                                        <li class="nginx-toc-link l2">
                                                            <a data-menu-id="/nginx-app-protect-waf/v5/releases/" class="accordion-toggle"
                                                                aria-expanded="false" data-toggle="collapse"
                                                                href="#nap-waf--v5--releases">
                                                                <i class="fa fa-2xs fa-fw fa-chevron-right"></i><i
                                                                    class="fa fa-2xs fa-fw fa-chevron-down"></i>Releases</a>
                                                        </li>
                                                    <ul>
                                                </div>
                                                <div id="nap-waf--v5--releases" class="accordion-body collapse leaf">
                                                    <div class="accordion-inner">

                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.6/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.6/">NGINX App Protect WAF 5.6</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.5/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.5/">NGINX App Protect WAF 5.5</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.4/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.4/">NGINX App Protect WAF 5.4</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.3/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.3/">NGINX App Protect WAF 5.3</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.2/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.2/">NGINX App Protect WAF 5.2</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.1/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.1/">NGINX App Protect WAF 5.1</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                        
                                                        
                                                        <ul class="sidebar-l2-padding">
                                                            <li class="nginx-toc-link l3 sidebar-il-border">
                                                                <a data-menu-id="/nginx-app-protect-waf/v5/releases/about-5.0/" href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.0/">NGINX App Protect WAF 5.0</a>
                                                            </li>
                                                        </ul>
                                                        
                                                        
                                                    
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                
                            </div>
                        </div>
                    </div>
                </div>

                

            

            </ul>
        
        </div>
    </div>
</div>

  </nav>

  
  
  <main class="content col d-block align-top content-has-toc" role="main">
  
    
  <section class="main-layout">
    <div class="sidebar-layout" id="sidebar-layout">
      <nav data-mf="true" id="sidebar-v2" class="sidebar" style="display:none;">
        


    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    

    
    





<atomic-search-interface id="search-standalone-sidebar" data-mf="true" style="display:none;">
    <atomic-search-box redirection-url="/search.html">
    </atomic-search-box>
</atomic-search-interface>
<button class="product-selector-button" id="product-selector-button">
    
    <div class="product-selector-name" id="product-selector-name">NGINX App Protect WAF</div>
    <div class="product-selector-button-icon" id="product-selector-button-icon">
        <svg width="8" height="14" viewBox="0 0 8 14" fill="none" xmlns="http://www.w3.org/2000/svg" id="product-selector-chevron-icon">
            <path d="M1 13L7 7L0.999999 1" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="product-selector-chevron-icon"/>
        </svg>     
    </div>
</button>
<div class="product-selector" id="product-selector">
    
    
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX ONE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-one">NGINX One Console</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx">NGINX Plus</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-instance-manager">NGINX Instance Manager</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-ingress-controller">NGINX Ingress Controller</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-gateway-fabric">NGINX Gateway Fabric</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://nginx.org/en/docs/">NGINX Open Source</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/solutions/">Subscription Licensing &amp; Solutions</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-agent">NGINX Agent</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX APP PROTECT</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-waf">NGINX App Protect WAF</a>
                </li>
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginx-app-protect-dos">NGINX App Protect DoS</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX AS A SERVICE</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="/nginxaas/azure/">NGINX as a Service for Azure</a>
                </li>
            
            </ul>
        </div>
    
    
    
        <div class="product-selector-content" id="product-selector-content">
            <p id="product-selector-content-product-group-name">NGINX OTHER</p>
            <ul id="product-selector-content-product-container">
            
                <li id="product-selector-content-product-name">
                    <a id="product-selector-content-product-link" href="https://unit.nginx.org/">NGINX Unit</a>
                </li>
            
            </ul>
        </div>
    
</div>
<div class="scrollbar-container">
    <div class="sidebar-navigation">
        <ul class="parent-collapsible-content">
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-7f7c14e5eb8150745de8410de59a0b22" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-7f7c14e5eb8150745de8410de59a0b22" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Version 4 and Earlier 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-2d3851ebcca023e8402ffbd425902942" class="toggle-checkbox" style="display: none;">
            <label for="toggle-2d3851ebcca023e8402ffbd425902942" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Administration Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/install/" style="">NGINX App Protect WAF Administration Guide </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/install-nms/" style="">Using NGINX App Protect WAF with NGINX Management Suite </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/admin-guide/upgrade-nap-waf/" style="">Upgrade NGINX App Protect WAF on Managed Instances </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-d8399080ca68c88dee77f413d6c6eb8b" class="toggle-checkbox" style="display: none;">
            <label for="toggle-d8399080ca68c88dee77f413d6c6eb8b" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Configuration Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/configuration-guide/configuration/" style="">NGINX App Protect WAF Configuration Guide </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-f2ecd5f5767c08c757f1f5db3fc8034e" class="toggle-checkbox" style="display: none;">
            <label for="toggle-f2ecd5f5767c08c757f1f5db3fc8034e" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Declarative Policy 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/declarative-policy/policy/" style="">NGINX App Protect WAF Declarative Policy </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-a84be0ddf4e66485eba4d708591c4721" class="toggle-checkbox" style="display: none;">
            <label for="toggle-a84be0ddf4e66485eba4d708591c4721" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Logging Overview 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/logs-overview/" style="">NGINX App Protect WAF Logs Overview </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/security-log/" style="">NGINX App Protect WAF Security Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/operation-logs/" style="">NGINX App Protect WAF Operation Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/debug-logs/" style="">NGINX App Protect WAF Debug Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/logging-overview/access-log/" style="">NGINX App Protect WAF Access Log </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-785457d0d85be3768066ec502a32c93e" class="toggle-checkbox" style="display: none;">
            <label for="toggle-785457d0d85be3768066ec502a32c93e" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Troubleshooting Guide 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/troubleshooting-guide/troubleshooting/" style="">NGINX App Protect WAF Troubleshooting Guide </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-32e6e6a300adaf7bc875f71de9e14393" class="toggle-checkbox" style="display: none;">
            <label for="toggle-32e6e6a300adaf7bc875f71de9e14393" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Releases 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.14/" style="">NGINX App Protect WAF 4.14 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.13/" style="">NGINX App Protect WAF 4.13 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.12/" style="">NGINX App Protect WAF 4.12 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.11/" style="">NGINX App Protect WAF 4.11 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.10/" style="">NGINX App Protect WAF 4.10 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.9/" style="">NGINX App Protect WAF 4.9 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.8.1/" style="">NGINX App Protect WAF 4.8.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.8/" style="">NGINX App Protect WAF 4.8 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.7/" style="">NGINX App Protect WAF 4.7 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.6/" style="">NGINX App Protect WAF 4.6 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.5/" style="">NGINX App Protect WAF 4.5 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.4/" style="">NGINX App Protect WAF 4.4 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.3/" style="">NGINX App Protect WAF 4.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.2/" style="">NGINX App Protect WAF 4.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.1/" style="">NGINX App Protect WAF 4.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-4.0/" style="">NGINX App Protect WAF 4.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.12.2/" style="">NGINX App Protect WAF 3.12.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.12/" style="">NGINX App Protect WAF 3.12 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.11/" style="">NGINX App Protect WAF 3.11 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.10/" style="">NGINX App Protect WAF 3.10 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.9.1/" style="">NGINX App Protect WAF 3.9.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.9/" style="">NGINX App Protect WAF 3.9 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.8/" style="">NGINX App Protect WAF 3.8 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.7/" style="">NGINX App Protect WAF 3.7 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.6/" style="">NGINX App Protect WAF 3.6 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.5/" style="">NGINX App Protect WAF 3.5 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.4/" style="">NGINX App Protect WAF 3.4 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.3/" style="">NGINX App Protect WAF 3.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.2/" style="">NGINX App Protect WAF 3.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.1/" style="">NGINX App Protect WAF 3.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-3.0/" style="">NGINX App Protect WAF 3.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.3/" style="">NGINX App Protect WAF 2.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.2/" style="">NGINX App Protect WAF 2.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.1/" style="">NGINX App Protect WAF 2.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-2.0/" style="">NGINX App Protect WAF 2.0 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.3/" style="">NGINX App Protect WAF 1.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.2/" style="">NGINX App Protect WAF 1.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.1/" style="">NGINX App Protect WAF 1.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v4/releases/about-1.0/" style="">NGINX App Protect WAF 1.0 </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
            <li class="parent-collapsible-content-item">
                
                    <input type="checkbox" id="toggle-b15959597292934ffe771956f825d77b" class="toggle-checkbox" style="display: none;">
                    <label for="toggle-b15959597292934ffe771956f825d77b" class="collapsible-header">
                        
                            <span class="parent-box expand"></span>
                            <span class="parent-box opened"></span>
                        
                        Version 5 
                    </label>
                    

<ul class="collapsible-content">
    
    <li>
        
            <input type="checkbox" id="toggle-f569a7fa0e4d3de9c70dae244b27b695" class="toggle-checkbox" style="display: none;">
            <label for="toggle-f569a7fa0e4d3de9c70dae244b27b695" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Administration Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/overview/" style="">NGINX App Protect WAF Administration Guide </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/install/" style="">Installing NGINX App Protect WAF </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-helm/" style="">Deploy NGINX App Protect WAF with Helm </a>
            
        
    </li>
    
    <li>
        
                                  
                <span class="box current partial" id="current-page"></span>                 
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-manifests/" style="font-weight: bold;">Deploy NGINX App Protect WAF with Manifests </a>
            <nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#build-the-nginx-image">Build the NGINX Image</a>
      <ul>
        <li><a href="#download-certificates">Download Certificates</a></li>
        <li><a href="#dockerfile-based-on-the-official-nginx-image">Dockerfile Based on the Official NGINX Image</a></li>
        <li><a href="#nginx-open-source-dockerfile">NGINX Open Source Dockerfile</a></li>
        <li><a href="#nginx-plus-dockerfile">NGINX Plus Dockerfile</a></li>
        <li><a href="#build-image">Build Image</a></li>
      </ul>
    </li>
    <li><a href="#nginx-configuration">NGINX Configuration</a></li>
    <li><a href="#waf-services-configuration">WAF Services Configuration</a>
      <ul>
        <li><a href="#jwt-token-and-docker-config-secret">JWT Token and Docker Config Secret</a></li>
        <li><a href="#manifest-deployment">Manifest Deployment</a></li>
        <li><a href="#start-deployment">Start Deployment</a></li>
      </ul>
    </li>
    <li><a href="#configure-read-only-file-systems">Configure read only file systems</a>
      <ul>
        <li><a href="#enable-readonlyrootfilesystem-and-configure-writable-paths">Enable <code>readOnlyRootFilesystem</code> and configure writable paths</a></li>
        <li><a href="#update-nginx-configuration-with-writable-paths">Update NGINX configuration with writable paths</a></li>
        <li><a href="#possible-issues">Possible issues</a></li>
      </ul>
    </li>
    <li><a href="#enable-mtls">Enable mTLS</a></li>
    <li><a href="#use-compiled-policy-and-logging-profile-bundles-in-nginx">Use compiled Policy and Logging Profile bundles in NGINX</a></li>
    <li><a href="#air-gap-install-secure-offline-deployment">Air-Gap Install: Secure Offline Deployment</a>
      <ul>
        <li><a href="#prerequisites-1">Prerequisites</a></li>
        <li><a href="#build-the-nginx-image-1">Build the NGINX Image</a></li>
        <li><a href="#build-image-sub">Build Image</a></li>
        <li><a href="#nginx-configuration-1">NGINX Configuration</a></li>
        <li><a href="#waf-services-configuration-1">WAF Services Configuration</a></li>
        <li><a href="#start-deployment-2">Start Deployment</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-on-docker/" style="">Deploy NGINX App Protect WAF with Docker </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/compiler/" style="">NGINX App Protect WAF Compiler </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/upgrade-nap-waf/" style="">Upgrade NGINX App Protect WAF on Managed Instances </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-ba5280a2dc88e2ef839cbdf99dd63718" class="toggle-checkbox" style="display: none;">
            <label for="toggle-ba5280a2dc88e2ef839cbdf99dd63718" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Configuration Guides 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/configuration-guide/configuration/" style="">NGINX App Protect WAF Configuration Guide </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-32298ec202b6ded814ea2044cb7b2329" class="toggle-checkbox" style="display: none;">
            <label for="toggle-32298ec202b6ded814ea2044cb7b2329" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Declarative Policy 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/declarative-policy/policy/" style="">NGINX App Protect WAF Declarative Policy </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-44f8e13744a3277f9d094e0ab4e169e0" class="toggle-checkbox" style="display: none;">
            <label for="toggle-44f8e13744a3277f9d094e0ab4e169e0" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Logging Overview 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/security-log/" style="">NGINX App Protect WAF Security Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/access-log/" style="">NGINX App Protect WAF Access Log </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/logging-overview/logs-overview/" style="">NGINX App Protect WAF Logs Overview </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-aceec0e2fe4ec190c9b41c79e11e4032" class="toggle-checkbox" style="display: none;">
            <label for="toggle-aceec0e2fe4ec190c9b41c79e11e4032" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Troubleshooting 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/" style="">NGINX App Protect WAF Troubleshooting Guide </a>
            
        
    </li>
    
</ul>
        
    </li>
    
    <li>
        
            <input type="checkbox" id="toggle-0e34ddcd46826354bb34b18a381baf59" class="toggle-checkbox" style="display: none;">
            <label for="toggle-0e34ddcd46826354bb34b18a381baf59" class="collapsible-header">
                
                    <span class="box expand partial-box"></span>
                    <span class="box opened partial-box"></span>
                
                Releases 
            </label>
            

<ul class="collapsible-content">
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.6/" style="">NGINX App Protect WAF 5.6 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.5/" style="">NGINX App Protect WAF 5.5 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.4/" style="">NGINX App Protect WAF 5.4 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.3/" style="">NGINX App Protect WAF 5.3 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.2/" style="">NGINX App Protect WAF 5.2 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.1/" style="">NGINX App Protect WAF 5.1 </a>
            
        
    </li>
    
    <li>
        
                                 
                <span class="box-link partial"></span>              
            
            <a href="http://localhost:1313/nginx-app-protect-waf/v5/releases/about-5.0/" style="">NGINX App Protect WAF 5.0 </a>
            
        
    </li>
    
</ul>
        
    </li>
    
</ul>
                
            </li>
        
        </ul>
    </div>
</div>
      </nav>
    </div>

    <section class="content-layout">
      <div data-cms-edit="content" class="text-content">
        <section class="breadcrumb-layout" data-mf="true" style="display: none;">
          
            
            <nav aria-label="breadcrumb" class="breadcrumb navbar">
    <div class="nav flex-md-row">
        <ol class="breadcrumb">
            
            
            
            
                
            
            
                
            
            
                
            
            
                
            
            
                
            
            
            
                <li><a href="/">Home</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/">F5 NGINX App Protect WAF</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/v5/">Version 5</a><i class="fas fa-chevron-right"></i></li>
                
            
                <li><a href="/nginx-app-protect-waf/v5/admin-guide/">Administration Guides</a><i class="fas fa-chevron-right"></i></li>
                
            
                Deploy NGINX App Protect WAF with Manifests
        </ol>
    </div>
</nav>
  
            
          
        </section>
        <h1>Deploy NGINX App Protect WAF with Manifests</h1>
        <h2 
id="prerequisites">Prerequisites  <a class="headerlink float-right" href="#prerequisites" title="Prerequisites"><i class="fas fa-link fa-xs"></i></a>
</h2><ul>
<li>An active F5 NGINX App Protect WAF subscription in <a href="https://my.f5.com/" target="_blank" rel="noopener">MyF5</a> (purchased or trial).</li>
<li>A functional Kubernetes cluster.</li>
<li><code>kubectl</code> command-line tool, properly configured.</li>
</ul>
<h2 
id="build-the-nginx-image">Build the NGINX Image  <a class="headerlink float-right" href="#build-the-nginx-image" title="Build the NGINX Image"><i class="fas fa-link fa-xs"></i></a>
</h2><p>Follow the instructions below to build a Docker image containing the NGINX and the NGINX App Protect module.</p>
<h3 
id="download-certificates">Download Certificates  <a class="headerlink float-right" href="#download-certificates" title="Download Certificates"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Log in to <a href="https://my.f5.com" target="_blank" rel="noopener">My F5</a> and download the following two files from your active NGINX App Protect WAF subscription:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6d9cbf38&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6d9cbf38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
</div>
<p>Proceed, by creating a <code>Dockerfile</code> using one of the examples provided below.</p>
<h3 
id="dockerfile-based-on-the-official-nginx-image">Dockerfile Based on the Official NGINX Image  <a class="headerlink float-right" href="#dockerfile-based-on-the-official-nginx-image" title="Dockerfile Based on the Official NGINX Image"><i class="fas fa-link fa-xs"></i></a>
</h3><blockquote class="note">
  <div><strong>Note:</strong><br/> While this example utilizes the official NGINX Open Source image as a base, the crucial requirement is that NGINX must be installed as a package from the official NGINX repository, rather than being compiled from source.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6da75628&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6da75628">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:1.25.5-bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       --import nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> chmod <span class="m">644</span> /etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~bookworm app-protect-module-oss  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get remove --purge --auto-remove -y apt-transport-https lsb-release gnupg wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/nginx-app-protect.list</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:1.25.5-bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       --import nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> chmod <span class="m">644</span> /etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~bookworm app-protect-module-oss  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get remove --purge --auto-remove -y apt-transport-https lsb-release gnupg wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/nginx-app-protect.list</span></span></code></pre></div>
</div>
<h3 
id="nginx-open-source-dockerfile">NGINX Open Source Dockerfile  <a class="headerlink float-right" href="#nginx-open-source-dockerfile" title="NGINX Open Source Dockerfile"><i class="fas fa-link fa-xs"></i></a>
</h3><div class="tabs-container">
	<ul class="nav nav-tabs" id="nap5_nginx_oss_dockerfiles" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#nap5_nginx_oss_dockerfiles-0" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-0" aria-selected="true">Alpine Linux</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-1" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-1">Amazon Linux 2</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-2" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-2">CentOS</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-3" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-3">Debian</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-4" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-4">Oracle Linux 8</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-5" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-5">RHEL</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_oss_dockerfiles-6" role="tab" aria-controls="nap5_nginx_oss_dockerfiles-6">Ubuntu</a></li></ul>
</div>
<div class="tab-content" id="nap5_nginx_oss_dockerfiles"><div id="nap5_nginx_oss_dockerfiles-0" class="tab-pane show active" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-0">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6de21538&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6de21538">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk add openssl curl ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;%s%s%s%s\n&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;http://nginx.org/packages/mainline/alpine/v&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="sb">`</span>egrep -o <span class="s1">&#39;^[0-9]+\.[0-9]+&#39;</span> /etc/alpine-release<span class="sb">`</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;/main&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="p">|</span> tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk add openssl curl ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;%s%s%s%s\n&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;http://nginx.org/packages/mainline/alpine/v&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="sb">`</span>egrep -o <span class="s1">&#39;^[0-9]+\.[0-9]+&#39;</span> /etc/alpine-release<span class="sb">`</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;/main&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="p">|</span> tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-1" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-1">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e2c0ad0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e2c0ad0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> amazonlinux:2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    amazon-linux-extras <span class="nb">enable</span> epel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean metadata <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install wget ca-certificates epel-release shadow-utils yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/amzn2/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;priority=9&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> amazonlinux:2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    amazon-linux-extras <span class="nb">enable</span> epel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean metadata <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install wget ca-certificates epel-release shadow-utils yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/amzn2/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;priority=9&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-2" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-2">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6ed3dfa8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6ed3dfa8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    yum -y install wget ca-certificates epel-release yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    yum -y install wget ca-certificates epel-release yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-3" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-3">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6eefef40&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6eefef40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-4" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-4">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f023308&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f023308">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-5" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-5">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f1672a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f1672a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_oss_dockerfiles-6" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_oss_dockerfiles-6">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f281a28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f281a28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div></div>

<p>You are ready to <a href="#build-image">Build the image</a>.</p>
<h3 
id="nginx-plus-dockerfile">NGINX Plus Dockerfile  <a class="headerlink float-right" href="#nginx-plus-dockerfile" title="NGINX Plus Dockerfile"><i class="fas fa-link fa-xs"></i></a>
</h3><div class="tabs-container">
	<ul class="nav nav-tabs" id="nap5_nginx_plus_dockerfiles" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#nap5_nginx_plus_dockerfiles-0" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-0" aria-selected="true">Alpine Linux</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-1" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-1">Amazon Linux 2</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-2" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-2">CentOS</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-3" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-3">Debian</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-4" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-4">Oracle Linux 8</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-5" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-5">RHEL</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_nginx_plus_dockerfiles-6" role="tab" aria-controls="nap5_nginx_plus_dockerfiles-6">Ubuntu</a></li></ul>
</div>
<div class="tab-content" id="nap5_nginx_plus_dockerfiles"><div id="nap5_nginx_plus_dockerfiles-0" class="tab-pane show active" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-0">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f37ae70&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f37ae70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-1" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-1">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f44cdd0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f44cdd0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> amazonlinux:2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    amazon-linux-extras <span class="nb">enable</span> epel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean metadata <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install wget ca-certificates epel-release shadow-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-amazon2.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> amazonlinux:2</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    amazon-linux-extras <span class="nb">enable</span> epel <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean metadata <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install wget ca-certificates epel-release shadow-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-amazon2.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-2" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-2">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f599238&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f599238">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    yum -y install wget ca-certificates epel-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> centos:7</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    yum -y install wget ca-certificates epel-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-7.4.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/7/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-7-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> yum clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/yum<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-3" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-3">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f68ebe8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f68ebe8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-4" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-4">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f770930&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f770930">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-5" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-5">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f88dbb0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f88dbb0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-7.4.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;9&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">else</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/<span class="si">${</span><span class="nv">NGINX_PLUS_REPO</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-7.4.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;9&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">else</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/<span class="si">${</span><span class="nv">NGINX_PLUS_REPO</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_nginx_plus_dockerfiles-6" class="tab-pane" role="tabpanel" aria-labelledby="nap5_nginx_plus_dockerfiles-6">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f98d970&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f98d970">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div></div>

<h3 
id="build-image">Build Image  <a class="headerlink float-right" href="#build-image" title="Build Image"><i class="fas fa-link fa-xs"></i></a>
</h3><blockquote class="note">
  <div><strong>Note:</strong><br/> Never upload your NGINX App Protect WAF v5 images to a public container registry such as Docker Hub. Doing so violates your license agreement.</div>
</blockquote>

<p>To build the image, execute the following command in the directory containing the <code>nginx-repo.crt</code>, <code>nginx-repo.key</code>, and <code>Dockerfile</code>. Here, <code>nginx-app-protect-5</code> is an example image tag.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fa1d250&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fa1d250">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker build --no-cache --platform linux/amd64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-crt,src<span class="o">=</span>nginx-repo.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-key,src<span class="o">=</span>nginx-repo.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -t nginx-app-protect-5 .</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker build --no-cache --platform linux/amd64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-crt,src<span class="o">=</span>nginx-repo.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-key,src<span class="o">=</span>nginx-repo.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -t nginx-app-protect-5 .</span></span></code></pre></div>
</div>
<p>Next, push it to your private image repository, ensuring it&rsquo;s accessible to your Kubernetes cluster.</p>
<h2 
id="nginx-configuration">NGINX Configuration  <a class="headerlink float-right" href="#nginx-configuration" title="NGINX Configuration"><i class="fas fa-link fa-xs"></i></a>
</h2><p>In your nginx configuration:</p>
<ol>
<li>
<p>Load the NGINX App Protect WAF v5 module at the main context:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6daa3c58&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6daa3c58">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the Enforcer address at the <code>http</code> context:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6dac7e78&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6dac7e78">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect WAF on an <code>http/server/location</code> context (make sure you only enable NGINX App Protect WAF with <code>proxy_pass</code>/<code>grpc_pass</code> locations):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6daeb0f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6daeb0f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enable</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enable</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
</ol>
<p>In this guide, the following files are used:</p>
<div class="tabs-container">
	<ul class="nav nav-tabs" id="nap5_install_conf_files_k8s" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#nap5_install_conf_files_k8s-0" role="tab" aria-controls="nap5_install_conf_files_k8s-0" aria-selected="true">nginx.conf</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#nap5_install_conf_files_k8s-1" role="tab" aria-controls="nap5_install_conf_files_k8s-1">default.conf</a></li></ul>
</div>
<div class="tab-content" id="nap5_install_conf_files_k8s"><div id="nap5_install_conf_files_k8s-0" class="tab-pane show active" role="tabpanel" aria-labelledby="nap5_install_conf_files_k8s-0">
<p><code>/etc/nginx/nginx.conf</code></p>
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f6a0140&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f6a0140">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
  <div id="nap5_install_conf_files_k8s-1" class="tab-pane" role="tabpanel" aria-labelledby="nap5_install_conf_files_k8s-1">
<p><code>/etc/nginx/conf.d/default.conf</code></p>
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f7094d8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f7094d8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">domain.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span> <span class="s">text/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8080/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">8080</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># redirect server error pages to the static page /50x.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">error_page</span> <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span> <span class="s">/50x.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="p">=</span> <span class="s">/50x.html</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">domain.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span> <span class="s">text/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8080/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">8080</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># redirect server error pages to the static page /50x.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">error_page</span> <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span> <span class="s">/50x.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="p">=</span> <span class="s">/50x.html</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div></div>

<h2 
id="waf-services-configuration">WAF Services Configuration  <a class="headerlink float-right" href="#waf-services-configuration" title="WAF Services Configuration"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="jwt-token-and-docker-config-secret">JWT Token and Docker Config Secret  <a class="headerlink float-right" href="#jwt-token-and-docker-config-secret" title="JWT Token and Docker Config Secret"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Create a Kubernetes secret:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6dbc3200&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6dbc3200">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create secret docker-registry regcred --docker-server<span class="o">=</span>private-registry.nginx.com --docker-username<span class="o">=</span>&lt;JWT Token&gt; --docker-password<span class="o">=</span>none</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create secret docker-registry regcred --docker-server<span class="o">=</span>private-registry.nginx.com --docker-username<span class="o">=</span>&lt;JWT Token&gt; --docker-password<span class="o">=</span>none</span></span></code></pre></div>
</div><p>It is important that the <code>--docker-username=&lt;JWT Token&gt;</code> contains the contents of the token and does not point to the token itself. Ensure that when you copy the contents of the JWT token, there are no additional characters or extra whitespaces. This can invalidate the token and cause 401 errors when trying to authenticate to the registry. Use <code>none</code> for password (as the password is not used).</p>
</li>
<li>
<p>Verify Secret:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6dc0fc90&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6dc0fc90">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get secret regcred --output<span class="o">=</span>yaml</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl get secret regcred --output<span class="o">=</span>yaml</span></span></code></pre></div>
</div></li>
<li>
<p>Use Secret in Deployments:</p>
</li>
</ol>
<p>The Secret is now available for use in manifest deployments.</p>










<blockquote class="important side-callout">
   <div>
     
     
       
       <i class="fas fa-shield-alt"></i>
     
     
     <strong>Protect sensitive data</strong><br/>
     
     <p>To protect your system and data, follow these security practices:</p>
<ol>
<li>
<p><strong>JWTs:</strong> Treat JSON Web Tokens (JWTs) as sensitive data. Store them securely and delete them after use to prevent unauthorized access.</p>
</li>
<li>
<p><strong>Shell history:</strong> Commands with JWTs or passwords are saved in plain text in your shell history. After running such commands, clear the history to protect credentials. For example:</p>
<ul>
<li>Edit your shell history file (such as ~/.bash_history or ~/.zsh_history) to remove specific commands.</li>
<li>Use <code>history -c</code> to clear all shell history in bash or zsh.</li>
</ul>
</li>
</ol>

   </div>
 </blockquote>

<h3 
id="manifest-deployment">Manifest Deployment  <a class="headerlink float-right" href="#manifest-deployment" title="Manifest Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><p>In this configuration, two replicas are deployed, with each hosting both NGINX and WAF services together in a single Kubernetes pod.</p>
<p>For simplification in this documentation, we&rsquo;re using a hostPath backed persistent volume claim <code>nap5-storage.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6dcf1dc0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6dcf1dc0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/mnt/nap5_bundles_pv_data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolumeClaim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/mnt/nap5_bundles_pv_data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolumeClaim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span></span></span></code></pre></div>
</div><p>An example <code>nap5-deployment.yaml</code>:</p>
<p>Replace the <code>&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</code> with the actual image tag.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6deb5080&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6deb5080">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span></span></span></code></pre></div>
</div><p>Finally, <code>nap5-service.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6df2de18&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6df2de18">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
</div><h3 
id="start-deployment">Start Deployment  <a class="headerlink float-right" href="#start-deployment" title="Start Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>Assuming the above manifests are saved in the <code>/home/user/k8s</code> directory, you can deploy them by executing the following command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6df7c7e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6df7c7e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f /home/user/k8s</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f /home/user/k8s</span></span></code></pre></div>
</div><p>Example output:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6dfd7508&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6dfd7508">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">deployment.apps/nap5-deployment created
</span></span><span class="line"><span class="cl">service/nginx created
</span></span><span class="line"><span class="cl">persistentvolume/nap5-bundles-pv created
</span></span><span class="line"><span class="cl">persistentvolumeclaim/nap5-bundles-pvc created</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">deployment.apps/nap5-deployment created
</span></span><span class="line"><span class="cl">service/nginx created
</span></span><span class="line"><span class="cl">persistentvolume/nap5-bundles-pv created
</span></span><span class="line"><span class="cl">persistentvolumeclaim/nap5-bundles-pvc created</span></span></code></pre></div>
</div><p>This command tells <code>kubectl</code> to apply the configuration defined in all the files within the <code>/home/user/k8s</code> directory to your Kubernetes cluster.</p>
</li>
<li>
<p>Verify the deployment:</p>
<ul>
<li>
<p>Check the status of the deployment using:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e02d7f0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e02d7f0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get deployments</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get deployments</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the pods are running with:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e04eb30&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e04eb30">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods</span></span></code></pre></div>
</div></li>
<li>
<p>Verify services with:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e06d378&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e06d378">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get services</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get services</span></span></code></pre></div>
</div></li>
<li>
<p>To verify the enforcement functionality, ensure the following request is rejected:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e0c0398&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e0c0398">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;&lt;node-external-ip&gt;:&lt;node-port&gt;/&lt;script&gt;&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;&lt;node-external-ip&gt;:&lt;node-port&gt;/&lt;script&gt;&#34;</span></span></span></code></pre></div>
</div></li>
</ul>
</li>
<li>
<p>To restart the deployment, use:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e175220&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e175220">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl rollout restart deployment.apps/nap5-deployment</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl rollout restart deployment.apps/nap5-deployment</span></span></code></pre></div>
</div></li>
<li>
<p>To remove the deployment, use:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e1e2050&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e1e2050">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -f /home/user/k8s</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -f /home/user/k8s</span></span></code></pre></div>
</div></li>
</ol>
<h2 
id="configure-read-only-file-systems">Configure read only file systems  <a class="headerlink float-right" href="#configure-read-only-file-systems" title="Configure read only file systems"><i class="fas fa-link fa-xs"></i></a>
</h2><p>NGINX App Protect WAF v5 allows you to enable the <code>readOnlyRootFilesystem</code> option in your <a href="https://kubernetes.io/docs/tasks/configure-pod-container/security-context/" target="_blank" rel="noopener">Kubernetes Configuration</a>. This option restricts the root filesystem to read-only mode, which improves security by limiting potential write access in case of compromise.</p>
<p>To enable this feature, you will need a Kubernetes cluster that supports read-only root file systems, and you access to the NGINX and NGINX App Protect WAF configurations.</p>
<p>You may need to identify any extra paths that need to be writable by App Protect during runtime: the following steps assume you are using the defaults path.</p>

<hr>
<h3 
id="enable-readonlyrootfilesystem-and-configure-writable-paths">Enable <code>readOnlyRootFilesystem</code> and configure writable paths  <a class="headerlink float-right" href="#enable-readonlyrootfilesystem-and-configure-writable-paths" title="Enable readOnlyRootFilesystem and configure writable paths"><i class="fas fa-link fa-xs"></i></a>
</h3><p>The first step is to add the <code>readOnlyRootFilesystem</code> value (as <em>true</em>) to your Kubernetes pod security context as follows:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fb87348&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fb87348">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span></span></span></code></pre></div>
</div><p>With a read-only root file system, you will likely still require write access for certain directories, such as logs and temporary files. You can add these directories by mounting them as writable volumes in your Kubernetes deployment.</p>
<p>In this example, <code>/tmp</code> and <code>/var/log/nginx</code> are writable directories, essential for NGINX and App Protect operations.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fc20c50&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fc20c50">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log/nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc </span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="l">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log/nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">           </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">             </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc </span></span></span></code></pre></div>
</div><p>A full example might look like the following:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fdee708&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fdee708">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log/nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc </span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/tmp</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/var/log/nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">readOnlyRootFilesystem</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-log</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">tmp-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc </span></span></span></code></pre></div>
</div>
<hr>
<h3 
id="update-nginx-configuration-with-writable-paths">Update NGINX configuration with writable paths  <a class="headerlink float-right" href="#update-nginx-configuration-with-writable-paths" title="Update NGINX configuration with writable paths"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Once you have created writable paths in your Kubernetes cluster, you should update your NGINX configuration to use these paths.</p>
<p>The following are fields in <code>nginx.conf</code> you should update, which correspond to writable volumes configured during the last step:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fe87c28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fe87c28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/tmp/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">...</span>
</span></span><span class="line"><span class="cl"><span class="s">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kn">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Temporary directories for kubernetes &#34;readonlyfilesystem&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">client_body_temp_path</span> <span class="s">/tmp/nginx-client-body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_temp_path</span>       <span class="s">/tmp/nginx-proxy</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">fastcgi_temp_path</span>     <span class="s">/tmp/nginx-fastcgi</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">uwsgi_temp_path</span>       <span class="s">/tmp/nginx-uwsgi</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">scgi_temp_path</span>        <span class="s">/tmp/nginx-scgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">...</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/tmp/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">...</span>
</span></span><span class="line"><span class="cl"><span class="s">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="kn">...</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Temporary directories for kubernetes &#34;readonlyfilesystem&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s">client_body_temp_path</span> <span class="s">/tmp/nginx-client-body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_temp_path</span>       <span class="s">/tmp/nginx-proxy</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">fastcgi_temp_path</span>     <span class="s">/tmp/nginx-fastcgi</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">uwsgi_temp_path</span>       <span class="s">/tmp/nginx-uwsgi</span><span class="p">;</span>    
</span></span><span class="line"><span class="cl">    <span class="kn">scgi_temp_path</span>        <span class="s">/tmp/nginx-scgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kn">...</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span></span></span></code></pre></div>
</div><p>A full example might look like the following:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fef32e8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fef32e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/tmp/nginx.pid</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Temporary directories for kubernetes &#34;readonlyfilesystem&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">client_body_temp_path</span> <span class="s">/tmp/nginx-client-body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_temp_path</span>       <span class="s">/tmp/nginx-proxy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">fastcgi_temp_path</span>     <span class="s">/tmp/nginx-fastcgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">uwsgi_temp_path</span>       <span class="s">/tmp/nginx-uwsgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">scgi_temp_path</span>        <span class="s">/tmp/nginx-scgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">debug</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/tmp/nginx.pid</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Temporary directories for kubernetes &#34;readonlyfilesystem&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">client_body_temp_path</span> <span class="s">/tmp/nginx-client-body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_temp_path</span>       <span class="s">/tmp/nginx-proxy</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">fastcgi_temp_path</span>     <span class="s">/tmp/nginx-fastcgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">uwsgi_temp_path</span>       <span class="s">/tmp/nginx-uwsgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">scgi_temp_path</span>        <span class="s">/tmp/nginx-scgi</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">127.0.0.1</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
<hr>
<h3 
id="possible-issues">Possible issues  <a class="headerlink float-right" href="#possible-issues" title="Possible issues"><i class="fas fa-link fa-xs"></i></a>
</h3><p><strong>Permission denied errors</strong></p>
<p>If you encounter file permission issues, verify that the paths requiring write access are correctly configured as writable volumes in the pod manifest.</p>
<p><strong>NGINX App Protect WAF initialization errors</strong>:</p>
<p>Check the NGINX and NGINX App Protect Logs to ensure that App Protect can write to necessary files like logs and temporary directories.</p>
<p>For general issues, read the <a href="http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/">Troubleshooting</a> topic.</p>

<hr>
<h2 
id="enable-mtls">Enable mTLS  <a class="headerlink float-right" href="#enable-mtls" title="Enable mTLS"><i class="fas fa-link fa-xs"></i></a>
</h2><p>To secure traffic between NGINX and App Protect Enforcer using mTLS, follow the steps below:</p>
<blockquote class="note">
  <div><strong>Note:</strong><br/> Refer to the <a href="/nginx-app-protect-waf/v5/configuration-guide/configuration/#secure-traffic-between-nginx-and-app-protect-enforcer-using-mtls">Configuration Guide</a> to generate certificates and modify the <code>nginx.conf</code> for mTLS.</div>
</blockquote>

<p>First, create a Kubernetes Secret that contains the certificate and key files:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6ff62c10&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6ff62c10">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">	kubectl create secret generic enforcer-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_server.crt<span class="o">=</span>/path/to/app_protect_server.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_server.key<span class="o">=</span>/path/to/app_protect_server.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_client_ca.crt<span class="o">=</span>/path/to/app_protect_client_ca.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">	kubectl create secret generic enforcer-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_server.crt<span class="o">=</span>/path/to/app_protect_server.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_server.key<span class="o">=</span>/path/to/app_protect_server.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>	--from-file<span class="o">=</span>app_protect_client_ca.crt<span class="o">=</span>/path/to/app_protect_client_ca.crt</span></span></code></pre></div>
</div><p>Next, update or create the <code>nap5-deployment.yaml</code> to mount the Secret as a volume and set the environment variables to point to the mounted files:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f70056680&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f70056680">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">	</span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/ssl/certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4431&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_SERVER_CERT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_server.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_SERVER_KEY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_server.key&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_CA_FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_client_ca.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/ssl/certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                    </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">enforcer-certificates</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="w">	</span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">2</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">imagePullSecrets</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">regcred</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/ssl/certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-enforcer:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;4431&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_SERVER_CERT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_server.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_SERVER_KEY</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_server.key&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_CA_FILE</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/etc/ssl/certs/app_protect_client_ca.crt&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/ssl/certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">readOnly</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">private-registry.nginx.com/nap/waf-config-mgr:&lt;version-tag&gt;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                    </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                  </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	          </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">certs</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	              </span><span class="nt">secret</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	                </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l">enforcer-certificates</span></span></span></code></pre></div>
</div>
<hr>
<h2 
id="use-compiled-policy-and-logging-profile-bundles-in-nginx">Use compiled Policy and Logging Profile bundles in NGINX  <a class="headerlink float-right" href="#use-compiled-policy-and-logging-profile-bundles-in-nginx" title="Use compiled Policy and Logging Profile bundles in NGINX"><i class="fas fa-link fa-xs"></i></a>
</h2><p>In this setup, copy your compiled policy and logging profile bundles to <code>/mnt/nap5_bundles_pv_data</code> on a cluster node. Make sure that input files are accessible to UID 101. Then, in your NGINX configuration, refer to these files from <code>/etc/app_protect/bundles</code>.</p>
<p>For example, to apply <code>custom_policy.tgz</code> that you&rsquo;ve placed in <code>/mnt/nap5_bundles_pv_data/</code>, use:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fa58b70&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6fa58b70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_policy_file</span> <span class="s">&#34;/etc/app_protect/bundles/custom_policy.tgz&#34;</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_policy_file</span> <span class="s">&#34;/etc/app_protect/bundles/custom_policy.tgz&#34;</span><span class="p">;</span></span></span></code></pre></div>
</div>
<p>The NGINX configuration can be integrated using a ConfigMap mount.</p>
<h2 
id="air-gap-install-secure-offline-deployment">Air-Gap Install: Secure Offline Deployment  <a class="headerlink float-right" href="#air-gap-install-secure-offline-deployment" title="Air-Gap Install: Secure Offline Deployment"><i class="fas fa-link fa-xs"></i></a>
</h2><h3 
id="prerequisites-1">Prerequisites  <a class="headerlink float-right" href="#prerequisites-1" title="Prerequisites"><i class="fas fa-link fa-xs"></i></a>
</h3><ul>
<li>Active NGINX App Protect WAF subscription in <a href="https://my.f5.com/" target="_blank" rel="noopener">MyF5</a> (purchased or trial) on the online machine.</li>
<li>Docker (with Docker Compose) is <a href="https://docs.docker.com/engine/install/" target="_blank" rel="noopener">installed and running</a> on both the online and offline/Air-Gap machine.</li>
<li>Local registry for the offline/Air-Gap machine</li>
<li>A functional Kubernetes cluster.</li>
<li><code>kubectl</code> command-line tool, properly configured.</li>
</ul>
<h3 
id="build-the-nginx-image-1">Build the NGINX Image  <a class="headerlink float-right" href="#build-the-nginx-image-1" title="Build the NGINX Image"><i class="fas fa-link fa-xs"></i></a>
</h3><p>Follow the instructions below to build a Docker image containing the NGINX and the NGINX App Protect module on the machine connected to the internet.</p>
<h4 
id="download-certificates-1">Download Certificates  <a class="headerlink float-right" href="#download-certificates-1" title="Download Certificates"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Log in to <a href="https://my.f5.com" target="_blank" rel="noopener">My F5</a> and download the following two files from your active NGINX App Protect WAF subscription:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6d9cbf38&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6d9cbf38">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">nginx-repo.key
</span></span><span class="line"><span class="cl">nginx-repo.crt</span></span></code></pre></div>
</div>
<p>Proceed, by creating a <code>Dockerfile</code> using one of the examples provided below.</p>
<h4 
id="dockerfile-based-on-the-official-nginx-image-1">Dockerfile Based on the Official NGINX Image  <a class="headerlink float-right" href="#dockerfile-based-on-the-official-nginx-image-1" title="Dockerfile Based on the Official NGINX Image"><i class="fas fa-link fa-xs"></i></a>
</h4><blockquote class="note">
  <div><strong>Note:</strong><br/> While this example utilizes the official NGINX Open Source image as a base, the crucial requirement is that NGINX must be installed as a package from the official NGINX repository, rather than being compiled from source.</div>
</blockquote>




<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6da75628&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6da75628">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:1.25.5-bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       --import nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> chmod <span class="m">644</span> /etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~bookworm app-protect-module-oss  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get remove --purge --auto-remove -y apt-transport-https lsb-release gnupg wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/nginx-app-protect.list</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> nginx:1.25.5-bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget https://cs.nginx.com/static/keys/nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --no-default-keyring --keyring gnupg-ring:/etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       --import nginx_signing.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> chmod <span class="m">644</span> /etc/apt/trusted.gpg.d/nginx.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install --no-install-recommends --no-install-suggests -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~bookworm app-protect-module-oss  <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get remove --purge --auto-remove -y apt-transport-https lsb-release gnupg wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/* /etc/apt/sources.list.d/nginx-app-protect.list</span></span></code></pre></div>
</div>
<h4 
id="nginx-open-source-dockerfile-1">NGINX Open Source Dockerfile  <a class="headerlink float-right" href="#nginx-open-source-dockerfile-1" title="NGINX Open Source Dockerfile"><i class="fas fa-link fa-xs"></i></a>
</h4><div class="tabs-container">
	<ul class="nav nav-tabs" id="offline_nap5_nginx_oss_dockerfiles" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#offline_nap5_nginx_oss_dockerfiles-0" role="tab" aria-controls="offline_nap5_nginx_oss_dockerfiles-0" aria-selected="true">Alpine Linux</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_oss_dockerfiles-1" role="tab" aria-controls="offline_nap5_nginx_oss_dockerfiles-1">Debian</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_oss_dockerfiles-2" role="tab" aria-controls="offline_nap5_nginx_oss_dockerfiles-2">Oracle Linux 8</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_oss_dockerfiles-3" role="tab" aria-controls="offline_nap5_nginx_oss_dockerfiles-3">RHEL</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_oss_dockerfiles-4" role="tab" aria-controls="offline_nap5_nginx_oss_dockerfiles-4">Ubuntu</a></li></ul>
</div>
<div class="tab-content" id="offline_nap5_nginx_oss_dockerfiles"><div id="offline_nap5_nginx_oss_dockerfiles-0" class="tab-pane show active" role="tabpanel" aria-labelledby="offline_nap5_nginx_oss_dockerfiles-0">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6de21538&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6de21538">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk add openssl curl ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;%s%s%s%s\n&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;http://nginx.org/packages/mainline/alpine/v&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="sb">`</span>egrep -o <span class="s1">&#39;^[0-9]+\.[0-9]+&#39;</span> /etc/alpine-release<span class="sb">`</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;/main&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="p">|</span> tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apk add openssl curl ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;%s%s%s%s\n&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;http://nginx.org/packages/mainline/alpine/v&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="sb">`</span>egrep -o <span class="s1">&#39;^[0-9]+\.[0-9]+&#39;</span> /etc/alpine-release<span class="sb">`</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="s2">&#34;/main&#34;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="p">|</span> tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-oss/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_oss_dockerfiles-1" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_oss_dockerfiles-1">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6eefef40&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6eefef40">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/debian `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_oss_dockerfiles-2" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_oss_dockerfiles-2">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f023308&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f023308">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_oss_dockerfiles-3" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_oss_dockerfiles-3">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f1672a0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f1672a0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[nginx-mainline]&#34;</span> &gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx mainline repo&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgkey=https://nginx.org/keys/nginx_signing.key&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;module_hotfixes=true&#34;</span> &gt;&gt; /etc/yum.repos.d/nginx.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-oss]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-oss/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-oss.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_oss_dockerfiles-4" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_oss_dockerfiles-4">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f281a28&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f281a28">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX OSS and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://nginx.org/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      http://nginx.org/packages/mainline/ubuntu `lsb_release -cs` nginx\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> gpg --dearmor <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /usr/share/keyrings/nginx-static-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-static-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-static-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">      https://pkgs.nginx.com/app-protect-x-oss/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>      tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y <span class="nv">nginx</span><span class="o">=</span>1.25.5-1~<span class="sb">`</span>lsb_release -cs<span class="sb">`</span> app-protect-module-oss <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div></div>

<p>You are ready to <a href="#build-image-sub">Build the image</a></p>
<h4 
id="nginx-plus-dockerfile-1">NGINX Plus Dockerfile  <a class="headerlink float-right" href="#nginx-plus-dockerfile-1" title="NGINX Plus Dockerfile"><i class="fas fa-link fa-xs"></i></a>
</h4><div class="tabs-container">
	<ul class="nav nav-tabs" id="offline_nap5_nginx_plus_dockerfiles" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#offline_nap5_nginx_plus_dockerfiles-0" role="tab" aria-controls="offline_nap5_nginx_plus_dockerfiles-0" aria-selected="true">Alpine Linux</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_plus_dockerfiles-1" role="tab" aria-controls="offline_nap5_nginx_plus_dockerfiles-1">Debian</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_plus_dockerfiles-2" role="tab" aria-controls="offline_nap5_nginx_plus_dockerfiles-2">Oracle Linux 8</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_plus_dockerfiles-3" role="tab" aria-controls="offline_nap5_nginx_plus_dockerfiles-3">RHEL</a></li>
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_nginx_plus_dockerfiles-4" role="tab" aria-controls="offline_nap5_nginx_plus_dockerfiles-4">Ubuntu</a></li></ul>
</div>
<div class="tab-content" id="offline_nap5_nginx_plus_dockerfiles"><div id="offline_nap5_nginx_plus_dockerfiles-0" class="tab-pane show active" role="tabpanel" aria-labelledby="offline_nap5_nginx_plus_dockerfiles-0">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f37ae70&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f37ae70">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_VER&#39;s are 3.16/3.17/3.19</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_VER</span><span class="o">=</span><span class="s2">&#34;3.19&#34;</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> alpine:${OS_VER}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/apk/cert.pem,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/apk/cert.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    wget -O /etc/apk/keys/nginx_signing.rsa.pub https://cs.nginx.com/static/keys/nginx_signing.rsa.pub <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;https://pkgs.nginx.com/app-protect-x-plus/alpine/v`egrep -o &#39;^[0-9]+\.[0-9]+&#39; /etc/alpine-release`/main\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee -a /etc/apk/repositories <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apk add app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/apk/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_plus_dockerfiles-1" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_plus_dockerfiles-1">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f68ebe8&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f68ebe8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: bullseye/bookworm</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>bookworm
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> debian:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       debian-archive-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/debian `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_plus_dockerfiles-2" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_plus_dockerfiles-2">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f770930&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f770930">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> oraclelinux:8</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    dnf -y install wget ca-certificates yum-utils <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/nginx-plus-8.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/8/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-8-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf -y install app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> dnf clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/dnf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_plus_dockerfiles-3" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_plus_dockerfiles-3">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f88dbb0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f88dbb0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-7.4.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;9&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">else</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/<span class="si">${</span><span class="nv">NGINX_PLUS_REPO</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported UBI_VERSION&#39;s are 7/8/9</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">UBI_VERSION</span><span class="o">=</span><span class="m">9</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base Image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> registry.access.redhat.com/ubi${UBI_VERSION}/ubi</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define the ARG again after FROM to use it in this stage</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> UBI_VERSION<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="nv">PKG_MANAGER</span><span class="o">=</span>dnf<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;7&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">PKG_MANAGER</span><span class="o">=</span>yum<span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-7.4.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">elif</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">&#34;</span> <span class="o">=</span> <span class="s2">&#34;9&#34;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">else</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>        <span class="nv">NGINX_PLUS_REPO</span><span class="o">=</span><span class="s2">&#34;nginx-plus-</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">.repo&#34;</span><span class="p">;</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="k">fi</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> -y install wget ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/dependencies.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/yum.repos.d https://cs.nginx.com/static/files/<span class="si">${</span><span class="nv">NGINX_PLUS_REPO</span><span class="si">}</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;[app-protect-x-plus]&#34;</span> &gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;name=nginx-app-protect repo&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;baseurl=https://pkgs.nginx.com/app-protect-x-plus/centos/</span><span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span><span class="s2">/\$basearch/&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientcert=/etc/ssl/nginx/nginx-repo.crt&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;sslclientkey=/etc/ssl/nginx/nginx-repo.key&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;gpgcheck=0&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">echo</span> <span class="s2">&#34;enabled=1&#34;</span> &gt;&gt; /etc/yum.repos.d/app-protect-<span class="si">${</span><span class="nv">UBI_VERSION</span><span class="si">}</span>-x-plus.repo <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">$PKG_MANAGER</span> clean all <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/cache/<span class="nv">$PKG_MANAGER</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_nginx_plus_dockerfiles-4" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_nginx_plus_dockerfiles-4">
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">dockerfile</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6f98d970&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6f98d970">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="c"># syntax=docker/dockerfile:1</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Supported OS_CODENAME&#39;s are: focal/jammy</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">ARG</span> <span class="nv">OS_CODENAME</span><span class="o">=</span>jammy
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c"># Base image</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">FROM</span><span class="s"> ubuntu:${OS_CODENAME}</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Install NGINX Plus and NGINX App Protect WAF v5 module</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">RUN</span> --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-crt,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.crt,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    --mount<span class="o">=</span><span class="nv">type</span><span class="o">=</span>secret,id<span class="o">=</span>nginx-key,dst<span class="o">=</span>/etc/ssl/nginx/nginx-repo.key,mode<span class="o">=</span><span class="m">0644</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get install -y <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       apt-transport-https <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       lsb-release <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ca-certificates <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       wget <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gnupg2 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       ubuntu-keyring <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -qO - https://cs.nginx.com/static/keys/nginx_signing.key <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       gpg --dearmor <span class="p">|</span> tee /usr/share/keyrings/nginx-archive-keyring.gpg &gt;/dev/null <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> gpg --dry-run --quiet --no-keyring --import --import-options import-show /usr/share/keyrings/nginx-archive-keyring.gpg <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-plus.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nb">printf</span> <span class="s2">&#34;deb [signed-by=/usr/share/keyrings/nginx-archive-keyring.gpg] \
</span></span></span><span class="line"><span class="cl"><span class="s2">       https://pkgs.nginx.com/app-protect-x-plus/ubuntu `lsb_release -cs` nginx-plus\n&#34;</span> <span class="p">|</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>       tee /etc/apt/sources.list.d/nginx-app-protect.list <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> wget -P /etc/apt/apt.conf.d https://cs.nginx.com/static/files/90pkgs-nginx <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get update <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> <span class="nv">DEBIAN_FRONTEND</span><span class="o">=</span><span class="s2">&#34;noninteractive&#34;</span> apt-get install -y app-protect-module-plus <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stdout /var/log/nginx/access.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> ln -sf /dev/stderr /var/log/nginx/error.log <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> apt-get clean <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>    <span class="o">&amp;&amp;</span> rm -rf /var/lib/apt/lists/*<span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Expose port</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">EXPOSE</span><span class="s"> 80</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Define stop signal</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">STOPSIGNAL</span><span class="s"> SIGQUIT</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="c"># Set default command</span><span class="err">
</span></span></span><span class="line"><span class="cl"><span class="err"></span><span class="k">CMD</span> <span class="p">[</span><span class="s2">&#34;nginx&#34;</span><span class="p">,</span> <span class="s2">&#34;-g&#34;</span><span class="p">,</span> <span class="s2">&#34;daemon off;&#34;</span><span class="p">]</span></span></span></code></pre></div>
</div>
</div></div>

<h3 
id="build-image-sub">Build Image  <a class="headerlink float-right" href="#build-image-sub" title="Build Image"><i class="fas fa-link fa-xs"></i></a>
</h3><blockquote class="note">
  <div><strong>Note:</strong><br/> Never upload your NGINX App Protect WAF v5 images to a public container registry such as Docker Hub. Doing so violates your license agreement.</div>
</blockquote>

<p>To build the image, execute the following command in the directory containing the <code>nginx-repo.crt</code>, <code>nginx-repo.key</code>, and <code>Dockerfile</code>. Here, <code>nginx-app-protect-5</code> is an example image tag.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fa1d250&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fa1d250">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker build --no-cache --platform linux/amd64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-crt,src<span class="o">=</span>nginx-repo.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-key,src<span class="o">=</span>nginx-repo.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -t nginx-app-protect-5 .</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker build --no-cache --platform linux/amd64 <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-crt,src<span class="o">=</span>nginx-repo.crt <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --secret <span class="nv">id</span><span class="o">=</span>nginx-key,src<span class="o">=</span>nginx-repo.key <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  -t nginx-app-protect-5 .</span></span></code></pre></div>
</div>
<h4 
id="download-waf-enforcer-and-waf-config-mgr-images">Download Waf-Enforcer and Waf-Config-mgr Images  <a class="headerlink float-right" href="#download-waf-enforcer-and-waf-config-mgr-images" title="Download Waf-Enforcer and Waf-Config-mgr Images"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Pull the <code>waf-enforcer</code> and <code>waf-config-mgr</code> images. Replace <code>5.2.0</code> with the actual release version you are deploying.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e34d4d0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e34d4d0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull private-registry.nginx.com/nap/waf-enforcer:5.2.0
</span></span><span class="line"><span class="cl">docker pull private-registry.nginx.com/nap/waf-config-mgr:5.2.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker pull private-registry.nginx.com/nap/waf-enforcer:5.2.0
</span></span><span class="line"><span class="cl">docker pull private-registry.nginx.com/nap/waf-config-mgr:5.2.0</span></span></code></pre></div>
</div><h4 
id="saving-and-transferring-images">Saving and Transferring Images  <a class="headerlink float-right" href="#saving-and-transferring-images" title="Saving and Transferring Images"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>Save the NGINX Open Source or NGINX Plus image you built earlier.</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e398bd8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e398bd8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o nginx-app-protect-5.tar nginx-app-protect-5</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o nginx-app-protect-5.tar nginx-app-protect-5</span></span></code></pre></div>
</div></li>
<li>
<p>Save the <code>waf-enforcer</code> docker image</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e3d25b8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e3d25b8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o waf-enforcer.tar waf-enforcer:5.2.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o waf-enforcer.tar waf-enforcer:5.2.0</span></span></code></pre></div>
</div></li>
<li>
<p>Save the <code>waf-config-mgr</code> docker image</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e42a3f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e42a3f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o waf-config-mgr.tar waf-config-mgr:5.2.0</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker save -o waf-config-mgr.tar waf-config-mgr:5.2.0</span></span></code></pre></div>
</div></li>
<li>
<p>Transfer the tar files from the online machine to the offline/air-gapped machine.</p>
</li>
<li>
<p>On the offline machine load the docker images</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e45a198&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e45a198">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker load -i nginx-app-protect-5.tar
</span></span><span class="line"><span class="cl">docker load -i waf-enforcer.tar
</span></span><span class="line"><span class="cl">docker load -i waf-config-mgr.tar</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker load -i nginx-app-protect-5.tar
</span></span><span class="line"><span class="cl">docker load -i waf-enforcer.tar
</span></span><span class="line"><span class="cl">docker load -i waf-config-mgr.tar</span></span></code></pre></div>
</div></li>
</ol>
<h4 
id="local-registry-setup">Local Registry Setup  <a class="headerlink float-right" href="#local-registry-setup" title="Local Registry Setup"><i class="fas fa-link fa-xs"></i></a>
</h4><p>Set up a local registry for the images on the offline/air-gap machine.
For the example deployment we will use <a href="https://www.docker.com/blog/how-to-use-your-own-registry-2/" target="_blank" rel="noopener">Registry</a>.</p>
<ol>
<li>
<p>Set up a local registry on the offline/air-gap machine</p>
</li>
<li>
<p>Add nginx-app-protect-5, waf-enforcer, and waf-config-mgr to the local registry</p>
</li>
</ol>
<h3 
id="nginx-configuration-1">NGINX Configuration  <a class="headerlink float-right" href="#nginx-configuration-1" title="NGINX Configuration"><i class="fas fa-link fa-xs"></i></a>
</h3><p>In your nginx configuration:</p>
<ol>
<li>
<p>Load the NGINX App Protect WAF v5 module at the main context:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e47d418&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e47d418">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Configure the Enforcer address at the <code>http</code> context:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e494730&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e494730">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enforcer_address</span> <span class="n">waf-enforcer</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enforcer_address</span> <span class="n">waf-enforcer</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
<li>
<p>Enable NGINX App Protect WAF on an <code>http/server/location</code> context (make sure you only enable NGINX App Protect WAF with <code>proxy_pass</code>/<code>grpc_pass</code> locations):</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e4ac218&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e4ac218">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enable</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">app_protect_enable</span> <span class="no">on</span><span class="p">;</span></span></span></code></pre></div>
</div></li>
</ol>
<p>In this guide, we have created the following files under <code>/conf/</code> directory on the offline machine:</p>
<div class="tabs-container">
	<ul class="nav nav-tabs" id="offline_nap5_install_conf_files_hostname" role="tablist"><li class="nav-item"><a data-toggle="tab" class="nav-link active" href="#offline_nap5_install_conf_files_hostname-0" role="tab" aria-controls="offline_nap5_install_conf_files_hostname-0" aria-selected="true">nginx.conf</a></li>
		
			<li class="nav-item"><a data-toggle="tab" class="nav-link" href="#offline_nap5_install_conf_files_hostname-1" role="tab" aria-controls="offline_nap5_install_conf_files_hostname-1">default.conf</a></li></ul>
</div>
<div class="tab-content" id="offline_nap5_install_conf_files_hostname"><div id="offline_nap5_install_conf_files_hostname-0" class="tab-pane show active" role="tabpanel" aria-labelledby="offline_nap5_install_conf_files_hostname-0">
<p><code>/nginx.conf</code></p>
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6fdb9b48&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6fdb9b48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">waf-enforcer</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">user</span>  <span class="s">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">worker_processes</span>  <span class="s">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">load_module</span> <span class="s">modules/ngx_http_app_protect_module.so</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">error_log</span>  <span class="s">/var/log/nginx/error.log</span> <span class="s">notice</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">pid</span>        <span class="s">/var/run/nginx.pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">include</span>       <span class="s">/etc/nginx/mime.types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">default_type</span>  <span class="s">application/octet-stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">log_format</span>  <span class="s">main</span>  <span class="s">&#39;</span><span class="nv">$remote_addr</span> <span class="s">-</span> <span class="nv">$remote_user</span> <span class="s">[</span><span class="nv">$time_local]</span> <span class="s">&#34;</span><span class="nv">$request&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;</span><span class="nv">$status</span> <span class="nv">$body_bytes_sent</span> <span class="s">&#34;</span><span class="nv">$http_referer&#34;</span> <span class="s">&#39;</span>
</span></span><span class="line"><span class="cl">                    <span class="s">&#39;&#34;</span><span class="nv">$http_user_agent&#34;</span> <span class="s">&#34;</span><span class="nv">$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">access_log</span>  <span class="s">/var/log/nginx/access.log</span>  <span class="s">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">sendfile</span>        <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="kn">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">app_protect_enforcer_address</span> <span class="n">waf-enforcer</span><span class="p">:</span><span class="mi">50000</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">include</span> <span class="s">/etc/nginx/conf.d/*.conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div>
  <div id="offline_nap5_install_conf_files_hostname-1" class="tab-pane" role="tabpanel" aria-labelledby="offline_nap5_install_conf_files_hostname-1">
<p><code>/default.conf</code></p>
<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">nginx</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6faf3030&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6faf3030">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">domain.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span> <span class="s">text/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8080/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">8080</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># redirect server error pages to the static page /50x.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">error_page</span> <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span> <span class="s">/50x.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="p">=</span> <span class="s">/50x.html</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-nginx" data-lang="nginx"><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">domain.com</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">proxy_http_version</span> <span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># NGINX App Protect WAF
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kn">app_protect_enable</span> <span class="no">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="kn">client_max_body_size</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">default_type</span> <span class="s">text/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">proxy_pass</span> <span class="s">http://127.0.0.1:8080/</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kn">listen</span> <span class="mi">8080</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">server_name</span> <span class="s">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="s">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">index</span> <span class="s">index.html</span> <span class="s">index.htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># redirect server error pages to the static page /50x.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">#
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kn">error_page</span> <span class="mi">500</span> <span class="mi">502</span> <span class="mi">503</span> <span class="mi">504</span> <span class="s">/50x.html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kn">location</span> <span class="p">=</span> <span class="s">/50x.html</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kn">root</span> <span class="s">/usr/share/nginx/html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span></span></span></code></pre></div>
</div>
</div></div>

<h3 
id="waf-services-configuration-1">WAF Services Configuration  <a class="headerlink float-right" href="#waf-services-configuration-1" title="WAF Services Configuration"><i class="fas fa-link fa-xs"></i></a>
</h3><h4 
id="manifest-deployment-1">Manifest Deployment  <a class="headerlink float-right" href="#manifest-deployment-1" title="Manifest Deployment"><i class="fas fa-link fa-xs"></i></a>
</h4><p>In this configuration, one replicas are deployed, with each hosting both NGINX and WAF services together in a single Kubernetes pod.</p>
<p>For simplification in this documentation, we&rsquo;re using a hostPath backed persistent volume claim <code>nap5-storage.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e582f98&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e582f98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/mnt/nap5_bundles_pv_data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolumeClaim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">local</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">capacity</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">persistentVolumeReclaimPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">Retain</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">hostPath</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;/mnt/nap5_bundles_pv_data&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nn">---</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">PersistentVolumeClaim</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l">manual</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="l">ReadWriteOnce</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">resources</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">requests</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l">2Gi</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">volumeName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pv</span></span></span></code></pre></div>
</div><p>An example <code>nap5-deployment.yaml</code>:</p>
<p>Replace the <code>&lt;your-private-registry&gt;/nginx-app-protect-5:&lt;your-tag&gt;</code> with the actual image tag.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e7ac710&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e7ac710">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/nginx-app-protect-5:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-default-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/conf.d/default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/waf-enforcer:5.2.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/waf-config-mgr:5.2.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-default-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">apps/v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-deployment</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="m">1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">template</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">labels</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">containers</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/nginx-app-protect-5:latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-default-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/nginx/conf.d/default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">subPath</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-enforcer</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/waf-enforcer:5.2.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">env</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">ENFORCER_PORT</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;50000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">waf-config-mgr</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">localhost:5000/waf-config-mgr:5.2.0</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l">IfNotPresent</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">securityContext</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">allowPrivilegeEscalation</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">capabilities</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">drop</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span>- <span class="l">all</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/bd_config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/opt/app_protect/config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l">/etc/app_protect/bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bd-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">emptyDir</span><span class="p">:</span><span class="w"> </span>{}<span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">app-protect-bundles</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l">nap5-bundles-pvc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">nginx.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-default-config-volume</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">configMap</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx-config</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">items</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">              </span>- <span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">                </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">default.conf</span></span></span></code></pre></div>
</div><p>Finally, <code>nap5-service.yaml</code>:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">yaml</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e82a6b0&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e82a6b0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l">v1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l">Service</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">metadata</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">nginx</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">spec</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">selector</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l">nap5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l">TCP</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="m">80</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l">NodePort</span></span></span></code></pre></div>
</div><p>In this configuration, a single replica is deployed. It hosts both NGINX and WAF services. These services run together in a single Kubernetes pod.</p>
<p>Add <code>nginx.conf</code> and <code>default.conf</code> to a config map.</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e889638&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e889638">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create configmap nginx-config <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --from-file<span class="o">=</span>/nginx.conf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --from-file<span class="o">=</span>/default.conf</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl create configmap nginx-config <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --from-file<span class="o">=</span>/nginx.conf <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --from-file<span class="o">=</span>/default.conf</span></span></code></pre></div>
</div><h4 
id="start-deployment-1">Start Deployment  <a class="headerlink float-right" href="#start-deployment-1" title="Start Deployment"><i class="fas fa-link fa-xs"></i></a>
</h4><ol>
<li>
<p>Assuming the above manifests are saved in the <code>/home/user/k8s</code> directory, you can deploy them by executing the following command:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e8d31e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e8d31e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f /home/user/k8s</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl apply -f /home/user/k8s</span></span></code></pre></div>
</div><p>Example output:</p>



<div class="code-block" data-mf="true" style="display: none;"><span class="code-type chroma">shell</span><div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e937b48&#34;)" class="code-copy-button multi-line" type="button">Copy</button>
        <div class="highlight-v2" id="id-18440f1f6e937b48">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">deployment.apps/nap5-deployment created
</span></span><span class="line"><span class="cl">service/nginx created
</span></span><span class="line"><span class="cl">persistentvolume/nap5-bundles-pv created
</span></span><span class="line"><span class="cl">persistentvolumeclaim/nap5-bundles-pvc created</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">deployment.apps/nap5-deployment created
</span></span><span class="line"><span class="cl">service/nginx created
</span></span><span class="line"><span class="cl">persistentvolume/nap5-bundles-pv created
</span></span><span class="line"><span class="cl">persistentvolumeclaim/nap5-bundles-pvc created</span></span></code></pre></div>
</div><p>This command tells <code>kubectl</code> to apply the configuration defined in all the files within the <code>/home/user/k8s</code> directory to your Kubernetes cluster.</p>
</li>
<li>
<p>Verify the deployment:</p>
<ul>
<li>
<p>Check the status of the deployment using:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e979de0&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e979de0">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get deployments</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get deployments</span></span></code></pre></div>
</div></li>
<li>
<p>Verify that the pods are running with:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e9b0cc8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e9b0cc8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get pods</span></span></code></pre></div>
</div></li>
<li>
<p>Verify services with:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6e9ecdb8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6e9ecdb8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get services</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">kubectl get services</span></span></code></pre></div>
</div></li>
<li>
<p>To verify the enforcement functionality, ensure the following request is rejected:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6ea21978&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6ea21978">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;&lt;node-external-ip&gt;:&lt;node-port&gt;/&lt;script&gt;&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;&lt;node-external-ip&gt;:&lt;node-port&gt;/&lt;script&gt;&#34;</span></span></span></code></pre></div>
</div></li>
</ul>
</li>
<li>
<p>To restart the deployment, use:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6ea5c2f8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6ea5c2f8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl rollout restart deployment.apps/nap5-deployment</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl rollout restart deployment.apps/nap5-deployment</span></span></code></pre></div>
</div></li>
<li>
<p>To remove the deployment, use:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6ea93d98&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6ea93d98">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -f /home/user/k8s</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">kubectl delete -f /home/user/k8s</span></span></code></pre></div>
</div></li>
</ol>
<h3 
id="start-deployment-2">Start Deployment  <a class="headerlink float-right" href="#start-deployment-2" title="Start Deployment"><i class="fas fa-link fa-xs"></i></a>
</h3><ol>
<li>
<p>To start the NGINX and WAF services, navigate to the directory that contains the <code>docker-compose.yml</code> file and run:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6eada298&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6eada298">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker compose up -d</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker compose up -d</span></span></code></pre></div>
</div></li>
<li>
<p>To verify the enforcement functionality, ensure the following request is rejected:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6eb0d6e8&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6eb0d6e8">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;localhost/&lt;script&gt;&#34;</span></span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">curl <span class="s2">&#34;localhost/&lt;script&gt;&#34;</span></span></span></code></pre></div>
</div></li>
<li>
<p>(Optionally) To reload the NGINX, run:</p>



<div class="code-block" data-mf="true" style="display: none;">
    <div class="code-container chroma">
        <button onclick="copyToClipBoard(this, &#34;id-18440f1f6eb6ed80&#34;)" class="code-copy-button" type="button">Copy</button>
        <div class="highlight-v2 single-line" id="id-18440f1f6eb6ed80">
            <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker <span class="nb">exec</span> nginx  nginx -s reload</span></span></code></pre></div>
        </div>
    </div>
</div><div id="code-block-v1" data-mf="false">
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">sudo docker <span class="nb">exec</span> nginx  nginx -s reload</span></span></code></pre></div>
</div></li>
</ol>
<hr>
<h2 
id="troubleshooting">Troubleshooting  <a class="headerlink float-right" href="#troubleshooting" title="Troubleshooting"><i class="fas fa-link fa-xs"></i></a>
</h2><ul>
<li><strong>Pod Failures</strong>: If a pod fails, check its logs using <code>kubectl logs [pod_name] -c [container_name]</code> for error messages. The default names for the containers are:
<ul>
<li><code>nginx</code>.</li>
<li><code>waf-enforcer</code></li>
<li><code>waf-config-mgr</code></li>
</ul>
</li>
<li><strong>Connectivity Issues</strong>: Verify the service and deployment configurations, especially port mappings and selectors.</li>
<li><strong>Permissions Issues</strong>: By default, the containers <code>waf-config-mgr</code> and <code>waf-enforcer</code> operate with the user and group IDs set to 101:101. Ensure that the bundle files are accessible to these IDs.</li>
</ul>
<p>If you encounter any issues, check the <a href="http://localhost:1313/nginx-app-protect-waf/v5/troubleshooting-guide/troubleshooting/#nginx-app-protect-5">Troubleshooting Guide</a>.</p>
<h2 
id="conclusion">Conclusion  <a class="headerlink float-right" href="#conclusion" title="Conclusion"><i class="fas fa-link fa-xs"></i></a>
</h2><p>This guide provides the foundational steps for deploying NGINX App Protect WAF v5 on Kubernetes. You may need to adjust the deployment to fit your specific requirements.</p>
<p>For more detailed configuration options and advanced deployment strategies, refer to the <a href="http://localhost:1313/nginx-app-protect-waf/v5/configuration-guide/configuration/">NGINX App Protect WAF v5 configuration guide</a>.</p>

        
        

        <hr>
  
        
        <div class="last-modified">
          
<div>
    <a href="https://github.com/nginx/documentation//tree/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-file-lines fa-fw"></i> View source</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//edit/main/content/nap-waf/v5/admin-guide/deploy-with-manifests.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
  </div>
  <div>
    <a href="https://github.com/nginx/documentation//issues/new?title=Deploy%20NGINX%20App%20Protect%20WAF%20with%20Manifests&amp;template=2-bug_report.md" class="" target="_blank" rel="noopener"><i class="fa-solid fa-list-check fa-fw"></i> Create a new issue</a>
  </div>



        </div>
        

        
         
<script type='text/javascript'> 
    (function(){var g=function(e,h,f,g){ 
        this.get=function(a){
            for(var a=a+"=",c=document.cookie.split(";"),b=0,e=c.length;b<e;b++){
                for(var d=c[b];" "==d.charAt(0);)
                    d=d.substring(1,d.length);
                    if(0==d.indexOf(a))
                        return d.substring(a.length,d.length)
            }
            return null
        }; 
        
        this.set=function(a,c){
            var b="",b=new Date;
            b.setTime(b.getTime()+6048E5);
            b="; expires="+b.toGMTString();
            document.cookie=a+"="+c+b+"; path=/; "
        }; 
        
        this.check=function(){
            var a=this.get(f);
            if(a)
                a=a.split(":");
            else if(100!=e)
                "v"==h&&(e=Math.random()>=e/100?0:100),
                a=[h,e,0],
                this.set(f,a.join(":"));
            else 
                return!0;
            var c=a[1];
            if(100==c)
                return!0;
            switch(a[0]){
                case "v":
                    return!1;
                case "r":
                    return c=a[2]%Math.floor(100/c),a[2]++,this.set(f,a.join(":")),!c
            }
            return!0
        }; 

        this.go=function(){
            if(this.check()){
                var a=document.createElement("script");
                a.type="text/javascript";
                a.src=g;
                document.body&&document.body.appendChild(a)
            }
        };

        this.start=function(){
            var t=this;
            "complete"!==document.readyState?window.addEventListener ?
                window.addEventListener("load",function(){t.go()},!1) : 
                window.attachEvent&&window.attachEvent("onload",function(){t.go()}):t.go()};
    }; 

    try{
        const project_id = window.location.hostname.includes("staging") ? "QSI_S_ZN_2YG73ads2zp5bN0" : "QSI_S_ZN_2QSTn2r41YlXrYk";
        const endpoint = window.location.hostname.includes("staging") ? "https://zn2yg73ads2zp5bn0-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2YG73ads2zp5bN0" : "https://zn2qstn2r41ylxryk-f5.siteintercept.qualtrics.com/SIE/?Q_ZID=ZN_2QSTn2r41YlXrYk";
        (new g(100,"r", project_id, endpoint)).start()
    }
    catch(i){}})();

    document.addEventListener("DOMContentLoaded", function () {
        document.querySelector(".qualtrics-feedback").id = window.location.hostname.includes("staging") ? "ZN_2YG73ads2zp5bN0" : "ZN_2QSTn2r41YlXrYk"
    });
</script>
<hr>
<div style="height: 60px;"></div>
<div class="qualtrics-feedback" id='ZN_2QSTn2r41YlXrYk'></div>


        

	
<div class="container flex">
	<ul class="next-prev-icon">

		
		
		<li style="flex:1; text-align: left; white-space: nowrap;"><a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-with-helm/" class="" title="Previous -- Deploy NGINX App Protect WAF with Helm "><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M23.378 46.5L1.94 25.06C1.80067 24.9209 1.69014 24.7556 1.61472 24.5738C1.53931 24.3919 1.50049 24.1969 1.50049 24C1.50049 23.8031 1.53931 23.6081 1.61472 23.4262C1.69014 23.2444 1.80067 23.0791 1.94 22.94L23.378 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M45.878 46.5L24.44 25.06C24.3007 24.9209 24.1901 24.7556 24.1147 24.5738C24.0393 24.3919 24.0005 24.1969 24.0005 24C24.0005 23.8031 24.0393 23.6081 24.1147 23.4262C24.1901 23.2444 24.3007 23.0791 24.44 22.94L45.878 1.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		

		
			<li style="flex:1; text-align: right; white-space: nowrap;"><a href="http://localhost:1313/nginx-app-protect-waf/v5/admin-guide/deploy-on-docker/" class="" title="Next -- Deploy NGINX App Protect WAF with Docker"><svg width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M24.622 1.5L46.06 22.94C46.1993 23.0791 46.3099 23.2444 46.3853 23.4262C46.4607 23.6081 46.4995 23.8031 46.4995 24C46.4995 24.1969 46.4607 24.3919 46.3853 24.5738C46.3099 24.7556 46.1993 24.9209 46.06 25.06L24.622 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
<path d="M2.122 1.5L23.56 22.94C23.6993 23.0791 23.8099 23.2444 23.8853 23.4262C23.9607 23.6081 23.9995 23.8031 23.9995 24C23.9995 24.1969 23.9607 24.3919 23.8853 24.5738C23.8099 24.7556 23.6993 24.9209 23.56 25.06L2.122 46.5" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
</svg>
</a></li>
		
		</ul>
	</div>

        </main>
        
          
            <div id="toc" class="col-md-3 d-none d-xl-block d-print-none nginx-toc align-top">
            <nav class="bd-links" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <h3 class="bd-toc-link">What's on This Page</h3><nav id="TableOfContents">
  <ul>
    <li><a href="#prerequisites">Prerequisites</a></li>
    <li><a href="#build-the-nginx-image">Build the NGINX Image</a>
      <ul>
        <li><a href="#download-certificates">Download Certificates</a></li>
        <li><a href="#dockerfile-based-on-the-official-nginx-image">Dockerfile Based on the Official NGINX Image</a></li>
        <li><a href="#nginx-open-source-dockerfile">NGINX Open Source Dockerfile</a></li>
        <li><a href="#nginx-plus-dockerfile">NGINX Plus Dockerfile</a></li>
        <li><a href="#build-image">Build Image</a></li>
      </ul>
    </li>
    <li><a href="#nginx-configuration">NGINX Configuration</a></li>
    <li><a href="#waf-services-configuration">WAF Services Configuration</a>
      <ul>
        <li><a href="#jwt-token-and-docker-config-secret">JWT Token and Docker Config Secret</a></li>
        <li><a href="#manifest-deployment">Manifest Deployment</a></li>
        <li><a href="#start-deployment">Start Deployment</a></li>
      </ul>
    </li>
    <li><a href="#configure-read-only-file-systems">Configure read only file systems</a>
      <ul>
        <li><a href="#enable-readonlyrootfilesystem-and-configure-writable-paths">Enable <code>readOnlyRootFilesystem</code> and configure writable paths</a></li>
        <li><a href="#update-nginx-configuration-with-writable-paths">Update NGINX configuration with writable paths</a></li>
        <li><a href="#possible-issues">Possible issues</a></li>
      </ul>
    </li>
    <li><a href="#enable-mtls">Enable mTLS</a></li>
    <li><a href="#use-compiled-policy-and-logging-profile-bundles-in-nginx">Use compiled Policy and Logging Profile bundles in NGINX</a></li>
    <li><a href="#air-gap-install-secure-offline-deployment">Air-Gap Install: Secure Offline Deployment</a>
      <ul>
        <li><a href="#prerequisites-1">Prerequisites</a></li>
        <li><a href="#build-the-nginx-image-1">Build the NGINX Image</a></li>
        <li><a href="#build-image-sub">Build Image</a></li>
        <li><a href="#nginx-configuration-1">NGINX Configuration</a></li>
        <li><a href="#waf-services-configuration-1">WAF Services Configuration</a></li>
        <li><a href="#start-deployment-2">Start Deployment</a></li>
      </ul>
    </li>
    <li><a href="#troubleshooting">Troubleshooting</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
  </div>
</nav>
            </div>
          
        
        
      </div>
    </section>
  </section>
</div>




      </div>
  </section>

    <footer id="footer">
      
      <footer id="footer">
  <div class="container-fluid">
    <div class="row align-items-center">
      <div class="col-md-6 d-md-flex">
        <img class="nginx-logo-footer" src="http://localhost:1313/images/icons/NGINX-Part-of-F5-horiz-all-white-525x208@2x.png"/>
      </div>
    </div>

    
    <div class="row d-print-none d-none d-md-flex">
      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Company</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/go/product/welcome-to-nginx"
              target="_blank"
              alt="Select to learn about F5 NGINX"
              >About F5 NGINX</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/company/events"
              target="_blank"
              alt="Select to learn about F5 events"
              >Events</a
            >
          </li>
        </ul>
        <br />
        <span class="footer-head">Resources</span>
        <ul class="footer-text">
          <li>
            <a
              href="https://www.f5.com/company/blog/nginx"
              target="_blank"
              alt="Select to visit the F5 NGINX blog"
              >Blog</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/go/faq/nginx-faq"
              target="_blank"
              alt="Select to visit the F5 NGINX frequently asked questions page"
              >FAQ</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/services"
              target="_blank"
              alt="Select to learn about F5 NGINX Support"
              >Professional Services</a
            >
          </li>
          <li>
            <a
              href="https://www.f5.com/learn/training"
              target="_blank"
              alt="Select to learn about F5 training offerings"
              >Training</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">Products</span>
        <ul class="footer-text">
          <li>
            <a
              title="F5 NGINX One"
              aria-label="F5 NGINX One"
              href="https://www.f5.com/products/nginx/one"
              >F5 NGINX One</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Plus"
              aria-label="F5 NGINX Plus"
              href="https://www.f5.com/products/nginx/nginx-plus"
              >F5 NGINX Plus</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX App Protect"
              aria-label="F5 NGINX App Protect"
              href="https://www.f5.com/products/nginx/nginx-app-protect"
              >F5 NGINX App Protect</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Instance Manager"
              aria-label="F5 NGINX Instance Manager"
              href="https://www.f5.com/products/nginx/instance-manager"
              >F5 NGINX Instance Manager</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Ingress Controller"
              aria-label="F5 NGINX Ingress Controller"
              href="https://www.f5.com/products/nginx/nginx-ingress-controller"
              >F5 NGINX Ingress Controller</a
            >
          </li>
          <li>
            <a
              title="F5 NGINX Gateway Fabric"
              aria-label="F5 NGINX Gateway Fabric"
              href="https://www.f5.com/products/nginx/nginx-gateway-fabric"
              >F5 NGINX Gateway Fabric</a
            >
          </li>
          <li>
            <a
              title="F5 NGINXaaS for Azure"
              aria-label="F5 NGINXaaS for Azure"
              href="https://www.f5.com/products/nginx/f5-nginxaas-for-azure"
              >F5 NGINXaaS for Azure</a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-3 d-none d-md-block">
        <span class="footer-head">NGINX on GitHub</span>
        <ul class="footer-text">
          <li>
            <a
              title="NGINX Open Source"
              aria-label="NGINX Open Source"
              href="https://github.com/nginx/nginx"
              ><span class="inner">NGINX Open Source</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Unit"
              aria-label="NGINX Unit"
              href="https://github.com/nginx/unit"
              ><span class="inner">NGINX Unit</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Amplify"
              aria-label="NGINX Amplify"
              href="https://github.com/nginxinc/nginx-amplify-agent"
              ><span class="inner">NGINX Amplify</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Agent"
              aria-label="NGINX Agent"
              href="https://github.com/nginx/Agent"
              ><span class="inner">NGINX Agent</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Kubernetes Ingress Controller"
              aria-label="NGINX Kubernetes Ingress Controller"
              href="https://github.com/nginxinc/kubernetes-ingress"
              ><span class="inner">NGINX Kubernetes Ingress Controller</span></a
            >
          </li>
          <li>
            <a
              title="NGINX Gateway Fabric"
              aria-label="NGINX Gateway Fabric"
              href="https://github.com/nginxinc/nginx-gateway-fabric"
              ><span class="inner">NGINX Gateway Fabric</span></a
            >
          </li>
        </ul>
      </div>

      <div class="col-md-2 d-none d-md-block">
        <span class="footer-head">Social</span>
        <ul class="footer-social">
          <li>
            <a
              href="https://www.facebook.com/nginxinc"
              title="facebook"
              aria-label="facebook"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-facebook" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://twitter.com/nginx"
              title="X"
              aria-label="x"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-x-twitter" aria-hidden="true"></i
            ></a>
          </li>
          <li>
            <a
              href="https://www.linkedin.com/company/nginx"
              title="linkedin"
              aria-label="linkedin"
              target="_blank"
              rel="noreferrer"
              ><i class="fa-brands fa-linkedin" aria-hidden="true"></i>
            </a>
          </li>
          <li>
            <a
              href="https://www.youtube.com/user/NginxInc"
              title="youtube"
              aria-label="youtube"
              target="_blank"
              rel="noreferrer"
              alt="NGINX Youtube Channel"
              ><i class="fa-brands fa-square-youtube" aria-hidden="true"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    
    <div class="site-info footer-text">
      <div class="text-center">
        <p>
          <a href="https://www.f5.com/"
            ><img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo"></a
          >
          2025 F5, Inc. All rights reserved.
        </p>
        <p>
          <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks</a
          >
          <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies</a
          >
          <a href="https://docs.nginx.com/ossc">Open Source Components</a>
          <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy</a
          >
          <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information</a
          >
          <span id="teconsent-v1"></span>
        </p>
      </div>
    </div>
    
  </div>
  
</footer>

      
    </footer>

    <footer data-mf="true" id="footer-v2" style="display:none;">
      
      <div class="footer-layout">
    <div class="footer-f5-trademark">
        <img class="f5-logo-footer" src="http://localhost:1313/images/icons/Logo_F5.svg" alt="F5 logo">
        <p>2025 F5, Inc. All rights reserved. NGINX is a registered trademark of F5, Inc.</p>
    </div>
    <div class="footer-useful-links">
        <a
            href="https://www.f5.com/company/policies/trademarks"
            rel="noopener"
            target="_blank"
            >Trademarks
        </a>
        <a
            href="https://www.f5.com/company/policies"
            rel="noopener"
            target="_blank"
            >Policies
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice"
            rel="noopener"
            target="_blank"
            >Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/F5-California-privacy-summary"
            rel="noopener"
            target="_blank"
            >California Privacy
        </a>
        <a
            href="https://www.f5.com/company/policies/privacy-notice#no-sell"
            rel="noopener"
            target="_blank"
            >Do Not Sell My Personal Information
        </a>
        <span id="teconsent-v2"></span>
    </div>
</div>

      
    </footer>
  
<script src="/js/jquery-3-6-4.min.js" type="text/javascript" integrity=""></script>


<script src="/js/kube.min.a3a07cceb64989e2f0bf41653ab4d8346ba4312270eb5cc80d6afad3bf30a0ca9768aaa2559cb582e663332c541edab6a4068ef2e88b739fa425e2e870eb0aff.js" type="text/javascript" integrity="sha512-o6B8zrZJieLwv0FlOrTYNGukMSJw61zIDWr6078woMqXaKqiVZy1guZjMyxUHtq2pAaO8uiLc5&#43;kJeLocOsK/w=="></script>



<script src="/js/bootstrap.bundle.min.c15ed88f56a52190ea645094409cbce5537eaaf108972f777c840037b8aa0c508f12e70b09e345cf8af7e450a8f6ce96ae974340f8bcd316e58d707c063b6f72.js" type="text/javascript"
  integrity="sha512-wV7Yj1alIZDqZFCUQJy85VN&#43;qvEIly93fIQAN7iqDFCPEucLCeNFz4r35FCo9s6WrpdDQPi80xbljXB8Bjtvcg=="></script>



<script src="/js/code-copy.bb21b72280613039f1fabb11acc6a901c07caaee454933031066fbda6b5406fd31077a80ec913ba32261224d138bcbb4a34d27c51efae571c68d59282943b9a4.js" type="text/javascript"></script>



<script src="/js/code-copy-v2.71bcaee23ab00cb45dc944f321264e21d25bc1ec1ae76f9596286cb408ea5654b4ee016e7914cc2554b237114eeb467d39df18735311f2d28480b3ccd2feb4ad.js" type="text/javascript"></script>





<script
  type="module"
  src="https://static.cloud.coveo.com/atomic/v3.19.0/atomic.esm.js"
  integrity="sha512-VA9k6iDWhwxl8bwKUYPD63l93lGX7daV60k3yFxEt9EuEq4iWvsu5COq1mZ8OXKl0KCOFlUSDXS32Cy+YwbufQ=="
  crossorigin="anonymous">
</script>


<script class="coveo-script" src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/CoveoJsSearch.Lazy.min.js"
  integrity="sha512-HxdDBIp5snbqtu1TPkBnXLKEvN9IPz3PeZW8zT9KfsflV9Ck822XDroDlpVbfCfXeiu8C0RDVn0fdu7aGy/H1g=="
  crossorigin="anonymous"></script>

<script src="https://static.cloud.coveo.com/searchui/v2.10104/0/js/templates/templates.js"
  integrity="sha512-CR0Yk/LIwgh1MsKqjecDp/r6F9ipKc6gA+4+E1pplT3N3r1pk+la/HaqyDiKtjOFwrwIIbIYBFrUJgPql93QHw=="
  crossorigin="anonymous"></script>






<script src="/js/coveo.min.4acfd205930e2d31230100f345e0463332eb3e3af1b4aa9a6e3131b0b2bac53566ae4d18b390066fce94c0c75d39b5e121d1291f81e5accc1a82d93da9f11b7f.js" integrity="sha512-Ss/SBZMOLTEjAQDzReBGMzLrPjrxtKqabjExsLK6xTVmrk0Ys5AGb86UwMddObXhIdEpH4HlrMwagtk9qfEbfw=="
  type="text/javascript"></script>


















<script src="/js/sidebar.min.6fed0180a23d01103c68ffb054a183fba5e7ba673de8c56d85857af964dcc0c11623ee09f6185207a373127cb2547ff9247ae3516ed47c67e1b58dbe71e9d576.js" type="text/javascript" integrity="sha512-b&#43;0BgKI9ARA8aP&#43;wVKGD&#43;6Xnumc96MVthYV6&#43;WTcwMEWI&#43;4J9hhSB6NzEnyyVH/5JHrjUW7UfGfhtY2&#43;cenVdg=="></script>
  


<script src="/js/site-dropdown.min.3bb49b6f7d25bcd4a2b008525bb8538d84237348bf618b40970ff6eca87119d68c326ca7ba04854ad102be36495fe1d70f1cb239916555b67dd17683dc283333.js" type="text/javascript" integrity="sha512-O7Sbb30lvNSisAhSW7hTjYQjc0i/YYtAlw/27KhxGdaMMmynugSFStECvjZJX&#43;HXDxyyOZFlVbZ90XaD3CgzMw=="></script>



<script src="/js/product-selector.min.b588249327fb12c7602fa08eb618560171f54e7348d6c1bacfdbf541f5e13023493f64f78fb6d4b9014892e5e4f0aaaee95b859bb37aa53bbe8c0e27e65167d1.js" type="text/javascript" integrity="sha512-tYgkkyf7EsdgL6COthhWAXH1TnNI1sG6z9v1QfXhMCNJP2T3j7bUuQFIkuXk8Kqu6VuFm7N6pTu&#43;jA4n5lFn0Q=="></script>



<script src="/js/sidebar-v2.min.3f906631e696b2c88883bfcfc62371165359130cfd118ceb49893ae0d8760dc38177ee3bb94a61dee45023115de8445f0b9fe48f933618ef7ba7b3180a05adbd.js" type="text/javascript" integrity="sha512-P5BmMeaWssiIg7/PxiNxFlNZEwz9EYzrSYk64Nh2DcOBd&#43;47uUph3uRQIxFd6ERfC5/kj5M2GO97p7MYCgWtvQ=="></script> 
  <div id="consent_blackbar"></div>
</body>
</html>


