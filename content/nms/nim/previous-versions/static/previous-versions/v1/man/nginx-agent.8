.\"
.\" Copyright (C) 2011-2021 Nginx, Inc.
.\" All rights reserved.
.\"
.\" Redistribution and use in source and binary forms, with or without
.\" modification, are permitted provided that the following conditions
.\" are met:
.\" 1. Redistributions of source code must retain the above copyright
.\"    notice, this list of conditions and the following disclaimer.
.\" 2. Redistributions in binary form must reproduce the above copyright
.\"    notice, this list of conditions and the following disclaimer in the
.\"    documentation and/or other materials provided with the distribution.
.\"
.\" THIS SOFTWARE IS PROVIDED BY THE AUTHOR AND CONTRIBUTORS ``AS IS'' AND
.\" ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
.\" IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
.\" ARE DISCLAIMED.  IN NO EVENT SHALL THE AUTHOR OR CONTRIBUTORS BE LIABLE
.\" FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
.\" DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
.\" OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
.\" HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
.\" LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
.\" OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
.\" SUCH DAMAGE.
.\"
.\"
.Dd 6/16/21
.Dt NGINX-AGENT 8
.Os
.Sh NAME
.Nm nginx-agent
.Nd "Instance Management for NGINX; quick, fast and easy" 
.Sh SYNOPSIS
.Nm
.Op Fl h
.Op Fl Fl flag Ar argument
.Sh DESCRIPTION
.Nm
( pronounced "engine x" ) is an agent for NGINX. 
The NGINX Agent is used by other NGINX programs to manage NGINX instances.
Like NGINX, the agent is known for its high performance, stability, simple
configuration, and low resource consumption.
.Pp
The options are as follows:
.Bl -tag -width ".Fl .Fl d Ar directives"
.It Fl Fl api-token Ar string
.Dv Token to use as
.Ar string
for command and metrics service.
.It Fl Fl config-dirs Ar path...
Set the allowed directories for writing files and includes to in a colon seperated list
(default "/etc/nginx").
.It Fl h, Fl Fl help
Print help.
.It Fl Fl log-level Ar level
Set log
.Ar level .
The default 
.Ar level
is "debug".
The argument
.Ar level
can be one of:
.Cm panic , fatal , error , info , debug , trace .
The following table shows the corresponding log levels:
.Pp
.Bl -tag -width ".Cm reopen" -compact
.It Cm panic
.Dv Emergencies, system is unusable. 
.It Cm fatal
.Dv Severe error that will prevent the application from continuing.
.It Cm error
.Dv Error in the application, possibly recoverable.
.It Cm info
.Dv Events for informational purposes.
.It Cm debug
.Dv Diagnostics and troubleshooting.
.It Cm trace
.Dv Use to trace code and functions.
.El
.Pp
.It Fl Fl log-path Ar path
.Ar path for logs.
If empty, uses stdout/stderr.
(default "/var/log/nginx-agent").
.It Fl Fl metadata Ar keyval-pair
metadata for specific instance.
.Ar keyval-pair
is a key value pair separated by an = sign.
(default []).
.It Fl Fl metrics-mode Ar type
Set the
.Ar type
to the type of metrics collected
(default "nim").
.It Fl Fl metrics-server Ar address
Name and gRPC port of the server to connect to as 
.Ar address. 
IP address or FQDN can be used.
The default
.Ar address
is "127.0.0.1:10000" and should be changed to where nginx-manager runs.
.It Fl Fl nginx-bin-path Ar path
.Ar path
to the NGINX binary
(default "/usr/sbin/nginx").
.It Fl Fl nginx-exclude-logs Ar path...
List of NGINX access logs to exclude from metrics
(comma separated).
.It Fl Fl nginx-metrics-poll-interval Ar duration
Set the
.Ar duration
that
.Nm
polls for metrics in seconds
(default 1s).
.It Fl Fl nginx-pid-path Ar path
.Ar path
to the NGINX pid file.
.It Fl Fl nginx-plus-api Ar URL
NGINX Plus API
.Ar URL
see: nginx.org/r/api
(example "http://127.0.0.1:8080/api").
.It Fl Fl nginx-stub-status Ar URL
NGINX Open Source stub_status
.Ar URL
see: nginx.org/r/api
(example "http://127.0.0.1:80/stub_status").
.It Fl Fl server Ar address
Name and gRPC port of the server to connect to as 
.Ar address. 
IP address or FQDN can be used.
(default "127.0.0.1:10000").
.It Fl Fl tags Ar list...
.Ar list
of tags for this specific instance as a comma-separated list.
.It Fl Fl tls-ca Ar path
.Ar path
to the certificate CA file for encryption
.It Fl Fl tls-cert Ar path
.Ar path
to certificate for encryption.
.It Fl Fl tls-enable
Enable grpc encryption.
Set we are encrypting the grpc on nginx-manager.
Omit if we are encrypting to a proxy server but not encrypting grpc.
.It Fl Fl tls-key Ar path
.Ar path
to the certificate key file for encyrption.
.El
.Pp
.Sh ENVIRONMENT
The
.Ev NGINX
environment variables are used internally by
.Nm
and should not be set directly by the user.
.Sh FILES
.Bl -tag -width indent "/Users/joeuser/Library/really_long_file_name" -compact
.It Pa "/etc/nginx-agent/nginx-agent.conf"
CONF_PATH The main configuration file.
.It Pa "/var/log/nginx-agent/nginx-agent.log"
LOG_PATH Log file location.
.El
.Sh EXIT STATUS
Exit status is 0 on success, or 1 if the command fails.
.Sh EXAMPLES
Non-standard NGINX configuration file and PID in 
.Pa /var/run/nginx.pid
:
.Bd -literal -offset indent
nginx-agent --server "nginx-manager.example.com:10000" \e
    --nginx-bin-path /usr/sbin/nginx \e
    --nginx-pid-path /var/run/nginx.pid \e
    --nginx-stub-status 127.0.0.1:80/stub_status
.Ed
.Sh COPYRIGHT
Copyright (C) 2011-2021 Nginx, Inc.
All rights reserved.
.Sh SEE ALSO
Documentation at
.Pa https://docs.nginx.com/nginx-instance-manager/getting-started/agent/
.Pp
For questions and technical support, please refer to
.Pa https://www.nginx.com/support/ .
