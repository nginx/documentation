---
title: ngx_otel_module
description: ngx_otel_module
toc: true
nd-org-source: ngx_otel_module.xml
nd-commercial: false
nd-commercial-partial: false
---


<!--
      ********************************************************************************
      üõë WARNING: AUTOGENERATED FILE - DO NOT EDIT üõë This Markdown file was
      automatically generated from the source XML documentation. Any manual
      changes made directly to this file will be overwritten. To request or
      suggest changes, please edit the source XML files instead.
      https://github.com/nginx/nginx.org/tree/main/xml/en
      ********************************************************************************
      -->


The `ngx_otel_module` module provides
[OpenTelemetry](https://opentelemetry.io)
distributed tracing support.
The module supports
[W3C](https://w3c.github.io/trace-context)
context propagation and OTLP/gRPC export protocol.

The source code of the module is available
[here](https://github.com/nginxinc/nginx-otel).
Download and install instructions are available
[here](https://github.com/nginxinc/nginx-otel/blob/main/README.md).

The module is also available in a prebuilt
`nginx-module-otel`[package]({{< relref "../linux_packages#dynmodules" >}})
since 1.25.3
and in `nginx-plus-module-otel` package
as part of our
commercial subscription since 1.23.4.
## Example Configuration


```nginx 
load_module modules/ngx_otel_module.so;

events {
}

http {

    otel_exporter {
        endpoint localhost:4317;
    }

    server {
        listen 127.0.0.1:8080;

        location / {
            otel_trace         on;
            otel_trace_context inject;

            proxy_pass http://backend;
        }
    }
}
 ```

## Directives

### otel_exporter

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_exporter</strong> { ... }</code><br/></td>
</tr><tr>
<th>Default: </th>
<td>
      ‚Äî
    </td>
</tr><tr>
<th>Context: </th>
<td><code>http</code></td>
</tr>

{{< /ngx-directive >}}


Specifies OTel data export parameters:


`
    endpoint [(http|https)://]host:port;`


OTLP/gRPC endpoint that will accept telemetry data.
TLS is supported since 0.1.2.


`
    trusted_certificate path;`


the CA certificates file in PEM format used to verify TLS endpoint
(since 0.1.2).
Defaults to OS provided CA bundle.


`header name value;`


a custom HTTP header to add to telemetry export request (since 0.1.2).


`interval time;`


the maximum interval between two exports,
by default is `5` seconds.


`batch_size number;`


the maximum number of spans to be sent in one batch per worker,
by default is `512`.


`batch_count number;`


the number of pending batches per worker,
spans exceeding the limit are dropped,
by default is `4`.




Example:

```nginx 
otel_exporter {
    endpoint https://otel-example.nginx.com:4317;

    header X-API-Token "my-token-value";
}
 ```

### otel_service_name

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_service_name</strong> <i>name</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>otel_service_name unknown_service:nginx;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code></td>
</tr>

{{< /ngx-directive >}}


Sets the
‚Äú[`service.name`](https://opentelemetry.io/docs/reference/specification/resource/semantic_conventions/#service)‚Äù
attribute of the OTel resource.
### otel_resource_attr

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_resource_attr</strong> <i>name</i> <i>value</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td>
      ‚Äî
    </td>
</tr><tr>
<th>Context: </th>
<td><code>http</code></td>
</tr>

{{< /ngx-directive >}}

_This directive appeared in version 0.1.2._


Sets a custom OTel resource attribute.
### otel_trace

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_trace</strong> <i>on</i> <i>|</i> <i>off</i> <i>|</i> <i>$variable</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>otel_trace off;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Enables or disables OpenTelemetry tracing.
The directive can also be enabled by specifying a variable:

```nginx 
split_clients "$otel_trace_id" $ratio_sampler {
              10%              on;
              *                off;
}

server {
    location / {
        otel_trace         $ratio_sampler;
        otel_trace_context inject;
        proxy_pass         http://backend;
    }
}
 ```

### otel_trace_context

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_trace_context</strong> <i>extract</i> <i>|</i> <i>inject</i> <i>|</i> <i>propagate</i> <i>|</i> <i>ignore</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>otel_trace_context ignore;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Specifies how to propagate
[traceparent/tracestate](https://www.w3.org/TR/trace-context/#design-overview) headers:


`extract`


uses an existing trace context from the request,
so that the identifiers of
a [var_otel_trace_id](#var_otel_trace_id) and
the [var_otel_parent_id](#var_otel_parent_id)
are inherited from the incoming request.


`inject`


adds a new context to the request, overwriting existing headers, if any.


`propagate`


updates the existing context
(combines [extract](#extract) and [inject](#inject)).


`ignore`


skips context headers processing.



### otel_span_name

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_span_name</strong> <i>name</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td>
      ‚Äî
    </td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Defines the name of the OTel
[span](https://opentelemetry.io/docs/concepts/observability-primer/#spans).
By default, it is a name of the location for a request.
The name can contain variables.
### otel_span_attr

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>otel_span_attr</strong> <i>name</i> <i>value</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td>
      ‚Äî
    </td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Adds a custom OTel span attribute.
The value can contain variables.
## Default span attributes


The following [span attributes](https://github.com/open-telemetry/opentelemetry-specification/blob/main/specification/trace/semantic_conventions/http.md)
are added automatically:


- `http.method`
- `http.target`
- `http.route`
- `http.scheme`
- `http.flavor`
- `http.user_agent`
- `http.request_content_length`
- `http.response_content_length`
- `http.status_code`
- `net.host.name`
- `net.host.port`
- `net.sock.peer.addr`
- `net.sock.peer.port`

## Embedded Variables



### `$otel_trace_id`


the identifier of the trace the current span belongs to,
for example, `56552bc4daa3bf39c08362527e1dd6c4`


### `$otel_span_id`


the identifier of the current span,
for example, `4c0b8531ec38ca59`


### `$otel_parent_id`


the identifier of the parent span,
for example, `dc94d281b0f884ea`


### `$otel_parent_sampled`


the ‚Äú`sampled`‚Äù flag of the parent span,
can be ‚Äú`1`‚Äù or ‚Äú`0`‚Äù



