---
title: ngx_http_userid_module
description: ngx_http_userid_module
toc: true
nd-org-source: http/ngx_http_userid_module.xml
nd-commercial: false
nd-commercial-partial: false
---


<!--
      ********************************************************************************
      üõë WARNING: AUTOGENERATED FILE - DO NOT EDIT üõë This Markdown file was
      automatically generated from the source XML documentation. Any manual
      changes made directly to this file will be overwritten. To request or
      suggest changes, please edit the source XML files instead.
      https://github.com/nginx/nginx.org/tree/main/xml/en
      ********************************************************************************
      -->


The `ngx_http_userid_module` module sets cookies
suitable for client identification.
Received and set cookies can be logged using the embedded variables
[var_uid_got](#var_uid_got) and
[var_uid_set](#var_uid_set).
This module is compatible with the
[mod_uid](http://www.lexa.ru/programs/mod-uid-eng.html)
module for Apache.
## Example Configuration


```nginx 
userid         on;
userid_name    uid;
userid_domain  example.com;
userid_path    /;
userid_expires 365d;
userid_p3p     'policyref="/w3c/p3p.xml", CP="CUR ADM OUR NOR STA NID"';
 ```

## Directives

### userid

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid</strong> <i>on</i> <i>|</i> <i>v1</i> <i>|</i> <i>log</i> <i>|</i> <i>off</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid off;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Enables or disables setting cookies and logging the received cookies:

`on`


enables the setting of version 2 cookies
and logging of the received cookies;


`v1`


enables the setting of version 1 cookies
and logging of the received cookies;


`log`


disables the setting of cookies,
but enables logging of the received cookies;


`off`


disables the setting of cookies and logging of the received cookies.



### userid_domain

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_domain</strong> <i>name</i> <i>|</i> <i>none</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_domain none;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Defines a domain for which the cookie is set.
The `none` parameter disables setting of a domain for the
cookie.
### userid_expires

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_expires</strong> <i>time</i> <i>|</i> <i>max</i> <i>|</i> <i>off</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_expires off;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Sets a time during which a browser should keep the cookie.
The parameter `max` will cause the cookie to expire on
‚Äú`31 Dec 2037 23:55:55 GMT`‚Äù.
The parameter `off` will cause the cookie to expire at
the end of a browser session.
### userid_flags

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_flags</strong> <i>off</i> <i>|</i> <i>flag</i> <i>...</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_flags off;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}

_This directive appeared in version 1.19.3._


If the parameter is not `off`,
defines one or more additional flags for the cookie:
`secure`,
`httponly`,
`samesite=strict`,
`samesite=lax`,
`samesite=none`.
### userid_mark

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_mark</strong> <i>letter</i> <i>|</i> <i>digit</i> <i>|</i> <i>=</i> <i>|</i> <i>off</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_mark off;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


If the parameter is not `off`, enables the cookie marking
mechanism and sets the character used as a mark.
This mechanism is used to add or change
[userid_p3p](#userid_p3p) and/or a cookie expiration time while
preserving the client identifier.
A mark can be any letter of the English alphabet (case-sensitive),
digit, or the ‚Äú`=`‚Äù character.

If the mark is set, it is compared with the first padding symbol
in the base64 representation of the client identifier passed in a cookie.
If they do not match, the cookie is resent with the specified mark,
expiration time, and `P3P` header.
### userid_name

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_name</strong> <i>name</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_name uid;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Sets the cookie name.
### userid_p3p

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_p3p</strong> <i>string</i> <i>|</i> <i>none</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_p3p none;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Sets a value for the `P3P` header field that will be
sent along with the cookie.
If the directive is set to the special value `none`,
the `P3P` header will not be sent in a response.
### userid_path

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_path</strong> <i>path</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_path /;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


Defines a path for which the cookie is set.
### userid_service

{{< ngx-directive >}}

<tr>
<th>Syntax: </th>
<td><code><strong>userid_service</strong> <i>number</i>;</code><br/></td>
</tr><tr>
<th>Default: </th>
<td><pre>userid_service IP address of the server;</pre></td>
</tr><tr>
<th>Context: </th>
<td><code>http</code>, <code>server</code>, <code>location</code></td>
</tr>

{{< /ngx-directive >}}


If identifiers are issued by multiple servers (services),
each service should be assigned its own `number`
to ensure that client identifiers are unique.
For version 1 cookies, the default value is zero.
For version 2 cookies, the default value is the number composed from the last
four octets of the server‚Äôs IP address.
## Embedded Variables


The `ngx_http_userid_module` module
supports the following embedded variables:


### `$uid_got`


The cookie name and received client identifier.



### `$uid_reset`


If the variable is set to a non-empty string that is not ‚Äú`0`‚Äù,
the client identifiers are reset.
The special value ‚Äú`log`‚Äù additionally leads to the output of
messages about the reset identifiers to the
[error_log]({{< relref "../ngx_core_module#error_log" >}}).



### `$uid_set`


The cookie name and sent client identifier.



